<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="iso-5981">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="assets/ico/favicon.png">

    <title>LINK - Agency Theme</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/css/main.css" rel="stylesheet">

    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/icomoon.css" rel="stylesheet" >

    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,700' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
    <script src="assets/js/modernizr.custom.js"></script>
    
  </head>

<body id="story-board"  >

	<div id="story" style="height:100%;overflow:auto;">

	<!-- Menu -->
	<nav class="menu" id="theMenu">
		<div style="margin-right:190px;margin-top:8px;" >
		  <a data-toggle="modal" href="./about.html" data-target="#modal-dialog-1" class="smoothScroll">
			  <button type="button" class="navbar-toggle low tip" data-tip="informazioni ed aiuto" >
				   <span class="icon icon-info2" style="font-size:30px; color:#dddddd;"></span>
			  </button>
		  </a>
		</div>

	</nav>

	<!-- MAIN IMAGE SECTION -->
	<div id="xheaderwrap">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2">
					<!--
					<div>
						<p>Please select a <a href="#" title="map file generated by iXmaps">.svgz</a> from your drive</p>
						<input id=fileInput type=file name=files[] multiple /><br>
						<input type="text" id="fileName" style="width:450px"></input>&nbsp;<input id="loadFile" type="button"  value="Load" style="vertical-align:top;"/>
						<hr />
					</div>
					-->
				</div>
			</div><!-- row -->
		</div><!-- /container -->
	</div><!-- /headerwrap -->

		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2">
					<h3>Legenda</h3>

					<div id="legendDiv">
					</div>

				</div>
			</div><!-- row -->
		</div><!-- /container -->


		<!-- ==== MODAL DIALOG ==== -->
		<div id="modal-dialog-1" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="background:white;color:black;z-index:9999">
		  <div class="modal-dialog modal-lg">
			  <div class="modal-content">
				...
			  </div>
			  <div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			  </div>
		  </div>
		</div>
		<div id="modal-dialog-2" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="background:black;z-index:9999">
		  <div class="modal-dialog modal-lg">
			  <div class="modal-content" style="color:#444">
				...
			  </div>
			  <div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			  </div>
		  </div>
		</div>

	</div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>

	<link rel="stylesheet" type="text/css" href="libs/tipr/tipr.css" />
	<script type="text/javascript" src="libs/tipr/tipr.js"></script>

	<!-- ixmaps iframe connect JavaScript
    ================================================== -->
	<script type="text/javascript">
		var ixmaps = null;
		if ( window.opener ){
			ixmaps = window.opener.ixmaps;
		}else
		if ( parent ){
			ixmaps = parent.window.ixmaps;
		}
		else{
			alert("error: missing parent window for themes !");
		}

		/**
		 * isAPIAvailable  
		 * checks the browser support for the HTML5 File API
		 * displays a warning if the browser doesn't support it
		 * @type boolean
		 * @return true,false
		 */
		function isAPIAvailable() {
			// Check for the various File API support.
			if (window.File && window.FileReader && window.FileList && window.Blob) {
				  // Great success! All the File APIs are supported.
				  return true;
			} else {
				  alert("The browser you're using does not currently support\nthe HTML5 File API. As a result the file loading demo\nwon't work properly.");
				  return false;
			}
		}
		/**
		 * handleFileSelect  
		 * parses the textfield input into the map data source
		 * @param evt the evemt handle
		 * @type void
		 */
		function handleFileSelect(evt) {
			var files = evt.target.files; // FileList object
			for(var i=0, len=files.length; i<len; i++) {
				doFile(files[i], i);
			}
		}
		/**
		 * doFile  
		 * reads the file and
		 * parses the data into the map data source
		 * @param file filename
		 * @param i filenumber
		 * @type void
		 */
		 var actFile = null;
		function doFile(file, i) {
			$("#fileName").val(file.name);
			actFile = file;
			__loadMap(file.name);
		}

		/**
		 * doLoadFile  
		 * reads a file via FileReader HTML5 
		 * parses the data into the map data source
		 * @type void
		 */
		function doLoadFile() {
			var reader = new FileReader();
			reader.readAsText(actFile);
			reader.onload = function(event){
			  var csv = event.target.result;
			  if ( !processCSVData(csv,actFile.name) ){
				alert('Unable to read ' + actFile.name );
			  }
			};
		reader.onerror = function(){ alert('Unable to read ' + actFile.name); };
		}
		
		/**
		 * __inFilter  
		 * check if sublayer is filtered 
		 * @param layer the layer object
		 * @param c the sublayer name
 		 * @type boiolean
		 * @return true if sublayer is in filter value
		 */
		__inFilter = function(layer,c){
			var filterA = layer.szFilterValue.split("|");
			for ( i in filterA ){
				if ( filterA[i] == c ){
					return true;
				}
			}
			return false;
		}

		/**
		 * __makeLegendType  
		 * make a part of the layer legend 
		 * generates the legend elements of one layer with the given type (polygon,polyline,point,..) 
		 * the layer may have sublayer
		 * @param layer the layer object
		 * @param name the layer name
		 * @param type the type of the layer (polygon,polyline,point,..)
 		 * @type string
		 * @return the legend element (HTML)
		 */
		__makeLegendType = function(layer,name,type){

			var szLegend = "";

			if ( layer.categoryA && (layer.szType == type) ){

				var sub = false;
				for ( c in layer.categoryA ){
					if ( c && (layer.categoryA[c].type != "single") && (layer.categoryA[c].legendname) ){
						sub = true;
					}
				}
				
				if ( sub ){
					szLegend += "<li style='margin-top:0.5em;'>";
					szLegend += '<input type="checkbox" class="check" checked="checked" onchange="javascript:ixmaps.__switchMasterLayer($(this),\''+name+'\');">';
					szLegend += '<span>&nbsp;'+layer.szLegendName+'</span>';
				}	

				szLegend += sub?"<ul style='margin-bottom:0.5em;'>":"<ul>";

				var szChecked = (layer.szDisplay == "none")?"":"checked=\"checked\"";

				switch( layer.szType ){
					case "point":
						for ( c in layer.categoryA ){  
							if ( layer.szFilter && layer.szFilterValue && !__inFilter(layer,c) ){
								continue;
							}
							var szCatogoryName = layer.categoryA[c].legendname || layer.szLegendName;
							szCatogoryName = (c && (szCatogoryName!="(null)"))?szCatogoryName:layer.szLegendName;
							szLegend += "<li>";
							szLegend += '<input type="checkbox" class="check sub_check" '+szChecked+' style="margin:0 0.2em 0 0.2em" onchange="javascript:ixmaps.__switchLayer($(this),\''+name+((c&&(layer.categoryA[c].legendname))?('::'+c):'')+'\');">&nbsp;';
							szLegend += "<span style='vertical-align:-0.1em;font-size:1.5em;line-height:0.8em;color:"+layer.categoryA[c].fill+"'>&#8226;</span>&nbsp;&nbsp;"+szCatogoryName+"</li>";
						}
						break;
					case "line":
						for ( c in layer.categoryA ){
							if ( layer.szFilter && layer.szFilterValue && !__inFilter(layer,c) ){
								continue;
							}
							var szCatogoryName = layer.categoryA[c].legendname || layer.szLegendName;
							szCatogoryName = (c && (szCatogoryName!="(null)"))?szCatogoryName:layer.szLegendName;
							szLegend += "<li>";
							szLegend += '<input type="checkbox" class="check sub_check" '+szChecked+' style="margin:0 0.2em 0 0.2em" onchange="javascript:ixmaps.__switchLayer($(this),\''+name+((c&&(layer.categoryA[c].legendname))?('::'+c):'')+'\');">&nbsp;';
							szLegend += "<span style='vertical-align:1.1em;font-size:0.2em;background:"+layer.categoryA[c].fill+"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;"+szCatogoryName+"</li>";
						}
						break;
					case "polygon":
						for ( c in layer.categoryA ){
							if ( c && c != "null" && layer.szFilter && layer.szFilterValue && !__inFilter(layer,c) ){
								continue;
							}
							var szCatogoryName = layer.categoryA[c].legendname || layer.szLegendName;
							szCatogoryName = (c && (szCatogoryName!="(null)"))?szCatogoryName:layer.szLegendName;
							szLegend += "<li>";
							szLegend += '<input type="checkbox" class="check sub_check" '+szChecked+' style="margin:0 0.2em 0 0.2em" onchange="javascript:ixmaps.__switchLayer($(this),\''+name+((c&&(layer.categoryA[c].legendname))?('::'+c):'')+'\');">&nbsp;';
							szLegend += "<span style='font-size:0.8em;background:"+layer.categoryA[c].fill+"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;"+szCatogoryName+"</li>";
						}
						break;
				}
				szLegend += "</ul>";

				if ( sub ){
					szLegend += "</li>";
				}	

			}else
			if ( layer.szType == type ){

				szLegend += "<li style='margin-top:0.5em;'>";
				szLegend += '<input type="checkbox" class="check" checked="checked" onchange="javascript:ixmaps.__switchLayer($(this),\''+name+'\');">';
				szLegend += '<span>&nbsp;'+name+'</span>';
				szLegend += "</li>";
			}
		return szLegend;
		};

		/**
		 * ixmaps.__switchLayer  
		 * switch one layer/sublayer on/off dependent of the checked value  
		 * @param el the caller (HTML) element 
		 * @param szLayer the layer name
 		 * @type void
		 */
		ixmaps.__switchLayer = function(el,szLayer){
			ixmaps.switchLayer(szLayer,$(el).is(":checked"));
		}
		
		/**
		 * ixmaps.__switchMasterLayer  
		 * switch all sublayer of a master layer on/off dependent of the checked value 
		 * to switch, trigger the legend checkboxes of the sublayer
		 * @param el the caller (HTML) element 
		 * @param szLayer the layer name
 		 * @type void
		 */
		ixmaps.__switchMasterLayer = function(el,szLayer){
			var subLayerList = $($(el)[0].parentNode).find('input.sub_check');
			for ( var i=0; i<subLayerList.length; i++ ){
				$(subLayerList[i]).prop('checked',$(el).is(":checked"));
				$(subLayerList[i]).trigger('change');
			}
		}

		// ------------------------------
		// if map ready, make first theme
		// ------------------------------

		ixmaps.waitForMap("map",function(){

			var layerA = ixmaps.getLayer();
			var szLegend = "";
			szLegend += "<ul>";

			for ( a in layerA ){
				szLegend += __makeLegendType(layerA[a],a,"polygon");
			}
			szLegend += "<div style='height:0.7em;'></div>";
			for ( a in layerA ){
				szLegend += __makeLegendType(layerA[a],a,"line");
			}
			szLegend += "<div style='height:0.7em;'></div>";
			for ( a in layerA ){
				szLegend += __makeLegendType(layerA[a],a,"point");
			}

			szLegend += "</ul>";

			szLegend += "<br>";

			$("#legendDiv").html(szLegend);				
		});

		
		if(isAPIAvailable()) {
			$('#fileInput').bind('change', handleFileSelect);
		}

		/**
		 * __loadMap  
		 * load new map 
		 * @param szNewMap the URL of the (SVG) map to be loaded 
		 * @param callback a function to be called on success 
 		 * @type void
		 */
		__loadMap = function(szNewMap,callback){
			// GR 29.12.2013 important! if not, we have more than one SVG document! see export (below)
			ixmaps.embeddedSVG = null;

			ixmaps.loadMap(null,szNewMap);
		}

		ixmaps.htmlgui_onZoomAndPan = function(nZoom){
			var layerA = ixmaps.getLayer();
			var depA = ixmaps.getLayerDependency();
			console.log("--> htmlgui_onZoomAndPan("+(1/nZoom)+")");
		};
		ixmaps.htmlgui_setScaleSelect = function(scale){
			console.log("--> htmlgui_setScaleSelect(1:"+(scale)+")");
		}


	</script>



  </body>
</html>
