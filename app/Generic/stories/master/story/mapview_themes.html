<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="iso-5981">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="assets/ico/favicon.png">

    <title>LINK - Agency Theme</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/css/main.css" rel="stylesheet">

    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/icomoon.css" rel="stylesheet" >

    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,700' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
    <script src="assets/js/modernizr.custom.js"></script>
    
  </head>

  <body>

	<!-- Menu -->
	<nav class="menu" id="theMenu">
		<div style="margin-right:178px;margin-top:38px;" >
		  <a data-toggle="modal" href="./about.html" data-target="#modal-dialog" class="smoothScroll">
			  <button type="button" class="navbar-toggle low tip" data-tip="informazioni ed aiuto" >
				   <span class="icon icon-info2" style="font-size:30px; color:#dddddd;"></span>
			  </button>
		  </a>
		</div>

	</nav>

	<!-- MAIN IMAGE SECTION -->
	<div id="xheaderwrap">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2">
					<h1>Map Viewer</h1>
					<p>Generic iXmaps map viewer<p>
					<!--
					<div>
						<p>Please select a <a href="#" title="map file generated by iXmaps">.svgz</a> from your drive</p>
						<input id=fileInput type=file name=files[] multiple /><br>
						<input type="text" id="fileName" style="width:450px"></input>&nbsp;<input id="loadFile" type="button"  value="Load" style="vertical-align:top;"/>
						<hr />
					</div>
					-->
				</div>
			</div><!-- row -->
		</div><!-- /container -->
	</div><!-- /headerwrap -->

		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2">
					<h3>Legend</h3>

					<div id="legendDiv">
					</div>

				</div>
			</div><!-- row -->
		</div><!-- /container -->

		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2">
					<h3>Theme Legend</h3>

					<div id="themeLegendDiv">
					</div>

				</div>
			</div><!-- row -->
		</div><!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/main.js"></script>
	<script src="assets/js/masonry.pkgd.min.js"></script>
	<script src="assets/js/imagesloaded.js"></script>
    <script src="assets/js/classie.js"></script>

	<link rel="stylesheet" type="text/css" href="libs/tipr/tipr.css" />
	<script type="text/javascript" src="libs/tipr/tipr.js"></script>

	<!-- ixmaps iframe connect JavaScript
    ================================================== -->
	<script type="text/javascript">
		var ixmaps = null;
		if ( window.opener ){
			ixmaps = window.opener.ixmaps;
		}else
		if ( parent ){
			ixmaps = parent.window.ixmaps;
		}
		else{
			alert("error: missing parent window for themes !");
		}

		/**
		 * isAPIAvailable  
		 * checks the browser support for the HTML5 File API
		 * displays a warning if the browser doesn't support it
		 * @type boolean
		 * @return true,false
		 */
		function isAPIAvailable() {
			// Check for the various File API support.
			if (window.File && window.FileReader && window.FileList && window.Blob) {
				  // Great success! All the File APIs are supported.
				  return true;
			} else {
				  alert("The browser you're using does not currently support\nthe HTML5 File API. As a result the file loading demo\nwon't work properly.");
				  return false;
			}
		}
		/**
		 * handleFileSelect  
		 * parses the textfield input into the map data source
		 * @param evt the evemt handle
		 * @type void
		 */
		function handleFileSelect(evt) {
			var files = evt.target.files; // FileList object
			for(var i=0, len=files.length; i<len; i++) {
				doFile(files[i], i);
			}
		}
		/**
		 * doFile  
		 * reads the file and
		 * parses the data into the map data source
		 * @param file filename
		 * @param i filenumber
		 * @type void
		 */
		 var actFile = null;
		function doFile(file, i) {
			$("#fileName").val(file.name);
			actFile = file;
			console.log(file);
			__loadMap(file.name);
		}
		/**
		 * doFile  
		 * reads the file and
		 * parses the data into the map data source
		 * @param file filename
		 * @param i filenumber
		 * @type void
		 */
		function doLoadFile() {
			var reader = new FileReader();
			reader.readAsText(actFile);
			reader.onload = function(event){
			  var csv = event.target.result;
			  if ( !processCSVData(csv,actFile.name) ){
				alert('Unable to read ' + actFile.name );
			  }
			};
		reader.onerror = function(){ alert('Unable to read ' + actFile.name); };
		}
		
		__makeLegendType = function(layer,name,type){

			var szLegend = "";

			if ( layer.categoryA && (layer.szType == type) ){

				var sub = false;
				for ( c in layer.categoryA ){
					if ( layer.categoryA[c].legendname && layer.categoryA[c].legendname != "(null)" ){
						sub = true;	
					}
				}
				
				if ( sub ){
					szLegend += "<li style='margin-top:0.5em;'>"+a+"</li>";
				}	

				szLegend += sub?"<ul style='margin-bottom:0.5em;'>":"<ul>";

				switch( layer.szType ){
					case "point":
						for ( c in layer.categoryA ){
							var szCatogoryName = layer.categoryA[c].legendname;
							szCatogoryName = (szCatogoryName!="(null)")?szCatogoryName:name;
							szLegend += "<li>"+"<span style='vertical-align:-0.1em;font-size:1.5em;line-height:0.8em;color:"+layer.categoryA[c].fill+"'>&#8226;</span>&nbsp;&nbsp;"+szCatogoryName+"</li>";
						}
						break;
					case "line":
						for ( c in layer.categoryA ){
							var szCatogoryName = layer.categoryA[c].legendname;
							szCatogoryName = (szCatogoryName!="(null)")?szCatogoryName:name;
							szLegend += "<li>"+"<span style='vertical-align:1.1em;font-size:0.2em;background:"+layer.categoryA[c].fill+"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;"+szCatogoryName+"</li>";
						}
						break;
					case "polygon":
						for ( c in layer.categoryA ){
							var szCatogoryName = layer.categoryA[c].legendname;
							szCatogoryName = (szCatogoryName!="(null)")?szCatogoryName:name;
							szLegend += "<li>"+"<span style='font-size:0.8em;background:"+layer.categoryA[c].fill+"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;"+szCatogoryName+"</li>";
						}
						break;
				}
			szLegend += "</ul>";
			}
		return szLegend;
		};



		// ------------------------------
		// if map ready, make first theme
		// ------------------------------
		ixmaps.onMapReady = function(){
			var layerA = ixmaps.getLayer();
			var szLegend = "";
			szLegend += "<ul>";

			for ( a in layerA ){
				szLegend += __makeLegendType(layerA[a],a,"polygon");
			}
			szLegend += "<div style='height:0.7em;'></div>";
			for ( a in layerA ){
				szLegend += __makeLegendType(layerA[a],a,"line");
			}
			szLegend += "<div style='height:0.7em;'></div>";
			for ( a in layerA ){
				szLegend += __makeLegendType(layerA[a],a,"point");
			}

			szLegend += "</ul>";

			szLegend += "<br>";

			$("#legendDiv").html(szLegend);				
		};

		// intercept theme creation, to mark active themes
		ixmaps.htmlgui_onDrawTheme = function(szId){ 

			var themeObj = ixmaps.getThemeObj(szId);
			var colorA  = themeObj.colorScheme;
			var labelA  = themeObj.szLabelA;
			console.log(themeObj);
			if ( !labelA ){
				labelA = new Array();
				var szUnit = themeObj.szUnit || "";
				for ( var i=0; i<colorA.length; i++){
					var szPart = parseFloat(themeObj.partsA[i].min).toFixed(2)+szUnit+" ... "+parseFloat(themeObj.partsA[i].max).toFixed(2)+szUnit;
					labelA.push(szPart);
				}
			}
			szHtml = "";
			szHtml += themeObj.szTitle;
			szHtml += "<table style='font-size:0.8em;line-height:1.1em;'>";
			var max = Math.min(200,colorA.length);
			// get exact count from themeObj
			var count = "";
			for ( var i=0; i<max; i++){
				count = themeObj.exactCountA[i]?"("+themeObj.exactCountA[i]+")":"";
				szHtml += "<tr valign='top'><td><span onclick='javascript:ixmaps.hideThemeClass(\""+szId+"\","+i+")' onmouseover='javascript:ixmaps.markThemeClass(\""+szId+"\","+i+")' onmouseout='javascript:ixmaps.unmarkThemeClass(\""+szId+"\","+i+")' style='background:"+colorA[i]+";font-size:0.7em;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td><td><span>"+labelA[i]+"</span></td><td>"+count+"</td></tr>";
			}
			szHtml += "</table>";

			szHtml += "<p class='footnote'><em>Tip:</em> sposta il mouse sopra il colore per vedere solo questa classe</p>"; 

			var szFilter = "";
			szHtml += "filtro: <form "
					  +"style=\"display:inline-block;left:0px;height:26px;margin-right:10px;border:1px solid #ddd;background:#fff;\" "
					  +"name=\"FilterForm\">" 
							+"<input class=\"ifield\" id=\"query\" type=\"text\" size=\"9\" "
								+"value=\""+ szFilter +"\" "
								+"style=\"width:150px;height:22px;position:relative;top:0px;border:none;\" title=\"query map items\" " 
								+"onkeyup=\"javascript:var value = $(this).val();ixmaps.filterThemeItems('"+szId+"',value);\">"
							+"</input>"
					  +"</form>"
					  +"<span><a href=\"javascript:ixmaps.selectFilterItems('"+szId+"');\" >sommare questo"
					  +"</a></span>";
			szHtml += "<p class='footnote'>definisce un filtro applicato a tutti dati.</p>"; 

			szHtml += "<p class='footnote'>filtri prefigurati:";	
			szHtml += "<a href=\"javascript:$('#query').val('comuni');ixmaps.filterThemeItems('"+szId+"','comuni');\">comuni</a> | ";
			szHtml += "<a href=\"javascript:$('#query').val('provinciali');ixmaps.filterThemeItems('"+szId+"','provinciali');\">provinciali</a> | ";
			szHtml += "<a href=\"javascript:$('#query').val('regionali');ixmaps.filterThemeItems('"+szId+"','regionali');\">regionali</a> | ";
			szHtml += "<a href=\"javascript:$('#query').val('');ixmaps.filterThemeItems('"+szId+"','');\">tutto</a>";
			szHtml += "</p>";
			szHtml += "<br>";

			$("#themeLegendDiv").html(szHtml);
		};

		// intercept theme deletion, to remove active themes mark
		ixmaps.htmlgui_onRemoveTheme = function(szId){
			if ( clickA[szId] ){
				__setThemeButtonStyle(clickA[szId],false);
				clickA[szId] = null;
				lastClicked  = null;
			}
			$("#themeLegendDiv").html("");
		};

		


















		if(isAPIAvailable()) {
			$('#fileInput').bind('change', handleFileSelect);
		}

		// switch off layer with states names
		ixmaps.switchLayer("province_2011",false);

		$('#topic-tipo').change(function (){ixmaps.changeTopic($(this))});
		$('#topic-dest').change(function (){ixmaps.changeTopic($(this))});
		$('#type_dominant').change(function (){ixmaps.changeParam($(this))});
		$('#type_deviant').change(function (){ixmaps.changeParam($(this))});
		$('#type_value').change(function (){ixmaps.changeParam($(this))});
		$('#type_plusminus').change(function (){ixmaps.changeParam($(this))});
		$('#type_deviation').change(function (){ixmaps.changeParam($(this))});
		$('#type_deviation2').change(function (){ixmaps.changeParam($(this))});
		$('#type_chart').change(function (){ixmaps.changeParam($(this))});
		$('#type_chart_percent').change(function (){ixmaps.changeParam($(this))});
		$('#type_bubble').change(function (){ixmaps.changeParam($(this))});
		$('#type_label').change(function (){ixmaps.changeParam($(this))});
		$('#type_chart_p').change(function (){ixmaps.changeParam($(this))});
		$('#type_bubble_1').change(function (){ixmaps.changeParam($(this))});
		$('#type_bubble_2').change(function (){ixmaps.changeParam($(this))});
		$('#type_bubble_3').change(function (){ixmaps.changeParam($(this))});
		$('#type_bar').change(function (){ixmaps.changeParam($(this))});
		$('#type_column').change(function (){ixmaps.changeParam($(this))});
		$('#type_label_p').change(function (){ixmaps.changeParam($(this))});


		$('.tip').tipr({'mode':'top'});

		$('[checked="checked"]').parent().addClass("active");
	
	
		__loadMap = function(szNewMap,callback){
			// GR 29.12.2013 important! if not, we have more than one SVG document! see export (below)
			ixmaps.embeddedSVG = null;

			ixmaps.loadMap(null,szNewMap);
		}

	</script>



  </body>
</html>
