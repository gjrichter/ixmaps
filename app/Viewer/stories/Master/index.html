<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>iXMaps Project Viewer</title>
	<meta name="author" content="ixmaps" />
	<meta name="description" content="ixmaps story" />
	<meta name="keywords"  content="ixmaps,corruption,map" />
	<meta name="Resource-type" content="Document" />


	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.9.0/css/bootstrap-slider.min.css" />

	<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="index.css" />
	<link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/icomoon.css" rel="stylesheet" />    
	<style>

	.story-body{
		background-color: rgba(255,255,255,0.75);
		border-radius: 1em;
		display: none;
	}
	.shareBtns a {
		color: #aaa;
	}
	a {
		color: #aaa;
		text-decoration: none;
	}
	a:hover {
		text-decoration: none;
	}
	.footer {
	}
	.footer p {
		background-color: rgba(235,235,235,0.7);
		padding: 0.8em;
	}
	.footer a {
		color: #428bca;
	}
	.inline-legend{
		background-color: rgba(239,235,239,0.7);
		background-color: rgba(255,255,255,0.7);

	}
	.title{
		font-size: 2.5em;
		background-color: rgba(255,255,255,0.5);
	}
	.inline-legend-tool-button{	
		color:#444444;
		xxbackground:#ffffff;
		padding:0.4em;
	}
	.navbar-pad-original {
		-moz-box-shadow: 0px 2px 10px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		-webkit-box-shadow: 0px 2px 10px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		box-shadow: 0px 2px 10px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		xxborder-bottom: solid #ddd 1px;
	}
	.nav-tabs {
		border-bottom: none;
	}
	.slider-handle {
		position: absolute;
		top: 0px;
		width: 20px;
		height: 20px;
		background-color: #ddd;
		background-image: none;
		filter: none;
		box-shadow: rgba(255, 255, 255, 0.2) 0px 1px 0px inset, rgba(0, 0, 0, 0.05) 0px 1px 2px;
		background-repeat: repeat-x;
		border-width: 0px;
		border-style: solid;
		border-color: transparent;
		border-image: initial;
	}
		
	.slidecontainer {
		width: 85%; /* Width of the outside container */
		position: absolute;
		left: 7em;
		bottom: 1.5em;
	}

	/* The slider itself */
	.slider {
		-webkit-appearance: none;  /* Override default CSS styles */
		appearance: none;
		width: 100%; /* Full-width */
		height: 25px; /* Specified height */
		background: #d3d3d3; /* Grey background */
		outline: none; /* Remove outline */
		opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
		-webkit-transition: .2s; /* 0.2 seconds transition on hover */
		transition: opacity .2s;
	}

	/* Mouse-over effects */
	.slider:hover {
		opacity: 1; /* Fully shown on mouse-over */
	}

	/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */ 
	.slider::-webkit-slider-thumb {
		-webkit-appearance: none; /* Override default look */
		appearance: none;
		width: 25px; /* Set a specific slider handle width */
		height: 25px; /* Slider handle height */
		background: #4CAF50; /* Green background */
		cursor: pointer; /* Cursor on hover */
	}

	.slider::-moz-range-thumb {
		width: 25px; /* Set a specific slider handle width */
		height: 25px; /* Slider handle height */
		background: #4CAF50; /* Green background */
		cursor: pointer; /* Cursor on hover */
	}
	.slider {
		-webkit-appearance: none;
		width: 99%;
		margin-left:0px;
		height: 5px;
		border-radius: 10px;   
		background: rgba(155,155,155,0.3);
		border: solid #888 0px;
		outline: none;
		opacity: 0.7;
		-webkit-transition: .2s;
		transition: opacity .2s;
	}

	.slider::-webkit-slider-thumb {
		-webkit-appearance: none;
		appearance: none;
		width: 14px;
		height: 14px;
		border-radius: 0.5em; 
		background: #4CAF50;
		cursor: pointer;
	}

	.slider::-moz-range-thumb {
		width: 25px;
		height: 25px;
		border-radius: 50%;
		background: #4CAF50;
		cursor: pointer;
	}
	#slider-text {
		color:white;
	}
		
	.facet a, .facet-active a {
		font-family: arial;
		color: black;
	}
	a.link {
		text-decoration: underline;
	}
	#loadProjectButton > a,#loadProjectHideButton > a{
		text-decoration: none;
	}

	body #importdiv{
		background:#fff;
		overflow:auto;
		padding: 1em;
	}
	.fileContainer {
		overflow: hidden;
		position: relative;
	}

	.fileContainer [type=file] {
		cursor: inherit;
		display: block;
		font-size: 999px;
		filter: alpha(opacity=0);
		min-height: 100%;
		min-width: 100%;
		opacity: 0;
		position: absolute;
		right: 0;
		text-align: right;
		top: 0;
	}

	/* Example stylistic flourishes */

	.fileContainer {
		font-weight: normal;
		color: black;
		background: white;
		border: #888 solid 0.5px;
		border-radius: .25em;
		float: left;
		padding: .5em;
	}

	.fileContainer [type=file] {
		cursor: pointer;
	}
	
	legend {
		border: 0;
		margin:0;
	}

	.nav-tabs>li.active>a, .nav-tabs>li.active>a:hover, .nav-tabs>li.active>a:focus {
		color: #555;
		background-color: white;
		border: 1px solid #ddd;
		border-bottom-color: transparent;
		cursor: default;
	}

	.nav-tabs>li>a, .nav-tabs>li>a:hover, .nav-tabs>li>a:focus {
		color: #555;
		background-color: #eee;
		border: 1px solid #ddd;
		border-bottom-color: transparent;
		cursor: default;
	}


	.fa {
		vertical-align:2px;
		margin-left:0.1em;
		font-size: 24px;
	}

	.checkbox {
	  padding-left: 0px;
	}

	.checkbox label:after {
	  content: '';
	  display: table;
	  clear: both;
	}

	.checkbox .cr {
	  position: relative;
	  display: inline-block;
	  border: 1px solid #a9a9a9;
	  border-radius: .25em;
	  width: 1.3em;
	  height: 1.3em;
	  float: left;
	  margin-right: .5em;
	}

	.checkbox .cr .cr-icon {
	  position: absolute;
	  font-size: .8em;
	  line-height: 0;
	  top: 50%;
	  left: 5%;
	}

	.checkbox label input[type="checkbox"] {
	  display: none;
	}

	.checkbox label input[type="checkbox"]+.cr>.cr-icon {
	  opacity: 0;
	}

	.checkbox label input[type="checkbox"]:checked+.cr>.cr-icon {
	  opacity: 1;
	}

	.checkbox label input[type="checkbox"]:disabled+.cr {
	  opacity: .5;
	}

	#tooltip {
		font-family: arial narrow,system; 
		background: white;
		border: 0.5px solid black;
		border-radius: 5px;
		padding: 5px;
		max-width: 80%;
	}
	</style>

</head>
<body class="story-body">

	<div id="header" class="navbar-fixed-top"  style="position:fixed;top:0;left:0;width:99%;height:40px;padding:0px 20px 50px 0px;background:#ffffff;z-index:9999" >
		<div style="margin:0.9em 0.9em" >
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2">
					<div class="header" aria-hidden="true">
						<div class="linkSocialContainer" style="float:left">
							<span class="linkContainer"></span>
							<span class="shareBtns" style="font-size:24px">
								<a href="javascript:ixmaps.popupShare()">
								<span class="fa fa-share fa-fw" title="share actual map" ></span></a>
								<a href="javascript:ixmaps.loadStoryTool('./filter.html',{frame:true})" >
								<i class="icon shareIcon blackHover share_bitly icon-filter" title="filter items" tabindex="-1" style="margin-left:0.2em" ></i></a>
								<a href="javascript:ixmaps.loadStoryTool('./layer.html')" >
								<i class="icon shareIcon blackHover share_bitly icon-map" title="select base map" tabindex="-1" style="margin-left:0.2em" ></i></a>
								<a href="javascript:__showAbout()" >
								<i class="icon shareIcon blackHover share_bitly icon-info" title="About" tabindex="-1" style="margin-left:0.2em" ></i></a>
								<a href="javascript:ixmaps.loadStoryTool('./menu.html')" >
								<span class="fa fa-columns fa-fw" title="layout menu"></span></a>
								<a href="javascript:ixmaps.loadStoryTool('./table.html',{frame:true})" >
								<i class="icon shareIcon blackHover share_bitly icon-table2" title="table view" tabindex="-1" style="margin-left:0.2em" ></i></a>
								<a href="javascript:ixmaps.loadStoryTool('./list.html',{frame:true})" >
								<i class="icon shareIcon blackHover share_bitly icon-insert-template" title="list view" tabindex="-1" style="font-size:0.95em;margin-left:0.2em" ></i></a>
							</span>
						</div>
						<div class="linkSocialContainer" style="float:right;margin-right:-1.5em;margin-top:0.2em;">
							<span class="linkContainer"></span>
							<span class="shareBtns" style="font-size:18px">
									<a href="javascript:ixmaps.fullScreen()">
								<i class="icon shareIcon blackHover share_bitly icon-cross" title="Info" tabindex="-1" style="margin-left:0.2em" ></i></a>
							</span>
						</div>
						<div class="logoContainer" style="float:right;margin-right:-10px;display:none">
							<table>
								<tr>
									<td class="logoWrapper">
										<a class="logoLink" target="_blank" tabindex="-1">
											<img class="logoImg" src="" height="60px" style="opacity:0.8"/>
										</a>
									</td>
								</tr>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>	

		<div id="section1" style="margin:0;padding:1em 2em 0em 1em" >
			<div style="margin-top:3em">
				<div >
					<form id="upload" action="index.html" method="POST" enctype="multipart/form-data">
					<fieldset>
						<legend id="legend">iXMaps Project Viewer
							<span id="loadProjectButton" style="display:none"> 
								<a href="javascript:$('#loadProject').show();$('#loadProjectButton').hide();$('#loadProjectHideButton').show()" title="load project">[+]</a></span>
							<span id="loadProjectHideButton" style="display:none"> 
								<a href="javascript:$('#loadProject').hide();$('#loadProjectButton').show();$('#loadProjectHideButton').hide()" title="load project">[-]</a></span>
							<span id="saveProjectButton" style="display:none"> 
								<a href="javascript:ixmaps.popupProject()" title="save project">[->]</a></span>
						</legend>
						<input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000" />
						<div id="loadProject" style="margin-top:0.5em;background:rgba(0,0,0,0.1);display:none;">
							<input type="file" id="fileselect" name="fileselect[]" multiple="multiple" style="display:none"/>
							<div id="filedrag" style="clear:both;height:10em;width:100%;border:dashed #dddddd 2px;">drop files here</div>
							<label class="fileContainer" for="fileselect" style="position:relative;top:-6em;left:30%">or select project</label>
						</div>

					</fieldset>

					</form>
				</div>
				<div id="messages">
				</div>				

			</div>

		</div>
		<div id="section2" >
			<div style="margin-top:1em">

				<div id="legendTabs" style="display:none">
					<ul id="legendTabsList" class="nav nav-tabs" >
						<li id="lastLegendTab" ><a href="#" onclick="activateTab($(this))">Map</a></li>
					</ul>
				</div>

				<div id='themeLegendDiv' style="margin-top:-2.5em;clear:both;display:none"></div>

				<div id='map-legend' class='inline-legend' style="clear:both;display:none;font-size:1em"></div>

			</div>

		</div>


	</div>


	<!-- ==== MODAL DIALOG ==== -->
	<div id="modal-dialog-1" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="z-index:9999">
	  <div class="modal-dialog modal-lg">
		  <div class="modal-content">
			...
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		  </div>
	  </div>
	</div>
	<div id="modal-dialog-2" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="z-index:9999">
	  <div class="modal-dialog modal-lg">
		  <div class="modal-content">
			...
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		  </div>
	  </div>
	</div>
	<div id="modal-dialog-3" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="white;z-index:9999">
	  <div class="modal-dialog modal-lg">
		  <div class="modal-content">
			...
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		  </div>
	  </div>
	</div>

	<div id="tooltip" style="position: absolute; display: none;"></div>

	<!--[if IE]>
		<script type="text/javascript">
			 var console = { log: function() {} };
		</script>
	<![endif]-->

 	<script type="text/javascript" src="../../../../ui/libs/jquery/jquery-1.7.1.min.js"></script>

	<script type="text/javascript">
		
		__showAbout = function(){
			ixmaps.showAbout();
			ixmaps.loadStoryTool('./about_en-EN.html');
            try	{
			     ixmaps.loadStoryTool('./about_'+window.navigator.language+'.html');
            }
            catch (e){}
		}

		// ===========================================
		//
		// !! get ixmaps api from story parent/opener
		//
		// ===========================================

		var ixmaps = null;
		if ( window.opener ){
			ixmaps = window.opener.ixmaps;
		}else
		if ( parent ){
			ixmaps = parent.window.ixmaps;
		}
		else{
			alert("error: missing parent window for themes !");
		}

		ixmaps.initialized = true;

		$(document).ready(function() {

            
			// -----------------------------------------------
			// load themes script
			// and initialize map if all loaded
			// -----------------------------------------------

			$.when(
				$.getScript( "./index.js" ),
				$.getScript( "./inline_legend.js" ),
				$.getScript("../../../../ui/js/tools/layer_legend.js"),
				$.Deferred(function( deferred ){
					$( deferred.resolve );
				})
			).done(function(){
				
                // detect project or bookmark to execute
                //
                var szProject = ixmaps.parentApi.project || 
								ixmaps.parentApi.parentApi.project || 
								null;
				
                var szBookmark = ixmaps.parentApi.bookmark ||
								 ixmaps.parentApi.embeddedApi.bookmark ||
					             ixmaps.parentApi.embeddedApi.embeddedApi.bookmark ||
					             null;

				// show or hide project selection 
                //
                if ( szProject || szBookmark ) {
                    $("#loadProject").hide();
                    $("#legend").hide();
                    $("#loadProjectButton").show();
                }else{
                    $("#loadProject").fadeIn("slow");
                }

                // adapt iframe height in parent
				// ----------------------------------------------------------------------
				ixmaps.resizeStoryFrame = function() {
					// give time to render
					setTimeout('ixmaps.doresizeStoryFrame()',1);
				}
				ixmaps.doresizeStoryFrame = function() {
					var the_height = window.parent.window.document.getElementById('embed-story').contentWindow.document.body.scrollHeight + 5;
					if ( the_height > 100 ){
						//the_height = Math.min(the_height,630);
						//the_height -= 20;
						window.parent.window.document.getElementById('story-board').style.height= the_height+"px";
						// set border radius !!
						window.parent.window.document.getElementById('story-board').style["border-radius"] = "0.5em";
						window.parent.window.document.getElementById('story-board').style["border"] = "solid #888 0px";
					}
				};

				ixmaps.legend.maxwidth = window.innerWidth * 0.85;

				ixmaps.htmlgui_setMapTypeBG(ixmaps.getMapTypeId());
				/*
				 * listen on Zoom and Pan  
				 * to make the map layer legend 
				 */
				ixmaps.htmlgui_onZoomAndPan = function(nZoom){
					
                    if(ixmaps.embeddedApi.loadedProject){
					   setTimeout("ixmaps.viewer_makeLayerLegend()",1);
                    }
					ixmaps.resizeStoryFrame();
				};
                
				ixmaps.htmlgui_onProjectLoaded = function(loadedProject){

					if (loadedProject.map.legend){
                        ixmaps.loadExternalLegend(loadedProject.map.legend);                       
                    } else
                    if (loadedProject.map.info){
                        setTimeout("ixmaps.loadExternalLegend('"+loadedProject.map.info+"')",100);
                    } 
                 }

                // GR 09.01.2019 trigger change on story (body) to adapt iframe height in parent
				// ----------------------------------------------------------------------
				var myElement = $("body")[0];
				if(window.addEventListener) {
					// Normal browsers
					myElement.addEventListener('DOMSubtreeModified', ixmaps.resizeStoryFrame, false);
				} else
				if(window.attachEvent) {
					// IE
					myElement.attachEvent('DOMSubtreeModified', ixmaps.resizeStoryFrame);
				}

				$(".story-body").show();
                
  				// execute project, if defined in URL (?project=...)
				// ----------------------------------------------------------------------
                if ( szProject ){
					ixmaps.loadProject("map",szProject);
				}

  				// execute bookmark, if defined in URL 
				// ----------------------------------------------------------------------
                if ( szBookmark ){
  					ixmaps.execBookmark('map',szBookmark,false);
				}

			}).fail(function(){
				alert("script loading "+arguments[2].toString());
			});

		});

		// ------------------------------
		// page handling
		// ------------------------------
		
		ixmaps.oldNavbarStyle = [];
		
		$( window ).resize(function() {
			// refresh scrollspy !!!
			$('[data-spy="scroll"]').each(function () {  
			  var $spy = $(this).scrollspy('refresh')  
			}); 
			$('.fp-controlArrowUpDown').css("left",(window.innerWidth/2-25)+"px");
			//$('body').css("font-size",window.innerWidth/33+"px");
			
			if ( ixmaps.oldNavbarStyle[0] ){
				parent.$("#story-tool").attr("style",ixmaps.oldNavbarStyle.pop());
				$("#section2").attr("style",ixmaps.oldNavbarStyle.pop());
				$(".navbar-fixed-top").attr("style",ixmaps.oldNavbarStyle.pop());
				ixmaps.oldNavbarStyle = [];
			}
			
			if( ixmaps.layout == "vertical" ){
				
				ixmaps.oldNavbarStyle.push($(".navbar-fixed-top").attr("style")||"");
				ixmaps.oldNavbarStyle.push($("#section2").attr("style")||"");
				ixmaps.oldNavbarStyle.push(parent.$("#story-tool").attr("style")||"");
				
				$(".navbar-fixed-top").css("width","50px");
				$(".navbar-fixed-top").css("height","400px");
				$(".navbar-fixed-top").css("left","-5px");
				$(".navbar-fixed-top").css("top","10px");
				
				$("#section2").css("margin-top","-4.2em");
				$("#section2").css("margin-left","6em");
				parent.$("#story-tool").css("margin","-2.5em 0 0 4em");
			}
			else
			if( ixmaps.layout == "minimal" ){
				
				ixmaps.oldNavbarStyle.push($(".navbar-fixed-top").attr("style")||"");
				ixmaps.oldNavbarStyle.push($("#section2").attr("style")||"");
				ixmaps.oldNavbarStyle.push(parent.$("#story-tool").attr("style")||"");
				
				$("#section2").css("margin-top","-5em");
				$(".navbar-fixed-top").css("display","none");
				
				if ( !$("#switchToInline")[0] ){
					$("#legendTabs").append("<div id='switchToInline' style='position:absolute;top:0.8em;right:0.3em;font-size:0.8em;'><a href='javascript:ixmaps.setLayout(\"overlay\")' ><span class='fa fa-ellipsis-v fa-fw' style='color:rgba(120,120,120,0.5);font-size:24px;' title='layout menu'></span></a></div>");
					$("#legendTabs").append("<div id='switchToInline' style='position:absolute;top:0.8em;right:2.3em;font-size:0.8em;'><a href='javascript:__showAbout()' ><span class='fa fa-info fa-fw' style='color:rgba(120,120,120,0.5);font-size:24px;' title='layout menu'></span></a></div>");

				}
			}
			
			ixmaps.redrawLegend();
			ixmaps.resizeStoryFrame();
			
		});

		var isTouch = (('ontouchstart' in window) || (navigator.msMaxTouchPoints > 0));
		if (isTouch){
			$("::-webkit-scrollbar").css("display","none"); 
		}

		$('#fullpage').fadeIn( "slow");

		ixmaps.htmlgui_onItemClick = function(szId){
			
			var szItemUrl = "./item.html";
			if ( ixmaps.loadedProject.map.item && (ixmaps.loadedProject.map.item != "html") )  {
				szItemUrl = ixmaps.loadedProject.map.item; 
			}
			
			if(szId.match(/theme/)){
				var data = ixmaps.getData('map',szId);
				var szTitle = data?data.title:"";
				ixmaps.szMapItemId = szId;
				ixmaps.loadStoryTool(szItemUrl,{frame:true});
				return true;
			}
			else{
				if ( szId.match(/mapbackground/) ){
					ixmaps.hideStoryTool();
					return false;
				}
				ixmaps.szMapItemId = szId;
				ixmaps.loadStoryTool(szItemUrl,{frame:true});
				//ixmaps.embeddedSVG.window.map.Api.highlightItem(szId);
				return true;
			}
			return true;
		};
		
		ixmaps.htmlgui_onSelection = function(szId){
			var szItemUrl = "./selection.html";
			if ( ixmaps.loadedProject.map.selection && (ixmaps.loadedProject.map.selection != "html") )  {
				szItemUrl = ixmaps.loadedProject.map.selection; 
			}
			
			if(szId.match(/theme/)){
				var data = ixmaps.getData('map',szId);
				var szTitle = data?data.title:"";
				ixmaps.szMapItemId = szId;
				ixmaps.loadStoryTool(szItemUrl,{frame:true});
				return true;
			}
			else{
				if ( szId.match(/mapbackground/) ){
					ixmaps.hideStoryTool();
					return false;
				}
				ixmaps.szMapItemId = szId;
				ixmaps.loadStoryTool(szItemUrl,{frame:true});
				//ixmaps.embeddedSVG.window.map.Api.highlightItem(szId);
				return true;
			}
			return false;
		}

	</script>


	<script src="filedrag.js"></script>

</body>
</html>
