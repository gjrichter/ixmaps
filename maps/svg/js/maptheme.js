var themeStyleTranslateA=[{style:"opacity",obj:"nOpacity"},{style:"fillopacity",obj:"fillOpacity"},{style:"autoopacity",obj:"autoOpacity"},{style:"shadow",obj:"fOrigShadow"},{style:"blur",obj:"nBlur"},{style:"filter",obj:"szFilter"},{style:"dfilter",obj:"nDeltaFilter"},{style:"filterfield",obj:"szFilterField"},{style:"dbtable",obj:"coTable"},{style:"dbtableUrl",obj:"coTableUrl"},{style:"dbtableType",obj:"coTableType"},{style:"dbtableExt",obj:"coTableExt"},{style:"datacache",obj:"fDataCache"},{style:"itemfield",
obj:"szItemField"},{style:"lookupfield",obj:"szSelectionField"},{style:"lookuptoupper",obj:"fSelectionFieldToUpper"},{style:"lookupsuffix",obj:"szSelectionFieldSuffix"},{style:"showdata",obj:"fShowData"},{style:"datafields",obj:"szDataFieldsA",type:"array"},{style:"userdraw",obj:"userDraw"},{style:"ranges",obj:"szRangesA",type:"array"},{style:"rangecentervalue",obj:"nRangeCenterValue"},{style:"symbols",obj:"szSymbolsA",type:"array"},{style:"values",obj:"szValuesA",type:"array",delimiter:"|"},{style:"label",
obj:"szOrigLabelA",type:"array",delimiter:"|"},{style:"xaxis",obj:"szXaxisA",type:"array"},{style:"units",obj:"szUnits"},{style:"labelunits",obj:"szLabelUnits"},{style:"units100",obj:"szUnits100"},{style:"sizevalueunits",obj:"szSizeValueUnits"},{style:"alphavalueunits",obj:"szAlphaValueUnits"},{style:"legendunits",obj:"szLegendUnits"},{style:"weights",obj:"szWeights"},{style:"align",obj:"szAlign"},{style:"normalsizevalue",obj:"nNormalSizeValue"},{style:"normalsizescale",obj:"szNormalSizeScale"},{style:"scale",
obj:"nScale"},{style:"rangescale",obj:"nRangeScale"},{style:"valuefield",obj:"szValueField"},{style:"labelfield",obj:"szLabelField"},{style:"sizefield",obj:"szSizeField"},{style:"alphafield",obj:"szAlphaField"},{style:"alphafield100",obj:"szAlphaField100"},{style:"dopacitypow",obj:"nDopacityPow"},{style:"dopacityramp",obj:"szDopacityRamp"},{style:"dopacityscale",obj:"nDopacityScale"},{style:"buffersize",obj:"nBufferSize"},{style:"bufferstep",obj:"nBufferSizeStep"},{style:"field100min",obj:"nField100Min"},
{style:"fractionscale",obj:"nFractionScale"},{style:"minvalue",obj:"nMinValue"},{style:"maxvalue",obj:"nMaxValue"},{style:"textfont",obj:"szTextFont"},{style:"textcolor",obj:"szTextColor"},{style:"linecolor",obj:"szLineColor"},{style:"linewidth",obj:"nLineWidth"},{style:"bordercolor",obj:"szBorderColor"},{style:"borderstyle",obj:"szBorderStyle"},{style:"borderwidth",obj:"szBorderWidth"},{style:"borderradius",obj:"nBorderRadius"},{style:"boxcolor",obj:"szBoxColor"},{style:"boxopacity",obj:"nBoxOpacity"},
{style:"boxmargin",obj:"nBoxMargin"},{style:"textplacement",obj:"szTextPlacement"},{style:"infotitle",obj:"szInfoTitle"},{style:"titlefield",obj:"szTitleField"},{style:"snippetfield",obj:"szSnippetField"},{style:"exclude",obj:"szExcludeA",type:"array"},{style:"nodatacolor",obj:"szNoDataColor"},{style:"titleupper",obj:"szTitleUpper"},{style:"labelupper",obj:"szLabelUpper"},{style:"valueupper",obj:"szValueUpper"},{style:"glowupper",obj:"szGlowUpper"},{style:"chartupper",obj:"szChartUpper"},{style:"boxupper",
obj:"szBoxUpper"},{style:"valuescale",obj:"nValueScale"},{style:"minvaluesize",obj:"nValueSizeMin"},{style:"valuedecimals",obj:"szValueDecimals"},{style:"fadevaluepow",obj:"szFadeValuePow"},{style:"fadenegative",obj:"nFadeNegative"},{style:"centerpart",obj:"szCenterPart"},{style:"clipframes",obj:"nClipFrames"},{style:"cliplegend",obj:"nClipColorLegend"},{style:"clipparts",obj:"nClipParts"},{style:"minchartsize",obj:"nChartSizeMin"},{style:"showparts",obj:"szShowParts"},{style:"gridx",obj:"nGridX"},
{style:"gridwidth",obj:"nGridWidth"},{style:"gridmatrix",obj:"nGridMatrix"},{style:"gridwidthpx",obj:"nGridWidthPx"},{style:"aggregationfield",obj:"szAggregationField"},{style:"aggregationscale",obj:"szAggregationFieldA",type:"array"},{style:"aggregation",obj:"szAggregation"},{style:"minaggregation",obj:"szMinAggregation"},{style:"dominantfilter",obj:"szDominantFilter"},{style:"dominantdfilter",obj:"nDominantDFilter"},{style:"overviewchart",obj:"szOverviewChart"},{style:"evidence",obj:"evidenceMode"},
{style:"markclass",obj:"markedClass"},{style:"name",obj:"szName"},{style:"title",obj:"szTitle"},{style:"snippet",obj:"szSnippet"},{style:"description",obj:"szDescription"}];function __maptheme_getStyleString(e){for(var c="",f=0;f<themeStyleTranslateA.length;f++)c+=__maptheme_getOneStyleProperty(e[themeStyleTranslateA[f].obj],themeStyleTranslateA[f].style,themeStyleTranslateA[f].type,themeStyleTranslateA[f].delimiter);return c}
function __maptheme_getOneStyleProperty(e,c,f,d){d=d?d:",";if("undefined"!=typeof e&&null!=e)if(f&&"undefined"!=typeof f){if("array"==f&&e&&e.length){f="";for(var h=0;h<e.length;h++)f+=(0<h?d:"")+String(e[h]);return c+":"+f+";"}}else return c+":"+String(e)+";";return""}function __getArrayString(e,c){var f="";if(e&&"undefined"!=e&&"undefined"!=typeof e)for(var d=0;d<e.length;d++)f+=(0<d?c:"")+String(e[d]).replace(/\'/gi," ").replace(/\"/gi," ");return f}
function __maptheme_getStyleObj(e){for(var c={},f=0;f<themeStyleTranslateA.length;f++)null!=e[themeStyleTranslateA[f].obj]&&"undefined"!=e[themeStyleTranslateA[f].obj]&&(c[themeStyleTranslateA[f].style]=e[themeStyleTranslateA[f].obj]);return c}
Map.Themes=function(){this.themesA=[];this.themeNodesA=[];this.themeNodesPosA=[];this.themeNodesBoxA=[];this.themeNodes=0;this.activeBuffer=this.activeTheme=null;this.switchedLayerA=[];this.enableMultiChoroplethe=this.enableChartOffset=!1;this.enableSubThemes=!0;this.szChoropletheInfoStyle="histogram";this.nMaxThemeCharts=5E5;this.nMaxShadowCharts=1E3;this.nflushPaintShape=5E3;this.nflushChartDraw=1E3;this.nColorSchemeMaxHeight=120;this.autoHideInfoTools=this.allwaysShowValues=!1;this.themeDataCacheA=
[]};Map.Themes.prototype=new Map;if("string"==typeof thisversion&&map.checkVersion(thisversion)){map.Themes=new Map.Themes;try{HTMLWindow.ixmaps.htmlgui_onInitThemes()}catch(e$$4){}}else alert("Map.Themes incompatible !");Map.Themes.prototype.addTheme=function(e){this.themesA[this.themesA.length]=e;if(!e.szFlag.match(/selection/i))try{HTMLWindow.ixmaps.htmlgui_onNewTheme(e.szId)}catch(c){}};Map.Themes.prototype.getThemeCount=function(){return this.themesA.length};
Map.Themes.prototype.getAllThemes=function(){return this.themesA};Map.Themes.prototype.isTheme=function(e){for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szIdStr&&this.themesA[c].szIdStr==e)return this.themesA[c];return!1};
Map.Themes.prototype.newTheme2=function(e,c,f,d,h,g){if(map.isIdle()){("undefined"!=typeof e&&"string"!=typeof e||"undefined"!=typeof c&&"string"!=typeof c||"undefined"!=typeof f&&"string"!=typeof f||"undefined"!=typeof d&&"string"!=typeof d||"undefined"!=typeof h&&"string"!=typeof h||"undefined"!=typeof g&&"string"!=typeof g)&&alert("ERROR: only string argument allowed !");var l=e+c+f+d+h+g;if(!d.match(/FORCE/)&&this.isTheme(l))return this.removeTheme(null,this.isTheme(l).szId),null;var k=g&&"undefined"!=
g?g.split("|"):null,m=g=null;if(m=(m=d.split("style="))&&1<m.length?__getStyleObj(m[1]):__getStyleObj(d))g=[5,"white","blue"],m.colorscheme&&(g=m.colorscheme.match(/\|/)||m.colorscheme.match(/RGB/)?m.colorscheme.split("|"):m.colorscheme.split(",")),g=new MapTheme(e,c,f,m.type,g,h,k),g.nOrder=this.getThemeCount(),g.szIdStr=l,this.parseStyle(g,m);this.allwaysShowValues&&(g.szFlag+="|VALUES");g.parent=this;this.addTheme(g);g.fRealize=!0;if(g.coTable)return this.loadExternalData(g.coTable,g.nRefreshTimeout,
g),g;if(fLoadExternalData){e=e.split("|");for(c=0;c<e.length;c++)this.loadExternalData(e[c],g.nRefreshTimeout,g);return g}map.Event.doDefaultZoom();executeWithMessage("map.Themes.execute()","... processing ...");return g}setTimeout('map.Themes.newTheme2("'+e+'","'+c+'","'+f+'","'+d+'","'+h+'","'+g+'")',250)};Map.Themes.prototype.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};
Map.Themes.prototype.toArray=function(e){return this.isArray(e)?e:e.match(/\|/)?e.split("|"):e.split(",")};Map.Themes.prototype.toString=function(e){return this.isArray(e)?e.join("|"):e};
Map.Themes.prototype.newThemeByObj=function(e){if(map.isIdle()){if(e=e||this.newThemeObjA.pop()){var c=JSON.stringify(e);if(!e.style.type.match(/FORCE/)&&this.isTheme(c))return this.removeTheme(null,this.isTheme(c).szId),null;var f=null,d=e.style;if(!d)return null;if(this.isArray(d.label))var f=d.label,h=d.label.join("|");else f=(h=d.label)&&"undefined"!=h?h.split("|"):null;h=[5,"white","blue"];d.colorscheme&&(h=this.toArray(d.colorscheme));e.layer=this.toString(e.layer);e.field=this.toString(e.field);
f=new MapTheme(e.layer,e.field,e.field100,d.type,h,d.title,f);f.nOrder=this.getThemeCount();f.szIdStr=c;this.parseStyle(f,d);this.allwaysShowValues&&(f.szFlag+="|VALUES");f.parent=this;this.addTheme(f);f.fRealize=!0;if(f.coTable)return this.loadExternalData(f.coTable,f.nRefreshTimeout,f),f;if(fLoadExternalData){e=e.layer.split("|");for(c=0;c<e.length;c++)this.loadExternalData(e[c],f.nRefreshTimeout,f);return f}map.Event.doDefaultZoom();executeWithMessage("map.Themes.execute()","... processing ...");
return f}}else e&&(this.newThemeObjA=this.newThemeObjA||[],this.newThemeObjA.push(e)),setTimeout("map.Themes.newThemeByObj()",100)};
Map.Themes.prototype.parseStyle=function(e,c){if(e&&c){if(c.classes){if(isNaN(Number(e.origColorScheme[0]))){var f=e.origColorScheme[e.origColorScheme.length-1];e.origColorScheme[1]=e.origColorScheme[0];e.origColorScheme[2]=f}e.origColorScheme[0]=Number(c.classes)}c.colorstyle&&"spectrum"==e.origColorScheme[1]&&(e.origColorScheme[2]=c.colorstyle);c.dominantdfilter&&(e.nDominantDFilter=Number(c.dominantdfilter));c.dominantfilter&&(e.szDominantFilter=String(c.dominantfilter));c.filter&&(e.szFilter=
String(c.filter));c.filterfield&&(e.szFilterField=String(c.filterfield));c.filtervalue&&(e.szFilterValue=String(c.filtervalue));c.overviewchart&&(e.szOverviewChart=c.overviewchart);c.evidence&&(e.evidenceMode=c.evidence);c.markclass&&(e.markedClass=c.markclass);c.fillopacity&&("auto"==c.fillopacity?(e.autoOpacity=!0,e.fillOpacity=0):e.fillOpacity=Number(c.fillopacity));c.opacity&&("auto"==c.opacity?(e.autoOpacity=!0,e.fillOpacity=0):e.nOpacity=Number(c.opacity));c.autoopacity&&(e.autoOpacity=!0,e.fillOpacity=
0);e.fShadow=c.shadow?e.fOrigShadow="false"==c.shadow?!1:!0:e.fOrigShadow=!1;c.maxshadow&&(e.nMaxShadowCharts=Number(c.maxshadow));c.blur&&(e.nBlur=Number(c.blur));c.dbtable&&(f=c.dbtable.split(" "),e.coTable=f[0],2==f.length&&(e.coTableType="jsonDB",e.coTableUrl=f[1].split("(")[1].split(")")[0]),3==f.length&&(e.coTableType=f[1],e.coTableUrl=f[2].split("(")[1].split(")")[0]),4==f.length&&(e.coTableType=f[1],e.coTableUrl=f[2].split("(")[1].split(")")[0],e.coTableExt=f[3].split("(")[1].split(")")[0]));
c.dbtableType&&(e.coTableType=c.dbtableType);c.dbtableUrl&&(e.coTableUrl=c.dbtableUrl);c.dbtableExt&&(e.coTableExt=c.dbtableExt);c.lookupfield&&(e.szSelectionField=e.szItemField=c.lookupfield);c.lookuptoupper&&(e.fSelectionFieldToUpper="true"==c.lookuptoupper||c.lookuptoupper);c.lookupsuffix&&(e.szSelectionFieldSuffix=c.lookupsuffix);c.lookupprefix&&(e.szSelectionFieldPrefix=c.lookupprefix);c.itemfield&&(e.szItemField=c.itemfield);c.ranges&&(e.szRangesA=this.toArray(c.ranges),e.szRanges=this.toString(c.ranges));
c.symbols&&(e.szSymbolsA=this.toArray(c.symbols));if(c.values&&(e.szValuesA=this.toArray(c.values),c.type.match(/EXACT/)&&e.szValuesA.length))for(f=0;f<e.szValuesA.length;f++)e.getStringValueIndex(e.szValuesA[f],"set");c.align&&(e.szAlign=c.align);c.units&&(e.szUnits=c.units);c.units100&&(e.szUnits100=c.units100);c.sizevalueunits&&(e.szSizeValueUnits=" "+c.sizevalueunits);c.alphavalueunits&&(e.szAlphaValueUnits=" "+c.alphavalueunits);c.legendunits&&(e.szLegendUnits=" "+c.legendunits);c.labelunits&&
(e.szLabelUnits=" "+c.labelunits);c.xaxis&&(e.szXaxisA=this.toArray(c.xaxis));c.name&&(e.szName=unescape(c.name));c.title&&(e.szTitle=unescape(c.title));c.snippet&&(e.szSnippet=unescape(c.snippet));c.description&&(e.szDescription=unescape(c.description));c.label&&(e.szLabelA=e.szOrigLabelA=this.toArray(c.label));c.weights&&(e.szWeightsA=this.toArray(c.weights),e.szWeights=this.toString(c.weights));c.weight&&(e.szWeightsA=[c.weights],e.szWeights=c.weight);c.scale&&(e.nScale=Number(c.scale));c.valuefield&&
(e.szValueField=c.valuefield);c.labelfield&&(e.szLabelField=c.labelfield);c.titlefield&&(e.szTitleField=c.titlefield);c.snippetfield&&(e.szSnippetField=c.snippetfield);c.sizefield&&(e.szSizeField=c.sizefield);c.alphafield&&(e.szAlphaField=c.alphafield);c.alphafield100&&(e.szAlphaField100=c.alphafield100);c.refresh&&(e.nRefreshTimeout=1E3*Number(c.refresh));c.buffersize&&(e.nBufferSize=c.buffersize);c.bufferstep&&(e.nBufferSizeStep=c.bufferstep);c.field100min&&(e.nField100Min=c.field100min);c.fractionscale&&
(e.nFractionScale=c.fractionscale);c.minvalue&&(e.nMinValue=c.minvalue);c.maxvalue&&(e.nMaxValue=c.maxvalue);c.showdata&&(e.fShowData="true"==c.showdata||c.showdata);c.datacache&&(e.fDataCache="true"==c.datacache);c.editor&&(e.fEditor="true"==c.editor);c.datafields&&(e.szDataFieldsA=this.toArray(c.datafields));c.textcolor&&(e.szTextColor=c.textcolor);c.textfont&&(e.szTextFont=c.textfont);c.linecolor&&(e.szLineColor=c.linecolor);c.linewidth&&(e.nLineWidth=c.linewidth);c.bordercolor&&(e.szBorderColor=
c.bordercolor);c.borderstyle&&(e.szBorderStyle=c.borderstyle);c.borderwidth&&(e.szBorderWidth=c.borderwidth);c.borderradius&&(e.nBorderRadius=Number(c.borderradius));c.boxcolor&&(e.szBoxColor=c.boxcolor);c.boxopacity&&(e.nBoxOpacity=c.boxopacity);c.boxmargin&&(e.nBoxMargin=c.boxmargin);c.textplacement&&(e.szTextPlacement=c.textplacement);c.infotitle&&(e.szInfoTitle=c.infotitle);c.exclude&&(e.szExcludeA=this.toArray(c.exclude));c.aggregation&&(e.szAggregation=c.aggregation);c.rangecentervalue&&(e.nRangeCenterValue=
Number(c.rangecentervalue));c.rangescale&&(e.nRangeScale=c.rangescale);c.normalsizevalue&&(e.nNormalSizeValue=c.normalsizevalue);c.normalsizescale&&(e.szNormalSizeScale=c.normalsizescale,e.nNormalSizeScale=__scanScaleValue(e.szNormalSizeScale));c.nodatacolor&&(e.szNoDataColor=__getSaveColor(c.nodatacolor));c.boxupper&&(e.szBoxUpper=c.boxupper,e.nBoxUpper=__scanScaleValue(e.szBoxUpper));c.titleupper&&(e.szTitleUpper=c.titleupper,e.nTitleUpper=__scanScaleValue(e.szTitleUpper));c.labelupper&&(e.szLabelUpper=
c.labelupper,e.nLabelUpper=__scanScaleValue(e.szLabelUpper));c.valueupper&&(e.szValueUpper=c.valueupper,e.nValueUpper=__scanScaleValue(e.szValueUpper));c.valuesupper&&(e.szValueUpper=c.valuesupper,e.nValueUpper=__scanScaleValue(e.szValueUpper));c.glowupper&&(e.szGlowUpper=c.glowupper,e.nGlowUpper=__scanScaleValue(e.szGlowUpper));c.chartupper&&(e.szChartUpper=c.chartupper,e.nChartUpper=__scanScaleValue(e.szChartUpper));c.valuescale&&(e.nValueScale=Number(c.valuescale));c.clipframes&&(e.nClipFrames=
c.clipframes);c.clipframerate&&(e.nClipTimeout=1/Number(c.clipframerate)*1E3);c.cliplegend&&(e.nClipColorLegend=Number(c.cliplegend));c.clipvaluesize&&(e.nValueSizeMin=Number(c.clipvaluesize));c.minvaluesize&&(e.nValueSizeMin=Number(c.minvaluesize));c.valuedecimals&&(e.szValueDecimals=c.valuedecimals);c.fadevaluepow&&(e.szFadeValuePow=c.fadevaluepow);c.dopacityscale&&(e.nDopacityScale=c.dopacityscale);c.dopacityramp&&(e.szDopacityRamp=c.dopacityramp);c.dopacitypow&&(e.nDopacityPow=c.dopacitypow);
c.fadenegative&&(e.nFadeNegative=Number(c.fadenegative)||.5);c.clipparts&&(e.nClipParts=Number(c.clipparts)||0);c.minsize&&(e.nChartSizeMin=Number(c.minsize)||0);c.minchartsize&&(e.nChartSizeMin=Number(c.minchartsize)||0);c.clipsize&&(e.nChartSizeMin=Number(c.clipsize)||0);c.showparts&&(e.szShowParts=this.toString(c.showparts),e.szShowPartsA=this.toArray(c.showparts));c.gridx&&(e.nGridX=Number(c.gridx)||1);c.gridwidth&&(String(c.gridwidth).match(/px/)&&(e.nGridWidthPx=parseFloat(c.gridwidth)||50,
map.Themes.doChangeThemeStyle(e.szId,"AUTOGRID","add")),e.nGridWidth=Number(c.gridwidth)||0);c.gridmatrix&&(e.nGridMatrix=Number(c.gridmatrix)||20,map.Themes.doChangeThemeStyle(e.szId,"AUTOGRID","add"));c.gridwidthpx&&(e.nGridWidthPx=Number(c.gridwidthpx)||50,map.Themes.doChangeThemeStyle(e.szId,"AUTOGRID","add"));c.aggregationfield&&(e.szAggregationField=c.aggregationfield);c.aggregationscale&&(e.szAggregationFieldA=this.toArray(c.aggregationscale));c.minaggregation&&(e.szMinAggregation=c.minaggregation,
e.nMinAggregation=Number(c.minaggregation)||0);c.userdraw&&(e.userDraw=c.userdraw);c.centerpart&&(e.szCenterPart=this.toString(c.centerpart))}};Map.Themes.prototype.getAllThemeDefinitionStrings=function(){for(var e=[],c=0;c<this.themesA.length;c++)e.push(this.getThemeDefinitionString(this.themesA[c]));return e};__toRGB=function(e){var c,f;c=parseInt(e.substr(1,2),16);f=parseInt(e.substr(3,2),16);e=parseInt(e.substr(5,2),16);return"RGB("+c+","+f+","+e+")"};__getSaveColor=function(e){try{if("#"==e.charAt(0))return __toRGB(e)}catch(c){}return e};
__getSaveColorScheme=function(e){for(var c=0;c<e.length;c++)e[c]=__getSaveColor(e[c]);return e.join("|")};__scanScaleValue=function(e){return e.match(/:/)?Number(e.split(":")[1]):Number(e)};Map.Themes.prototype.cleanUpThemeObj=function(e){var c=e.style;if(c.symbols){var f=c.symbols[0];for(i in c.symbols)if(c.symbols[i]!=f){f=null;break}f&&(c.symbols.length=1)}c.gridwidthpx&&c.gridwidth&&(c.gridwidth=null);c.evidence&&"isolate"==c.evidence&&(c.evidence=null);c.aggregation&&(c.aggregation=null);return e};
Map.Themes.prototype.getThemeDefinitionString=function(e){return'map.Api.newMapTheme("'+e.szThemes+'","'+(e.szFields||"")+'","'+(e.szField100||"")+'","type:'+e.szFlag+";colorscheme:"+__getSaveColorScheme(e.origColorScheme)+";"+__maptheme_getStyleString(e)+'");'};Map.Themes.prototype.getMapThemeStyleString=function(e){return(e=this.getTheme(e)||this.activeTheme)&&e.colorScheme?"type:"+e.szFlag+";colorscheme:"+e.colorScheme+";"+__maptheme_getStyleString(e)+"":null};
Map.Themes.prototype.getMapThemeDefinitionObj=function(e){var c=this.getTheme(e)||this.activeTheme;e={};e.layer=c.szThemes;e.field=c.szFields||"";e.field100=c.szField100||"";var f={type:c.szFlag,colorscheme:c.origColorScheme},c=__maptheme_getStyleObj(c);for(a in c)f[a]=c[a];e.style=f;return this.cleanUpThemeObj(e)};Map.Themes.prototype.getTheme=function(e){for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szId==e)return this.themesA[c];return this.activeTheme};
Map.Themes.prototype.getThemeIndex=function(e){for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szId==e)return c};Map.Themes.prototype.refreshTheme=function(e){if(e=this.getTheme(e.split(":")[0])){e.fRealize=!0;if(!fAllIncluded){if(e.coTable){this.loadExternalData(e.coTable,!0,e);return}if(fLoadExternalData){for(var c=szThemes.split("|"),f=0;f<c.length;f++)this.loadExternalData(c[f],!0,e);return}}executeWithMessage("map.Themes.execute()","... processing ...")}};
Map.Themes.prototype.nextClipFrame=function(e){(e=this.getTheme(e.split(":")[0]))&&e.realizeNextClipFrame()};Map.Themes.prototype.setClipFrame=function(e,c){var f=e?this.getTheme(e.split(":")[0]):this.activeTheme;f&&f.setClipFrame(c)};Map.Themes.prototype.pauseClip=function(e){(e=this.getTheme(e.split(":")[0]))&&e.pauseClip()};Map.Themes.prototype.startClip=function(e){(e=this.getTheme(e.split(":")[0]))&&e.startClip()};
Map.Themes.prototype.loadExternalData=function(e,c,f){this.coTableExt||(this.coTableExt=[]);if(e){var d=map.Dictionary.getLocalText("... creating theme ...");c&&(eval(e+".table = null"),d=map.Dictionary.getLocalText("... refreshing theme ..."));this.__test=null;try{eval("this.__test = "+e+".table")}catch(h){try{eval("this.__test = "+e+"_table")}catch(g){}}var l=f.fEditor||!1;this.themeDataCacheA[e]&&((this.themeDataCacheA[e].coTableUrl||f.coTableUrl)&&this.themeDataCacheA[e].coTableUrl!=f.coTableUrl||
(this.themeDataCacheA[e].coTableExt||f.coTableExt)&&this.themeDataCacheA[e].coTableExt!=f.coTableExt||(l=!0));if(this.__test&&l&&0!=f.fDataCache)executeWithMessage("map.Themes.execute()",d),f&&f.coTableExt&&(f.coTableExt=this.coTableExt[f.coTable]);else{if(f&&(f.coTableUrl||f.coTableExt))try{this.themeDataCacheA[e]={coTableUrl:f.coTableUrl,coTableExt:f.coTableExt};this.fWaitingforData=!0;HTMLWindow.ixmaps.htmlgui_loadExternalData(f.coTableUrl,{theme:f,type:f.coTableType,name:f.coTable,ext:f.coTableExt});
this.coTableExt[f.coTable]=f.coTableExt;return}catch(k){}fLocalHost?this.loadExternalDataDefault(e,c,d):this.loadExternalDataZipped(e,c,d)}}};
Map.Themes.prototype.loadExternalDataUrlZipped=function(e,c,f,d){this.fWaitingforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var h=new JSLoader;h.finishedCallback="map.Themes.loadExternalDataFinish('"+d+"')";h.errorCallback="map.Themes.loadExternalDataUrl('"+e+"','"+c+"',"+f+",'"+d+"')";h.szMessage=map.Dictionary.getLocalText("... loading data ...");h.loadScript(c+".gz",f)};
Map.Themes.prototype.loadExternalDataUrl=function(e,c,f,d){this.fWaitingforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var h=new JSLoader;h.finishedCallback="map.Themes.loadExternalDataFinish('"+d+"')";h.errorCallback="map.Themes.loadExternalDataDefault('"+e+"',"+f+",'"+d+"')";h.szMessage=map.Dictionary.getLocalText("... loading data ...");h.loadScript(c,f)};
Map.Themes.prototype.loadExternalDataZipped=function(e,c,f){this.fWaitingforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var d=new JSLoader;d.finishedCallback="map.Themes.loadExternalDataFinish('"+f+"')";d.errorCallback="map.Themes.loadExternalDataDefault('"+e+"',"+c+",'"+f+"')";d.szMessage=map.Dictionary.getLocalText("... loading data ...");d.loadScript(e+".js.gz",c)};
Map.Themes.prototype.loadExternalDataDefault=function(e,c,f){this.fWaitingforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var d=new JSLoader;d.finishedCallback="map.Themes.loadExternalDataFinish('"+f+"')";d.errorCallback="map.Themes.loadExternalDataFinish('"+f+"')";d.szMessage=map.Dictionary.getLocalText("... loading data ...");d.loadScript(e+".js",c)};
Map.Themes.prototype.loadExternalDataFinish=function(e){this.fWaitingforData=!1;executeWithMessage("map.Themes.execute()",e)};Map.Themes.prototype.activateTheme=function(e,c){var f=this.getTheme(c.split(":")[0]);f&&(f.fRedraw=!0,executeWithMessage("map.Themes.execute()","... processing ..."));e.stopPropagation();e.preventDefault()};
Map.Themes.prototype.removeTheme=function(e,c){var f=this.getTheme(c.split(":")[0]);f&&(f.szFlag.match(/CHART/)&&(f.fToggle=!0),f.fRemove=!0,executeWithMessage("map.Themes.execute()","... processing ..."));e&&(e.stopPropagation(),e.preventDefault())};
Map.Themes.prototype.removeAll=function(e){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/LOCKED/)||(this.themesA[c].fRemove=!this.themesA[c].fRealize);executeWithMessage("map.Themes.execute()","... processing ...");e&&(e.stopPropagation(),e.preventDefault())};
Map.Themes.prototype.removeAllCharts=function(e){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/CHART/)&&!this.themesA[c].szFlag.match(/LOCKED/)&&(this.themesA[c].fRemove=!this.themesA[c].fRealize);executeWithMessage("map.Themes.execute()","... processing ...");e&&(e.stopPropagation(),e.preventDefault())};
Map.Themes.prototype.removeAllChoroplethe=function(e){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/CHOROPLETHE/)&&!this.themesA[c].szFlag.match(/LOCKED/)&&(this.themesA[c].fRemove=!this.themesA[c].fRealize);executeWithMessage("map.Themes.execute()","... processing ...");e&&(e.stopPropagation(),e.preventDefault())};
Map.Themes.prototype.removeAllSelections=function(e){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/SELECTION/)&&(this.themesA[c].fRemove=!0);executeWithMessage("map.Themes.execute()","... processing ...");e&&(e.stopPropagation(),e.preventDefault())};Map.Themes.prototype.redrawInfoAll=function(e){for(var c=0;c<this.themesA.length;c++)this.themesA[c].fRedrawInfo=!0;executeWithMessage("map.Themes.execute()","... processing ...");e&&(e.stopPropagation(),e.preventDefault())};
Map.Themes.prototype.reformat=function(e){for(var c=this.minY=this.minX=0;c<this.themesA.length;c++)this.themesA[c].fRepositionInfo=!0,this.themesA[c].fRedrawInfo=!0;executeWithMessage("map.Themes.execute()","... processing ...");e&&(e.stopPropagation(),e.preventDefault())};
Map.Themes.prototype.execute=function(){var e=!1,c=0;if(!this.fWaitingforData)if(map.Tiles.isLoading())setTimeout("map.Themes.execute()",250),this.fExecuteDelayed=!0;else if(this.fExecuteDelayed)this.fExecuteDelayed=!1,executeWithMessage("map.Themes.execute()"," ... ");else{for(c=0;c<this.themesA.length;c++)(this.themesA[c].fRealize||this.themesA[c].fRedraw||this.themesA[c].fToFront)&&this.themesA[c].szFlag.match(/CHOROPLETHE/)&&!this.themesA[c].szFlag.match(/SUBTHEME/)&&(e=this.themesA[c].szShapeType);
if(e&&this.enableMultiChoroplethe)for(c=0;c<this.themesA.length;c++)this.themesA[c].szFlag&&this.themesA[c].szFlag.match(/CHOROPLETHE/)&&this.themesA[c].szShapeType==e&&(this.themesA[c].disable(),this.themesA[c].isVisible=!1,this.themesA[c].fRedrawInfo=!1);if(e&&!this.enableMultiChoroplethe)for(c=0;c<this.themesA.length;c++)!this.themesA[c].szFlag||!this.themesA[c].szFlag.match(/CHOROPLETHE/)||this.themesA[c].szShapeType!=e||this.themesA[c].fRealize||this.themesA[c].fRedraw||this.themesA[c].fToFront||
(this.themesA[c].fRemove=!0);for(c=0;c<this.themesA.length;c++){if(this.themesA[c].fToggle){this.themesA[c].toggle();this.themesA[c].fToggle=!1;this.execute();break}if(this.themesA[c].fRemove){1<this.themesA.length&&!this.themesA[c].szFlag.match(/SELECTION/)&&!this.themesA[c].szFlag.match(/CHART/)&&this.activateNextPaint(this.themesA[c]);this.themesA[c].removeElements();this.remove(this.themesA[c]);this.reformat();this.execute();break}if(this.themesA[c].fRealize)this.themesA[c].fRedraw=!1,this.themesA[c].fEnableProgressBar=
!0,setTimeout("map.Themes.showProgressBar()",5E3),this.themesA[c].fRealize=!1,this.themesA[c].realize();else if(this.themesA[c].fRedraw)this.themesA[c].checkHiddenLayerState&&this.themesA[c].checkHiddenLayerState()?(this.themesA[c].fRealize=!0,this.themesA[c].fRedraw=!1,this.themesA[c].fReload=!1,this.themesA[c].unpaintMap(),map.Themes.execute()):(this.themesA[c].fEnableProgressBar=!0,this.themesA[c].redraw(!1));else if(this.themesA[c].fActualize)this.themesA[c].fActualize=!1,this.themesA[c].checkHiddenLayerState&&
this.themesA[c].checkHiddenLayerState()?(this.themesA[c].fRealize=!0,this.themesA[c].fRedraw=!1,this.themesA[c].fReload=!1,this.themesA[c].unpaintMap(),map.Themes.execute()):(this.themesA[c].fEnableProgressBar=!0,this.themesA[c].redraw(!1));else if(this.themesA[c].fToFront)this.themesA[c].fEnableProgressBar=!1,this.themesA[c].toFront(),this.themesA[c].fToFront=!1;else if(this.themesA[c].fResize)this.themesA[c].resize(this.themesA[c].fResize),this.themesA[c].fResize=!1;else if(this.themesA[c].fOpacity)this.themesA[c].opacity(this.themesA[c].fOpacity),
this.themesA[c].fOpacity=!1;else if(this.themesA[c].fBlur)this.themesA[c].blur(this.themesA[c].nBlur),this.themesA[c].fBlur=!1;else if(this.themesA[c].fOffset)this.themesA[c].offset(this.themesA[c].fOffset),this.themesA[c].fOffset=!1;else if(this.themesA[c].fRedrawInfo)this.themesA[c].widgetNode&&this.themesA[c].showInfo(),this.themesA[c].fRedrawInfo=!1;else if(this.themesA[c].fResort){try{this.themesA[c].sortChartObjects()}catch(f){}this.themesA[c].fResort=!1}else if(this.themesA[c].fDeclutter){try{this.themesA[c].declutterCharts()}catch(d){}this.themesA[c].fDeclutter=
!1}}this.executeCallback&&(eval(this.executeCallback),this.executeCallback=null);clearMessage(100);clearMessage(1E3)}};Map.Themes.prototype.continueExecute=function(){for(var e=0;e<this.themesA.length;e++)this.themesA[e].fAggregate?(this.themesA[e].fAggregate=!1,this.themesA[e].realize_aggregate()):this.themesA[e].fDraw?(this.themesA[e].fDraw=!1,this.themesA[e].realize_draw()):this.themesA[e].fContinue&&(this.themesA[e].fContinue=!1,this.themesA[e].realizeContinue(this.themesA[e].continueIndex))};
Map.Themes.prototype.realizeDone=function(e){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/SELECTION/)&&(this.themesA[c].fRealize=!0);e.fRealizeDone=!0;try{HTMLWindow.ixmaps.htmlgui_onDrawTheme(e.szId)}catch(f){}e.szFlag.match(/TEXTONLY/)&&setTimeout("map.Layer.adaptLabel()",10)};
Map.Themes.prototype.showProgressBar=function(){for(var e=0;e<this.themesA.length;e++)(this.themesA[e].fRealize||this.themesA[e].fContinue||this.themesA[e].fAggregate||this.themesA[e].fDraw)&&2<this.themesA[e].nCount/this.themesA[e].nDoneCount&&this.themesA[e].mapSleep?this.themesA[e].mapSleep.fShowProgressBar=!0:(this.themesA[e].fRealize||this.themesA[e].fContinue||this.themesA[e].fAggregate||this.themesA[e].fDraw)&&setTimeout("map.Themes.showProgressBar()",1E3)};
Map.Themes.prototype.remove=function(e){e==this.activeTheme&&(this.activeTheme=null);e==this.activeBuffer&&(this.activeBuffer=null);for(var c=0;c<this.themesA.length;c++)if(this.themesA[c]==e){for(;c<this.themesA.length-1;c++)this.themesA[c]=this.themesA[c+1];this.themesA.length--}};Map.Themes.prototype.cancelExecute=function(){this.activeTheme.fCancel=!0};Map.Themes.prototype.sequence=function(){this.sequenceNr=0;this.sequenceNext()};
Map.Themes.prototype.sequenceNext=function(){this.sequenceNr<this.themesA.length&&(this.themesA[this.sequenceNr].fRedraw=!0,map.Themes.executeCallback="setTimeout('map.Themes.sequenceNext()',500)",map.Themes.execute(),this.sequenceNr++)};
Map.Themes.prototype.activateNextPaint=function(e){e=this.getThemeIndex(e.szId);for(var c=e-1;c!=e;c--){0>c&&(c=this.themesA.length-1);if(c==e)break;if(this.themesA[c].isChecked&&!this.themesA[c].szFlag.match(/CHART/))return this.themesA[c].fRedraw=!0,this.themesA[c].fRedrawInfo=!1,!0}return!1};Map.Themes.prototype.toggleThemeValues=function(e,c){this.toggleValueDisplay(e,this.activeTheme.szId,!this.activeTheme.szFlag.match(/VALUES/))};
Map.Themes.prototype.toggleThemeLegends=function(e,c){SVGThemeGroup.style.setProperty("display",c?"inline":"none","")};Map.Themes.prototype.minimizeThemeLegends=function(e){this.fMinimizedLegends=!0;for(var c=0;c<this.themesA.length;c++)this.minimizeInfo(e,this.themesA[c].szId)};Map.Themes.prototype.changeAllChartScaling=function(e,c){for(var f=0;f<this.themesA.length;f++)this.themesA[f].fResize=999,executeWithMessage("map.Themes.execute()","... processing ...");e.stopPropagation();e.preventDefault()};
Map.Themes.prototype.changeChartScaling=function(e,c,f){if(c=this.getTheme(c.split(":")[0]))c.fResize=f,executeWithMessage("map.Themes.execute()","... processing ...");e.stopPropagation();e.preventDefault()};Map.Themes.prototype.changeChartOpacity=function(e,c,f){if(c=this.getTheme(c.split(":")[0]))c.fOpacity=f,executeWithMessage("map.Themes.execute()","... processing ...");e.stopPropagation();e.preventDefault()};
Map.Themes.prototype.changeChartOffset=function(e,c,f){if((e=this.getTheme(c.split(":")[0]))&&e.leadOffset&&(f=SVGDocument.getElementById(f))){f.fu=new Methods(f);c=f.fu.getPosition();var d=f.fu.getGroupScale();e.fOffset=new point(c.x-e.leadOffset.x,c.y-e.leadOffset.y);f.fu.setPosition(e.leadOffset.x,e.leadOffset.y);e.fOffset.x/=map.Zoom.nZoom/d.x;e.fOffset.y/=map.Zoom.nZoom/d.y;e.offset(e.fOffset);e.fOffset=!1;e.leadOffset=!1}};
Map.Themes.prototype.tellChartOffset=function(e,c,f){(e=this.getTheme(c.split(":")[0]))&&!e.leadOffset&&this.enableChartOffset&&(f=SVGDocument.getElementById(f))&&(f.fu=new Methods(f),e.leadOffset=f.fu.getPosition())};
Map.Themes.prototype.initChartOffset=function(e,c,f){if(this.getTheme(c.split(":")[0])){var d=SVGDocument.getElementById(f);d&&(d.origPosition||(d.origPosition=d.fu.getPosition()),d.onMouseMove=function(c){d.actualPosition=d.fu.getPosition();map.Themes.makeChartOffsetPointer(d)},d.widgetObj=new Widget(d,d))}};Map.Themes.prototype.endChartOffset=function(e,c,f){this.getTheme(c.split(":")[0])&&(e=SVGDocument.getElementById(f))&&e.widgetObj.remove()};
Map.Themes.prototype.makeChartOffsetPointer=function(e){e.pointerObj?(map.Dom.clearGroup(e.pointerObj),map.Dom.clearGroup(e.pointShObj)):(e.pointerObj=map.Dom.newGroup(e),e.pointShObj=map.Dom.newGroup(e),e.pointerObj.parentNode.insertBefore(e.pointerObj,e.pointerObj.parentNode.firstChild),e.pointShObj.parentNode.insertBefore(e.pointShObj,e.pointShObj.parentNode.firstChild));if(e.origPosition||e.actualPosition){var c=new box(0,0,100,75),f=new point(e.actualPosition.x-e.origPosition.x,e.actualPosition.y-
e.origPosition.y),d=map.Scale.normalX(15),h=map.Scale.normalX(5),g=map.Scale.normalX(10);map.Scale.normalX(5);h=f.y+c.height/2;d=f.x+c.width/2;Math.abs(h)+c.width/2-c.height/2>Math.abs(d)?(c.width/3>g&&(f.x>-c.width/3&&(d-=c.width/3),f.x<-c.width/3*2&&(d+=c.width/3)),0<h?(map.Dom.newShape("path",e.pointShObj,"M"+-f.x+","+-f.y+" l "+(d-map.Scale.normalX(5))+","+(f.y+map.Scale.normalX(1))+" "+map.Scale.normalX(4)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",e.pointerObj,"M"+-f.x+","+
-f.y+" l "+(d-map.Scale.normalX(5))+","+(f.y+map.Scale.normalX(1))+" "+map.Scale.normalX(3)+",0 z","fill:red")):(map.Dom.newShape("path",e.pointShObj,"M"+-f.x+","+-f.y+" l "+(d-map.Scale.normalX(4))+","+(f.y+c.height)+" "+map.Scale.normalX(4)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",e.pointerObj,"M"+-f.x+","+-f.y+" l "+(d-map.Scale.normalX(4))+","+(f.y+c.height)+" "+map.Scale.normalX(3)+",0 z","fill:red"))):(c.height/5>g&&(f.y>-c.height/3&&(h-=c.height/3),f.y<-c.height/3*2&&(h+=
c.height/3)),0<d?(map.Dom.newShape("path",e.pointShObj,"M"+-f.x+","+-f.y+" l "+(f.x-c.width)+","+(h-map.Scale.normalX(4))+" 0,"+map.Scale.normalX(4)+" z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",e.pointerObj,"M"+-f.x+","+-f.y+" l "+(f.x-c.width)+","+(h-map.Scale.normalX(4))+" 0,"+map.Scale.normalX(3)+" z","fill:red")):(map.Dom.newShape("path",e.pointShObj,"M"+-f.x+","+-f.y+" l "+(f.x+c.width)+","+(h-map.Scale.normalX(4))+" 0,"+map.Scale.normalX(4)+" z","fill:black;fill-opacity:0.5"),
map.Dom.newShape("path",e.pointerObj,"M"+-f.x+","+-f.y+" l "+(f.x+c.width)+","+(h-map.Scale.normalX(4))+" 0,"+map.Scale.normalX(3)+" z","fill:red")))}};
MapTheme.prototype.declutterCharts=function(){for(var e=this.chartGroup.childNodes,c=0;c<e.length;c++)e[c].actualPosition&&(e[c].fu.setPosition(e[c].origPosition.x,e[c].origPosition.y),e[c].origPosition=null,e[c].actualPosition=null,e[c].pointerObj&&(map.Dom.clearGroup(e[c].pointerObj),map.Dom.clearGroup(e[c].pointShObj)),e[c].pointerObj=null,e[c].pointShObj=null);if(!e[0].actualPosition){var f=e[0].fu.getBox();map.Zoom.getBox();for(var d=[],c=0;c<e.length;c++){var h=!1,g=e[c].fu.getPosition(),l=
e[c].fu.getBox();l.x+=g.x;l.y+=g.y;for(var k in d)for(var m in d[k])if(!(l.y+l.height<d[k][m].box.y-.3*d[k][m].box.height||l.y>d[k][m].box.y+1.3*d[k][m].box.height||l.x+l.width<d[k][m].box.x-d[k][m].box.width||l.x>d[k][m].box.x+2*d[k][m].box.width)){d[k].push({node:e[c],y:e[c].fu.getPosition().x,box:l});h=!0;break}h||d.push([{node:e[c],y:e[c].fu.getPosition().x,box:l}])}for(k=0;k<d.length;k++)if(e=d[k],e.sort(this.sortUpChartObjectsCompare),1<e.length){h=e[0].node.fu.getPosition();for(c=0;c<e.length;c++)g=
e[c].node.fu.getPosition(),g.y<h.y&&(h.x=g.x,h.y=g.y);h.y-=map.Scale.normalX(50)*map.Scale.nZoomScale;g=e[0].node.fu.getPosition();for(c=0;c<e.length;c++)e[c].node.origPosition=e[c].node.fu.getPosition(),e[c].node.fu.setPosition(g.x+1.2*f.width*c,h.y),e[c].node.actualPosition=new point(g.x+1.2*f.width*c,h.y),scale=e[c].node.fu.getScale().x,e[c].node.actualPosition.x=e[c].node.origPosition.x-(e[c].node.origPosition.x-e[c].node.actualPosition.x)/scale,e[c].node.actualPosition.y=e[c].node.origPosition.y-
(e[c].node.origPosition.y-e[c].node.actualPosition.y)/scale,map.Themes.makeChartOffsetPointer(e[c].node)}}};Map.Themes.prototype.setChartSizeType=function(e,c,f){if(c=this.getTheme(c.split(":")[0])){for(var d="",h=c.szFlag.split("|"),g=0;g<h.length;g++)"SIZE"==h[g]||"FIXSIZE"==h[g]||"NOSIZE"==h[g]||"HEIGHT"==h[g]||"3D"==h[g]&&"2D"==f||(d+=(d.length?"|":"")+h[g]);executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+(d+("|"+f))+"')","... processing ...")}e.stopPropagation();e.preventDefault()};
Map.Themes.prototype.toggleValueDisplay=function(e,c,f){if(c=this.getTheme(c.split(":")[0])){for(var d="",h=c.szFlag.split("|"),g=0;g<h.length;g++)"VALUES"!=h[g]&&(d+=(d.length?"|":"")+h[g]);f&&(d+="|VALUES");executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+d+"')","... processing ...")}e&&(e.stopPropagation(),e.preventDefault())};
Map.Themes.prototype.toggleDopacity=function(e,c,f){if(c=this.getTheme(c.split(":")[0])){for(var d="",h=c.szFlag.split("|"),g=0;g<h.length;g++)h[g].match(/DOPACITY/)||(d+=(d.length?"|":"")+h[g]);f&&(d+="|DOPACITYMAX");executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+d+"')","... processing ...")}e&&(e.stopPropagation(),e.preventDefault())};
Map.Themes.prototype.changeDopacityAlphaRamp=function(e,c,f){if(c=this.getTheme(c.split(":")[0])){var d=c.szFlag;c.nDopacityScale=c.nDopacityScale||1;c.nDopacityScale*=f;executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+d+"')","... processing ...")}e&&(e.stopPropagation(),e.preventDefault())};
Map.Themes.prototype.toggleChartDisplay=function(e,c,f){if(c=this.getTheme(c.split(":")[0]))c.fToggle=!0,executeWithMessage("map.Themes.execute()","... processing ...");e.stopPropagation();e.preventDefault()};Map.Themes.prototype.zoomToClass=function(e,c,f,d){setTimeout("map.Themes.doZoomToClass('"+c+"','"+f+"','"+d+"')",100)};
Map.Themes.prototype.markClass=function(e,c,f,d){var h=this.getTheme(c.split(":")[0]);h&&h.isVisible&&!h.showInfoMore&&("undefined"!=typeof h.markedClass&&h.markedClass==f?this.unmarkClass(e,c):(h.markedClass=f,h.fMarkEnable=!0,h.fUnmarkEnable=!1,this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),displayMessage("...",1E3,!0),this.markTimeout=setTimeout("map.Themes.doMarkClass('"+c+"','"+f+"','"+d+"')",500)))};
Map.Themes.prototype.unmarkClass=function(e,c){var f=this.getTheme(c.split(":")[0]);f&&f.isVisible&&!f.showInfoMore&&(f.markedClass=null,displayMessage("...",1E3,!0),this.unmarkTimeout=setTimeout("map.Themes.doUnmarkClass('"+c+"')",500),f.fUnmarkEnable=!0,f.fMarkEnable=!1)};Map.Themes.prototype.doZoomToClass=function(e,c,f){(e=this.getTheme(e.split(":")[0]))&&e.zoomToClass(Number(c),Number(f))};
Map.Themes.prototype.doMarkClass=function(e,c,f){if(e=this.getTheme(e.split(":")[0])){e.markClass(Number(c),Number(f));try{HTMLWindow.ixmaps.htmlgui_onDrawTheme(e.szId)}catch(d){}}};Map.Themes.prototype.doUnmarkClass=function(e){if(this.subTheme)this.subTheme.removeSubTheme(),this.subTheme=null;else if(e=this.getTheme(e.split(":")[0])){e.unmarkClass();try{HTMLWindow.ixmaps.htmlgui_onDrawTheme(e.szId)}catch(c){}}};
Map.Themes.prototype.hideClass=function(e,c,f,d){(e=this.getTheme(c.split(":")[0]))&&e.isVisible&&e.showClass(Number(f),Number(d),!1)};Map.Themes.prototype.showClass=function(e,c,f,d){(e=this.getTheme(c.split(":")[0]))&&e.isVisible&&e.showClass(Number(f),Number(d),!0)};
Map.Themes.prototype.filterItems=function(e,c,f,d){(e=c?this.getTheme(c.split(":")[0]):this.activeTheme)&&e.isVisible&&!e.showInfoMore&&(e.fMarkEnable=!0,e.fUnmarkEnable=!1,this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),this.opt=d,this.markTimeout=setTimeout("map.Themes.doFilterItems('"+c+"','"+f+"')",500))};Map.Themes.prototype.doFilterItems=function(e,c){executeWithMessage("map.Themes.doFilterItemsGo('"+e+"','"+c+"')","applying filter ...")};
Map.Themes.prototype.doFilterItemsGo=function(e,c){var f=this.getTheme(e.split(":")[0]);f&&(f.filterItems(c,this.opt),this.activeTheme=f)};Map.Themes.prototype.selectFilterItems=function(e,c){var f=this.getTheme(c.split(":")[0]);f&&f.selectFilterItems()};Map.Themes.prototype.chartTypeMenu=function(e,c,f,d){if(e=c?this.getTheme(c.split(":")[0]):map.Themes.activeTheme)e.szFlag.match(/CHART/),e.chartMenu(f,d,"chart")};
Map.Themes.prototype.chartColorMenu=function(e,c,f,d){(e=this.getTheme(c.split(":")[0]))&&e.chartMenu(f,d,"variation")};Map.Themes.prototype.toggleMore=function(e,c){var f=this.getTheme(c.split(":")[0]);f&&(f.showInfoMore=!f.showInfoMore,f.unmarkClass(),f.fRedrawInfo=!0,f.ptWidget&&f.ptWidget.x==f.widgetNode.fu.getPosition().x&&(f.fRepositionInfo=!0),map.Themes.execute())};
Map.Themes.prototype.exitMore=function(e,c){var f=this.getTheme(c.split(":")[0]);f&&(f.showInfoMore=!1,f.unmarkClass(),f.fRedrawInfo=!0,f.ptWidget&&f.ptWidget.x==f.widgetNode.fu.getPosition().x&&(f.fRepositionInfo=!0),map.Themes.execute())};
Map.Themes.prototype.onclickInfo=function(e,c){var f=e.target.getAttributeNS(null,"id");if(f&&f.match(/background/)){var f=SVGDocument.getElementById(c+":display:widget:infobuttons"),d=f.style.getPropertyValue("display"),h=this.getTheme(c.split(":")[0]);"none"==d?(f.style.setProperty("display","inline",""),this.fMinimized=h.szFlag.match(/MINIMIZED/),this.maximizeInfo(null,c),this.resizeInfo(null,c)):(SVGDocument.getElementById(c+":display:widget:infobuttons").style.setProperty("display","none",""),
this.fMinimized&&(this.fMinimized=null,this.minimizeInfo(null,c)),this.exitMore(null,c))}};Map.Themes.prototype.onoverInfo=function(e,c){this.onInfoOverTimeout=setTimeout("map.Themes.doOnoverInfo(null,'"+c+"')",400);this.onInfoOutTimeout&&clearTimeout(this.onInfoOutTimeout)};
Map.Themes.prototype.doOnoverInfo=function(e,c){var f=SVGDocument.getElementById(c+":display:widget:infobuttons"),d=f.style.getPropertyValue("display");f.style.setProperty("display","inline","");"none"==d&&this.resizeInfo(null,c)};Map.Themes.prototype.ondownInfo=function(e,c){this.onInfoOverTimeout&&clearTimeout(this.onInfoOverTimeout);this.onInfoOutTimeout&&clearTimeout(this.onInfoOutTimeout)};
Map.Themes.prototype.onoutInfo=function(e,c){this.onInfoOutTimeout=setTimeout("map.Themes.doOnoutInfo(null,'"+c+"')",400);this.onInfoOverTimeout&&clearTimeout(this.onInfoOverTimeout)};Map.Themes.prototype.doOnoutInfo=function(e,c){try{SVGDocument.getElementById(c+":display:widget:infobuttons").style.setProperty("display","none",""),this.exitMore(null,c)}catch(f){}};
Map.Themes.prototype.resizeInfo=function(e,c){var f=c+":display:widget",d=SVGDocument.getElementById(f+":backgroundrect:noobject"),f=SVGDocument.getElementById(f+":shadowrect:noobject"),h=d.parentNode,g=map.Dom.getBox(h),l=this.getTheme(c.split(":")[0]);l.removebutton&&l.removebutton.setPosition(g.width-map.Scale.normalX(2),map.Scale.normalY(7));l.maximizebutton&&l.maximizebutton.setPosition(g.width-map.Scale.normalX(map.Scale.nButtonSize+5),map.Scale.normalY(7));l.minimizebutton&&l.minimizebutton.setPosition(g.width-
map.Scale.normalX(map.Scale.nButtonSize+5),map.Scale.normalY(7));l.chartbutton&&l.chartbutton.setPosition(g.width-map.Scale.normalX(2),l.chartbutton.getPosition().y);l.morebutton&&l.morebutton.setPosition(g.width-map.Scale.normalX(2),l.morebutton.getPosition().y-map.Scale.normalY(.2*map.Scale.nButtonSize));g=map.Dom.getBox(h);d.setAttributeNS(null,"x",-map.Scale.normalX(5));d.setAttributeNS(null,"y",-map.Scale.normalY(5));d.setAttributeNS(null,"width",g.width+map.Scale.normalX(5)+map.Scale.normalX(2));
d.setAttributeNS(null,"height",g.height+map.Scale.normalY(5)+map.Scale.normalY(0));f.setAttributeNS(null,"x",-map.Scale.normalX(-3));f.setAttributeNS(null,"y",-map.Scale.normalY(-3));f.setAttributeNS(null,"width",g.width+map.Scale.normalX(5)+map.Scale.normalX(-3));f.setAttributeNS(null,"height",g.height+map.Scale.normalY(5)+map.Scale.normalY(-5))};
Map.Themes.prototype.autoPositionInfo=function(e,c){var f=this.getTheme(c.split(":")[0]);if(f){var d=f.widgetNode.fu.getPosition(),d=map.Scale.clipWidgetObjectToSVG(f.widgetNode,d,new point(0,0),null);f.widgetNode.fu.setPosition(d.x,d.y)}};Map.Themes.prototype.changeThemeStyle=function(e,c,f,d){executeWithMessage("map.Themes.doChangeThemeStyle('"+c+"','"+f+"','"+d+"')","... processing ...");e&&(e.stopPropagation(),e.preventDefault())};
function __calcNewValue(e,c,f){e=e||1;c=c||1;return f&&f.match(/pow/)?Math.pow(e,c):f&&f.match(/factor/)?e*c:f&&(f.match(/add/)||f.match(/delta/))?e+c:c}function __calcFactor(e,c,f){e=e||1;c=c||1;return f&&f.match(/factor/)?c:f&&f.match(/add/)?(e+c)/e:c/e}
Map.Themes.prototype.doChangeThemeStyle=function(e,c,f){var d=this.getTheme(e.split(":")[0])||this.activeTheme;if(d){if(c=__getStyleObj(c)){if(c.type){c.origType=c.type;if(f&&f.match(/add/)){var h=c.type.split("|");this.szTempStyle=d.szFlag;for(var g=0;g<h.length;g++)eval("this.szTempStyle.match(/"+h[g]+"/)")||(this.szTempStyle+="|"+h[g]);c.type=this.szTempStyle}else if(f&&f.match(/remove/)){for(var h=d.szFlag.split("|"),l="",g=0;g<h.length;g++)h[g]!=c.type&&(l+=(l.length?"|":"")+h[g]);c.type=l}else if(f&&
f.match(/toggle/)){for(var h=d.szFlag.split("|"),l="",k=!1,g=0;g<h.length;g++)h[g]!=c.type?l+=(l.length?"|":"")+h[g]:k=!0;c.type=l+(k?"":"|"+c.type)}else{if(c.type.match(/CHART/)&&!d.szFlag.match(/CHART/)||c.type.match(/CHOROPLETHE/)&&!d.szFlag.match(/CHOROPLETHE/))d.unpaintMap(),this.activateNextPaint(d);d.szFlag.match(/FRACTION/)&&(c.type+="|FRACTION");d.szFlag.match(/PERMILLE/)&&(c.type+="|PERMILLE");d.szFlag.match(/CALCVAL/)&&(c.type+="|CALCVAL");d.szFlag.match(/CALC100/)&&(c.type+="|CALC100");
d.szFlag.match(/PRODUCT/)&&(c.type+="|PRODUCT");d.szFlag.match(/RELATIVE/)&&(c.type+="|RELATIVE");d.szFlag.match(/INVERT/)&&(c.type+="|INVERT");d.szFlag.match(/INVERTSIZE/)&&(c.type+="|INVERTSIZE");d.szFlag.match(/DENSITY/)&&(c.type+="|DENSITY");d.szFlag.match(/SUM/)&&(c.type+="|SUM");d.szFlag.match(/CALCMEAN/)&&(c.type+="|CALCMEAN");d.szFlag.match(/AUTO100/)&&(c.type+="|AUTO100");if(c.type.match(/EQUIDISTANT/)||c.type.match(/LOG/)||c.type.match(/QUANTILE/))d.szOldRanges=d.szRanges?d.szRanges:d.szOldRanges,
d.szRanges=null,d.szOldLabelA=d.szLabelA?d.szLabelA:d.szOldLabelA,d.szLabelA=null;c.type.match(/RANGES/)&&(d.szRanges=d.szOldRanges?d.szOldRanges:d.szRanges,d.szRangesA=c.ranges.split(c.ranges.match(/\|/)?"|":","),d.szLabelA=d.szOldLabelA?d.szOldLabelA:d.szLabelA,Number(d.origColorScheme[0])&&d.szRanges&&(d.origColorScheme[0]=d.szRangesA.length-1))}g=d.szFlag;d.szFlag=c.type;!d.szFlag.match(/CHART/)||d.szFlag.match(/BUFFER/)||g.match(/CHART/)||(d.fShadow=d.fOrigShadow=!0);c.origType.match(/AGGREGATE/)||
c.origType.match(/RECT/)?(d.fRealize=!0,d.fRedraw=!1,d.unpaintMap(),d.themeNodesPosA=[]):(d.fRedraw=!0,d.fRedrawInfo=!0)}else if(f&&f.match(/remove/)){for(p in c)for(s in themeStyleTranslateA)themeStyleTranslateA[s].style==p&&(d[themeStyleTranslateA[s].obj]=null);map.Themes.unmarkClass(null,e);d.fReload=!0;d.fRealize=!0;executeWithMessage("map.Themes.execute()","... processing ...");return}c.classes&&(isNaN(Number(d.origColorScheme[0]))&&(d.origColorScheme[3]=d.origColorScheme[d.origColorScheme.length/
2],d.origColorScheme[4]="2colors",g=d.origColorScheme[d.origColorScheme.length-1],d.origColorScheme[1]=d.origColorScheme[0],d.origColorScheme[2]=g),d.origColorScheme[0]=Number(c.classes),d.szFlag.match(/CHART/)&&d.unpaintMap(),d.szOldRanges=d.szRanges,d.szRanges=null,d.fRealize=!0);c.ranges&&(d.szRanges=c.ranges,d.szRangesA=c.ranges.split(c.ranges.match(/\|/)?"|":","),d.fRealize=!0);c.colorstyle&&"spectrum"==d.origColorScheme[1]&&(d.origColorScheme[2]=c.colorstyle,d.szFlag.match(/CHART/)&&d.unpaintMap(),
d.fRealize=!0);c.colordef&&(d.origColorScheme=c.colordef.match(/\|/)?c.colordef.split("|"):c.colordef.split(","));if(c.colorscheme&&(h=c.colorscheme.match(/\|/)?c.colorscheme.split("|"):c.colorscheme.split(","))&&h.length){isNaN(Number(d.origColorScheme[0]))&&(d.origColorScheme[0]=d.origColorScheme.length);d.origColorScheme.length=1;for(g=0;5>g;g++)d.origColorScheme[g+1]=g<h.length?h[g]:null;try{d.colorScheme=ColorScheme.createColorScheme(d.origColorScheme[1],d.origColorScheme[2],d.origColorScheme[0],
d.origColorScheme[3],d.origColorScheme[4])}catch(m){d.colorScheme=d.defaultColorScheme}d.fRedraw=!0;d.szFlag.match(/CHART/)||(d.fRealize=!0);d.fRedrawInfo=!0;d.showInfo()}if(c.colorschemegeneration&&!isNaN(Number(d.origColorScheme[0]))){switch(c.colorschemegeneration){case "warm":d.origColorScheme[4]="#FFFDD8";break;case "cold":d.origColorScheme[4]="#FFFFFF";break;default:d.origColorScheme[4]=c.colorschemegeneration}d.szFlag.match(/CHART/)&&d.unpaintMap();try{d.colorScheme=ColorScheme.createColorScheme(d.origColorScheme[1],
d.origColorScheme[2],d.origColorScheme[0],d.origColorScheme[3],d.origColorScheme[4])}catch(u){d.colorScheme=d.defaultColorScheme}d.fRedraw=!0;d.fRedrawInfo=!0}c.symbols&&(d.szSymbolsA=c.symbols.split(c.symbols.match(/\|/)?"|":","),d.fRealize=!0);c.dominantdfilter&&(d.nDominantDFilter=Number(c.dominantdfilter),d.fRealize=!0);c.dominantfilter&&(d.szDominantFilter=String(c.dominantfilter),d.fRealize=!0);c.filter&&(f&&f.match(/remove/)?d.szFilter="":d.szFilter=String(c.filter),d.fRealize=!0,d.unpaintMap());
c.filterfield&&(d.szFilterField=String(c.filterfield),d.fRealize=!0);c.field100min&&(d.nField100Min=c.field100min,d.fRealize=!0);c.overviewchart&&!d.szFlag.match(/CHART/)&&(d.szOverviewChart=c.overviewchart,d.fRedrawInfo=!0);c.evidence&&(d.evidenceMode=c.evidence);c.aggregation&&(d.szAggregation=c.aggregation);c.opacity&&(d.fOpacity=__calcNewValue(d.fOpacity,Number(c.opacity),f));c.fillopacity&&(d.fillOpacity=__calcNewValue(d.fillOpacity,Number(c.fillopacity),f),d.fillOpacity=Math.min(Math.max(d.fillOpacity,
.001),1),d.fRedraw=!0);c.shadow&&(d.fShadow="toggle"==c.shadow?d.fOrigShadow=!d.fOrigShadow:d.fOrigShadow="false"==c.shadow?!1:!0,d.fRedraw=!0);c.blur&&("toggle"==c.blur?d.nBlur?(d.nOldBlur=d.nBlur,d.nBlur=0):d.nBlur=d.nOldBlur||1:d.nBlur=__calcNewValue(d.nBlur,Number(c.blur),f),d.fBlur=!0);c.scale&&(d.fResize=__calcFactor(d.nScale,Number(c.scale),f));c.dopacityscale&&(d.nDopacityScale=__calcNewValue(d.nDopacityScale,Number(c.dopacityscale),f),d.fRedraw=!0);c.d_dopacityscale&&(d.nDopacityScale*=Number(c.d_dopacityscale),
d.fRedraw=!0);c.alphafield&&(d.szAlphaField=String(c.alphafield),d.fRealize=!0);c.alphafield100&&(d.szAlphaField100=String(c.alphafield100),d.fRealize=!0);c.dopacityramp&&(d.szDopacityRamp=c.dopacityramp,d.fRealize=!0);c.dopacitypow&&(d.nDopacityPow=__calcNewValue(d.nDopacityPow,Number(c.dopacitypow),f),d.fRealize=!0);c.rangescale&&(d.nRangeScale=__calcNewValue(d.nRangeScale||1,Number(c.rangescale),f),d.fRedraw=!0);c.sizefield&&(d.szSizeField=String(c.sizefield),d.fRealize=!0);c.labelfield&&(d.szLabelField=
String(c.labelfield),d.fRealize=!0);c.valuefield&&(d.szValueField=String(c.valuefield),d.fRealize=!0);c.normalsizevalue&&(d.nNormalSizeValue||(d.nNormalSizeValue=d.szSizeField?d.nMaxSize:d.nMax),d.nNormalSizeValue=__calcNewValue(d.nNormalSizeValue,Number(c.normalsizevalue),f),d.fRedraw=!0);c.valuedecimals&&(d.szValueDecimals=c.valuedecimals,d.fRedraw=!0);c.valueupper&&(d.szValueUpper=c.valueupper,d.nValueUpper=__scanScaleValue(d.szValueUpper),d.fRedraw=!0);c.titleupper&&(d.szTitleUpper=c.titleupper,
d.nTitleUpper=__scanScaleValue(d.szTitleUpper),d.fRedraw=!0);c.boxupper&&(d.szBoxUpper=c.boxupper,d.nBoxUpper=__scanScaleValue(d.szBoxUpper),d.fRedraw=!0);c.minvaluesize&&(d.nValueSizeMin=__calcNewValue(d.nValueSizeMin,Number(c.minvaluesize),f),d.fRedraw=!0);c.clipvaluesize&&(d.nValueSizeMin=__calcNewValue(d.nValueSizeMin,Number(c.clipvaluesize),f),d.fRedraw=!0);c.minsize&&(d.nChartSizeMin=__calcNewValue(d.nChartSizeMin,Number(c.minsize),f),d.fRedraw=!0);c.minchartsize&&(d.nChartSizeMin=__calcNewValue(d.nChartSizeMin,
Number(c.minchartsize),f),d.fRedraw=!0);c.clipsize&&(d.nChartSizeMin=__calcNewValue(d.nChartSizeMin,Number(c.clipsize),f),d.fRedraw=!0);c.clipparts&&(d.nClipParts=Number(c.clipparts),d.fRedraw=!0);c.showparts&&(d.szShowParts=c.showparts,d.szShowPartsA=c.showparts.split(c.showparts.match(/\|/)?"|":","),map.Themes.unmarkClass(null,e),d.fRedraw=!0);c.gridx&&(d.nGridX=Number(c.gridx)||7,d.fRedraw=!0);c.gridwidth&&(d.szAggregationField=null,"auto"==c.gridwidth?d.nGridWidthPx=d.nGridWidthPx||50:c.gridwidth.match(/px/)?
d.nGridWidthPx=__calcNewValue(d.nGridWidthPx||1,Number(c.gridwidth),f):"factor"==f?d.nGridWidthPx?d.nGridWidthPx=__calcNewValue(d.nGridWidthPx||1,Number(c.gridwidth),f):d.nGridWidth=__calcNewValue(d.nGridWidth||1E3,Number(c.gridwidth),f):(d.nGridWidthPx=null,d.nGridWidth=__calcNewValue(d.nGridWidth||1,Number(c.gridwidth),f)),d.fRealize=!0,d.fRedraw=!0,d.fSuppressAggregationScale=!0,d.unpaintMap(),d.themeNodesPosA=[]);c.gridmatrix&&(d.szAggregationField=null,d.nGridMatrix=__calcNewValue(d.nGridMatrix||
1,Number(c.gridmatrix),f),d.fRealize=!0,d.fRedraw=!0,d.fSuppressAggregationScale=!0,d.unpaintMap(),d.themeNodesPosA=[]);c.gridwidthpx&&(d.szAggregationField=null,d.nGridWidthPx=__calcNewValue(d.nGridWidthPx||50,Number(c.gridwidthpx),f),d.fRealize=!0,d.fRedraw=!0,d.fSuppressAggregationScale=!0,d.unpaintMap(),d.themeNodesPosA=[]);c.aggregationfield&&(d.szAggregationField=c.aggregationfield,d.fRealize=!0,d.fRedraw=!0,d.fSuppressAggregationScale=!0,d.unpaintMap(),d.themeNodesPosA=[]);c.snippet&&(d.szSnippet=
unescape(c.snippet),d.fRealize=!0);c.title&&(d.szTitle=unescape(c.title),d.fRealize=!0)}d.fRedrawInfo=!0;executeWithMessage("map.Themes.execute()","... processing ...")}};Map.Themes.prototype.getThemeLayerList=function(){for(var e=[],c,f=0;f<this.themesA.length;f++)if(this.themesA[f].objThemesA&&!this.themesA[f].fRemove)for(c in this.themesA[f].objThemesA)e[e.length]=c;return e};
Map.Themes.prototype.isThemeLayerUsed=function(e){for(var c=this.getThemeLayerList(),f=0;f<c.length;f++)if(e==c[f])return!0;return!1};Map.Themes.prototype.isNodePartOfAnyTheme=function(e){if(e=map.Layer.getLayerObjOfNode(e))for(var c=map.Themes.getThemeLayerList(),f=0;f<c.length;f++)if(e.szName==c[f])return!0;return!1};Map.Themes.prototype.resetThemeNodesCache=function(){this.themeNodesA=[];this.themeNodes=0};
Map.Themes.prototype.addToThemeNodesCache=function(e){var c=0;nodeA=e.getElementsByTagName("g");for(n=0;n<nodeA.length;n++)if(e=String(map.Tiles.getMasterId(nodeA.item(n).getAttributeNS(null,"id"))))map.Themes.themeNodesA[e]||(map.Themes.themeNodesA[e]=[]),map.Themes.themeNodesA[e].push(nodeA.item(n)),map.Themes.themeNodes++,c++};
Map.Themes.prototype.removeFromThemeNodesCache=function(e){var c=0;nodeA=e.getElementsByTagName("g");for(n=0;n<nodeA.length;n++)if((e=String(map.Tiles.getMasterId(nodeA.item(n).getAttributeNS(null,"id"))))&&map.Themes.themeNodesA[e]){var f=map.Themes.themeNodesA[e].indexOf(nodeA.item(n));-1<f&&(map.Themes.themeNodesA[e].splice(f,1),c++)}};Map.Themes.prototype.setActive=function(e){this.activeTheme=e};
Map.Themes.prototype.minimizeInfo=function(e,c){var f=this.getTheme(c.split(":")[0]);if(f){var d=f.widgetNode.firstChild;if(d){var h=Number(d.getAttributeNS(szMapNs,"titleheight"));0>=h&&(h=420);for(var d=d.childNodes,g=0;g<d.length;g++){var l=d.item(g),k=l.getAttributeNS(null,"id");k.match(/body/)&&l.style.setProperty("display","none","");k.match(/footer/)&&l.style.setProperty("display","none","");k.match(/backgroundrect/)&&(l.setAttributeNS(szMapNs,"maxheight",l.getAttributeNS(null,"height")),l.setAttributeNS(null,
"height",h));k.match(/shadowrect/)&&(l.setAttributeNS(szMapNs,"maxheight",l.getAttributeNS(null,"height")),l.setAttributeNS(null,"height",String(h-100)));k.match(/minimizebutton/)&&l.style.setProperty("display","none","")}f.minimizebutton.nodeObj.style.setProperty("display","none","");f.morebutton.nodeObj.style.setProperty("display","none","");f.addDefinitionToFlag("MINIMIZED")}}};
Map.Themes.prototype.maximizeInfo=function(e,c){var f=this.getTheme(c.split(":")[0]);if(f){var d=f.widgetNode.firstChild;if(d){for(var d=d.childNodes,h=0;h<d.length;h++){var g=d.item(h),l=g.getAttributeNS(null,"id");l.match(/body/)&&g.style.setProperty("display","inline","");l.match(/footer/)&&g.style.setProperty("display","inline","");l.match(/backgroundrect/)&&g.setAttributeNS(null,"height",g.getAttributeNS(szMapNs,"maxheight"));l.match(/shadowrect/)&&g.setAttributeNS(null,"height",g.getAttributeNS(szMapNs,
"maxheight"));l.match(/minimizebutton/)&&g.style.setProperty("display","inline","")}f.minimizebutton.nodeObj.style.setProperty("display","inline","");f.morebutton.nodeObj.style.setProperty("display","inline","");f.removeDefinitionFromFlag("MINIMIZED")}}};
Map.Themes.prototype.getChartAll=function(e,c,f){for(var d=c.getAttributeNS(null,"id"),h=0,g=0;g<this.themesA.length;g++){var l=map.Dom.newGroup(c,d+":C1");this.getChart(e,l,f,this.themesA[g]);var k=map.Dom.getBox(l);0>k.width&&(k=new box(0,0,0,0));l.fu.setPosition(0,h);h+=k.height+map.Scale.normalY(10)}};
Map.Themes.prototype.getChart=function(e,c,f,d){d||(d=this.activeTheme);if(!d)return null;e&&":paint"==e.substr(e.length-6,6)&&(e=e.substr(0,e.length-6));if(d.szFlag.match(/CHOROPLETHE/)&&d.szFlag.match(/DOMINANT/)){var h=30;2<d.nOrigSumA.length&&(h=15*d.nOrigSumA.length/Math.log(d.nOrigSumA.length));f=map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":1");if(d.szFlag.match(/PERCENTOFMEAN/)||d.szFlag.match(/PERCENTOFMEDIAN/)||d.szFlag.match(/DEVIATION/)){d.drawChart(f,e,h,"CHART|BAR|VALUES|ZOOM",e&&
d.itemA[e]?d.itemA[e].nDominant:null);var g=map.Dom.getBox(f);0>g.width&&(g=new box(0,0,0,0));f=map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":2");d.drawChart(f,e,h,"VALUES|ZOOM");e=map.Dom.getBox(f);c=1<d.nOrigSumA.length?g.width/e.width*1.015:e.width/e.height;f.fu.setPosition(e.x-g.x,g.height+g.y+Math.min(map.Scale.normalY(200),Math.max(map.Scale.normalY(10),-e.y+map.Scale.normalY(6))));f.fu.scale(c,1);d=d.szFlag.match(/PERCENTOFMEDIAN/)?"median":"mean";e=e.width;map.Dom.newText(f,e,map.Scale.normalY(.9),
"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText(d));map.Dom.newText(f,e,map.Scale.normalY(5.5),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText("-"));map.Dom.newText(f,e,map.Scale.normalY(-3.7),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText("+"))}else c="CHART|BAR|SPACED|VALUES|ZOOM",d.szFlag.match(/3D/)&&(c+="|3D"),d.szFlag.match(/SORT/)&&(c+="|SORT"),
d.szFlag.match(/HORZ/)&&(c+="|HORZ|AXIS"),d.drawChart(f,e,h,c,null);return new point(0,map.Scale.normalY(30))}if(d.szFlag.match(/BUFFER/)&&d.szFlag.match(/CHART/))return null;if(d.szFlag.match(/CHOROPLETHE/)&&d.itemA[e])return h=d.itemA[e].nValuesA[0],f=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1),h=d.szFlag.match(/EXACT/)&&d.szLabelA&&d.szLabelA.length?d.szLabelA[h-1]:d.formatValue(h,2)+d.szUnit,map.Dom.newText(c,-40,0,f+";font-weight:normal;fill:#444444",h),!d.szFlag.match(/EXACT/)&&(d.szChoropletheInfoStyle.match(/HISTOGRAM/)||
d.szChoropletheInfoStyle.match(/histogram/)||d.szChoropletheInfoStyle.match(/CLASSES/)||d.szChoropletheInfoStyle.match(/classes/))&&(h=d.szChoropletheInfoStyle.match(/HISTOGRAM/)||d.szChoropletheInfoStyle.match(/histogram/),f=map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":histogram"),this.getHistogram(e,f,h?"DISTRIBUTION":"CLASSES",d),f.fu.setPosition(0,map.Scale.normalY(4))),new point(0,0);if(d.szFlag.match(/INFOSIZE/))return d.drawChart(c,e,30,f);h=30;d.szFlag.match(/SEQUENCE/)&&(h=25);d.szFlag.match(/BAR/)&&
(d.szFlag.match(/STACKED/)?h=30:2>=d.nOrigSumA.length?h=30:(d.szFlag.match(/UP/)||d.szFlag.match(/CENTER/)||d.szFlag.match(/SEQUENCE/),h=15*d.nOrigSumA.length/Math.log(d.nOrigSumA.length)));return d.drawChart(c,e,h,f)};
Map.Themes.prototype.getSummary=function(e,c){c||(c=this.activeTheme);if(!c||!e)return null;c.itemA[e]||(aA=e.split("::"),1<aA.length&&(e=aA[0]+"::"+String(aA[1]).toUpperCase()));if(!c.itemA[e])return null;for(var f=c.itemA[e].nOrigValuesA,d=0,h=0;h<f.length;h++)isNaN(f[h])&&(f[h]=0),d+=f[h];c.szFlag.match(/DIFFERENCE/)&&(d=f[f.length-1]);if(c.itemA[e].nValue100)return c.szUnits100=c.szUnits100||"",c.szFlag.match(/RELATIVE/)||c.szFlag.match(/DIFFERENCE/)?map.Dictionary.getLocalText("Relative to")+
": "+String(__formatValue(c.itemA[e].nValue100,2))+" "+(c.szUnits100||""):c.itemA[e].nSize?c.szAggregation.match(/sum/)?map.Dictionary.getLocalText("Counted")+": "+String(__formatValue(c.itemA[e].nSize,2))+" "+(c.szUnits100||""):map.Dictionary.getLocalText("Total")+": "+String(__formatValue(c.itemA[e].nSize,2))+" "+(c.szUnits100||""):d!=c.itemA[e].nValue100?String(__formatValue(d,2))+" / "+String(__formatValue(c.itemA[e].nValue100,2))+" "+(c.szUnits100||""):map.Dictionary.getLocalText("Total")+": "+
String(__formatValue(d,2))+" "+(c.szUnits100||"");if(c.itemA[e].nSize)return c.szFlag.match(/EXACT/)&&1==c.itemA[e].nValuesA.length&&c.szValueField?c.szLabelA[c.itemA[e].nValuesA[0]-1]:map.Dictionary.getLocalText("Total")+": "+String(__formatValue(c.itemA[e].nSize,2))+" "+(c.szSizeValueUnits||"");if(c.itemA[e].nAlpha)return map.Dictionary.getLocalText("Alpha value")+": "+String(__formatValue(c.itemA[e].nAlpha,2))+" "+(c.szAlphaValueUnits||"");!c.szFlag.match(/SUM/)||c.szFlag.match(/SEQUENCE/)||c.szFlag.match(/CLIP/);
return null};
Map.Themes.prototype.getValueComment=function(e,c){c||(c=this.activeTheme);if(!c||!e)return null;c.itemA[e]||(aA=e.split("::"),1<aA.length&&(e=aA[0]+"::"+String(aA[1]).toUpperCase()));if(!c.itemA[e])return null;for(var f=c.itemA[e].nOrigValuesA,d=0;d<f.length;d++)isNaN(f[d])&&(f[d]=0);c.szFlag.match(/DIFFERENCE/);return c.szFlag.match(/OFFSETMEAN/)?map.Dictionary.getLocalText("value")+": "+String(__formatValue(c.itemA[e].nValuesA[0],2))+" "+map.Dictionary.getLocalText("mean")+": "+String(__formatValue(c.nMeanA[0],2)):
null};Map.Themes.prototype.getTitle=function(e,c){c||(c=this.activeTheme);if(!c||!e)return null;c.itemA[e]||(aA=e.split("::"),1<aA.length&&(e=aA[0]+"::"+String(aA[1]).toUpperCase()));return c.itemA[e]?c.itemA[e].szTitle||null:null};Map.Themes.prototype.getLabel=function(e,c){c||(c=this.activeTheme);if(!c||!e)return null;c.itemA[e]||(aA=e.split("::"),1<aA.length&&(e=aA[0]+"::"+String(aA[1]).toUpperCase()));return c.itemA[e]?c.itemA[e].szLabel||null:null};
Map.Themes.prototype.getTextObjects=function(){for(var e=[],c=0;c<this.themesA.length;c++)if(this.themesA[c].szFlag.match(/TEXTONLY/)&&this.themesA[c].chartGroup)if("undefined"!=typeof this.themesA[c].markedClass&&null!=this.themesA[c].markedClass){nClass=this.themesA[c].markedClass;var f=this.themesA[c].chartGroup.getElementsByTagName("text");for(n=0;n<f.length;n++)0<f.item(n).firstChild.nodeValue.length&&Number(f.item(n).getAttributeNS(szMapNs,"class"))==nClass&&e.push(f.item(n))}else for(f=this.themesA[c].chartGroup.getElementsByTagName("text"),
n=0;n<f.length;n++)0<f.item(n).firstChild.nodeValue.length&&e.push(f.item(n));return e};Map.Themes.prototype.getMaxValue=function(e,c){c||(c=this.activeTheme);if(!c||!e)return null;for(var f=0,d=c.itemA[e].nValuesA,h=0;h<d.length;h++)isNaN(d[h])&&(d[h]=0),f=Math.max(f,d[h]);return f};
Map.Themes.prototype.getDataRow=function(e,c){c||(c=this.activeTheme);if(!c||!e)return null;c.itemA[e]||(aA=e.split("::"))&&1<aA.length&&(e=aA[0]+"::"+String(aA[1]).toUpperCase());if(!c.itemA[e]||c.szFlag.match(/AGGREGATE/)&&1<c.itemA[e].nCount)return null;var f=c.objThemesA[c.szThemesA[0]],d=[];if(c.szDataFieldsA)for(var h=0;h<c.szDataFieldsA.length;h++)for(var g=0;g<f.dbFields.length;g++)c.szDataFieldsA[h]==f.dbFields[g].id&&d.push(g);else for(g=0;g<f.dbFields.length;g++)d.push(g);var l=[];if(f.dbRecords){if("undefined"!=
typeof c.itemA[e].dbIndex){for(var h=c.itemA[e].dbIndex,k=!0,m=0,u=0,g=0;g<f.dbFields.length;g++)isNaN(f.dbRecords[h][g])&&(k=!1),m=Math.max(m,f.dbFields[g].id.length),u=Math.max(u,f.dbRecords[h][g].length);if(k||m>2*u){for(g=0;g<d.length;g++)l.push(f.dbRecords[h][d[g]]);for(g=0;g<d.length;g++)l.push(f.dbFields[d[g]].id)}else{for(g=0;g<d.length;g++)l.push(f.dbFields[d[g]].id);for(g=0;g<d.length;g++)l.push(f.dbRecords[h][d[g]])}return l}e=e.split("::")[1];for(h=0;h<f.dbRecords.length;h++)if(f.dbRecords[h]&&
f.dbRecords[h][f.nFieldSelectionIndex]&&String(f.dbRecords[h][f.nFieldSelectionIndex]).toUpperCase()==String(e).toUpperCase()){for(g=0;g<f.dbFields.length;g++)l.push(f.dbFields[g].id);for(g=0;g<f.dbFields.length;g++)l.push(f.dbRecords[h][g]);break}}return l};
Map.Themes.prototype.getFieldIndexArray=function(e){e||(e=this.activeTheme);if(!e||e.szDataFieldsA)return[];e.fieldIndexArray=[];for(var c=0;c<e.objThemesA[e.szThemesA[0]].nFieldIndexA.length;c++)e.fieldIndexArray.push(e.objThemesA[e.szThemesA[0]].nFieldIndexA[c]);0<=e.objThemesA[e.szThemesA[0]].nField100Index&&e.fieldIndexArray.push(e.objThemesA[e.szThemesA[0]].nField100Index);return e.fieldIndexArray};
Map.Themes.prototype.getScatterArray=function(e,c,f){e||(e=this.activeTheme);var d=0,h=e.nMin,g=e.nMax,l=0,k;f.match(/LOG/)&&(l=1-h,h=Math.log(h+l),g=Math.log(g+l));for(var g=(g-h)/c,m=[],u=0;u<c+1;u++)m[u]=0;for(k in e.itemA)u=e.itemA[k].nValuesA[0],"number"==typeof u&&(f.match(/LOG/)&&(u=Math.log(u+l)),nPos=Math.max(0,Math.min(c-1,Math.floor((u-h)/g))),m[nPos]++,d=Math.max(d,m[nPos]));return m};
Map.Themes.prototype.getResolutionQualityOfArray=function(e){for(var c=e.length,f=-1E6,d=0;d<c;d++)f=Math.max(f,e[d]);for(d=nCount=0;d<c;d++)e[d]>f/10&&nCount++;return nCount/c*100};Map.Themes.prototype.getDeviationOfArray=function(e){for(var c=e.length,f=-1E6,d=0,h=0,g=0,g=0;g<c;g++)f=Math.max(f,e[g]),d+=e[g];d/=c;for(g=0;g<c;g++)h+=(e[g]-d)*(e[g]-d);return g=Math.sqrt(h/c)};
Map.Themes.prototype.getHistogram=function(e,c,f,d){if(!c)return null;d||(d=this.activeTheme);if(!d||d.nMin==d.nMax||e&&(d.itemA[e]||(aA=e.split("::"),1<aA.length&&(e=aA[0]+"::"+String(aA[1]).toUpperCase())),!d.itemA[e]))return null;this.histGroup=map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":group");this.histFlag=f;this.histTheme=d;c=map.Scale.normalX(70);f=map.Scale.normalY(20);map.Dom.newShape("rect",this.histGroup,0,0,c-map.Scale.normalX(.5),f,"fill:none;stroke:none;");e?setTimeout("map.Themes.makeHistogram('"+
e+"')",100):setTimeout("map.Themes.makeHistogram()",100)};
Map.Themes.prototype.makeHistogram=function(e){var c,f=this.histGroup,d=this.histFlag,h=this.histTheme;if(d.match("CLASSES")){for(var g=map.Scale.normalX(50),l=map.Scale.normalY(5),k=g/h.colorScheme.length,m=0,u=0,z=e?h.itemA[e].nValuesA[0]:0,q=0,y=0;y<h.partsA.length;y++){var k=g/h.nCount*h.partsA[y].nCount,r=map.Dom.newShape("rect",f,m,u,k,l,"fill:"+h.colorScheme[y]+";stroke:black;stroke-width:1;");r&&r.setAttributeNS(szMapNs,"tooltip",h.szLegendLabelA[y]+" ("+h.formatValue(h.partsA[y].nCount)+
" "+map.Dictionary.getLocalText("members")+")");m+=k;z>h.partsA[y].max?q+=k:z>h.partsA[y].min&&(q+=k/(h.partsA[y].max-h.partsA[y].min)*(z-h.partsA[y].min))}map.Dom.newShape("circle",f,q,-map.Scale.normalX(.1),map.Scale.normalX(1),"fill:#444444;stroke:none;")}else if(d.match("DISTRIBUTION")){q=Math.min(140,Math.max(20,h.nCount/5));q=Math.min(500,Math.max(20,h.nCount/5));g=map.Scale.normalX(70);l=map.Scale.normalY(12);d.match("INTERACTIVE")&&(l=map.Scale.normalY(20));c=g/q;var z=e?h.itemA[e].nValuesA[0]:
0,D=0,w=h.nMin,C=h.nMax,B=0,J=this.getScatterArray(h,q,""),y=this.getDeviationOfArray(J),m=this.getScatterArray(h,q,"LOG"),u=this.getDeviationOfArray(m),K=!1,la=(C-w)/q;u&&u<y&&(J=m,B=1-w,w=Math.log(w+B),C=Math.log(C+B),z=Math.log(z+B),la=(C-w)/q,K=!0);for(y=0;y<q;y++)D=Math.max(D,J[y]);m=-20;u=0;h.histogram=new Map.Histogram(h);h.histogram.fDoLog=K;h.histogram.dValue=B;h.histogram.nWidth=g;h.histogram.nMin=w;h.histogram.nMax=C;for(var H=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4),v=0,
y=0;y<h.partsA.length;y++){k=(K?g/(C-w)*(Math.min(C,Math.log(h.partsA[y].max+B))-w):g/(C-w)*(Math.min(C,h.partsA[y].max)-w))-m;if(r=map.Dom.newShape("rect",f,m,u,k,l,"fill:"+h.colorScheme[y]+";stroke:black;stroke-width:"+map.Scale.normalX(.2)+";stroke-opacity:0.1"))r.setAttributeNS(szMapNs,"tooltip",h.szLegendLabelA[y]+" ("+h.formatValue(h.partsA[y].nCount)+" "+map.Dictionary.getLocalText("members")+")"),r.setAttributeNS(szMapNs,"onoverstyle","fill:"+h.colorScheme[y]+";stroke:black;stroke-width:"+
map.Scale.normalX(.5)+";"),r.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+h.szId+"','"+y+"','1')"),r.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+h.szId+"')");h.histogram.classRectA[y]=r;h.histogram.classRectXA[y]=m;h.histogram.classRectWidthA[y]=k;h.histogram.classRectMaxA[y]=h.partsA[y].max;if(d.match("INTERACTIVE")){var r=map.Dom.newGroup(f,""),I=null;if(0<y){map.Dom.newShape("line",r,m,u-map.Scale.normalY(2),m,u+l,"stroke:black;stroke-width:"+map.Scale.normalX(.5)+
";stroke-opacity:0.5");if(I=map.Dom.newShape("rect",r,m-map.Scale.normalY(1.5),u-map.Scale.normalY(6),map.Scale.normalX(3),map.Scale.normalY(5),"fill:"+h.colorScheme[y]+";stroke:black;styroke-width(1);"))I.setAttributeNS(null,"rx",map.Scale.normalX(2)),I.setAttributeNS(null,"ry",map.Scale.normalY(1.5));I=map.Dom.newText(r,m,u-map.Scale.normalY(7),H+"display:none;font-weight:normal;text-anchor:middle",h.formatValue(h.partsA[y-1].max,1))}v=new Slider(r,new box(-v,0,v+k,0));v.setId(String(y));v.parent=
h.histogram;v.textObj=I;v=k}m+=k}m=c/3;u=0;nScalingFactor=.9;y=this.getResolutionQualityOfArray(J);10>y&&(nScalingFactor=10-y);for(y=0;y<q;y++){C=J[y]/D*l*nScalingFactor;k=K?Math.exp(w+y*la)-B:w+y*la;v=K?Math.exp(w+(y+1)*la)-B:w+(y+1)*la;H="black";C=C&&!isNaN(C)?Math.min(l,Math.max(map.Scale.normalY(.5),C)):0;if(H=map.Dom.newShape("line",f,m,u+l,m,u+l-C,"stroke:"+H+";stroke-width:"+c+";"))H.setAttributeNS(szMapNs,"tooltip",h.formatValue(k,2)+" ... "+h.formatValue(v,2)+h.szUnit+" ("+J[y]+" members)"),
H.setAttributeNS(szMapNs,"onoverstyle","stroke:yellow;stroke-width:"+Math.max(map.Scale.normalX(1),c)+";");m+=c}map.Dom.newShape("line",f,-map.Scale.normalX(.5),l+1,g-map.Scale.normalX(.5),l+1,"stroke:black;stroke-width:"+map.Scale.normalX(.1)+";");q=-map.Scale.normalX(.5);g-=map.Scale.normalX(.5);m=map.Scale.normalX(2);map.Dom.newShape("line",f,q,l,q,l+m,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");map.Dom.newShape("line",f,g,l,g,l+m,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+
";");k=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4);u=.4*map.Scale.tStyle.Summary.nFontHeight;J=l+m+.8*u;y=h.formatValue(h.nMin,0);D=h.formatValue(h.nMax,0);map.Dom.newText(f,q-10,J,k+";font-weight:normal;text-anchor:start",y);0>h.nMin&&0<h.nMax&&(q=(0-w)/la*c,map.Dom.newShape("line",f,q,l,q,l+m,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";"),map.Dom.newText(f,q,J,k+";font-weight:normal;text-anchor:start","0"));C=0;for(y=10;y<h.nMax;y*=10)for(H=1;9>H&&!(y*H>h.nMax||y*H<h.nMin);H++)q=
((K?Math.log(y*H+B):y*H)-w)/la*c,v=h.formatValue(y*H,0),q>C+v.length*u*3/8?(map.Dom.newShape("line",f,q,l,q,l+m,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";"),map.Dom.newText(f,q,J,k+";font-weight:normal;text-anchor:middle",v),C=q+v.length*u*3/8):map.Dom.newShape("line",f,q,l,q,l+m/2,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");g>C+D.length*u*3/8&&map.Dom.newText(f,g,J,k+";font-weight:normal;text-anchor:middle;",D);e&&!d.match("INTERACTIVE")&&(q=(z-w)/la*c,map.Dom.newShape("circle",
f,q,-map.Scale.normalX(.1),map.Scale.normalX(1),"fill:#dd0000;stroke:none;"),map.Dom.newShape("line",f,-10,-5,q-10,-5,"stroke:#000000;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.3"))}else{g=map.Scale.normalX(70);l=map.Scale.normalY(12);k=g/700;u=m=0;C=h.nMax;e=l/C;c=Math.max(1,Math.ceil(h.nCount/700));d=[];w=0;B=[];for(z in h.itemA)B.push(h.itemA[z].nValuesA[0]);B.sort(h.sortUp);for(z in B)w%c?d[d.length-1]+=B[z]/c:d[d.length]=B[z]/c,w++;d.sort(h.sortUp);for(y=0;y<d.length;y++){z=d[y];
C=d[y]*e*.9;H="black";for(c=0;c<h.partsA.length;c++)if(d[y]<h.partsA[c].max){H=h.colorScheme[c];break}H=map.Dom.newShape("line",f,m,u,m,l,"stroke:"+H+";stroke-width:"+k+";");H.setAttributeNS(szMapNs,"tooltip",h.formatValue(z,2)+h.szUnit);isNaN(C)&&(C=0);H=map.Dom.newShape("line",f,m,u+l,m,u+l-C,"stroke:#000000;stroke-width:"+k+";");H.setAttributeNS(szMapNs,"tooltip",h.formatValue(z,2)+h.szUnit);m+=k}y=h.formatValue(h.nMin,0);D=h.formatValue(h.nMax,0);k=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,
.4);map.Dom.newText(f,m+map.Scale.normalX(1),u+l,k+";font-weight:normal;text-anchor:start;stroke-opacity:0.8;",y);map.Dom.newText(f,m+map.Scale.normalX(1),u+map.Scale.normalY(3.5),k+";font-weight:normal;text-anchor:start;stroke-opacity:0.8;",D);f&&f.fu.scale(g/m,1)}return f};Map.Histogram=function(e){this.mapTheme=e;this.fDoLog=!1;this.dValue=0;this.classRectA=[];this.classRectXA=[];this.classRectWidthA=[];this.classRectMaxA=[]};Map.Histogram.prototype=new Map;
Map.Histogram.prototype.onMouseOver=function(e,c,f){f.textObj&&f.textObj.style.setProperty("display","inline","")};Map.Histogram.prototype.onMouseOut=function(e,c,f){f.textObj&&f.textObj.style.setProperty("display","none","")};
Map.Histogram.prototype.onMouseMove=function(e,c,f){if(e=this.classRectA[Number(c)])e.setAttributeNS(null,"x",this.classRectXA[Number(c)]+f.value.x),e.setAttributeNS(null,"width",this.classRectWidthA[Number(c)]-f.value.x);if(e=this.classRectA[Number(c)-1]){e.setAttributeNS(null,"width",this.classRectWidthA[Number(c)-1]+f.value.x);var d=this.nMin+(this.nMax-this.nMin)/this.nWidth*(this.classRectXA[Number(c)]+f.value.x),d=this.fDoLog?Math.exp(d)-this.dValue:d;this.classRectMaxA[Number(c)-1]=d}f.textObj&&
(f.textObj.firstChild.nodeValue=__formatValue(d,1))};Map.Histogram.prototype.onMouseUp=function(e,c,f){(f=this.classRectA[Number(c)-1])&&(this.classRectWidthA[Number(c)-1]=f.getAttributeNS(null,"width"));c="ranges:"+String(this.nMin);for(f=0;f<this.classRectMaxA.length;f++)c+=","+String(this.classRectMaxA[f]);map.Themes.changeThemeStyle(e,this.mapTheme.szId,c)};Map.Themes.prototype.showErrorInfo=function(e,c){var f=this.getTheme(c.split(":")[0]);f&&f.showErrorInfo()};
Map.Themes.prototype.actualizeActiveTheme=function(e){for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szFlag.match(/CHART/))if(e&&1!=e&&this.themesA[c].szFlag.match(/DYNAMICSCALE/)&&(this.themesA[c].nScale*=Math.sqrt(e),this.themesA[c].fRealize=!0,this.themesA[c].fRedraw=!1,this.themesA[c].unpaintMap()),this.themesA[c].szFlag.match(/DECLUTTER/)&&(this.themesA[c].fDeclutter=!0,map.Themes.execute()),e&&1!=e&&(this.themesA[c].nChartSizeMin||this.themesA[c].nValueSizeMin||this.themesA[c].szAggregationFieldA||
this.themesA[c].nGridWidth||this.themesA[c].nGridMatrix||this.themesA[c].nGridWidthPx||this.themesA[c].nChartUpper||this.themesA[c].nValueUpper||this.themesA[c].nBoxUpper||this.themesA[c].nTitleUpper||this.themesA[c].nLabelUpper))if(this.themesA[c].fRealizeDone&&(this.themesA[c].szFlag.match(/AUTOGRID/)||this.themesA[c].nGridWidthPx||this.themesA[c].szAggregationFieldA)){this.themesA[c].fRealize=!0;this.themesA[c].fRedraw=!1;this.themesA[c].unpaintMap();this.themesA[c].themeNodesPosA=[];if(this.themesA[c].szAggregationFieldA)for(var f=
0;f<this.themesA[c].szAggregationFieldA.length;f++){var d=Number(this.themesA[c].szAggregationFieldA[f].split(":")[1]);d&&map.Scale.getTrueMapScale()*map.Scale.nZoomScale>d&&(isNaN(parseFloat(this.themesA[c].szAggregationFieldA[f+1]))?this.themesA[c].szAggregationField=this.themesA[c].szAggregationFieldA[f+1]:(this.themesA[c].nGridWidthPx=parseFloat(this.themesA[c].szAggregationFieldA[f+1]),this.themesA[c].szAggregationField=null));f++}this.themesA[c].nGridWidthPx?(f=map.Scale.getDistanceInMeter(1E3,
1E3,1E3+map.Scale.normalX(this.themesA[c].nGridWidthPx),1E3),this.themesA[c].nGridWidth=f/map.Scale.nZoomScale):(f=map.Zoom.getBox(),f=map.Scale.getDistanceInMeter(1E3,1E3,1E3+f.width,1E3),this.themesA[c].nGridWidth=f/(this.themesA[c].nGridMatrix||20)/map.Scale.nZoomScale)}else this.themesA[c].fRealizeDone&&1>e&&(this.themesA[c].nChartSizeMin||this.themesA[c].nValueSizeMin)&&this.themesA[c].unpaintMap(),this.themesA[c].fRedraw=!0;else this.themesA[c].szFlag.match(/AGGREGATE/)?this.themesA[c].fRedraw=
!0:this.themesA[c].fActualize=!0;else this.themesA[c].isChecked&&!this.themesA[c].fMarkClass&&(this.themesA[c].fRedraw=!0);map.Themes.execute();return null};Map.Themes.prototype.resortCharts=function(e){var c=!1;if(this.themesA.length){for(var f=0;f<this.themesA.length;f++)this.themesA[f].fDone&&(c=this.themesA[f].fResort=!0);c&&map.Themes.execute()}e&&(e.stopPropagation(),e.preventDefault())};Map.Themes.prototype.clear=function(){this.themesA.length=0};
function ObjTheme(e,c,f,d,h){this.szName=e;this.coTable=f;this.szSelectionField=d;this.szItemField=h;this.nIndex=c;this.nFieldIndexA=[];this.nFieldSelectionIndex=this.nField100Index=-1;this.nFieldSelectionIndexA=[];this.nLabelFieldIndex=this.nValueFieldIndex=this.nFieldItemIndex=-1;this.leadOffset=!1}
ObjTheme.prototype.getFields=function(){this.szFields=this.theme.szFields;this.szFieldsA=this.theme.szFields.split("|");this.szField100=this.theme.szField100;this.szValueField=this.theme.szValueField;this.szLabelField=this.theme.szLabelField;this.szTitleField=this.theme.szTitleField;this.szSnippetField=this.theme.szSnippetField;this.szSizeField=this.theme.szSizeField;this.szAlphaField=this.theme.szAlphaField;this.szAlphaField100=this.theme.szAlphaField100;this.szFilterField=this.theme.szFilterField;
this.szAggregationField=this.theme.szAggregationField;this.szSelectionFieldsA=(this.theme.szSelectionField||"").split("|");this.nFieldIndexA[0]=-1;this.nFieldSelectionIndexA[0]=-1;var e,c;c=this.coTable?this.coTable:this.szName;if(!this.szFields||""==this.szFields)return!0;try{eval("this.dbTable = "+c+".table")}catch(f){try{eval("this.dbTable = "+c+"_table")}catch(d){}}if(this.coTable&&!this.dbTable)return displayMessage("Data not loaded!",1E3,!0),!1;if(this.dbTable){try{eval("this.dbFields = "+c+
".fields")}catch(h){try{eval("this.dbFields = "+c+"_fields")}catch(g){}}try{this.szSelectionField||(this.szSelectionField=map.Layer.getLayerObj(this.szName).szSelection)}catch(l){return alert("no selection field found !!"),!1}for(e=0;e<this.dbTable.fields;e++)if(!this.dbFields||0==this.dbFields.length||!this.dbFields[e]||!this.dbFields[e].id)return alert("ERROR: theme '"+this.szName+"' - table '"+c+".js' - object 'fields' incorrect !"),!1;for(e=0;e<this.dbFields.length;e++){"undefined"!=typeof this.szItemField&&
String(this.dbFields[e].id).toLowerCase()==String(this.szItemField).toLowerCase()&&(this.nFieldItemIndex=e);"undefined"!=typeof this.szSelectionField&&String(this.dbFields[e].id).toLowerCase()==String(this.szSelectionField).toLowerCase()&&(this.nFieldSelectionIndex=e);for(c=0;c<this.szSelectionFieldsA.length;c++)this.dbFields[e].id==this.szSelectionFieldsA[c]&&(this.nFieldSelectionIndexA[c]=e);for(c=0;c<this.szFieldsA.length;c++)"!"==this.szFieldsA[c].substr(0,1)?this.dbFields[e].id==this.szFieldsA[c].substr(1,
this.szFieldsA[c].length-1)&&(this.nFieldIndexA[c]=e):this.dbFields[e].id==this.szFieldsA[c]&&(this.nFieldIndexA[c]=e);this.szField100&&this.dbFields[e].id==this.szField100&&(this.nField100Index=e);this.szValueField&&this.dbFields[e].id==this.szValueField&&(this.nValueFieldIndex=e);this.szLabelField&&this.dbFields[e].id==this.szLabelField&&(this.nLabelFieldIndex=e);this.szTitleField&&this.dbFields[e].id==this.szTitleField&&(this.nTitleFieldIndex=e);this.szSnippetField&&this.dbFields[e].id==this.szSnippetField&&
(this.nSnippetFieldIndex=e);this.szSizeField&&this.dbFields[e].id==this.szSizeField&&(this.nSizeFieldIndex=e);this.szAlphaField&&this.dbFields[e].id==this.szAlphaField&&(this.nAlphaFieldIndex=e);this.szAlphaField100&&this.dbFields[e].id==this.szAlphaField100&&(this.nAlphaField100Index=e);this.szFilterField&&this.dbFields[e].id==this.szFilterField&&(this.nFilterFieldIndex=e);this.szAggregationField&&this.dbFields[e].id==this.szAggregationField&&(this.nAggregationFieldIndex=e)}-1==this.nFieldSelectionIndex&&
-1==this.nFieldSelectionIndexA[0]&&(this.szSelectionField&&this.szSelectionField.length?alert("ERROR: theme '"+this.szName+"' selection field '"+this.szSelectionField+"' not found !"):alert("ERROR: theme '"+this.szName+"', selection not defined !"));for(c=0;c<this.szFieldsA.length;c++)if("undefined"==typeof this.nFieldIndexA[c])return alert("ERROR: theme '"+this.szName+"' value field '"+this.szFieldsA[c]+"' not found !"),!1}else{e=SVGDocument.getElementById(this.szName);null==e&&(c=map.Tiles.getTileNodes(this.szName))&&
(e=c[0]);if(!e)return this.szName="",!1;e=e.getAttributeNS(szMapNs,"info");if(null==e||""==e)return this.szName="",!1;var k=e.split("|");for(e=0;e<k.length;e++){for(c=0;c<this.szFieldsA.length;c++)"!"==this.szFieldsA[c].substr(0,1)?k[e]==this.szFieldsA[c].substr(1,this.szFieldsA[c].length-1)&&(this.nFieldIndexA[c]=e):k[e]==this.szFieldsA[c]&&(this.nFieldIndexA[c]=e);this.szField100&&k[e]==this.szField100&&(this.nField100Index=e);this.szValueField&&k[e]==this.szValueField&&(this.nValueFieldIndex=e);
this.szLabelField&&k[e]==this.szLabelField&&(this.nLabelFieldIndex=e);this.szSizeField&&k[e]==this.szSizeField&&(this.nSizeFieldIndex=e);this.szAlphaField&&k[e]==this.szAlphaField&&(this.nAlphaFieldIndex=e);this.szAlphaField100&&k[e]==this.szAlphaField100&&(this.nAlphaField100Index=e)}}for(c=0;c<this.szFieldsA.length;c++)0>this.nFieldIndexA[c]&&("$item$"!=this.szFieldsA[c]&&"$index$"!=this.szFieldsA[c]&&_ERROR("error: "+this.szFieldsA[c]+" not found in "+this.szName+" !"),this.szName="");return!0};
function MapTheme(e,c,f,d,h,g,l){this.fDone=!1;this.nMin=3E8;this.nNoData=this.nCount=this.nSum=this.nMax=0;this.szThemes=e;this.szThemesA=e.split("|");this.checkTheme();this.objThemesA=[];this.szFields=c;this.szFieldsA=c.split("|");this.szField100=f;this.nFieldsA=[];this.nFields100A=[];this.nFieldsSelectionA=[];this.nMinA=[];this.nMaxA=[];this.nSumA=[];this.nMeanA=[];this.nMedianA=[];this.nDeviationA=[];this.nOrigMinA=[];this.nOrigMaxA=[];this.nOrigSumA=[];for(f=0;f<this.szFieldsA.length;f++)this.nMinA[f]=
3E8,this.nMaxA[f]=0,this.nSumA[f]=0,this.nOrigMinA[f]=3E8,this.nOrigMaxA[f]=0,this.nOrigSumA[f]=0,this.nMedianA[f]=0,this.nMeanA[f]=0;this.nMin100=3E8;this.nSum100=this.nMax100=0;this.nMinSize=3E8;this.nSumSize=this.nMaxSize=0;this.nMinAlpha=3E8;this.nSumAlpha=this.nMaxAlpha=0;this.nDominantDFilter=this.szDominantFilter=null;this.nFilterA=[];this.dbTableA=[];this.dbFieldsA=[];this.dbRecordsA=[];if(h)for(f in this.origColorScheme=[],h)this.origColorScheme[f]=h[f];else this.origColorScheme=null;this.defaultColorScheme=
["#008888","#00aaaa","#00cccc","#00eeee","#00ffff"];this.szTitle=g?g:e+" ["+c+"]";this.szTitle=map.Dictionary.getLocalText(this.szTitle);this.szTitle=60<this.szTitle.length?this.szTitle.slice(0,50)+" ...":this.szTitle;this.szUnits="";this.szXaxisA=this.szAlphaValueUnits=this.szSizeValueUnits=null;this.szOrigLabelA=this.szLabelA=l;this.szLegendLabelA=[];this.szLegendStyle="";this.evidenceMode="isolate";this.szAggregation="mean";this.nValuesA=[];this.szExactA=this.szRangesA=this.szValuesA=null;this.itemA=
[];this.fDataCache=!0;this.fNegativeValuePossible=this.fNullIsValue=this.fEditor=!1;this.nStringToValue=1;this.nStringToValueA=[];this.szOrigFlag=this.szFlag=d?d:"CHOROPLETHE";this.nScale=1;this.nRefreshTimeout=0;this.szId="theme"+String(Math.random());this.szShapeType="polygon";if(e=map.Layer.getLayerObj(this.szThemesA[0]))this.szShapeType=e.szType,"line"==this.szShapeType&&this.szOrigFlag.match(/BUFFER/)&&(this.szShapeType+="+buffer");this.hiddenLayerA=[];this.szFlag.match(/CHART/)||(this.szFlag.match(/PIE/)?
this.szOverviewChart="PIE":this.szFlag.match(/DONUT/)&&(this.szOverviewChart="DONUT"));this.szFlag.match(/ZEROISVALUE/)&&(this.fNullIsValue=!0);this.szFlag.match(/NEGATIVEISVALUE/)&&(this.fNegativeValuePossible=!0);this.szFlag.match(/SUM/)&&(this.szAggregation="sum");if(this.szFlag.match(/CHART/)){if(this.szFlag.match(/EXACT/)||1<this.szFieldsA.length)this.fNullIsValue=!0;this.szFlag.match(/BUFFER/)||(this.fShadow=this.fOrigShadow=!0)}this.szFlag.match(/EXACT/)&&!this.szLabelA&&(this.szLabelA=[]);
this.fGrayNoMember=this.fSortBeforeDraw=this.fClipCharts=!0;this.nClipTimeout=1E3;this.paintedShapeNodesA=[];this.szChoropletheInfoStyle=map.Themes.szChoropletheInfoStyle;this.nMaxThemeCharts=map.Themes.nMaxThemeCharts;this.nMaxShadowCharts=map.Themes.nMaxShadowCharts;this.nflushPaintShape=map.Themes.nflushPaintShape;this.nflushChartDraw=map.Themes.nflushChartDraw;this.themeNodesPosA=[]}
MapTheme.prototype.checkTheme=function(){if(!this.szThemesA)return!1;for(var e=0;e<this.szThemesA.length;e++)if("generic"==this.szThemesA[e]||map.Layer.isLoaded(this.szThemesA[e]))return!0;for(e=0;e<this.szThemesA.length;)return!0;this.ErrorMessage="theme layer not loaded ! zoom in ?";return!1};MapTheme.prototype.def=function(){return map.Themes.getMapThemeDefinitionObj(this.szId)};MapTheme.prototype.getDefinitionObject=function(){return map.Themes.getMapThemeDefinitionObj(this.szId)};
MapTheme.prototype.initValues=function(){this.nMin=3E8;for(var e=this.nNoData=this.nCount=this.nSum=this.nMax=0;e<this.szFieldsA.length;e++)this.nMinA[e]=3E8,this.nMaxA[e]=0,this.nSumA[e]=0,this.nOrigMinA[e]=3E8,this.nOrigMaxA[e]=0,this.nOrigSumA[e]=0,this.nMedianA[e]=0,this.nMeanA[e]=0,this.nDeviationA[e]=0;this.nMin100=3E8;this.nSum100=this.nMax100=0;this.itemA=[];this.posItemA=[];this.chartPosA=[];this.exactCountA=[];this.exactSizeA=[];this.szAggregation||(this.szAggregation=this.szField100?"mean":
"sum");if(this.szAggregationFieldA&&!this.fSuppressAggregationScale)for(e=0;e<this.szAggregationFieldA.length;e++){var c=Number(this.szAggregationFieldA[e].split(":")[1]);c&&map.Scale.getTrueMapScale()*map.Scale.nZoomScale>c&&(isNaN(parseFloat(this.szAggregationFieldA[e+1]))?this.szAggregationField=this.szAggregationFieldA[e+1]:(this.nGridWidthPx=parseFloat(this.szAggregationFieldA[e+1]),this.szAggregationField=null));e++}this.fSuppressAggregationScale=!1;this.nWrongRecordLengthCount=0};
MapTheme.prototype.realize=function(){var e=new Date;this.fShowProgressBar=!1;this.initValues();this.getFields()?this.loadValues()?(this.timeLoading=new Date-e,this.fAggregate=!0,(1E3<this.timeLoading||this.szFlag.match(/VERBOSE/))&&!this.szFlag.match(/SILENT/)?executeWithMessage("map.Themes.continueExecute();",this.szFlag.match(/AGGREGATE/)?"aggregating":"parsing data"):map.Themes.continueExecute()):this.fRemove=!0:this.fRemove=!0};
MapTheme.prototype.realize_aggregate=function(){var e=new Date;this.distributeValues();this.timeAggregating=new Date-e;this.fDraw=!0;(1E3<this.timeLoading||this.szFlag.match(/VERBOSE/))&&!this.szFlag.match(/SILENT/)?executeWithMessage("map.Themes.continueExecute();","drawing"):map.Themes.continueExecute()};
MapTheme.prototype.realize_draw=function(){this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nSkipCount=this.nDoneCount=0;this.missedA=[];this.nActualFrame=0;var e=this.szFlag.match(/VERBOSE/)?"drawing":"";this.mapSleep=new Map.Sleep("map.Themes.continueExecute",this.nflushPaintShape,map.Dictionary.getLocalText(e));this.mapSleep.nCount=this.nCount;this.mapSleep.szCancel="map.Themes.cancelExecute()";this.szFlag.match(/CLIP/)&&(this.mapSleep=null,this.nClipIncr=
1);this.szFlag.match(/CHART/)?(this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushChartDraw,e),this.chartMap()):(this.unlabelMap(),this.paintMap(),this.makeVisible());this.isChecked=!0;this.szFlag.match(/BUFFER/)?map.Themes.activeBuffer=this:map.Themes.activeTheme=this;try{HTMLWindow.ixmaps.htmlgui_setActualTheme(this.szId)}catch(c){}!this.szFlag.match(/CHART/)||this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/SYMBOL/)||this.szFlag.match(/BAR/)&&this.colorScheme&&this.nOrigSumA&&
this.nOrigSumA.length!=this.colorScheme.length?this.isMarkable=!0:this.isMarkable=!1};MapTheme.prototype.realizeContinue=function(e){this.fMakeLabel?this.labelMap(e):this.szFlag.match(/CHART/)?this.chartMap(e):this.paintMap(e)};
MapTheme.prototype.realizeNextClipFrame=function(){this.fClipPause||(this.nActualFrame+=this.nClipIncr,this.nActualFrame>=this.nClipFrames?this.szFlag.match(/BACK/)?(this.nClipIncr=-this.nClipIncr,this.clipTimeout=setTimeout("map.Themes.nextClipFrame('"+this.szId+"')",2E3)):this.szFlag.match(/LOOP/)?(this.nActualFrame=-1,this.clipTimeout=setTimeout("map.Themes.nextClipFrame('"+this.szId+"')",2E3)):(this.nActualFrame=this.nClipFrames-1,this.pauseClip()):0>this.nActualFrame?this.szFlag.match(/BACK/)?
(this.nClipIncr=-this.nClipIncr,this.clipTimeout=setTimeout("map.Themes.nextClipFrame('"+this.szId+"')",10)):(this.nActualFrame=0,this.pauseClip()):(displayMessage("... "+this.nActualFrame+" ...",5E3),this.mapSleep=null,this.szFlag.match(/CHART/)?(this.chartPosA=[],this.posItemA=[],this.fRedraw=!0,this.chartMap()):this.paintMap(),this.fRedrawInfo=!0))};
MapTheme.prototype.setClipFrame=function(e){this.fClipPause=!0;this.nActualFrame=Math.min(e,this.nClipFrames);this.mapSleep=null;this.szFlag.match(/CHART/)?(this.chartPosA=[],this.posItemA=[],this.unpaintMap(),this.chartMap()):this.paintMap();this.fRedrawInfo=!0};
MapTheme.prototype.startClip=function(){var e=SVGDocument.getElementById(this.szId+":display:widget:clippausebutton:button");e&&e.style.setProperty("display","inline","");(e=SVGDocument.getElementById(this.szId+":display:widget:clipstartbutton:button"))&&e.style.setProperty("display","none","");this.fClipPause=!1;this.nActualFrame=0;this.realizeNextClipFrame()};
MapTheme.prototype.pauseClip=function(){var e=SVGDocument.getElementById(this.szId+":display:widget:clippausebutton:button");e&&e.style.setProperty("display","none","");(e=SVGDocument.getElementById(this.szId+":display:widget:clipstartbutton:button"))&&e.style.setProperty("display","inline","");this.fClipPause=!0};
MapTheme.prototype.realizeDone=function(){this.nRefreshTimeout&&setTimeout("map.Themes.refreshTheme('"+this.szId+"')",this.nRefreshTimeout);this.szFlag.match(/CLIP/)&&(this.clipTimeout&&clearTimeout(this.clipTimeout),this.clipTimeout=setTimeout("map.Themes.nextClipFrame('"+this.szId+"')",this.nActualFrame?this.nClipTimeout:2E3));clearMessage();this.nWrongRecordLengthCount&&fDebug&&displayMessage("Data Error:  "+this.nWrongRecordLengthCount+" items have wrong record length",1E4,"notify");this.fRealize=
this.fRedraw=!1;this.fDone=!0;map.Themes.realizeDone(this)};MapTheme.prototype.beginDraw=function(){this.fOverviewMap||(this.fOverviewMap=map.Zoom.hideOverviewMap())};MapTheme.prototype.endDraw=function(){this.fOverviewMap&&(map.Zoom.showOverviewMap(),this.fOverviewMap=!1)};
MapTheme.prototype.redraw=function(e){this.clipTimeout&&clearTimeout(this.clipTimeout);this.fDataIncomplete&&this.__themeNodes!=map.Themes.themeNodes&&(this.fDataIncomplete=!1,this.initValues(),this.loadValues(),this.distributeValues());if(this.szFlag.match(/CHART/)){if(this.fClipCharts&&this.nSkipCount||this.fRedraw)this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nDoneCount=this.nSkipCount=0,this.chartMap()}else if(this.isChecked){if(this.partsA)for(i=
0;i<this.partsA.length;i++)this.partsA[i].nCount=0,this.partsA[i].nSum=0;this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushPaintShape,"painting map");this.makeVisible();this.paintMap()}e&&this.enable()};
MapTheme.prototype.toFront=function(){if(this.szFlag.match(/CHART/))this.chartGroup.parentNode.appendChild(this.chartGroup),(matrixA=getMatrix(this.chartGroup))&&setMatrix(this.chartGroup,matrixA),this.enable();else if(this.isChecked){for(i=0;i<this.partsA.length;i++)this.partsA[i].nCount=0,this.partsA[i].nSum=0;this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushPaintShape,"painting map");this.paintMap()}else this.enable()};
MapTheme.prototype.getFields=function(){for(var e=0;e<this.szThemesA.length;e++){var c=this.szThemesA[e];this.objThemesA[c]=new ObjTheme(c,e,this.coTable,this.szSelectionField,this.szItemField);this.objThemesA[c].theme=this;if(!this.objThemesA[c].getFields()){try{HTMLWindow.ixmaps.htmlgui_onErrorTheme(c)}catch(f){}return!1}}return!0};
MapTheme.prototype.addItemValues=function(e,c,f,d,h){if(!this.szFlag.match(/RAW/)||f|d|h){var g;if(this.szExcludeA)for(g=0;g<this.szExcludeA.length;g++)if(e.split("::")[1]==this.szExcludeA[g])return;if(!(this.nField100Min&&f&&f<this.nField100Min)){if(this.nMinValue&&c&&!f){var l=!1;for(g=c.length-1;0<=g;g--)c[g]>=this.nMinValue&&(l=!0);if(!l)return}l=1;if(this.__fDensity||this.__fDensityAlpha)if(l=this.getNodeArea(e),!l&&this.__fTiledLayer){this.fDataIncomplete=!0;return}if(this.szWeights)for(g=0;g<
c.length;g++)c[g]*=this.szWeightsA[g]||this.szWeightsA[0];if(this.__fAuto100){for(g=f=0;g<c.length;g++)f+=c[g]||0;this.fField100=!0}this.itemA[e]={nOrigValuesA:[],nValuesA:c,nValue100:f,nValueSum:0};for(g=0;g<c.length;g++){this.itemA[e].nOrigValuesA[g]=isNaN(c[g])?0:c[g];this.itemA[e].nValueSum+=c[g];if(this.fField100)if(f){var k=c[g];0!=k||this.szFlag.match(/ZEROISVALUE/)?"!"==this.szFieldsA[g].substr(0,1)?(k=f-k,this.itemA[e].nOrigValuesA[g]=k):this.szFlag.match(/CALCVAL/)||this.szFlag.match(/CALC100/)?
(k=f?Math.round(k*f/100):k,this.itemA[e].nOrigValuesA[g]=k):this.szFlag.match(/PRODUCT/)?k=f?k*f:k:this.szFlag.match(/DIFFERENCE/)&&1==c.length&&!this.szFlag.match(/RELATIVE/)?(f=0<g?c[g-1]:this.itemA[e].nValue100,k-=f):(k=f?k/f:1,this.szFlag.match(/FRACTION/)?k*=this.nFractionScale||1:this.szFlag.match(/PERMILLE/)?k*=1E3:(k*=100,0<k&&this.szFlag.match(/RELATIVE/)?k-=100:0<k&&this.szFlag.match(/INVERT/)&&(k=100-k))):k=0;c[g]=k}else c[g]=0;this.__fDensity&&(c[g]/=l)}if(this.__fDifference&&1<c.length){for(g=
0;g<c.length;g++)g<c.length-1?(k=c[g],c[g]=c[g+1]-c[g],this.szFlag.match(/RELATIVE/)&&(c[g]*=100/k)):this.szFlag.match(/STACKED/)||(c[g]=0);c.pop()}for(g=0;g<c.length;g++){if(!this.nSumA)return;isNaN(c[g])||(this.nMin=Math.min(this.nMin,c[g]),this.nMax=Math.max(this.nMax,c[g]),this.nSum+=c[g],this.nMinA[g]=Math.min(this.nMinA[g],c[g]),this.nMaxA[g]=Math.max(this.nMaxA[g],c[g]),this.nSumA[g]+=c[g],this.nOrigMinA[g]=Math.min(this.nOrigMinA[g],this.itemA[e].nOrigValuesA[g]),this.nOrigMaxA[g]=Math.max(this.nOrigMaxA[g],
this.itemA[e].nOrigValuesA[g]),this.nOrigSumA[g]+=this.itemA[e].nOrigValuesA[g]);0>c[g]&&(this.fNegativeValues=!0)}isNaN(f)||(this.nMin100=Math.min(this.nMin100,f),this.nMax100=Math.max(this.nMax100,f),this.nSum100+=f);d&&this.szSizeField&&!isNaN(d)&&(this.itemA[e].nSize=d,this.nMinSize=Math.min(this.nMinSize,d),this.nMaxSize=Math.max(this.nMaxSize,d),this.nSumSize+=d);this.szAlphaField&&null!=h&&!isNaN(h)&&(this.__fDensityAlpha&&(h=l?Math.min(h/l,5E4):0),this.itemA[e].nAlpha=h,this.nMinAlpha=Math.min(this.nMinAlpha,
h),this.nMaxAlpha=Math.max(this.nMaxAlpha,h),this.nSumAlpha+=h);if(this.__fExact&&this.exactCountA)for(g=0;g<c.length;g++)c[g]&&(this.exactCountA[c[g]-1]?(this.exactCountA[c[g]-1]++,this.exactSizeA[c[g]-1]+=this.itemA[e].nSize||1):(this.exactCountA[c[g]-1]=1,this.exactSizeA[c[g]-1]=this.itemA[e].nSize||1));this.nCount++}}else{this.itemA[e]={nOrigValuesA:[],nValuesA:c,nValue100:f,nValueSum:0};if(!this.szFlag.match(/AGGREGATE/))for(g=0;g<c.length;g++)this.nMin=Math.min(this.nMin,c[g]),this.nMax=Math.max(this.nMax,
c[g]),this.nSum+=c[g],this.__fExact&&this.exactCountA&&c[g]&&(this.exactCountA[c[g]-1]?(this.exactCountA[c[g]-1]++,this.exactSizeA[c[g]-1]+=this.itemA[e].nSize||1):(this.exactCountA[c[g]-1]=1,this.exactSizeA[c[g]-1]=this.itemA[e].nSize||1));this.nCount++}};
MapTheme.prototype.getStringValueIndex=function(e,c){if(0==e.length||" "==e)if(this.szFlag.match(/UNDEFINEDISVALUE/))e="undefined";else return-1;this.szFlag.match(/IGNORECASE/)&&(e=e.toUpperCase());"undefined"!=typeof this.nStringToValueA[e]||this.szValuesA&&this.szValuesA.length&&"set"!=c||(this.szLabelA=this.szLabelA||[],this.szExactA=this.szExactA||[],this.nStringToValueA[e]=this.nStringToValue,this.szLabelA[this.nStringToValue-1]=this.szLabelA[this.nStringToValue-1]||e,this.szExactA.push(this.nStringToValue),
this.nStringToValue++);return this.nStringToValueA[e]};MapTheme.prototype.checkHiddenLayerState=function(){for(i=0;i<this.szThemesA.length;i++)if(map.Layer.isScaleDependentLayer(this.szThemesA[i])&&(this.hiddenLayerA[this.szThemesA[i]]&&map.Layer.isScaleDependentLayerOn(this.szThemesA[i])||!this.hiddenLayerA[this.szThemesA[i]]&&!map.Layer.isScaleDependentLayerOn(this.szThemesA[i])))return!0;return!1};
__scanValue=function(e){return String(e).match(/,/)?parseFloat(String(e).replace(/\./gi,"").replace(/,/gi,".")):parseFloat(String(e).replace(/ /gi,""))};
MapTheme.prototype.loadValues=function(){this.nMissingLookupCount=0;this.__fExact=this.szFlag.match(/EXACT/);this.__fDifference=this.szFlag.match(/DIFFERENCE/);this.__fFilter=this.szFilter&&this.szFilter.length;this.__fDensity=this.szFlag.match(/DENSITY/);this.__fDensityAlpha=this.szAlphaField100&&this.szAlphaField100.match(/\$density\$/i);this.__fAuto100=this.szFlag.match(/AUTO100/)&&!this.szFlag.match(/AGGREGATE/);this.__fTiledLayer=map.Layer.getLayerObj(this.szThemesA[0])?map.Layer.getLayerObj(this.szThemesA[0]).szFlag.match(/tiled/):
!1;this.__themeNodes=map.Themes.themeNodes;for(i=0;i<this.szThemesA.length;i++)if(map.Layer.isScaleDependentLayer(this.szThemesA[i])&&!map.Layer.isScaleDependentLayerOn(this.szThemesA[i]))this.fReload=this.hiddenLayerA[this.szThemesA[i]]=!0;else{this.hiddenLayerA[this.szThemesA[i]]=!1;if(!this.objThemesA[this.szThemesA[i]].dbTable)return this.loadValuesFromMap();if(!this.loadValuesOfTheme(this.szThemesA[i]))return!1}return!0};
MapTheme.prototype.filterValues=function(e){if(this.szFilter.match(/WHERE/)){if(!this.objTheme.filterQueryA){for(var c=this.szFilter.split("WHERE ")[1].split("AND"),f=[],d={},h=0;h<c.length;h++)c[h].match(/BETWEEN/)&&(c[h]=c[h]+"AND"+c[h+1],c.splice(h+1,1));for(h=0;h<c.length;h++)c[h]=c[h].trim();this.objTheme.filterQueryA=[];for(var h=0;h<c.length;h++){for(var f=c[h].split(" "),g=0;g<f.length;g++)if('"'==f[g][0]&&'"'!=f[g][f[g].length-1]){do f[g]=f[g]+" "+f[g+1],f.splice(g+1,1);while('"'!=f[g][f[g].length-
1])}for(g=0;g<f.length;g++)if("'"==f[g][0]&&"'"!=f[g][f[g].length-1]){do f[g]=f[g]+" "+f[g+1],f.splice(g+1,1);while("'"!=f[g][f[g].length-1])}d={};d.szFilterField=f[0].replace(/("|')/g,"");d.szFilterOp=f[1];d.szFilterValue=f[2].replace(/("|')/g,"").replace(".","\\.").replace(/\//gi,"\\/");"BETWEEN"==d.szFilterOp&&"AND"==f[3]&&(d.szFilterValue2=f[4].replace(".","\\.").replace(/\//gi,"\\/"));for(g=0;g<this.objTheme.dbFields.length;g++)this.objTheme.dbFields[g].id==d.szFilterField&&(d.nFilterFieldIndex=
g);this.objTheme.filterQueryA.push(d)}}for(h in this.objTheme.filterQueryA)if(this.__szValue=String(this.objTheme.dbRecords[e][this.objTheme.filterQueryA[h].nFilterFieldIndex]),this.__szFilterOp=this.objTheme.filterQueryA[h].szFilterOp,this.__szFilterValue=this.objTheme.filterQueryA[h].szFilterValue,this.__szFilterValue2=this.objTheme.filterQueryA[h].szFilterValue2,c=!0,c=parseFloat(this.__szValue),c="="==this.__szFilterOp?this.__szValue==this.__szFilterValue||c==Number(this.__szFilterValue):"<>"==
this.__szFilterOp?!(this.__szValue==this.__szFilterValue||c==Number(this.__szFilterValue)):">"==this.__szFilterOp?c>Number(this.__szFilterValue):"<"==this.__szFilterOp?c<Number(this.__szFilterValue):">="==this.__szFilterOp?c>=Number(this.__szFilterValue):"<="==this.__szFilterOp?c<=Number(this.__szFilterValue):"LIKE"==this.__szFilterOp?eval("this.__szValue.match(/"+this.__szFilterValue+"/i)"):"IN"==this.__szFilterOp?eval("this.__szFilterValue.match(/\\("+this.__szValue+"\\,/)")||eval("this.__szFilterValue.match(/\\,"+
this.__szValue+"\\,/)")||eval("this.__szFilterValue.match(/\\,"+this.__szValue+"\\)/)"):"BETWEEN"==this.__szFilterOp?c>=Number(this.__szFilterValue)&&c<=Number(this.__szFilterValue2):eval("this.__szValue.match(/"+this.__szFilterValue+"/i)"),!c)return!1}else if(this.__szValue=this.objTheme.dbRecords[e].join(" "),!eval("this.__szValue.match(/"+this.szFilter+"/i)"))return!1;return!0};
MapTheme.prototype.getSelectionId=function(e,c){if(this.fSelection){if(this.fSelection.match(/LatLon/)){var f=Number(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[0]]),d=Number(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[1]]);return f&&d?isNaN(f)||isNaN(d)?null:e+"::"+(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[0]]+","+this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[1]])+(this.szSelectionFieldSuffix||""):null}if(this.fSelection.match(/MultiPoint/))return szId=
this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndex],f=null,(f=szId.match(positionRegExp))?e+"::"+(f[2]+","+f[1])+(this.szSelectionFieldSuffix||""):null;szId=__mpap_decode_utf8(String(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndex]));this.fSelectionFieldToUpper&&(szId=String(szId).toUpperCase());return e+"::"+szId+(this.szSelectionFieldSuffix||"")}if(this.objTheme.nFieldSelectionIndexA&&1<this.objTheme.nFieldSelectionIndexA.length)return this.fSelection="LatLon",this.getSelectionId(e,
c);szId=__mpap_decode_utf8(String(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndex]));if(szId.match(/MultiPoint/))return this.fSelection="MultiPoint",this.getSelectionId(e,c);this.fSelectionFieldToUpper&&(szId=String(szId).toUpperCase());return e+"::"+szId+(this.szSelectionFieldSuffix||"")};
MapTheme.prototype.loadValuesOfTheme=function(e){var c,f,d,h,g;this.fNegativeValues=this.fField100=!1;this.szUnit=(this.szUnits&&"."==this.szUnits.substr(0,1)?"":" ")+(this.szUnits||"");var l=!0;this.objTheme=this.objThemesA[e];0<this.objTheme.nField100Index&&(this.fField100=!0);if(this.objTheme.dbTable&&e&&e.length){if(this.coTable){try{eval("this.objTheme.dbRecords = "+this.coTable+".records")}catch(k){eval("this.objTheme.dbRecords = "+this.coTable+"_records")}if(!this.objTheme.dbRecords)return displayMessage("Data "+
this.coTable+" could not be loaded!",2E3,!0),!1}else try{eval("this.objTheme.dbRecords = "+e+".records")}catch(m){eval("this.objTheme.dbRecords = "+e+"_records")}this.objTheme.nFieldSelectionIndexA.length||null==this.objTheme.nFieldSelectionIndexA;if("$item$"!=this.szFieldsA[0]&&!this.szFlag.match(/EXACT/))for(h=Math.min(40,this.objTheme.dbRecords.length),c=0;c<h;c++)if(this.objTheme.dbRecords[c])for(f=0;f<this.szFieldsA.length;f++)if(d=this.objTheme.dbRecords[c][this.objTheme.nFieldIndexA[f]],__scanValue(d)!=
parseFloat(d)){this.__fScanValue=!0;c=h;break}for(c=0;c<this.objTheme.dbRecords.length;c++)if(!this.objTheme.dbRecords[c]||this.objTheme.dbRecords[c].length<this.objTheme.dbFields.length)this.nWrongRecordLengthCount++;else if(!this.__fFilter||this.filterValues(c)){h=[];if("$item$"==this.szFieldsA[0])h[0]=1;else if("$index$"==this.szFieldsA[0])h[0]=c+1;else for(f=0;f<this.szFieldsA.length;f++)d=this.objTheme.dbRecords[c][this.objTheme.nFieldIndexA[f]],d=this.__fExact?this.getStringValueIndex(String(d)):
this.__fScanValue?__scanValue(d):parseFloat(d),isNaN(d)||0==d&&!this.fNullIsValue||0>d&&!this.fNegativeValuePossible||(h[f]=d);h.length=this.szFieldsA.length;g="$item$"==this.szField100?1:0>this.objTheme.nField100Index?0:__scanValue(this.objTheme.dbRecords[c][this.objTheme.nField100Index]);0!=g||this.fNullIsValue||(g=null);0>g&&!this.fNegativeValuePossible&&(g=null);var u=null;this.szSizeField&&(u=__scanValue(this.objTheme.dbRecords[c][this.objTheme.nSizeFieldIndex]));var z=null;this.szAlphaField&&
(z=__scanValue(this.objTheme.dbRecords[c][this.objTheme.nAlphaFieldIndex]),isNaN(z)&&(z=0));this.szAlphaField100&&this.objTheme.nAlphaField100Index&&(z*=100/__scanValue(this.objTheme.dbRecords[c][this.objTheme.nAlphaField100Index]),isNaN(z)&&(z=0));if(d=f=this.getSelectionId(e,c)){0<=this.objTheme.nFieldItemIndex&&this.objTheme.nFieldItemIndex!=this.objTheme.nFieldSelectionIndex&&(f=__mpap_decode_utf8(String(this.objTheme.dbRecords[c][this.objTheme.nFieldItemIndex])),this.fSelectionFieldToUpper&&
(f=String(f).toUpperCase()),f=e+"::"+f);if(this.itemA[f]&&(f+="*"+Math.random(),this.itemA[f]))continue;this.addItemValues(f,h,g,u,z);this.itemA[f]&&(this.szValueField&&(this.itemA[f].szValue="$index$"==this.szValueField?c+1:__mpap_decode_utf8(this.objTheme.dbRecords[c][this.objTheme.nValueFieldIndex])),this.szLabelField&&(this.itemA[f].szLabel="$index$"==this.szValueField?c+1:__mpap_decode_utf8(this.objTheme.dbRecords[c][this.objTheme.nLabelFieldIndex])),this.szTitleField&&(this.itemA[f].szTitle=
__mpap_decode_utf8(this.objTheme.dbRecords[c][this.objTheme.nTitleFieldIndex])),this.szSnippetField&&(this.itemA[f].szSnippet=__mpap_decode_utf8(this.objTheme.dbRecords[c][this.objTheme.nSnippetFieldIndex])),this.itemA[f].szSelectionId=d?d:f,this.szAggregationField&&(this.itemA[f].szAggregation=__mpap_decode_utf8(this.objTheme.dbRecords[c][this.objTheme.nAggregationFieldIndex])),this.itemA[f].dbIndex=c)}else this.nMissingLookupCount++}}else l=!1;if(l)return!0};
MapTheme.prototype.loadValuesFromMap=function(){var e,c,f,d;this.fNegativeValues=this.fField100=!1;this.szUnit=" "+(this.szUnits||"");var h=[],g=[];for(e=0;e<this.szThemesA.length;e++){this.objTheme=this.objThemesA[this.szThemesA[e]];var l=map.Layer.getLayerObj(this.szThemesA[e]);if(null==l)return alert("MapTheme error: no layer like '"+this.szThemesA[e]+"'"),!1;if(l.szFlag.match(/tiled/)){g[0]=map.Scale.canvasNode;g.length=1;this.fDataIncomplete=!map.Tiles.allTilesLoaded();break}else g[g.length]=
SVGDocument.getElementById(l.szName)}l=!0;for(c=0;c<g.length;c++){d=g[c].getElementsByTagName("path");var k=g[c].getElementsByTagName("use"),m=g[c].getElementsByTagName("circle");for(e=0;e<d.length;e++)h[h.length]=d.item(e);for(e=0;e<k.length;e++)h[h.length]=k.item(e);for(e=0;e<m.length;e++)h[h.length]=m.item(e)}if(0==h.length)for(l=!1,c=0;c<g.length;c++)for(d=g[c].getElementsByTagName("g"),e=0;e<d.length;e++)h[h.length]=d.item(e);for(e=0;e<h.length;e++)if(1==h[e].nodeType&&h[e].hasAttributeNS(szMapNs,
"info")){d=l?h[e].parentNode.getAttributeNS(null,"id"):h[e].getAttributeNS(null,"id");g=-1;if(d&&0!==d.length)for(k=map.Tiles.getMasterId(d).split(":")[0],c=0;c<this.szThemesA.length;c++)k==this.szThemesA[c]&&(g=c);k=map.Tiles.getMasterId(d);if(!this.itemA[k]&&0<=g){m=h[e].getAttributeNS(szMapNs,"info").split("|");c=[];d=0>this.objTheme.nField100Index?0:Number(m[this.objThemesA[this.szThemesA[g]].nField100Index]);0!=d||this.fNullIsValue||(d=null);0>d&&!this.fNegativeValuePossible&&(d=null);if(this.szFlag.match(/CHART/)&&
this.szFlag.match(/BUFFER/))this.szFields&&this.szRangesA&&this.szRangesA.length?c[0]=m[this.objThemesA[this.szThemesA[g]].nFieldIndexA[0]]:(c[0]=this.nBufferSize,this.nCount=1);else{for(f=0;f<this.szFieldsA.length;f++){var u=nValue=m[this.objThemesA[this.szThemesA[g]].nFieldIndexA[f]];nValue=Number(nValue);if(isNaN(nValue))if(this.szFlag.match(/EXACT/))nValue=this.getStringValueIndex(u);else continue;if(0!=nValue||this.fNullIsValue)0>nValue&&!this.fNegativeValuePossible||(c[f]=nValue)}c.length=this.szFieldsA.length}f=
null;this.szSizeField&&(f=Number(m[this.objThemesA[this.szThemesA[g]].nSizeFieldIndex]));u=null;this.szAlphaField&&(u=Number(m[this.objThemesA[this.szThemesA[g]].nAlphaFieldIndex]));this.szAlphaField100&&this.objTheme.nAlphaField100Index&&(u*=100/Number(m[this.objThemesA[this.szThemesA[g]].nAlphaField100Index]),isNaN(u)&&(u=0));k=__mpap_decode_utf8(k);this.itemA[k]||(this.addItemValues(k,c,d,f,u),this.itemA[k]&&(this.szValueField&&(this.itemA[k].szValue=m[this.objThemesA[this.szThemesA[g]].nValueFieldIndex]),
this.szLabelField&&(this.itemA[k].szLabel=m[this.objThemesA[this.szThemesA[g]].nLabelFieldIndex]),this.szTitleField&&(this.itemA[k].szTitle=m[this.objThemesA[this.szThemesA[g]].nTitleFieldIndex]),this.szSnippetField&&(this.itemA[k].szSnippet=m[this.objThemesA[this.szThemesA[g]].nSnippetFieldIndex]),this.itemA[k].szSelectionId=k))}}return!0};
MapTheme.prototype.aggregateValues=function(){var e=[],c=[],f=[],d=[],h=[],g=null,l=0;this.nTopicsSkipedByZeroExclusion=0;if(this.nGridWidthPx){var k=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.nGridWidthPx),1E3);this.nGridWidth=k}this.nGridMatrix&&(k=map.Zoom.getBox(),k=map.Scale.getDistanceInMeter(1E3,1E3,1E3+k.width,1E3),this.nGridWidth=k/(this.nGridMatrix||20)/map.Scale.nZoomScale);k=this.nGridWidth?Math.round(map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/20)*map.Scale.nZoomScale*
20:0;for(a in this.itemA){var m="undefined",g=g||a;if(this.szAggregationField){m=this.itemA[a].szAggregation;e[m]||(e[m]=[],d[m]=new point(0,0),c[m]=0,f[m]=0,l++);e[m][a]=this.itemA[a];e[m][a].nSize=this.itemA[a].nSize||1;e[m][a].szTitle=m;f[m]+=e[m][a].nSize;var u=this.getNodePosition(this.itemA[a].szSelectionId);u&&(d[m].x+=u.x,d[m].y+=u.y,c[m]++)}else{var u=this.getNodePosition(this.itemA[a].szSelectionId),z=this.itemA[a].szSelectionId.split("::")[0];if(u)if(this.szFlag.match(/DIFFUSE/)&&this.nGridWidth){var q=
[],y=[];q[0]=new point(Math.ceil(u.x/k)*k,Math.ceil(u.y/k)*k);q[1]=new point(Math.ceil(u.x/k)*k,Math.floor(u.y/k)*k);q[2]=new point(Math.floor(u.x/k)*k,Math.floor(u.y/k)*k);q[3]=new point(Math.floor(u.x/k)*k,Math.ceil(u.y/k)*k);var r=Math.pow(k,2)+Math.pow(k,2);y[0]=r-(Math.pow(q[0].x-u.x,2)+Math.pow(q[0].y-u.y,2));y[1]=r-(Math.pow(q[1].x-u.x,2)+Math.pow(q[1].y-u.y,2));y[2]=r-(Math.pow(q[2].x-u.x,2)+Math.pow(q[2].y-u.y,2));y[3]=r-(Math.pow(q[3].x-u.x,2)+Math.pow(q[3].y-u.y,2));u=y[0]+y[1]+y[2]+y[3];
for(r=0;4>r;r++){z=a+"-"+r;this.themeNodesPosA[z]=q[r];m=String(this.themeNodesPosA[z].x)+","+String(this.themeNodesPosA[z].y);e[m]||(e[m]=[],c[m]=0,l++);for(var D={nValuesA:[],nOrigValuesA:[]},w=0;w<this.itemA[a].nValuesA.length;w++)D.nValuesA[w]=this.itemA[a].nValuesA[w]*(this.szFlag.match(/EXACT/)?1:y[r]/u),D.nOrigValuesA[w]=this.itemA[a].nOrigValuesA[w]*(this.szFlag.match(/EXACT/)?1:y[r]/u);D.nValue100=(this.itemA[a].nValue100||100)*(this.szFlag.match(/EXACT/)?1:y[r]/u);e[m][z]=D;e[m][z].nSize=
(this.itemA[a].nSize||1)/u*y[r];c[m]++}}else this.nGridWidth?(D=null,this.szFlag.match(/RECT/)?D=new point(Math.round(u.x/k)*k,Math.round(u.y/k)*k):(this.szFlag.match(/PLOTY/)?(q=Math.round(u.y/k)*k,y=Math.round(q/k)%2?1.15*k/2:0,D=new point(1.15*Math.round((u.x+y)/(1.15*k))*k-y,q)):(r=Math.round(u.x/k)*k,m=Math.round(r/k)%2?1.15*k/2:0,D=new point(r,1.15*Math.round((u.y+m)/(1.15*k))*k-m)),Math.abs(r-u.x)>k/4&&(q=[],y=[],m=Math.round(r/k)%2?0:1.15*k/2,r>u.x?(q[0]=new point(D.x-k,D.y-1.15*k/2),q[1]=
new point(D.x-k,D.y+1.15*k/2)):(q[0]=new point(D.x+k,D.y-1.15*k/2),q[1]=new point(D.x+k,D.y+1.15*k/2)),y[0]=Math.sqrt(Math.pow(q[0].x-u.x,2)+Math.pow(q[0].y-u.y,2)),y[1]=Math.sqrt(Math.pow(q[1].x-u.x,2)+Math.pow(q[1].y-u.y,2)),y[3]=Math.sqrt(Math.pow(D.x-u.x,2)+Math.pow(D.y-u.y,2)),y[0]<y[3]?D=new point(Math.round(q[0].x/k)*k,1.15*Math.round((q[0].y+m)/(1.15*k))*k-m):y[1]<y[3]&&(D=new point(Math.round(q[1].x/k)*k,1.15*Math.round((q[1].y+m)/(1.15*k))*k-m)))),m=z+"::"+String(D.x)+","+String(D.y),this.themeNodesPosA[a]=
D):m=this.itemA[a].szSelectionId,e[m]||(e[m]=[],d[m]=new point(0,0),c[m]=0,l++),e[m][a]=this.itemA[a],e[m][a].nSize=this.itemA[a].nSize||1,u&&(d[m].x+=u.x,d[m].y+=u.y),c[m]++;else e[m]||(e[m]=[],d[m]=new point(0,0),c[m]=0,this.fDataIncomplete=fTilesLoaded,l++),e[m][a]=this.itemA[a],e[m][a].nSize=this.itemA[a].nSize||1,c[m]++,this.fDataIncomplete=!0}}if(this.szFlag.match(/EXACT/))for(t in this.szSizeField||(this.szSizeField="aggregation"),e){l=e[t];h[t]=0;y=[];q=[];for(a in l)y[l[a].szTitle]||(y[l[a].szTitle]=
1,h[t]++),q[l[a].nValuesA[0]]||(q[l[a].nValuesA[0]]={itemA:[]}),q[l[a].nValuesA[0]].itemA[a]=l[a];for(w in q)for(a in l=q[w].itemA,l)if(l[a]){l[a].nCount=1;for(b in l)l[b]&&b!=a&&(l[a].nCount+=1,l[a].nSize=(l[a].nSize||1)+(l[b].nSize||1),l[a].nAlpha=(l[a].nAlpha||1)+(l[b].nAlpha||1),l[a].szValue=String(l[a].nSize),l[b]=null,e[t][b]=null);k&&!this.szAggregationField&&(!l[a].szTitle||3<l[a].nCount)&&(l[a].szTitle=this.formatValue(l[a].nCount,2)+" "+map.Dictionary.getLocalText("items aggregated"))}}else for(t in e){l=
e[t];if(!this.szFlag.match(/SUM/)&&!this.szFlag.match(/ZEROISVALUE/)){q=[];y=0;for(a in l)if(y++,l[a])for(w=0;w<l[a].nValuesA.length;w++)if(0==l[a].nOrigValuesA[w]){q[a]=a;break}if(1<y)for(a in q)l[a]=null,this.nTopicsSkipedByZeroExclusion++}for(a in l)if(l[a]){l[a].nCount=1;for(b in l)if(l[b]&&b!=a){for(w=0;w<l[a].nValuesA.length;w++)l[a].nValuesA[w]=(l[a].nValuesA[w]||0)+(l[b].nValuesA[w]||0),l[a].nOrigValuesA[w]=(l[a].nOrigValuesA[w]||0)+(l[b].nOrigValuesA[w]||0);l[a].nCount+=1;l[a].nValue100+=
l[b].nValue100;l[a].nSize=(l[a].nSize||1)+(l[b].nSize||1);l[a].nAlpha=(l[a].nAlpha||1)+(l[b].nAlpha||1);l[a].szValue=String(l[a].nSize);k&&!this.szAggregationField&&l[a].szTitle&&l[b].szTitle&&l[a].szTitle!=l[b].szTitle&&(l[a].szTitle=l[a].szTitle+","+l[b].szTitle);l[b]=null}k&&!this.szAggregationField&&(!l[a].szTitle||3<l[a].nCount)&&(l[a].szTitle=this.formatValue(l[a].nCount,2)+" "+map.Dictionary.getLocalText("items aggregated"))}}if(this.szAggregationField||this.szFlag.match(/RELOCATE/)){var C=
new point(0,0),B=0,w=1E6,k=0;for(t in e)w=Math.min(w,d[t].x/c[t]),B=Math.max(B,d[t].y/c[t]),C.x+=d[t].x*(f[t]||1),C.y+=d[t].y*(f[t]||1),k+=c[t]*(f[t]||1);C.x/=k;C.y/=k;new point(w,C.y);B=new point(C.x,B)}this.nMin=3E8;this.nMax=-3E8;this.nMinSize=3E8;this.nSumSize=this.nMaxSize=0;this.nMinAlpha=3E8;this.nSumAlpha=this.nMaxAlpha=0;this.szFlag.match(/EXACT/)&&(this.nMinA=[],this.nMaxA=[],this.nSumA=[],this.nOrigMinA=[],this.nOrigMaxA=[],this.nOrigSumA=[],this.nMedianA=[],this.nMeanA=[],this.nCountA=
[]);f="[";k=this.nStringToValue-1;for(w=0;w<k;w++)f+="0,";f+="]";this.itemA=[];k=0;q=Math.max(this.szRangesA?this.szRangesA.length:0,this.szExactA?this.szExactA.length:0)-(this.szFlag.match(/EXACT/)?0:1);for(t in e)if(k++,"undefined"!=t)if(l=e[t],this.szFlag.match(/EXACT/)&&(this.szFlag.match(/PIE/)||this.szFlag.match(/BAR/)||this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/PLOT/)||this.szFlag.match(/DOMINANT/))){for(a in l){r=a;break}this.itemA[r]={};eval("var nValuesA = "+f+";");this.itemA[r].szSelectionId=
r;this.itemA[r].szTitle=l[r].szTitle;if(this.szAggregationField||this.szFlag.match(/RELOCATE/))this.szFlag.match(/ALIGN/)?(this.itemA[r].szSelectionId=g,this.szFlag.match(/UP/)?this.themeNodesPosA[r]=new point(B.x,B.y):this.themeNodesPosA[r]=new point(C.x,C.y)):this.themeNodesPosA[r]=new point(d[t].x/c[t],d[t].y/c[t]);y=w=0;for(a in l)l[a]&&l[a].nValuesA&&(nValuesA[l[a].nValuesA[0]-1]=l[a].nSize/(this.szFlag.match(/SUM/)?1:l[a].nCount),w+=l[a].nSize,y+=l[a].nCount);this.itemA[r].nValuesA=this.itemA[r].nOrigValuesA=
nValuesA;this.itemA[r].nMinA=[];this.itemA[r].nMaxA=[];this.itemA[r].nSize=w/(this.szFlag.match(/SUM/)?1:y);this.itemA[r].szTitle=this.nGridWidth&&!this.szAggregationField&&1<h[t]?__formatValue(h[t],2)+" item(s) aggregated":this.itemA[r].szTitle||t;this.itemA[r].szValue=this.itemA[r].szTitle;this.itemA[r].szLabel=this.itemA[r].szTitle;this.nMin=this.nMinSize=Math.min(this.nMinSize,this.itemA[r].nSize);this.nMax=this.nMaxSize=Math.max(this.nMaxSize,this.itemA[r].nSize);this.nSumSize+=w/(this.szFlag.match(/SUM/)?
1:y);this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[r].nAlpha);this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[r].nAlpha);this.nSumAlpha+=this.itemA[r].nAlpha;if(this.szFlag.match(/AUTO100/)){for(w=nValue100=0;w<this.itemA[r].nValuesA.length;w++)nValue100+=this.itemA[r].nValuesA[w]||0;this.itemA[r].nValue100=nValue100;this.fField100=!0;for(w=0;w<this.itemA[r].nValuesA.length;w++)this.itemA[r].nValuesA[w]=this.itemA[r].nOrigValuesA[w]/this.itemA[r].nValue100*100}if(this.szFlag.match(/EXACT/)){if(!this.nMinA.length)for(w=
0;w<this.itemA[r].nValuesA.length;w++)this.nMinA[w]=3E8,this.nMaxA[w]=-3E8,this.nSumA[w]=0,this.nOrigMinA[w]=3E8,this.nOrigMaxA[w]=-3E8,this.nOrigSumA[w]=0,this.nMedianA[w]=0,this.nMeanA[w]=0,this.nCountA[w]=0;for(w=0;w<this.itemA[r].nValuesA.length;w++)this.nMinA[w]=Math.min(this.nMinA[w],this.itemA[r].nValuesA[w]||3E8),this.nMaxA[w]=Math.max(this.nMaxA[w],this.itemA[r].nValuesA[w]||-3E8),this.nSumA[w]+=this.itemA[r].nValuesA[w],this.nOrigMinA[w]=Math.min(this.nOrigMinA[w],this.itemA[r].nOrigValuesA[w]||
3E8),this.nOrigMaxA[w]=Math.max(this.nOrigMaxA[w],this.itemA[r].nOrigValuesA[w]||-3E8),this.nOrigSumA[w]+=this.itemA[r].nOrigValuesA[w],this.itemA[r].nValuesA[w]&&this.nCountA[w]++}this.nCount=k*q}else for(a in l)if(l[a]){u=a;this.szAggregationField||(u=t,this.itemA[u]&&(u=u.split("*")[0]+"*"+Math.random()));this.itemA[u]=l[a];l[a].szValue=l[a].szValue||1;y=this.szFlag.match(/SUM/)||this.szFlag.match(/EXACT/)?1:l[a].nCount;this.itemA[u].nValue100/=y;this.nMinSize=Math.min(this.nMinSize,this.itemA[u].nSize);
this.nMaxSize=Math.max(this.nMaxSize,this.itemA[u].nSize);this.nSumSize+=this.itemA[u].nSize;this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[u].nAlpha);this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[u].nAlpha);this.nSumAlpha+=this.itemA[u].nAlpha;if(this.nGridWidth||this.szAggregationField)for(this.itemA[u].szSelectionId=a,w=0;w<this.itemA[u].nValuesA.length;w++)this.itemA[u].nValuesA[w]/=y,this.itemA[u].nOrigValuesA[w]/=y,this.itemA[u].nValue100&&(this.itemA[u].nValuesA[w]=this.itemA[u].nOrigValuesA[w]/
this.itemA[u].nValue100,this.szFlag.match(/FRACTION/)||(this.itemA[u].nValuesA[w]*=this.szFlag.match(/PERMILLE/)?1E3:100),this.szFlag.match(/INVERT/)&&(this.itemA[u].nValuesA[w]=100-this.itemA[u].nValuesA[w])),this.nMin=Math.min(this.itemA[u].nValuesA[w]||3E8,this.nMin||3E8),this.nMax=Math.max(this.itemA[u].nValuesA[w]||-3E8,this.nMax||-3E8);else this.nMin=Math.min(this.itemA[u].nSize,this.nMin||3E8),this.nMax=Math.max(this.itemA[u].nSize,this.nMax||-3E8);if(this.szAggregationField||this.szFlag.match(/RELOCATE/))this.szFlag.match(/ALIGN/)?
this.szFlag.match(/UP/)?this.themeNodesPosA[u]=new point(B.x,B.y):this.themeNodesPosA[u]=new point(C.x,C.y):(this.themeNodesPosA[a]=new point(d[t].x/c[t],d[t].y/c[t]),this.themeNodesPosA[u]=new point(d[t].x/c[t],d[t].y/c[t]))}y=0;for(a in this.itemA)y++;if(this.szMinAggregation){e=y=0;for(a in this.itemA)e+=this.itemA[a].nCount,y++;e/=y;for(a in this.itemA)this.itemA[a].nCount&&this.itemA[a].nCount<(this.nMinAggregation||e/2)?delete this.itemA[a]:this.itemA[a].nSize&&this.itemA[a].nSize<(this.nMinAggregation||
e/2)&&delete this.itemA[a]}this.fSorted=!0};
MapTheme.prototype.distributeValues=function(){if(0==this.nCount)return!1;this.szFlag.match(/AGGREGATE/)?this.aggregateValues():"aggregation"==this.szSizeField&&(this.szSizeField=null);if(this.szFlag.match(/EXACT/)&&(!this.szExactA||!this.szExactA.length)&&(this.szExactA=this.szExactA||[],this.nStringToValueA))for(a in this.nStringToValueA)this.szExactA.push(this.nStringToValueA[a]);!this.szFlag.match(/EXACT/)||this.szLabelA&&this.szLabelA.length||!this.szValuesA||(this.szLabelA=this.szValuesA);this.origColorScheme||
(this.origColorScheme=this.colorScheme=this.defaultColorScheme);if(isNaN(Number(this.origColorScheme[0])))this.colorScheme=this.origColorScheme;else{!this.szFlag.match(/SEQUENCE/)&&this.szFieldsA.length>this.origColorScheme[0]&&(this.origColorScheme[0]=this.szFieldsA.length);this.szFlag.match(/EXACT/)&&(this.origColorScheme[0]=this.szExactA.length);try{this.colorScheme=ColorScheme.createColorScheme(this.origColorScheme[1],this.origColorScheme[2],this.origColorScheme[0],this.origColorScheme[3],this.origColorScheme[4])}catch(e){this.colorScheme=
this.defaultColorScheme}}if(this.colorScheme[0].match(/user/i))try{HTMLWindow.ixmaps.htmlgui_colorScheme(this)}catch(c){}if(this.szFlag.match(/DOMINANT/))for(;this.colorScheme.length<this.szFieldsA.length;)this.colorScheme[this.colorScheme.length]="#dddddd";if(this.szFlag.match(/NORMALIZE/)&&this.nMax){for(a in this.itemA)this.itemA[a].nValuesA[0]/=this.nMax;this.nMin/=this.nMax;this.nMax/=this.nMax}if(this.szFlag.match(/INVERTSIZE/)&&this.szSizeField){for(a in this.itemA)this.itemA[a].nSize=this.nMaxSize-
this.itemA[a].nSize;this.nNormalSizeValue=this.nNormalSizeValue||this.nMaxSize}if(!this.szFlag.match(/EXACT/)){var f=[];for(a in this.itemA)this.itemA[a].nValuesA[0]&&f.push(this.itemA[a].nValuesA[0]);"$item$"!=this.szFieldsA[0]&&f.sort(this.sortUp);this.nMedianA[0]=f[Math.round(f.length/2)]}var d=this.colorScheme.length,h=this.nMax-this.nMin,g=this.nMin,l=this.nMax;null==this.nRangeCenterValue||isNaN(this.nRangeCenterValue)||(l=Math.max(Math.abs(this.nRangeCenterValue-g),Math.abs(l-this.nRangeCenterValue)),
g=this.nRangeCenterValue-l,l=this.nRangeCenterValue+l,h=l-g);if(this.szFlag.match(/INTEGER/))d>h?d=h:d>h/2?d=Math.floor(h/2):h+=d-h%d;else{var k=1;for(this.szField100&&(k=.01);h>1E3*k;)k*=10;1<k?(g=Math.floor(g/k)*k,l=Math.ceil(l/k)*k):l+=l/1E5;h=l-g}if((this.nRangesA=this.szRangesA||this.szExactA)&&this.nRangesA.length){d=this.nRangesA.length-(this.szFlag.match(/EXACT/)?0:1);if(this.szSymbolsA&&this.szSymbolsA.length)for(;this.szSymbolsA.length<d;)this.szSymbolsA[this.szSymbolsA.length]=this.szSymbolsA[0];
if(this.colorScheme&&this.colorScheme.length)for(;this.colorScheme.length<d;)this.colorScheme[this.colorScheme.length]="#dddddd";this.partsA=[];for(k=0;k<d;k++)g=Number(this.nRangesA[k]),l=Number(this.nRangesA[k+(this.szFlag.match(/EXACT/)?0:1)])+1E-9,this.partsA[this.partsA.length]={min:g,max:l,color:this.colorScheme[k],nCount:0,nSum:0};if(this.szFlag.match(/EXACT/)&&this.exactCountA)for(k=0;k<d;k++)this.partsA[k].nCount=this.exactCountA[k];if(this.szFlag.match(/PLOTVAR/)){for(k=0;k<d;k++){f=[];
for(a in this.itemA)f.push(this.itemA[a].nValuesA[k]);g=Math.round(f.length/2);this.nMedianA[k]=f[g];this.nMeanA[k]=this.nSumA[k]/this.nCountA[k]}for(k=0;k<d;k++){f=[];for(a in this.itemA)this.itemA[a].nValuesA[k]&&f.push(this.itemA[a].nValuesA[k]);this.nDeviationA[k]=this.parent.getDeviationOfArray(f)}}}else{h/=d;h>k&&(h=Math.floor(h/k)*k);this.partsA=[];for(k=0;k<d;k++)this.partsA[this.partsA.length]={min:g+k*h,max:g+(k+1)*h,color:this.colorScheme[k],nCount:0,nSum:0};this.partsA[this.partsA.length-
1].max=l;if(this.szFlag.match(/QUANTILE/)){f[f.length]=l;g=Math.round(f.length/d);for(k=0;k<this.partsA.length;k++)this.partsA[k].min=f[k*g],this.partsA[k].max=f[(k+1)*g];this.partsA[this.partsA.length-1].max=l}if(this.szFlag.match(/LOG/)){g=Math.log(this.nMin?this.nMin:1);h=Math.log(this.nMax?this.nMax:1)-Math.log(this.nMin?this.nMin:1);h/=d;this.partsA=[];for(k=0;k<d;k++)this.partsA[this.partsA.length]={min:Math.exp(g+k*h),max:Math.exp(g+(k+1)*h),color:this.colorScheme[k],nCount:0,nSum:0};this.partsA[this.partsA.length-
1].max=this.nMax}if(this.szFlag.match(/DOMINANT/)||this.szFlag.match(/OFFSETMEAN/)||this.szFlag.match(/OFFSETMEDIAN/)||this.szFlag.match(/DEVIATION/)||this.szFlag.match(/PLOTVAR/))for(k=0;k<this.szFieldsA.length;k++){f=[];for(a in this.itemA)this.itemA[a].nValuesA[k]&&f.push(this.itemA[a].nValuesA[k]);"$item$"!=this.szFieldsA[k]&&f.sort(this.sortUp);this.nMedianA[k]=f[Math.round(f.length/2)];this.nSum100?this.szFlag.match(/DIFFERENCE/)?this.nMeanA[k]=this.nSumA[k]/this.nCount:(this.nMeanA[k]=this.nOrigSumA[k]/
this.nSum100,this.szFlag.match(/FRACTION/)?this.nMeanA[k]*=this.nFractionScale||1:this.szFlag.match(/PERMILLE/)?this.nMeanA[k]*=1E3:(this.nMeanA[k]*=100,this.szFlag.match(/RELATIVE/)?this.nMeanA[k]-=100:this.szFlag.match(/INVERT/)&&(this.nMeanA[k]=100-this.nMeanA[k]))):this.nMeanA[k]=this.nSumA[k]/this.nCount;this.szDominantFilter=this.szDominantFilter||"mean";this.nDominantDFilter=this.nDominantDFilter||0;this.szDominantFilter.match(/min/)?this.nFilterA[k]=this.nMinA[k]+(this.nMaxA[k]-this.nMinA[k])/
100*this.nDominantDFilter:this.szDominantFilter.match(/max/)?this.nFilterA[k]=this.nMinA[k]+(this.nMaxA[k]-this.nMinA[k])/100*this.nDominantDFilter:this.szDominantFilter.match(/mean/)?this.nFilterA[k]=this.nMeanA[k]+(this.nMaxA[k]-this.nMeanA[k])/100*this.nDominantDFilter:this.szDominantFilter.match(/median/)&&(this.nFilterA[k]=this.nMedianA[k]+(this.nMaxA[k]-this.nMedianA[k])/100*this.nDominantDFilter)}if(this.szFlag.match(/DEVIATION/)||this.szFlag.match(/PLOTVAR/))for(k=0;k<this.szFieldsA.length;k++){f=
[];for(a in this.itemA)this.itemA[a].nValuesA[k]&&f.push(this.itemA[a].nValuesA[k]);this.nDeviationA[k]=this.parent.getDeviationOfArray(f)}}this.partsA[this.partsA.length-1].max+=.001;return!0};MapTheme.prototype.sortUp=function(e,c){return e>c?1:-1};MapTheme.prototype.sortIndexUp=function(e,c){return e.value>c.value?1:-1};MapTheme.prototype.sortIndexDown=function(e,c){return e.value<c.value?1:-1};MapTheme.prototype.sortPartsUp=function(e,c){return e.nCount>c.nCount?1:-1};
MapTheme.prototype.sortMeanUp=function(e,c){return e.mean>c.mean?1:-1};MapTheme.prototype.shuffleArray=function(e,c){for(var f=e.length-1;0<f;f--){var d=Math.floor((c&&c[f]?c[f]:Math.random())*f+1),h=e[f];e[f]=e[d];e[d]=h}};MapTheme.prototype.getRandomNumberArray=function(e){for(var c=[],f=0;f<e;f++)c.push(Math.random());return c};
MapTheme.prototype.paintMap=function(e){this.beginDraw();this.mapSleep&&(this.mapSleep.checkSleepMessage="painting map");var c=0,f=0,d=0,h=0,g=0,l=0,k="",m="";map.Dictionary.getLocalText("of mean");map.Dictionary.getLocalText("of median");var u=!1,z=0,q=d=k=0,h=null;this.fillOpacity=this.fillOpacity?this.fillOpacity:this.nOpacity;this.szStyle="fill-opacity:"+String(this.fillOpacity?this.fillOpacity:fTransparentMap?.6:1);this.autoOpacity&&(this.szStyle="fill-opacity:"+String(Math.max(.3,Math.min(1,
.3+.5/Math.max(1,Math.log(map.Zoom.nZoom))))));this.szShapeType.match(/line/)&&(this.szStyle=this.fillOpacity?"stroke-opacity:"+this.fillOpacity+";":"stroke-opacity:1");if(!e||0==e){e=0;this.indexA=[];for(q in this.itemA)this.indexA[this.indexA.length]=q,this.itemA[q].todo=!0;this.nDoneCount=0}for(;e<this.indexA.length;e++){if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(e,10))){this.fContinue=!0;this.continueIndex=e;return}q=this.indexA[e];this.nDoneCount++;u=
!1;z=0;if(this.szFlag.match(/COMPOSECOLOR/))__maptheme_getComposedColor(this.itemA[q].nValuesA,this.colorScheme);else if(this.szFlag.match(/DOMINANT/)){u=!0;nIndex=-1;for(k=0;k<this.itemA[q].nValuesA.length;k++)c=this.itemA[q].nValuesA[k],f=100/this.nMeanA[k]*c,d=100/this.nMedianA[k]*c,h=(c-this.nMeanA[k])/this.nDeviationA[k],g=c,this.szFlag.match(/PERCENTOFMEAN/)&&(g=f),this.szFlag.match(/PERCENTOFMEDIAN/)&&(g=d),this.szFlag.match(/DEVIATION/)&&(g=h),c>this.nFilterA[k]&&g>z&&(this.itemA[q].nClass=
k,z=g,nIndex=k);if(0<=nIndex){this.itemA[q].nDominant=nIndex;c=this.itemA[q].nValuesA[nIndex];k=" "+this.szFieldsA[nIndex]+" ";this.szLabelA&&this.szLabelA[nIndex]&&(k=" "+this.szLabelA[nIndex]+" ");if(this.szFlag.match(/PERCENTOFMEAN/)||this.szFlag.match(/DEVIATION/))m=map.Dictionary.getLocalText(" ( mean: ")+this.formatValue(this.nMeanA[nIndex],1)+this.szUnit+")";this.szFlag.match(/PERCENTOFMEDIAN/)&&(m=map.Dictionary.getLocalText(" ( median: ")+this.formatValue(this.nMedianA[nIndex],1)+this.szUnit+
")");this.itemA[q].nValue=this.itemA[q].nValuesA[nIndex];this.itemA[q].szLabel=k;this.itemA[q].szColor=this.colorScheme[nIndex];h=this.getItemNodes(q);for(d=0;d<h.length;d++)if(g=this.paintShape(h[d],this.colorScheme[nIndex]),g.setAttributeNS(szMapNs,"tooltip",this.formatValue(c,2)+this.szUnit+k+m),this.szFlag.match(/DOPACITY/)){var y=z=0,z=isNaN(this.itemA[q].nValuesA[nIndex])?0:this.itemA[q].nValuesA[nIndex],y=isNaN(this.nMaxA[nIndex])?0:this.nMaxA[nIndex];this.szAlphaField?(l=0,"undefined"!=typeof this.itemA[q].nAlpha&&
(l=1/(this.nDopacityPow||1),l=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,l)*Math.pow(this.itemA[q].nAlpha,l))):this.szFlag.match(/DOPACITYLOGMEAN/)?l=Math.log((this.nDopacityScale||1)*(f-100))/Math.log(100):this.szFlag.match(/DOPACITYPOWMEAN/)?(l=1/(this.nDopacityPow||1),l=Math.pow((this.nDopacityScale||1)*(f-100),l)/Math.pow(100,l)):this.szFlag.match(/DOPACITYMEAN/)?l=(this.nDopacityScale||1)*(f-100)/100:this.szFlag.match(/DOPACITYLOGMAX/)?l=Math.log(z)/Math.log(y):this.szFlag.match(/DOPACITYPOWMAX/)?
(l=1/(this.nDopacityPow||1),l=(this.nDopacityScale||1)*Math.pow(z,l)/Math.pow(y,l)):l=this.szFlag.match(/DOPACITYMAX/)?(this.nDopacityScale||2)/y*z:Math.log((this.nDopacityScale||1)*z)/Math.log(y);l=1E-4>l?0:l;l=Math.min(this.nOpacity||.9,l);this.autoOpacity&&(l*=Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom)))));g.style.setProperty("fill-opacity",String(l),"")}this.partsA[nIndex].nCount++}else for(h=this.getItemNodes(q),d=0;d<h.length;d++)this.unPaintShape(h[d]),h[d].removeAttributeNS(szMapNs,
"tooltip")}else for(c=this.szFlag.match(/CLIP/)&&this.nClipFrames?this.nClipFrames==this.itemA[q].nValuesA.length?Number(this.itemA[q].nValuesA[this.nActualFrame]):this.itemA[q].nValuesA[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.itemA[q].nValuesA[1]*this.nActualFrame/(this.nClipFrames-1):this.itemA[q].nValuesA[0],k=0;k<this.partsA.length;k++)if(c<this.partsA[k].max){this.itemA[q].nValue=c;this.itemA[q].szColor=this.partsA[k].color;if(this.itemA[q].todo){h=this.getItemNodes(q);
for(d=0;d<h.length;d++)g=this.paintShape(h[d],this.partsA[k].color,c),this.szLabelA&&this.szLabelA[k]&&this.szFlag.match(/EXACT/)?g.setAttributeNS(szMapNs,"tooltip",this.szLabelA[k]):g.setAttributeNS(szMapNs,"tooltip",this.formatValue(c,2)+this.szUnit),this.szFlag.match(/DOPACITY/)&&(this.szAlphaField?(l=0,"undefined"!=typeof this.itemA[q].nAlpha&&(l=1/(this.nDopacityPow||1),l=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,l)*Math.pow(this.itemA[q].nAlpha,l))):0>this.nMin&&0<this.nMax?this.szFlag.match(/DOPACITYMAX/)?
(l=1/(this.nDopacityPow||1),l=Math.pow(Math.abs(c),l)/Math.pow(this.nMedianA[0]-this.nMin,l)*(this.fillOpacity||1)*(this.nDopacityScale||1)):l=this.szFlag.match(/DOPACITYLOG/)?Math.log(Math.abs(c))/Math.log(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.abs(c)/(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):this.szFlag.match(/BIPOLAR/)||this.szFlag.match(/DOPACITYMINMAX/)?this.szFlag.match(/DOPACITYMAX/)?(l=1/(this.nDopacityPow||1),
l=c>=this.nMeanA[0]?Math.pow(Math.abs(c-this.nMeanA[0]),l)/Math.pow(Math.abs(this.nMax-this.nMeanA[0]),l)*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.pow(Math.abs(this.nMeanA[0]-c),l)/Math.pow(Math.abs(this.nMeanA[0]-this.nMin),l)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYLOG/)?l=c>=this.nMedianA[0]?Math.log(Math.abs(c-this.nMedianA[0]))/Math.log(this.nMax-this.nMedianA[0])*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.log(Math.abs(c-this.nMedianA[0]))/
Math.log(this.nMedianA[0]-this.nMin)*(this.fillOpacity||1)*(this.nDopacityScale||1):(l=1/(this.nDopacityPow||1),l=c>=this.nMedianA[0]?Math.pow(Math.abs(c-this.nMedianA[0]),l)/Math.pow(this.nMax-this.nMedianA[0],l)*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.pow(Math.abs(c-this.nMedianA[0]),l)/Math.pow(this.nMedianA[0]-this.nMin,l)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYMIN/)?(l=1/(this.nDopacityPow||1),l=Math.pow(this.nMax-c,l)/Math.pow(this.nMax-this.nMin,
l)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYMAX/)?(l=1/(this.nDopacityPow||1),l=Math.pow(c-this.nMin,l)/Math.pow(this.nMax-this.nMin,l)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYLOG/)?l=Math.log(c-this.nMin)/Math.log(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):this.szFlag.match(/DOPACITY/)&&(l=(c-this.nMin)/(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1)),l=1E-4>l?0:
l,l=Math.min(this.nOpacity||.9,l),this.autoOpacity&&(l*=Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom))))),g.style.setProperty("fill-opacity",String(l),""));this.itemA[q].todo=!1}this.partsA[k].nCount++;this.partsA[k].nSum+=c;u=!0;break}if(!u)for(this.itemA[q].szColor=this.szNoDataColor?this.szNoDataColor:"white",h=this.getItemNodes(q),d=0;d<h.length;d++)g=this.paintShape(h[d],this.szNoDataColor?this.szNoDataColor:"white",-1),g.setAttributeNS(szMapNs,"tooltip","no value"),this.szFlag.match(/DOPACITY/)&&
g.style.setProperty("fill-opacity","0",""),this.nNoData++}this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;this.showInfo();this.endDraw();this.szFlag.match(/CLIP/)?this.nClipFrames==this.itemA[q].nValuesA.length?this.szXaxisA&&this.szXaxisA[this.nActualFrame]?displayMessage(this.szXaxisA[this.nActualFrame],3E3,"big"):this.szLabelA&&this.szLabelA[this.nActualFrame]&&displayMessage(this.szLabelA[this.nActualFrame],3E3,"big"):(c=this.szXaxisA||this.szLabelA)&&(0==this.nActualFrame?displayMessage(c[0],
3E3,"big"):this.nActualFrame==this.nClipFrames-1?displayMessage(c[1],3E3,"big"):displayMessage(" ... ",3E3,"big")):this.ErrorMessage?(displayMessage(this.ErrorMessage,1E4,"notify"),this.ErrorMessage=null):clearMessage();this.szFlag.match(/VALUES/)&&(!this.szValueUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nValueUpper)?(this.mapSleep&&this.mapSleep.initCheckSleep(25),this.fContinue=this.fMakeLabel=!0,this.nActualFrame=this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=
this.nRealizedCount=this.nSkipCount=this.nDoneCount=this.continueIndex=0,setTimeout("map.Themes.continueExecute()",250)):this.unlabelMap()};
MapTheme.prototype.unpaintMap=function(){if(this.szFlag.match(/CHART/)){if(this.chartGroup){if(0==this.chartGroup.childNodes.length&&this.itemA){var e=null;for(a in this.itemA)(e=SVGDocument.getElementById(this.szId+":"+a+":chartgroup"))&&e.parentNode.removeChild(e)}e=this.chartGroup.getAttributeNS(null,"id");this.szFlag.match(/CLIP/)||this.szFlag.match(/CLEAR/)||this.nGridWidthPx?map.Dom.removeElementById(e):executeWithMessage("map.Dom.removeElementById('"+e+"');","cleaning up ...");this.chartGroup=
null}}else{this.beginDraw();for(e=0;e<this.paintedShapeNodesA.length;e++)this.unPaintShape(this.paintedShapeNodesA[e]),this.paintedShapeNodesA[e].removeAttributeNS(szMapNs,"tooltip");this.paintedShapeNodesA.length=0;this.unlabelMap();this.endDraw();this.isVisible=!1;this.checkVisible();setTimeout("map.Layer.adaptLabel(null)",10)}};
MapTheme.prototype.paintShape=function(e,c,f){this.paintedShapeNodesA.push(e);switch(this.szShapeType){case "line":e.setAttributeNS(null,"style","stroke:"+c+";"+this.szStyle);break;case "line+buffer":var d=e.getAttributeNS(null,"id");if(!d.match(":paint")){var h=SVGDocument.getElementById(d+":paint");h||(h=e.cloneNode(1E3),e.parentNode.insertBefore(h,e),h.setAttributeNS(null,"id",d+":paint"));e=h}d=4;if(this.nBufferSize)if(this.nBufferSize.match(/\$value\$/)){f=this.nBufferSize.split("$value$");d=
"";for(h=0;h<f.length;h++)d+=f[h],h<f.length-1&&(d+="nValue");d=eval(d)}else d=this.nBufferSize.match(/value/)?1E3<100/(this.nMin+1E-9)*(this.nMax-this.nMin)?6+Math.log(f/this.nMax):10*f/(this.nMax-this.nMin):this.nBufferSize;d*=Math.log(1+1/__featureScaling_lastScale);e.setAttributeNS(null,"style","stroke:"+c+";stroke-width:"+map.Scale.normalX(d)*map.Scale.nZoomScale+";"+this.szStyle+";stroke-linecap:butt;");break;default:e.setAttributeNS(null,"style","fill:"+c+";"+this.szStyle)}return e};
MapTheme.prototype.unPaintShape=function(e){if("line+buffer"==this.szShapeType){var c=e.getAttributeNS(null,"id");(c=SVGDocument.getElementById(c+":paint"))&&c.parentNode.removeChild(c)}e.removeAttributeNS(null,"style")};
MapTheme.prototype.zoomToClass=function(e,c){var f=0;if(this.szFlag.match(/DOMINANT/))for(a in this.itemA)this.itemA[a].nClass==e&&f++;else f=this.partsA[e].nCount;if(0==f)displayMessage("No members !");else{var d=null;if(this.szFlag.match(/CHART/))for(var h=this.chartGroup.childNodes,f=0;f<h.length;f++){var g=h.item(f);if("seechilds"==g.getAttributeNS(szMapNs,"value"))for(var g=g.firstChild.childNodes,l=0;l<g.length;l++)g.item(l).getAttributeNS(szMapNs,"class");else g.getAttributeNS(szMapNs,"class")}else if(this.szFlag.match(/DOMINANT/))for(a in this.itemA)if(this.itemA[a].nClass==
e&&"highlight"==this.evidenceMode)for(d=this.getItemNodes(a),f=0;f<d.length;f++);else{if(this.itemA[a].nClass!=e&&"highlight"!=this.evidenceMode)for(d=this.getItemNodes(a),f=0;f<d.length;f++);}else{for(var h=new point(1E5,1E5),g=new point(-1E5,-1E5),l=this.partsA[e].min,k=this.partsA[e].max,f=1;f<c;f++)l=Math.min(l,this.partsA[e+f].min),k=Math.max(k,this.partsA[e+f].max);this.szFlag.match(/EXACT/)&&(l++,k++);for(a in this.itemA)if(this.itemA[a].nValuesA[0]>l&&this.itemA[a].nValuesA[0]<k)for(d=this.getItemNodes(a),
f=0;f<d.length;f++){bBox=map.Dom.getBox(d[f]);if(0==bBox.width||0==bBox.height){var m=getMatrix(d[f]);bBox.x+=m[4];bBox.y+=m[5];bBox.width=map.Scale.viewBox.width/20;bBox.height=map.Scale.viewBox.height/20;bBox.x-=bBox.width/2;bBox.y-=bBox.height/2}m=map.Scale.getMapOffset(d[f]);bBox.x+=m.x;bBox.y+=m.y;h.x=Math.min(h.x,bBox.x);h.y=Math.min(h.y,bBox.y);g.x=Math.max(g.x,bBox.x+bBox.width);g.y=Math.max(g.y,bBox.y+bBox.height)}f=new box(h.x,h.y,g.x-h.x,g.y-h.y);f.scale(1.2);f=map.Zoom.clipArea(f);map.Zoom.setNewArea(f)}}};
MapTheme.prototype.markClass=function(e,c){if(0!=this.fMarkEnable)if(map.Themes.enableSubThemes&&this.szFields.match(/\|/)&&this.szFlag.match(/DOMINANT/)&&!this.szFlag.match(/CHART/))this.createSubTheme(e);else{var f=this.szItemFilter&&this.szItemFilter.length;if(!this.szFlag.match(/CHART/)||f)this.fUnmarkEnable=!0,this.unmarkClass(),this.fUnmarkEnable=!1;if(0!=this.fMarkEnable){var d=0;if(this.szFlag.match(/DOMINANT/)&&!this.szFlag.match(/CHART/))for(a in this.itemA)this.itemA[a].nClass==e&&d++;
else d=this.partsA[e].nCount;if(500<d&&"highlight"==this.evidenceMode)displayMessage("Sorry ! to many members");else if(0==d)displayMessage("No members !");else{clearMessage();highLightList.removeAll();var h,d=null;if(this.szFlag.match(/CHART/))for(var g=this.chartGroup.childNodes,d=0;d<g.length;d++)if(h=g.item(d),"seechilds"==h.getAttributeNS(szMapNs,"value")){h=h.getElementsByTagName("g");for(var l=0;l<h.length;l++)for(var k=h.item(l).childNodes,m=0;m<k.length;m++){var u=k.item(m);if(u.getAttributeNS&&
u.getAttributeNS(szMapNs,"class")){if(this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/PLOT/)){var z=u.getAttributeNS(null,"transform");z&&z.length&&(u.setAttributeNS(szMapNs,"orig-transform",z),u.setAttributeNS(null,"transform",""))}z=Number(u.getAttributeNS(szMapNs,"class"));this.szFlag.match(/PIE/)&&(1<this.szFieldsA.length||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/EXACT/))?z==e?((this.szFlag.match(/VALUES/)||DonutCharts.partDrawOut(u))&&u.style.setProperty("opacity","1",""),u.style.setProperty("display",
"inline","")):DonutCharts.partDrawIn(u)||u.style.setProperty("display","none",""):this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(1<this.szFieldsA.length||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/EXACT/))?z==e?(u.setAttributeNS(null,"transform","matrix(1 0 0 1 -10 6.6)"),u.style.setProperty("fill-opacity","1","")):(u.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),u.style.setProperty("fill-opacity","0.85","")):z==e?f||u.style.setProperty("display",
"inline",""):u.style.setProperty("display","none","")}}}else z=Number(h.getAttributeNS(szMapNs,"class")),z==e?f||h.style.setProperty("display","inline",""):h.style.setProperty("display","none","");else{this.beginDraw();if(this.szFlag.match(/DOMINANT/))for(a in this.itemA)if(this.itemA[a].nClass==e&&"highlight"==this.evidenceMode)for(d=this.getItemNodes(a),h=0;h<d.length;h++)highLightList.addItem(d[h]);else{if(this.itemA[a].nClass!=e&&"highlight"!=this.evidenceMode)for(d=this.getItemNodes(a),h=0;h<
d.length;h++)d[h].setAttributeNS(szMapNs,"themestyle",d[h].getAttributeNS(null,"style")),d[h].style.setProperty("display","none","")}else{f=this.partsA[e].min;g=this.partsA[e].max;for(d=1;d<c;d++)f=Math.min(f,this.partsA[e+d].min),g=Math.max(g,this.partsA[e+d].max);for(a in this.itemA)if(this.szFlag.match(/EXACT/)&&this.itemA[a].nValuesA[0]==f){if("highlight"==this.evidenceMode)for(d=this.getItemNodes(a),h=0;h<d.length;h++)highLightList.addItem(d[h])}else if(this.itemA[a].nValuesA[0]>f&&this.itemA[a].nValuesA[0]<
g){if("highlight"==this.evidenceMode)for(d=this.getItemNodes(a),h=0;h<d.length;h++)highLightList.addItem(d[h])}else if("highlight"!=this.evidenceMode)for(d=this.getItemNodes(a),h=0;h<d.length;h++)if(this.szFlag.match(/BUFFER/))(l=SVGDocument.getElementById(d[h].getAttributeNS(null,"id")+":paint"))&&l.style.setProperty("display","none","");else{d[h].setAttributeNS(szMapNs,"themestyle",d[h].getAttributeNS(null,"style"));d[h].setAttributeNS(null,"style",d[h].getAttributeNS(szMapNs,"origthemestyle"));
if(l=SVGDocument.getElementById(d[h].firstChild.nextSibling.getAttribute("id")+"L"))l.setAttributeNS(szMapNs,"display",l.style.getPropertyValue("display")),l.style.setProperty("display","none","");if(l=SVGDocument.getElementById(d[h].firstChild.nextSibling.getAttribute("id")+"L:bg"))l.setAttributeNS(szMapNs,"display",l.style.getPropertyValue("display")),l.style.setProperty("display","none","")}}this.endDraw();this.fMarkClass=!0}}}}};
MapTheme.prototype.unmarkClass=function(e){if(0!=this.fUnmarkEnable)if(this.subTheme)this.removeSubTheme();else if(this.szItemFilter&&this.szItemFilter.length)this.fMarkEnable=!0,this.filterItems(this.szItemFilter,this.itemFilterOpt);else if(clearMessage(),this.szFlag.match(/CHART/)){e=this.chartGroup.childNodes;for(var c=0;c<e.length;c++){var f=e.item(c);if("seechilds"==f.getAttributeNS(szMapNs,"value"))for(var f=f.getElementsByTagName("g"),d=0;d<f.length;d++)for(var h=f.item(d).childNodes,g=0;g<
h.length;g++){var l=h.item(g);if(l.getAttributeNS&&l.getAttributeNS(szMapNs,"class")){if(this.szFlag.match(/SEQUENCE/)){var k=l.getAttributeNS(szMapNs,"orig-transform");k&&k.length&&(l.removeAttributeNS(szMapNs,"orig-transform"),l.setAttributeNS(null,"transform",k))}this.szFlag.match(/PIE/)&&(DonutCharts.partDrawIn(l),l.style.setProperty("opacity","1",""));this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(l.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),l.style.setProperty("fill-opacity",
"1",""));l.style&&l.style.setProperty("display","inline","")}}else f.style.setProperty("display","inline","")}this.szFlag.match(/TEXTONLY/)&&setTimeout("map.Layer.adaptLabel()",10)}else{this.beginDraw();if("highlight"!=this.evidenceMode)for(a in this.itemA)for(e=this.getItemNodes(a),c=0;c<e.length;c++)this.szFlag.match(/BUFFER/)?(f=SVGDocument.getElementById(e[c].getAttributeNS(null,"id")+":paint"))&&f.style.setProperty("display","inline",""):(f=e[c].getAttributeNS(szMapNs,"themestyle"))&&f.length&&
"null"!=f&&(e[c].setAttributeNS(null,"style",f),e[c].removeAttributeNS(szMapNs,"themestyle"),(f=SVGDocument.getElementById(e[c].firstChild.nextSibling.getAttribute("id")+"L"))&&f.style.setProperty("display",f.getAttributeNS(szMapNs,"display"),""),(f=SVGDocument.getElementById(e[c].firstChild.nextSibling.getAttribute("id")+"L:bg"))&&f.style.setProperty("display",f.getAttributeNS(szMapNs,"display"),""));else highLightList.removeAll();this.endDraw();this.fMarkClass=!1}};
MapTheme.prototype.showClass=function(e,c,f){var d=0;if(this.szFlag.match(/DOMINANT/))for(a in this.itemA)this.itemA[a].nClass==e&&d++;clearMessage();var h=null,d=f?"inline":"none";if(this.szFlag.match(/CHART/))for(f=this.chartGroup.childNodes,h=0;h<f.length;h++){var g=f.item(h);if("seechilds"==g.getAttributeNS(szMapNs,"value"))for(g=g.firstChild.childNodes,c=0;c<g.length;c++){var l=g.item(c),k=Number(l.getAttributeNS(szMapNs,"class"));k==e&&l.style.setProperty("display",d,"")}else k=Number(g.getAttributeNS(szMapNs,
"class")),k==e&&g.style.setProperty("display",d,"")}else{this.beginDraw();if(this.szFlag.match(/DOMINANT/))for(a in this.itemA){if(this.itemA[a].nClass==e)for(h=this.getItemNodes(a),c=0;c<h.length;c++)h[c].setAttributeNS(szMapNs,"themestyle",h[c].getAttributeNS(null,"style")),h[c].style.setProperty("display",d,"")}else{k=this.partsA[e].min;g=this.partsA[e].max;for(h=1;h<c;h++)k=Math.min(k,this.partsA[e+h].min),g=Math.max(g,this.partsA[e+h].max);this.szFlag.match(/EXACT/)&&(k++,g++);for(a in this.itemA)if(this.szFlag.match(/EXACT/)&&
this.itemA[a].nValuesA[0]==k||this.itemA[a].nValuesA[0]>k&&this.itemA[a].nValuesA[0]<g)for(h=this.getItemNodes(a),c=0;c<h.length;c++)this.szFlag.match(/BUFFER/)?(e=SVGDocument.getElementById(h[c].getAttributeNS(null,"id")+":paint"))&&e.style.setProperty("display",d,""):f?(e=h[c].getAttributeNS(szMapNs,"themestyle"))&&e.length&&"null"!=e&&(h[c].setAttributeNS(null,"style",e),h[c].removeAttributeNS(szMapNs,"themestyle")):(h[c].setAttributeNS(szMapNs,"themestyle",h[c].getAttributeNS(null,"style")),h[c].setAttributeNS(null,
"style",h[c].getAttributeNS(szMapNs,"origthemestyle")))}this.endDraw()}};
MapTheme.prototype.createSubTheme=function(e){this.subTheme&&this.removeSubTheme();var c="",f="",d="",h="",g="",l="",k="",m="";this.coTable&&"undefined"!=typeof this.coTable&&(c="dbtable:"+this.coTable+";");this.szSelectionField&&"undefined"!=typeof this.szSelectionField&&(f="lookupfield:"+this.szSelectionField+";");this.szAlphaField&&"undefined"!=typeof this.szAlphaField&&(d="alphafield:"+this.szAlphaField+";");this.szAlphaField100&&"undefined"!=typeof this.szAlphaField100&&(h="alphafield100:"+this.szAlphaField100+
";");this.nDopacityScale&&"undefined"!=typeof this.nDopacityScale&&(g="dopacityscale:"+this.nDopacityScale+";");this.nDopacityPow&&"undefined"!=typeof this.nDopacityPow&&(l="dopacitypow:"+this.nDopacityPow+";");this.szFlag.match(/DOPACITY/)&&(k+="DOPACITYMAX|");this.szFlag.match(/AGGREGATE/)&&(k+="AGGREGATE|");this.szFlag.match(/SUM/)&&(k+="SUM|");this.szFlag.match(/ZEROISVALUE/)&&(k+="ZEROISVALUE|");this.szFlag.match(/VALUES/)&&(k+="VALUES|");this.szAggregationField&&"undefined"!=typeof this.szAggregationField&&
(m+="aggregationfield:"+this.szAggregationField+";");this.szUnits&&"undefined"!=typeof this.szUnits&&(m+="units:"+this.szUnits+";");map.Themes.enableMultiChoroplethe=!0;this.subTheme=map.Themes.newTheme2(this.szThemes,this.szFields.split("|")[e],this.szField100,"type:CHOROPLETHE|QUANTILE|NOINFO|SUBTHEME|"+k+";colorscheme:7|white|"+this.colorScheme[e]+";"+c+f+d+h+g+l+m,this.szLabelA[e],"");map.Themes.subTheme=this};
MapTheme.prototype.removeSubTheme=function(){map.Themes.enableMultiChoroplethe=!1;this.subTheme&&(map.Themes.subTheme=!1,map.Themes.removeTheme(null,this.subTheme.szId),this.subTheme=null,map.Themes.realizeDone(this))};
MapTheme.prototype.isItemInFilter=function(e,c,f,d){if(!(0!=f.length||d&&d.field))return!0;if("undefined"!=typeof c.dbIndex)if(c=c.dbIndex,this.__szValue=e.dbRecords[c].join(" "),f.length){if(eval("this.__szValue.match(/"+f.replace(/\//gi,"\\/")+"/i)"))return!0}else if(d&&d.field){for(f=0;f<e.dbFields.length;f++)if(e.dbFields[f].id==d.field&&(d.min&&e.dbRecords[c][f]<d.min||d.max&&e.dbRecords[c][f]>d.max))return!1;return!0}return!1};
MapTheme.prototype.filterItems=function(e,c){if(0!=this.fMarkEnable){this.szItemFilter=e;this.itemFilterOpt=c;this.filterNodesA=e.length||c&&c.field?[]:null;for(var f=null,d=0;d<this.szThemesA.length&&(!(f=this.objThemesA[this.szThemesA[d]])||!f.dbRecords);d++);if(f&&f.dbRecords){if(this.szFlag.match(/CHART/))for(var h=this.chartGroup.childNodes,d=0;d<h.length;d++){var g=[],l=h.item(d);g.push(l);for(var k=0;k<g.length;k++)szId=g[k].getAttributeNS(null,"id"),szId=szId.split(":")[1]+"::"+szId.split(":")[3],
this.itemA[szId]?this.isItemInFilter(f,this.itemA[szId],e,c)?(l.style.setProperty("display","inline",""),this.filterNodesA&&this.filterNodesA.push(szId)):l.style.setProperty("display","none",""):l.style.setProperty("display","inline","")}else{this.beginDraw();for(a in this.itemA)if(this.itemA[a]&&"undefined"!=typeof this.itemA[a].dbIndex)if(this.isItemInFilter(f,this.itemA[a],e,c))for(this.filterNodesA&&this.filterNodesA.push(a),tilesNodesA=this.getItemNodes(a),j=0;j<tilesNodesA.length;j++)this.szFlag.match(/BUFFER/)?
(d=SVGDocument.getElementById(tilesNodesA[j].getAttributeNS(null,"id")+":paint"))&&d.style.setProperty("display","inline",""):(d=tilesNodesA[j].getAttributeNS(szMapNs,"themestyle"))&&d.length&&"null"!=d&&(tilesNodesA[j].setAttributeNS(null,"style",d),tilesNodesA[j].removeAttributeNS(szMapNs,"themestyle"),(d=SVGDocument.getElementById(tilesNodesA[j].firstChild.nextSibling.getAttribute("id")+"L"))&&d.style.setProperty("display",d.getAttributeNS(szMapNs,"display"),""),(d=SVGDocument.getElementById(tilesNodesA[j].firstChild.nextSibling.getAttribute("id")+
"L:bg"))&&d.style.setProperty("display",d.getAttributeNS(szMapNs,"display"),""));else for(tilesNodesA=this.getItemNodes(a),j=0;j<tilesNodesA.length;j++)if(this.szFlag.match(/BUFFER/))(d=SVGDocument.getElementById(tilesNodesA[j].getAttributeNS(null,"id")+":paint"))&&d.style.setProperty("display","none","");else{tilesNodesA[j].getAttributeNS(szMapNs,"themestyle")||tilesNodesA[j].setAttributeNS(szMapNs,"themestyle",tilesNodesA[j].getAttributeNS(null,"style"));tilesNodesA[j].setAttributeNS(null,"style",
tilesNodesA[j].getAttributeNS(szMapNs,"origthemestyle"));if(d=SVGDocument.getElementById(tilesNodesA[j].firstChild.nextSibling.getAttribute("id")+"L"))d.setAttributeNS(szMapNs,"display",d.style.getPropertyValue("display")),d.style.setProperty("display","none","");if(d=SVGDocument.getElementById(tilesNodesA[j].firstChild.nextSibling.getAttribute("id")+"L:bg"))d.setAttributeNS(szMapNs,"display",d.style.getPropertyValue("display")),d.style.setProperty("display","none","")}this.endDraw()}this.fMarkClass=
!0}}};MapTheme.prototype.selectFilterItems=function(){map.Selections.newSelection("generic",this.filterNodesA,"type:queryresult",this.szItemFilter)};
MapTheme.prototype.labelMap=function(e){var c=map.Zoom.getBox(),f=null;this.szValuesTextStyle="font-family:verdana;font-size:"+map.Scale.normalX(11)+"px;pointer-events:none";if(!e||0==e){var d=0;e=0;this.indexA=[];var h=0,g=0;if(this.fClipCharts)for(d in this.itemA){if(g++,this.itemA[d].nValuesA&&0<this.itemA[d].nValuesA.length&&(f=this.getNodePosition(this.itemA[d].szSelectionId)))if(f.x<c.x||f.x>c.x+c.width||f.y<c.y||f.y>c.y+c.height){if(this.nSkipCount++,chartGroup=SVGDocument.getElementById(this.szId+
":"+d+":chart"))chartGroup.parentNode.removeChild(chartGroup),this.chartPosA[this.itemA[d].szSelectionId]=null,this.posItemA[this.itemA[d].szSelectionId]=null}else this.indexA[this.indexA.length]=d,h++}else for(d in this.itemA)this.indexA[this.indexA.length]=d,g++,h++;h>this.nMaxThemeCharts&&(this.indexA.length=0,this.nSkipCount=h);this.mapSleep&&(this.mapSleep.nCount=h);this.fEnableProgressBar=!1}for(;e<this.indexA.length;e++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);this.fCancel=
!1;return}if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(e,10))){this.fContinue=!0;this.continueIndex=e;return}d=this.indexA[e];this.nDoneCount++;if(this.itemA[d].nValuesA&&0<this.itemA[d].nValuesA.length)if(f=this.getNodePosition(this.itemA[d].szSelectionId))if(this.fClipCharts&&!this.szFlag.match(/BUFFER/)&&(f.x<c.x||f.x>c.x+c.width||f.y<c.y||f.y>c.y+c.height))this.nSkipCount++;else for(f=this.getItemNodes(d),j=0;j<f.length;j++)this.labelShape(f[j],this.itemA[d].szColor,
this.itemA[d].szLabel?this.itemA[d].szLabel:this.itemA[d].nValue);else this.nMissingPositionCount++}this.fMakeLabel=!1;setTimeout("map.Layer.adaptLabel(null)",10)};MapTheme.prototype.unlabelMap=function(){for(a in map.Layer.generatedLabelA)map.Dom.removeElementById(a),map.Layer.generatedLabelA[a]=null};
MapTheme.prototype.labelShape=function(e,c,f){if(this.szFlag.match(/VALUES/)&&"undefined"!=f&&"undefined"!=typeof f&&(!this.szFlag.match(/NOZERO/)||0!=f)){var d=e.parentNode.getAttributeNS(null,"id"),h=SVGDocument.getElementById(d+":label");if(h){var g=SVGDocument.getElementById(d+":values:bg");g||(g=map.Dom.newGroup(h.parentNode,d+":values:bg"),map.Layer.generatedLabelA[d+":values:bg"]=g);var l=SVGDocument.getElementById(d+":values");l||(l=map.Dom.newGroup(h.parentNode,d+":values"),map.Layer.generatedLabelA[d+
":values"]=l);try{var k=e.firstChild.nextSibling.getAttributeNS(null,"id").split("#"),m=k[0]+"L"+(k[1]?"#"+k[1]:"")}catch(u){m=e.getAttributeNS(null,"id")+":::value"}SVGDocument.getElementById(m)||(d=__maptheme_getChartColors(c),f="string"==typeof f?f:this.formatValue(f,this.szValueDecimals||1)+(this.szUnit.match(/\%/)?"%":""),c="#ffffff",c=this.szTextColor||d.highColor,h=d.lowColor,k=1,d="1",this.szFlag.match(/DOPACITY/)&&(d=e.style.getPropertyValue("fill-opacity"),k=Math.min(1.3,3*Number(d))),k=
map.Scale.normalX(11)*map.Scale.nZoomScale*k*map.Scale.nLabelScaling*(this.nLabelScale||1),g=map.Dom.newText(g,0,0,"font-family:verdana;font-weight:normal;font-size:"+k+"px;text-anchor:middle;fill:none;stroke:"+h+";stroke-width:"+map.Scale.normalX(4)*map.Scale.nZoomScale+";stroke-opacity:0.5;pointer-events:none;display:none;stroke-linejoin:bevel;",f),l=map.Dom.newText(l,0,0,"font-family:verdana;font-weight:normal;font-size:"+k+"px;text-anchor:middle;fill:"+c+";stroke:none;pointer-events:none;display:none;",
f),l.setAttributeNS(null,"id",m),g.setAttributeNS(null,"id",m+":bg"),this.szFlag.match(/DOPACITY/)&&(l.style.setProperty("fill-opacity",d,""),g.style.setProperty("stroke-opacity",d,"")),(m=e.getAttributeNS(szMapNs,"center"))?(e=m.split(","),e=new point(Number(e[0].split(":")[1]),Number(e[1].split(":")[1]))):e=this.getNodePosition(e.getAttributeNS(null,"id")),e&&(l.fu.setPosition(e.x,e.y),g.fu.setPosition(e.x,e.y)))}}};
MapTheme.prototype.chartMap=function(e){var c;if(!this.nChartUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nChartUpper){this.chartGroup&&!e&&(this.chartPosA=[]);var f=this.nChartSize?this.nChartSize:30,d=map.Zoom.getBox(),h=this.szFlag.match(/AGGREGATE/)&&this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth||0)*map.Scale.nZoomScale:map.Scale.normalX(30)*map.Scale.nZoomScale;d.x-=h/2;d.y-=h/2;d.width+=h;d.height+=h;var g=null,h="#777777";c=8;if(!e||0==e){if(!this.partsA)return;
var l=0;e=0;this.indexA=[];this.szValuesLineStyle="stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.5;";this.szValuesLineBgStyle="stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;";this.szValuesTextStyle="font-family:"+(this.szTextFont||"arial")+";font-size:"+map.Scale.normalX(c)+"px;fill:"+h+";pointer-events:none";var k=map.Layer.objectGroup;if(!this.chartGroup&&(this.chartGroup=map.Dom.newGroup(k,this.szId+":chartgroup"),this.chartGroup.style.setProperty("opacity",String(this.nOpacity?
this.nOpacity:1),""),this.szFlag.match(/NOSCALE/)&&antiZoomAndPanList.addGroup(this.chartGroup),this.szFlag.match(/AGGREGATE/)&&(this.szFlag.match(/AUTOSIZE/)||this.szFlag.match(/GRIDSIZE/))&&antiZoomAndPanList.addGroup(this.chartGroup),this.szFlag.match(/BUFFER/))){this.szFlag.match(/OVERLAY/)&&!this.szShapeType.match(/line/)&&this.chartGroup.style.setProperty("opacity","1","");map.Layer.getLayerObj(this.szThemesA[0]);this.chartGroup.style.setProperty("pointer-events","none","");antiZoomAndPanList.addGroup(this.chartGroup);
var h=this.colorScheme[0],m=this.colorScheme[1]?this.colorScheme[1]:"red";"undefined"!=typeof this.szBorderColor&&(m=this.szBorderColor);var u="stroke-width:0;";if("undefined"!=typeof this.szBorderStyle)switch(this.szBorderStyle){case "dotted":u="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":u="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":u="stroke-width:"+map.Scale.normalX(1)+";";break;
case "none":u="stroke-width:0;"}if("undefined"!=typeof this.szBorderWidth)switch(this.szBorderWidth){case "thin":u+="stroke-width:"+map.Scale.normalX(.5)+";";break;case "thick":u+="stroke-width:"+map.Scale.normalX(1.5)+";"}this.chartGroup.setAttributeNS(null,"style","fill:"+h+";fill-opacity:"+(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0)+";stroke:"+m+";"+u+";")}this.blur(this.nBlur);this.mapSleep&&(this.mapSleep.checkSleepMessage="creating charts");k=getRotateAttributeValue(map.Scale.canvasNode);
if(this.szFlag.match(/SORT/)&&!this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/3D/)){this.indexA=[];for(l in this.itemA)this.indexA[this.indexA.length]=l;u=[];for(c=0;c<this.indexA.length;c++)m=this.itemA[this.indexA[c]].nValuesA[this.nActualFrame||0],this.itemA[this.indexA[c]].nSize?m=this.itemA[this.indexA[c]].nSize:this.szFlag.match(/SIZE/)&&this.itemA[this.indexA[c]].nValueSum&&(m=this.itemA[this.indexA[c]].nValueSum),isNaN(m)||u.push({a:this.indexA[c],y:m});this.szFlag.match(/UP/)?u.sort(this.sortDownChartObjectsCompare):
u.sort(this.sortUpChartObjectsCompare);if(this.szValueField&&"$index$"==this.szValueField)for(c=0;c<u.length;c++)this.itemA[u[c].a].szValue=String(u.length-c);this.indexA=[]}if(this.szFlag.match(/CHART/)&&!this.szFlag.match(/EXACT/)){for(s=0;s<this.partsA.length;s++)this.partsA[s].nCount=0,this.partsA[s].nSum=0;this.fRedrawInfo=!0;this.szFlag.match(/SEQUENCE/)&&(this.nFadeNegative=this.nFadeNegative||1)}var z=u=m=0;if(this.fClipCharts&&!this.szFlag.match(/BUFFER/)){for(c=0;c<this.partsA.length;c++)this.partsA[c].nSum=
0;for(l in this.itemA)if(u++,this.itemA[l].nValuesA&&0<this.itemA[l].nValuesA.length)if(g=this.getNodePosition(this.itemA[l].szSelectionId))if(g.x<d.x||g.x>d.x+d.width||g.y<d.y||g.y>d.y+d.height){if(this.nSkipCount++,chartGroup=SVGDocument.getElementById(this.szId+":"+l+":chart"))chartGroup.parentNode.removeChild(chartGroup),this.chartPosA[this.itemA[l].szSelectionId]=null,this.posItemA[this.itemA[l].szSelectionId]=null}else{this.indexA[this.indexA.length]=l;if(this.szFlag.match(/CHART/)&&!this.szFlag.match(/EXACT/))for(c=
0;c<this.partsA.length;c++)this.partsA[c].nCount++,this.partsA[c].nSum+=isNaN(this.itemA[l].nValuesA[c])?0:this.itemA[l].nValuesA[c];else if(this.szFlag.match(/CHART/))if(1<this.itemA[l].nValuesA.length)for(c=0;c<this.partsA.length;c++)this.partsA[c].nSum+=isNaN(this.itemA[l].nValuesA[c])?0:this.itemA[l].nValuesA[c];else this.partsA[this.itemA[l].nValuesA[0]-1]&&(this.partsA[this.itemA[l].nValuesA[0]-1].nSum+=isNaN(this.itemA[l].nSize)?1:this.itemA[l].nSize);m++}else this.missedA[l]=l,z++;if(u==z&&
!map.Tiles.allTilesLoaded()){this.fRedraw=this.fDataIncomplete=!0;setTimeout("map.Themes.execute()",1);return}}else for(l in this.itemA){this.indexA[this.indexA.length]=l;if(this.szFlag.match(/CHART/)&&!this.szFlag.match(/EXACT/))for(c=0;c<this.partsA.length;c++)this.partsA[c].nCount++,this.partsA[c].nSum+=isNaN(this.itemA[l].nValuesA[c])?0:this.itemA[l].nValuesA[c];u++;m++}if(m>this.nMaxThemeCharts)for(l in this.ErrorMessage="max charts ("+this.nMaxThemeCharts+") exceeded; please zoom in",this.indexA.length=
0,this.nSkipCount=m,this.itemA)(chartGroup=SVGDocument.getElementById(this.szId+":"+l+":chart"))&&chartGroup.parentNode.removeChild(chartGroup);this.fRedrawAllCharts=!1;m>this.nMaxShadowCharts?(this.fShadow&&(this.fRedrawAllCharts=!0),this.fShadow=!1):(this.fOrigShadow&&!this.fShadow&&(this.fRedrawAllCharts=!0),this.fShadow=this.fOrigShadow);this.mapSleep&&(this.mapSleep.nCount=m);this.fSorted=!1;if(this.fSortBeforeDraw&&!this.szFlag.match(/NOSRT/)&&(!this.szFlag.match(/NOSIZE/)||this.szFlag.match(/3D/)||
this.szFlag.match(/SORT/))&&(!this.szFlag.match(/EXACT/)||this.szFlag.match(/AGGREGATE/)||this.szSizeField)){u=[];if((this.szFlag.match(/3D/)||this.szFlag.match(/BOX/)||this.szFlag.match(/POINTER/))&&(!this.szFlag.match(/MULTIPLE/)&&!this.szFlag.match(/MULTIGRID/)||this.szFlag.match(/AGGREGATE/)))for(c=0;c<this.indexA.length;c++)(g=this.getNodePosition(this.itemA[this.indexA[c]].szSelectionId))?u[c]=k?{a:this.indexA[c],y:g.x*Math.sin(k)+g.y*Math.cos(k)}:{a:this.indexA[c],y:g.y}:u[c]={a:this.indexA[c],
y:0};else for(c=0;c<this.indexA.length;c++)m=this.itemA[this.indexA[c]].nValuesA[this.nActualFrame||0],this.itemA[this.indexA[c]].nSize?m=this.itemA[this.indexA[c]].nSize:this.szFlag.match(/SIZE/)&&this.itemA[this.indexA[c]].nValueSum&&(m=this.itemA[this.indexA[c]].nValueSum),isNaN(m)||u.push({a:this.indexA[c],y:m});this.szFlag.match(/SORT/)&&this.szFlag.match(/UP/)&&!this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/3D/)?u.sort(this.sortDownChartObjectsCompare):u.sort(this.sortUpChartObjectsCompare);
for(c=0;c<u.length;c++)this.indexA[c]=u[c].a;this.fSorted=!0}}this.chart={szColor:this.colorScheme[0],szLineColor:this.colorScheme[1]?this.colorScheme[1]:"none",szTextColor:this.colorScheme[1]?this.colorScheme[1]:"none"};if(2<this.colorScheme.length||this.szFlag.match(/EXACT/))this.chart.szColor=this.colorScheme[this.colorScheme.length-1],this.chart.szLineColor=this.colorScheme[0];this.szFlag.match(/NOLINES/)?this.chart.szLineColor="none":"none"==this.chart.szLineColor&&(h=__maptheme_getChartColors(h),
this.chart.szLineColor=h.textColor);this.szFlag.match(/PLOT/)&&(this.szFlag.match(/GRIDSIZE/)||this.szFlag.match(/AUTOSIZE/))&&(h=0,h=map.Layer.nDynamicObjectScale,g=this.szFlag.match(/GAP/)?1.2:1.15,h=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/g*this.nScale/h:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/g*this.nScale/h:map.Scale.normalX(f/3),this.nAutoScale=h/map.Scale.normalX(this.itemA[l].nValuesA.length/(this.nGridX||1)*f),this.nAutoWidth=h);for(;e<this.indexA.length;e++){if(this.fCancel){displayMessage("Canceled by user",
1E3,!0);this.fCancel=!1;return}if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(e,10))){this.fContinue=!0;this.continueIndex=e;this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);null!=this.markedClass&&this.markClass(this.markedClass,1);return}h=null;l=this.indexA[e];this.nDoneCount++;if(this.itemA[l].nValuesA&&0<this.itemA[l].nValuesA.length)if(c=this.itemA[l].szSelectionId,g=this.getNodePosition(c),g.x=isNaN(g.x)?
0:g.x,g.y=isNaN(g.y)?0:g.y,!g||isNaN(g.x)||isNaN(g.y))this.nMissingPositionCount++;else if(this.fClipCharts&&!this.szFlag.match(/BUFFER/)&&(g.x<d.x||g.x>d.x+d.width||g.y<d.y||g.y>d.y+d.height))this.nSkipCount++;else{this.fRedraw&&(this.itemA[l].chartNode=this.itemA[l].chartNode||SVGDocument.getElementById(this.szId+":"+l+":chart"));if(this.itemA[l].chartNode&&this.itemA[l].chartNode.parentNode)if(this.fRedraw||this.fRedrawAllCharts||this.szFlag.match(/BUFFER/)&&this.szShapeType.match(/line/))this.itemA[l].chartNode.parentNode.removeChild(this.itemA[l].chartNode),
this.itemA[l].chartNode=null;else{this.itemA[l].chartNode.parentNode.appendChild(this.itemA[l].chartNode);this.nRealizedCount++;continue}m=new point(0,0);h=null;if(c)if(h=SVGDocument.getElementById(this.szId+":"+c+":chart"))h.fu=new Methods(h);else if(h=map.Dom.newGroup(this.chartGroup,this.szId+":"+c+":chart"),this.szFlag.match(/BOX/)){m="#bbbbbb";"undefined"!=typeof this.szBorderColor&&(m=this.szBorderColor);u="stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.3;";if("undefined"!=typeof this.szBorderStyle)switch(this.szBorderStyle){case "dotted":u=
"stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":u="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":u="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":u="stroke-width:0;"}if("undefined"!=typeof this.szBorderWidth)switch(this.szBorderWidth){case "thin":u+="stroke-width:"+map.Scale.normalX(.3)+";";break;case "thick":u+="stroke-width:"+map.Scale.normalX(1.5)+";"}newBox=map.Dom.newShape("rect",
h,0,0,1,1,"fill:"+(this.szBoxColor||"white")+";fill-opacity:"+(this.nBoxOpacity||1)+";stroke:"+m+";"+u);newBox.setAttributeNS(null,"id",this.szId+":"+c+":chart:box");switch(this.szSymbolBoxStyle){case "frame":this.boxShape.setAttributeNS(null,"fill-opacity",0);break;case "field":this.boxShape.setAttributeNS(null,"fill-opacity",1)}}this.itemA[l].chartNode=h;h.setAttributeNS(szMapNs,"value",String(this.itemA[l].nValuesA[0]));m=this.drawChart(h,l,f,this.szFlag+"|SILENT");u=this.nScale;this.nScale=this.nAutoScale||
this.nScale;m&&g&&h&&(this.szFlag.match(/PLOT/)&&this.nAutoWidth&&this.nAutoScale&&(m.x+=this.nAutoWidth/this.nAutoScale/2,m.y-=this.nAutoWidth/this.nAutoScale/2),z=this.szFlag.match(/BUFFER/)?1:map.Scale.nObjectScaling,this.szFlag.match(/NOSCALE/)?(h.fu.setPosition(g.x-m.x,g.y-m.y*this.nScale),h.fu.scale(this.nScale,this.nScale)):fObjectScaling?(h.fu.setPosition(g.x-m.x*map.Layer.nObjectScale*this.nScale,g.y-m.y*map.Layer.nObjectScale*this.nScale),h.fu.scale(this.nScale*map.Layer.nObjectScale*z,
this.nScale*map.Layer.nObjectScale*z)):(h.fu.setPosition(g.x-m.x*map.Scale.nFeatureScaling*z*this.nScale,g.y-m.y*map.Scale.nFeatureScaling*z*this.nScale),h.fu.scale(this.nScale*map.Scale.nFeatureScaling*z,this.nScale*map.Scale.nFeatureScaling*z)));this.nScale=u;if(m){c=c.split("*")[0];if((this.szFlag.match(/MULTIPLE/)||this.szFlag.match(/ALIGN/))&&h.lastChild.firstChild){g=map.Dom.getBox(h.lastChild);m=this.szFlag.match(/UP/)?g.height:g.width;if(this.chartPosA[c]){this.chartPosA[c]+=this.szFlag.match(/TEXTONLY/)?
5:.5*m;var u=h.lastChild.fu.getPosition(),q=m*(this.nGridX||10);this.szFlag.match(/UP/)?h.lastChild.fu.setPosition(u.x+g.width*Math.floor(this.chartPosA[c]/q),u.y-this.chartPosA[c]%q):h.lastChild.fu.setPosition(u.x+this.chartPosA[c]%q,u.y-g.height*Math.floor(this.chartPosA[c]/q));this.chartPosA[c]+=this.szFlag.match(/TEXTONLY/)?m:.5*m}else this.chartPosA[c]=this.szFlag.match(/TEXTONLY/)?m:.5*m;this.posItemA&&(this.posItemA[c]||(this.posItemA[c]=[]),this.posItemA[c].push(this.itemA[l]))}else if((this.szFlag.match(/MULTIFIX/)||
this.szFlag.match(/MULTIGRID/))&&h.lastChild){m=1;g=map.Scale.normalX(15);z=map.Scale.normalX(15);if(this.chartPosA[c]){var u=h.lastChild.fu.getPosition(),y=this.chartPosA[c],q=this.nGridX||7;this.szFlag.match(/UP/)?h.lastChild.fu.setPosition(u.x+g*Math.floor(y/q),u.y-y%q*z):h.lastChild.fu.setPosition(u.x+y%q*g,u.y-z*Math.floor(y/q));this.chartPosA[c]+=m}else this.chartPosA[c]=m;this.posItemA&&(this.posItemA[c]||(this.posItemA[c]=[]),this.posItemA[c].push(this.itemA[l]));this.itemA[l].labelGroup&&
y%q!=q-1&&this.itemA[l].labelGroup.style.setProperty("display","none","")}this.szFlag.match(/TEXTONLY/)&&fCheckLabelOverlap&&(g=SVGDocument.getElementById(this.szId+":"+l+":text"))&&(new Map.Label.Item(g)).setDisplay("none");k&&setRotate(h,-Number(k));1==this.fShadow&&SVGDocument.getElementById(szShadowFilterId)?h.style.setProperty("filter","url(#"+szShadowFilterId+")",""):1==this.fShadow&&(c=map.Dom.newNode("filter",this.chartGroup.parentNode),c.setAttributeNS(null,"id",szShadowFilterId),c.setAttributeNS(null,
"filterUnits","objectBoundingBox"),c.setAttributeNS(null,"x","-50%"),c.setAttributeNS(null,"y","-50%"),c.setAttributeNS(null,"width","200%"),c.setAttributeNS(null,"height","200%"),g=map.Dom.newNode("feGaussianBlur",c),g.setAttributeNS(null,"stdDeviation","15"),g.setAttributeNS(null,"result","BlurAlpha"),g=map.Dom.newNode("feOffset",c),g.setAttributeNS(null,"in","BlurAlpha"),g.setAttributeNS(null,"dx","20"),g.setAttributeNS(null,"dy","20"),g.setAttributeNS(null,"result","OffsetBlurAlpha"),g=map.Dom.newNode("feColorMatrix",
c),g.setAttributeNS(null,"in","OffsetBlurAlpha"),g.setAttributeNS(null,"type","matrix"),g.setAttributeNS(null,"values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0"),g.setAttributeNS(null,"result","matrixOut"),g=map.Dom.newNode("feMerge",c),c=map.Dom.newNode("feMergeNode",g),c.setAttributeNS(null,"in","matrixOut"),c=map.Dom.newNode("feMergeNode",g),c.setAttributeNS(null,"in","SourceGraphic"),g=map.Dom.getBox(h.lastChild),g.width&&g.height&&h.style.setProperty("filter","url(#"+szShadowFilterId+")",""))}}}if(this.szFlag.match(/BOX/))if(this.nBoxUpper&&
map.Scale.getTrueMapScale()*map.Scale.nZoomScale>this.nBoxUpper)(d=SVGDocument.getElementById(this.szId+":"+r+":chart:box"))&&d.parentNode.removeChild(d);else for(e=0;e<this.indexA.length;e++)if(l=this.indexA[e],this.itemA[l].fDone){var r=this.itemA[l].szSelectionId,h=SVGDocument.getElementById(this.szId+":"+r+":chart"),d=SVGDocument.getElementById(this.szId+":"+r+":chart:box");if(h&&d&&!d.getAttributeNS(szMapNs,"boxed")){g=map.Dom.getBox(h);q=map.Scale.normalX(this.nBoxMargin||2);q=Math.min(2*q,
q*(g.width/map.Scale.normalX(f)));if(this.szFlag.match(/TITLE/)&&this.szTitleField&&(!this.nTitleUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nTitleUpper)){c=Math.max(g.width/10,map.Scale.normalX(4));y=this.itemA[l].szTitle;try{y=HTMLWindow.ixmaps.htmlgui_onInfoTitle(this.itemA[l].szTitle,this.itemA[l])}catch(D){}y=map.Dom.newText(h,g.x,g.y-1*c,"font-family:arial;font-size:"+c+"px;text-anchor:start;fill:"+(this.szTextColor||"#888888")+";stroke:none;pointer-events:none;",String(y||
" "));this.szFlag.match(/LONGTITLE/)?(g=map.Dom.getBox(h),g.y+=.1*c,g.height-=.1*c):(r=g.height,g.height+=1.8*c,g.y-=g.height-r,map.Dom.setClipRect(y,new box(g.x,g.y-10*c,g.width-c/3,20*c)))}this.szFlag.match(/PLOTX/)?(g.height=map.Scale.normalX(f),g.y=-map.Scale.normalX(f/2),g.width=this.nMax*map.Scale.normalX(1.1*f)/this.nMax*5*(this.nRangeScale||1)):this.szFlag.match(/PLOTY/)&&(r=g.height,y=g.width,g.width=map.Scale.normalX(f),g.height=this.nMax*map.Scale.normalX(1.1*f)/this.nMax*5*(this.nRangeScale||
1),g.x-=(g.width-y)/2,g.y-=(g.height-r)/2);d.setAttributeNS(null,"x",g.x-q);d.setAttributeNS(null,"y",g.y-q);d.setAttributeNS(null,"width",g.width+2*q);d.setAttributeNS(null,"height",g.height+2*q);(this.szFlag.match(/AUTOSIZE/)||this.szFlag.match(/GRIDSIZE/))&&g.width>g.height&&(d.setAttributeNS(null,"y",g.y-q-(g.width-g.height)),d.setAttributeNS(null,"height",g.width+2*q));"undefined"!=typeof this.nBorderRadius&&(q=Math.min(map.Scale.normalX(this.nBorderRadius),map.Scale.normalX(this.nBorderRadius*
(g.width/map.Scale.normalX(f)))),d.setAttributeNS(null,"rx",q),d.setAttributeNS(null,"ry",q));q=map.Scale.normalX(.2*(this.szBorderWidth||1)*(g.width/map.Scale.normalX(f)));d.style.setProperty("stroke-width",q);d.setAttributeNS(szMapNs,"boxed","1")}}this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);null!=this.markedClass&&this.markClass(this.markedClass,1);this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;this.showInfo();this.szFlag.match(/SHOWSTATISTIC/)&&
this.showErrorInfo();this.szFlag.match(/CLIP/)?this.nClipFrames==this.itemA[l].nValuesA.length?this.szXaxisA&&this.szXaxisA[this.nActualFrame]?displayMessage(this.szXaxisA[this.nActualFrame],3E3,"big"):this.szLabelA&&this.szLabelA[this.nActualFrame]&&displayMessage(this.szLabelA[this.nActualFrame],3E3,"big"):(f=this.szXaxisA||this.szLabelA)&&(0==this.nActualFrame?displayMessage(f[0],3E3,"big"):this.nActualFrame==this.nClipFrames-1?displayMessage(f[1],3E3,"big"):displayMessage(" ... ",3E3,"big")):
this.ErrorMessage?(displayMessage(this.ErrorMessage,1E4,"notify"),this.ErrorMessage=null):clearMessage();this.fSorted||(this.fResort=!0,map.Themes.execute());this.szFlag.match(/DECLUTTER/)&&(this.fDeclutter=!0,map.Themes.execute())}else this.unpaintMap(),this.realizeDone()};
MapTheme.prototype.sortChartObjects=function(){if(!(!this.chartGroup||this.szFlag.match(/NOSRT/)||this.szFlag.match(/NOSIZE/)&&!this.szFlag.match(/3D/)||this.szFlag.match(/EXACT/)&&!this.szFlag.match(/AGGREGATE/)&&!this.szSizeField)){var e=null,c=[],f=this.chartGroup.childNodes;if(this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/BUFFER/)||this.szFlag.match(/TEXTONLY/))for(var d=0;d<f.length;d++)e=f.item(d),c[d]={node:e,y:Math.abs(Number(e.getAttributeNS(szMapNs,"value")))};
else for(var h=getRotateAttributeValue(map.Scale.canvasNode)/180*Math.PI,d=0;d<f.length;d++)e=f.item(d),c[d]=h?{node:e,y:getTranslate(e).x*Math.sin(h)+getTranslate(e).y*Math.cos(h)}:{node:e,y:getTranslate(e).y};this.szFlag.match(/SORT/)&&this.szFlag.match(/UP/)&&!this.szFlag.match(/SEQUENCE/)?c.sort(this.sortDownChartObjectsCompare):c.sort(this.sortUpChartObjectsCompare);for(d=0;d<c.length;d++)c[d].node.parentNode.appendChild(c[d].node);(matrixA=getMatrix(this.chartGroup))&&setMatrix(this.chartGroup,
matrixA)}};MapTheme.prototype.sortUpChartObjectsCompare=function(e,c){return e.y>c.y?1:-1};MapTheme.prototype.sortDownChartObjectsCompare=function(e,c){return e.y<c.y?1:-1};
MapTheme.prototype.getChartSize=function(e,c,f,d){if(f.match(/NOSIZE/))return Math.max(5,c/4);d=Math.abs(d);var h=Math.max(5,c/2),g=this.nMax-this.nMin;this.nNormalSizeValue&&(g=this.nMaxSize=this.nNormalSizeValue);var l=this.itemA[e].nValue100;f.match(/SIZE/)&&!f.match(/NORMSIZE/)&&this.szSizeField&&e&&this.itemA[e]?h=f.match(/LINEAR/)?h/this.nMaxSize*this.itemA[e].nSize:f.match(/SIZELOG/)?h/Math.log(this.nMaxSize)*Math.log(this.itemA[e].nSize):f.match(/SIZEP4/)?h/Math.pow(this.nMaxSize,.25)*Math.pow(this.itemA[e].nSize,
.25):f.match(/3D/)||f.match(/SIZEP3/)||f.match(/SIZEVOLUME/)?h/Math.pow(this.nMaxSize,1/3)*Math.pow(this.itemA[e].nSize,1/3):h/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[e].nSize):f.match(/SIZE/)&&!f.match(/NORMSIZE/)&&(h=f.match(/LINEAR/)?h/g*d:f.match(/SIZELOG/)?h/Math.log(g)*Math.log(d):f.match(/SIZEP4/)?h/Math.pow(g,.25)*Math.pow(d,.25):f.match(/3D/)||f.match(/SIZEP3/)||f.match(/SIZEVOLUME/)?h/Math.pow(g,1/3)*Math.pow(d,1/3):h/Math.sqrt(g)*Math.sqrt(d));map.Scale.normalX(10);f.match(/HEIGHT/)&&
!f.match(/NORMSIZE/)&&(f.match(/SIZE/)?this.szSizeField&&e&&this.itemA[e]?Math.pow(10/g*this.itemA[e].nSize,1/3):Math.pow(10/g*d,1/3):l&&this.nMax100&&this.nMin100&&f.match(/FRACTION/));f.match(/ZOOM/)&&(this.origSize=h*=map.Scale.nObjectScaling,h=c/10+1*h/Math.log(Math.abs(g))*Math.log(Math.abs(d)),h=Math.min(h,c),h=Math.max(h,c/5));return h};
MapTheme.prototype.checkChartSize=function(e,c,f,d){return this.nChartSizeMin&&!f.match(/ZOOM/)&&this.getChartSize(e,c,f,d)/map.Layer.nObjectScale<this.nChartSizeMin?!1:!0};
MapTheme.prototype.drawChart=function(e,c,f,d,h){var g,l,k=null,m=0,u=0;this.szChartFlag=d;if(c){if(!this.itemA[c])return null;this.itemA[c].fDone=!1;var k=this.itemA[c].nValuesA,m=this.itemA[c].nValue100,u=Math.max(this.nMax,Math.abs(this.nMin)),z=0;if(!this.szFlag.match(/BUFFER/))for(var q=0;q<k.length;q++)isNaN(k[q])&&(k[q]=0),z+=k[q];if(this.szFlag.match(/MORPH/)&&this.szFlag.match(/CLIP/)&&this.nClipFrames){for(var k=[],y=this.itemA[c].nValuesA,q=0;q<y.length/2;q++){var r=y[q]*(this.nClipFrames-
1-this.nActualFrame)/(this.nClipFrames-1)+y[q+y.length/2]*this.nActualFrame/(this.nClipFrames-1);k[q]=r}for(q=z=0;q<k.length;q++)isNaN(k[q])&&(k[q]=0),z+=k[q]}var D=this.getChartSize(c,f,d,z);if(this.nChartSizeMin&&!d.match(/ZOOM/)){if(D/map.Layer.nObjectScale<this.nChartSizeMin)return null}else if(!this.szFlag.match(/MULTIFIX/)&&!this.szFlag.match(/MULTIGRID/)&&(isNaN(D)||0==D))return null;if(d.match(/DOT/)){r=k[0];if(d.match(/EXACT/)||2<this.colorScheme.length||this.szRanges&&this.szRanges.length)for(eb=
!1,q=0;q<this.partsA.length;q++)if(r<this.partsA[q].max){this.chart.szColor=this.colorScheme[q];var w=__maptheme_getChartColors(I);d.match(/NOLINES/)?this.chart.szLineColor="none":this.chart.szLineColor=w.textColor;d.match(/RANGE/)&&!d.match(/RANGES/)&&(D=map.Scale.normalX(2+5*(q+1)/this.partsA.length));d.match(/ZOOM/)||d.match(/MENUSIZE/)||d.match(/NORMSIZE/)||this.partsA[q].nCount++;e.setAttributeNS(szMapNs,"value","seechilds");T=q;eb=!0;break}var C=map.Scale.normalX((this.nLineWidth||.1)/f*D);
d.match(/OUTLINE/)&&(C=map.Scale.normalX(Math.min(1,1/f*D)));var B=map.Dom.newGroup(e,this.szId+":"+c+(c?":chartgroup":":ochrtgroup"));if(E=map.Dom.newShape("circle",B,0,0,map.Scale.normalX(D),"fill:"+this.chart.szColor+";stroke:"+(this.szLineColor||this.chart.szLineColor)+";stroke-width:"+(this.szTextColor||this.chart.szLineColor)+";"))E.setAttributeNS(szMapNs,"tooltip",this.formatValue(k[0],2)+this.szUnit+" "+this.szTitle+""),null!=T&&(E.setAttributeNS(szMapNs,"value",String(r)),E.setAttributeNS(szMapNs,
"class",String(T)));return new point(0,0)}}else{k=[];z=0;if(this.szOrigFlag.match(/AGGREGATE/)&&this.szOrigFlag.match(/EXACT/))for(q=0;q<this.colorScheme.length;q++)k[q]=this.nOrigSumA[q],u=Math.max(u,this.nOrigSumA[q]),z+=k[q];else for(q=0;q<this.szFieldsA.length;q++)k[q]=this.nOrigSumA[q],u=Math.max(u,this.nOrigSumA[q]),z+=k[q];if(m=this.nSum100){u=0;z=m;for(q=k.length-1;0<=q;q--)this.szFlag.match(/DIFFERENCE/)?m=0<q?k[q-1]:this.nSum100:this.szFlag.match(/CALCVAL/)||this.szFlag.match(/CALC100/)?
k[q]=k[q]:this.szFlag.match(/PRODUCT/)?k[q]=k[q]:(k[q]/=m,u=Math.max(u,k[q]),this.szFlag.match(/PERMILLE/)?k[q]*=1E3:this.szFlag.match(/FRACTION/)||(k[q]*=100),this.szFlag.match(/RELATIVE/)&&(k[q]-=100),this.szFlag.match(/INVERT/)&&(k[q]=100-k[q]));if(this.szFlag.match(/STACKED/)){if(u=100,this.szFlag.match(/NORMSIZE/)||d.match(/NORMSIZE/))for(q=u=0;q<k.length;q++)u+=k[q]}else u*=100,u+=u/10,u=this.nMax}else{if(this.szFlag.match(/DIFFERENCE/))for(q=k.length-1;0<=q;q--)0<q?k[q]-=k[q-1]:this.szFlag.match(/STACKED/)||
(k[q]=0);if(this.szAggregation&&this.szAggregation.match(/mean/)){for(q=0;q<k.length;q++)k[q]/=this.nCount;u=this.szFlag.match(/MENUSIZE/)?u/this.nCount:this.nMax}if(this.szFlag.match(/STACKED/)&&(this.szFlag.match(/NORMSIZE/)||d.match(/NORMSIZE/)||this.szFlag.match(/MENUSIZE/)||d.match(/MENUSIZE/)))for(q=u=0;q<k.length;q++)u+=k[q]}}var J=new point(0,0);if(!d)d=this.szFlag;else if(!d.match(/CHART/)&&d.match(/VALUES/)||d.match(/NORMSIZE/)||d.match(/MENUSIZE/))d=this.szFlag+"|"+d;d.match(/DOMINANT/)&&
!d.match(/CHART/)&&(d=d.match(/PERCENTOFMEAN/)?"BAR|OFFSETMEAN|POINTER|VALUES|ZOOM":d.match(/PERCENTOFMEDIAN/)?"BAR|OFFSETMEDIAN|POINTER|VALUES|ZOOM":d.match(/DEVIATION/)?"BAR|DEVIATION|POINTER|VALUES|ZOOM":"BAR|3D|VALUES|ZOOM");d.match(/ZOOM/)&&d.match(/BAR/)&&d.match(/POINTER/)&&1<k.length&&(d=this.removeDefinition(d,"SIZE")+"|COMPRESSMAX");if(1==k.length&&0==k[0]&&!d.match(/ZEROISVALUE/)&&!d.match(/EXACT/))return this.nZeroValueCount++,null;d.match(/VALUES/)&&(this.fHideValues=this.szValueUpper&&
map.Scale.getTrueMapScale()*map.Scale.nZoomScale>this.nValueUpper);var B=map.Dom.newGroup(e,this.szId+":"+c+(c?":chartgroup":":ochrtgroup")),K=null,la=null;d.match(/MOVABLE/)&&(B.setAttributeNS(null,"id",B.getAttributeNS(null,"id")+":movable"),B.setAttributeNS(null,"onmousedown",'map.Themes.initChartOffset(evt,"'+this.szId+'","'+this.szId+":"+c+':chartgroup:movable")'),B.setAttributeNS(null,"onmouseup",'map.Themes.endChartOffset(evt,"'+this.szId+'","'+this.szId+":"+c+':chartgroup:movable")'));if(d.match(/CHOROPLETHE/)){var H=
map.Scale.normalX(f/2),v=2*H/3,I=this.colorScheme[0],N=this.colorScheme[1]?this.colorScheme[1]:"none",C=map.Scale.normalX(.1)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling,E=map.Dom.constructNode("use",B,{"xlink:href":"#choroplethe_icon"});E.fu.scale(2,2);f=2*v/map.Scale.normalX(1);J.x=0;J.y=v+map.Scale.normalY(5)}if(d.match(/USER/))try{var qb=this.objThemesA[this.szThemesA[0]],fb=HTMLWindow.ixmaps.htmlgui_drawChart(SVGDocument,{target:B,theme:this,item:c,values:k,maxSize:f,flag:d,mark:h,dbRecord:qb.dbRecords?
qb.dbRecords[this.itemA[c].dbIndex]:null});if(fb)return B.fu.setPosition(B.fu.getPosition().x-fb.x,B.fu.getPosition().y-fb.y),fb.x=0,fb.y=0,fb}catch(Rc){}if(d.match(/PIE/)){if(0==z&&!d.match(/AUTOCOMPLETE/))return null;if(d.match(/CENTER/)){for(var Xb=this.nCenter=0,rc=-3E7,sc=3E7,ia=0;ia<k.length;ia++)Xb+=k[ia],k[ia]<sc&&(sc=k[ia],this.nCenterMin=ia),k[ia]>rc&&(rc=k[ia],this.nCenterMax=ia);this.szCenterPart=this.szCenterPart||"max","first"==this.szCenterPart?this.nCenter=0:"last"==this.szCenterPart?
this.nCenter=k.length-1:"min"==this.szCenterPart?this.nCenter=this.nCenterMin:"max"==this.szCenterPart?this.nCenter=this.nCenterMax:Number(this.szCenterPart)&&(this.nCenter=Number(this.szCenterPart));this.nCenterValue=k[this.nCenter];this.nCenterSize=this.nCenterValue/Xb*100}var oa=0,D=Math.max(5,f/2),ta=this.nMax-this.nMin,Fb=this.nMax100-this.nMin100;this.nNormalSizeValue&&(ta=Fb=this.nMaxSize=this.nNormalSizeValue);d.match(/SIZE/)&&!d.match(/NORMSIZE/)&&this.szSizeField&&c&&this.itemA[c]?D=d.match(/SIZELOG/)?
D/Math.log(this.nMaxSize)*Math.log(this.itemA[c].nSize):d.match(/SIZEP4/)?D/Math.pow(this.nMaxSize,.25)*Math.pow(this.itemA[c].nSize,.25):d.match(/3D/)||d.match(/SIZEP3/)||d.match(/SIZEVOLUME/)?D/Math.pow(this.nMaxSize,1/3)*Math.pow(this.itemA[c].nSize,1/3):D/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize):d.match(/SIZE/)&&!d.match(/NORMSIZE/)&&(D=d.match(/SIZELOG/)?D/Math.log(ta)*Math.log(z):d.match(/SIZEP4/)?D/Math.pow(ta,.25)*Math.pow(z,.25):d.match(/3D/)||d.match(/SIZEP3/)||d.match(/SIZEVOLUME/)?
D/Math.pow(ta,1/3)*Math.pow(z,1/3):D/Math.sqrt(ta)*Math.sqrt(z));oa=map.Scale.normalX(10);d.match(/HEIGHT/)&&!d.match(/NORMSIZE/)&&(oa=d.match(/SIZE/)?this.szSizeField&&c&&this.itemA[c]?oa*Math.pow(10/ta*this.itemA[c].nSize,1/3)*3:oa*Math.pow(10/ta*z,1/3)*3:m&&this.nMax100&&this.nMin100&&!d.match(/FRACTION/)?10*oa/Fb*m:10*oa/ta*z);d.match(/ZOOM/)&&(this.origSize=D*=map.Scale.nObjectScaling,D=f/10+3*D/Math.log(ta)*Math.log(z)*map.Layer.nDynamicObjectScale,D=Math.min(D,1.2*f),D=Math.max(D,f/2));var X=
DonutCharts.newChart(SVGDocument,B,0,0,map.Scale.normalX(D),0);J.x=0;J.y=map.Scale.normalY(D)+map.Scale.normalY(5);X.setStyle("flat");X.setLine("#555566");X.setLineWidth(map.Scale.normalX(.1));d.match(/NOLINES/)&&X.setLine("none");d.match(/WHITELINES/)&&X.setLine("white");this.szLineColor&&X.setLine(this.szLineColor);if(d.match(/3D/)){X.setStyle("3D");var ma=.5;d.match(/P3/)?ma=1/3:d.match(/P4/)&&(ma=.25);d.match(/SIZE/)&&!d.match(/NORMSIZE/)&&this.szSizeField&&c&&this.itemA[c]?oa=oa/Math.pow(this.nMaxSize,
ma)*Math.pow(this.itemA[c].nSize,ma):d.match(/SIZE/)&&!d.match(/NORMSIZE/)&&(oa=oa/Math.pow(ta,ma)*Math.pow(z,ma));d.match(/ZOOM/)&&(oa*=map.Scale.nObjectScaling,oa=oa/this.origSize*D);J.y*=.7}d.match(/VOLUME/)&&X.addStyle("VOLUME");if(d.match(/CENTER/)){var Ec=Math.sqrt(Math.pow(map.Scale.normalX(D),2)/100*this.nCenterSize);X.setRadInner(Ec)}else d.match(/DONUT/)&&(d.match(/3D/)?X.setRadInner(map.Scale.normalX(.5*D)):d.match(/THIN/)?X.setRadInner(map.Scale.normalX(.66*D)):d.match(/THICK/)?X.setRadInner(map.Scale.normalX(.33*
D)):X.setRadInner(map.Scale.normalX(.42*D)));d.match(/STARBURST/)&&(X.addStyle("STARBURST"),J.y*=.8);if(d.match(/XSFLOWER/)||d.match(/XSRAYS/))X.addStyle("XSRAYS"),J.y*=.8;else if(d.match(/SFLOWER/)||d.match(/SRAYS/))X.addStyle("SRAYS"),J.y*=.8;else if(d.match(/FLOWER/)||d.match(/RAYS/))X.addStyle("RAYS"),J.y*=.8;d.match(/SILENT/)&&X.addStyle("SILENT");d.match(/AUTOCOMPLETE/)&&X.addStyle("AUTOCOMPLETE");d.match(/BIGTOTOP/)&&X.addStyle("BIGTOTOP");d.match(/NOROTATE/)&&X.addStyle("NOROTATE");var ab=
0,tc=0,Q=0;if(d.match(/DONUT/))for(q=0;q<k.length;q++)k[q]>k[ab]&&(ab=q),k[q]<k[tc]&&(tc=q);if(d.match(/SORT/)){this.sortedIndex=[];for(q=0;q<k.length;q++)this.sortedIndex[q]={index:q,value:k[q]};this.sortedIndex.sort(this.sortIndexDown)}else this.sortedIndex=null;for(q=0;q<(this.nClipParts?Math.min(this.nClipParts,k.length):k.length);q++){var ka="",ua=q;this.sortedIndex&&(ua=this.sortedIndex[ua].index);if(!d.match(/CENTER/)||ua!=this.nCenter){ka=this.szLabelA&&this.szLabelA[ua]?"  "+this.szLabelA[ua]:
"  "+this.szFieldsA[ua];I=this.colorScheme[ua];if(1==k.length)for(x=0;x<this.partsA.length;x++)if(d.match(/EXACT/)&&k[ua]==this.partsA[x].min||!d.match(/EXACT/)&&k[ua]<this.partsA[x].max){I=this.colorScheme[x];e.setAttributeNS(szMapNs,"class",String(x));break}var uc=(d.match(/AUTOCOMPLETE/)&&!this.szUnit.match(/%/)?" % ":"")+this.szUnit;if(this.szShowParts){var Fc=I,I="none";for(ia in this.szShowPartsA)this.szShowPartsA[ia]==ua&&(I=Fc)}X.addPart(k[ua],oa,I,0,(this.szAggregation&&this.szAggregation.match(/sum/),
this.formatValue(k[ua],this.szValueDecimals||0,"ROUND")+uc),this.formatValue(k[ua],2)+uc+ka);"none"==this.colorScheme[q]&&X.setLine("black")}}X.realize();if(d.match(/CENTER/)&&!d.match(/DONUT/)&&(v=Math.sqrt(Math.pow(map.Scale.normalX(D),2)/100*this.nCenterSize),I=this.colorScheme[this.nCenter],map.Dom.newShape("circle",B,0,0,.95*v,"fill:"+I+";"),d.match(/CENTERVALUE/)||d.match(/ZOOM/)||d.match(/VALUES/)&&!this.fHideValues)){var Y=this.formatValue(this.nCenterValue,this.szValueDecimals||0,"ROUND")+
(5>=this.szUnit.length?this.szUnit:""),w=__maptheme_getChartColors(I),Aa=w.textColor,Z=String(Math.min(.8*v,3.5/Y.length*v));map.Dom.newText(B,0,.33*Z,"font-family:arial;font-size:"+Z+"px;font-weight:bold;text-anchor:middle;fill:"+Aa+";opacity:"+String(this.nOpacity?this.nOpacity:1)+";stroke:none;pointer-events:none",Y)}if(d.match(/VALUES/)&&(d.match(/ZOOM/)||!this.szValueUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nValueUpper))if(Z=Math.min(.8*D,3.4/X.partsA[0].szText.length*D),
1<k.length||d.match(/NOINLINETEXT/)||d.match(/ZOOM/)&&6>Z)this.drawDonutText(X,map.Scale.normalX(11)/(d.match(/ZOOM/)||d.match(/NORMSIZE/)?1.6:2));else{var Y=X.partsA[0].szText,w=__maptheme_getChartColors(I),Aa=this.szTextColor||w.textColor,v=map.Scale.normalX(D),Z=String(Math.min(.8*v,3.4/Y.length*v)),va=this.nValueSizeMin?Z/map.Scale.normalX(5):1;d.match(/VOLUME/)&&(oa=X.donutPartsA[0].nHeight);d.match(/3D/)||(oa=.6*v);var G=map.Dom.newText(B,0,-oa+v/2+.45*Z,"font-family:arial;font-size:"+Z+"px;text-anchor:middle;fill:"+
Aa+";opacity:"+va+";stroke:none;pointer-events:none",Y);d.match(/3D/)&&(G.fu.setPosition(0,-v/2+Z*(d.match(/VOLUME/)?.5:.25)),G.fu.scale(1,.5))}this.fillOpacity&&B.setAttributeNS(null,"opacity",String(this.fillOpacity));this.nOpacity&&(B.setAttributeNS(null,"fill-opacity",String(this.nOpacity)),B.setAttributeNS(null,"stroke-opacity",String(this.nOpacity)));if(d.match(/FADEDEVIATION/)){var Gb=(k[0]-this.nMeanA[0])/this.nDeviationA[0];10<Gb&&(va=Math.pow(10,.5)/Math.pow(Gb,.5),B.setAttributeNS(null,
"opacity",String(va)))}else d.match(/LIMITDEVIATION/)&&(Gb=(k[0]-this.nMeanA[0])/this.nDeviationA[0],10<Gb&&B.setAttributeNS(null,"opacity","0"));if(1==k.length&&d.match(/EXACT/))X.donutPartsA[0].objNode.setAttributeNS(szMapNs,"class",e.getAttributeNS(szMapNs,"class")),X.donutPartsA[0].textNode&&X.donutPartsA[0].textNode.setAttributeNS(szMapNs,"class",e.getAttributeNS(szMapNs,"class"));else for(q=0;q<X.donutPartsA.length;q++)X.donutPartsA[q].objNode.setAttributeNS(szMapNs,"class",String(this.sortedIndex?
this.sortedIndex[q].index:q)),X.donutPartsA[q].textNode&&X.donutPartsA[q].textNode.setAttributeNS(szMapNs,"class",String(this.sortedIndex?this.sortedIndex[q].index:q));1<k.length&&e.setAttributeNS(szMapNs,"value","seechilds");this.nRealizedCount++}else if(d.match(/BUBBLE/)||d.match(/SQUARE/)||d.match(/LABEL/)){H=map.Scale.normalX(f/2);Q=this.nMaxA[0];this.nNormalSizeValue&&(this.nMaxSize=Q=this.nNormalSizeValue);r=k[0];if(this.szFlag.match(/CLIP/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(this.nClipFrames==
k.length?(r=Number(k[this.nActualFrame]),Q=this.nMaxA[this.nActualFrame]):r=k[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+k[k.length-1]*this.nActualFrame/(this.nClipFrames-1),0==r&&!d.match(/ZEROISVALUE/))||d.match(/INVERTSIZE/)&&0==Q-k[0]&&!d.match(/ZEROISVALUE/))return null;var gb=c&&this.itemA[c]&&this.szSizeField?this.itemA[c].nSize||0:r,hb=c&&this.itemA[c]&&this.szSizeField?this.nMaxSize:Q;if(d.match(/MENUSIZE/))v=map.Scale.normalX(f/2.5);else if(v=H/Math.sqrt(hb)*Math.sqrt(Math.abs(gb)),
d.match(/LINEAR/))v=H/hb*Math.abs(gb);else if(d.match(/SIZEP3/))v=H/Math.pow(hb,1/3)*Math.pow(Math.abs(gb),1/3);else if(d.match(/SIZEP4/))v=H/Math.pow(hb,.25)*Math.pow(Math.abs(gb),.25);else if(d.match(/SIZELOG/))v=H/Math.log(hb)*Math.log(Math.abs(gb));else if(d.match(/EXACT/)&&!this.szSizeField)v=H/3;else if(d.match(/NOSIZE/))v=H/2;else if(d.match(/FIXSIZE/))v=H/2/(this.nNormalSizeValue||1);else if(d.match(/ZOOM/))v=3*H/3;else if(d.match(/NORMSIZE/))v=2*H/3/(d.match(/EXACT/)?1:Math.log(hb)*Math.log(Math.abs(gb)));
else if(d.match(/MENUSIZE/)||d.match(/SUM/)&&!c)v=2*H/3;var eb=!0,T=null,ca=E=null,Ha=G=null,I=this.colorScheme[0],Aa=N=this.colorScheme[1]?this.colorScheme[1]:"none";if(2<this.colorScheme.length||d.match(/EXACT/))I=this.colorScheme[this.colorScheme.length-1],N=this.colorScheme[0];d.match(/NOLINES/)?N="none":"none"==N&&(w=__maptheme_getChartColors(I),N=w.textColor);if(2<this.colorScheme.length||d.match(/EXACT/)||this.szRanges&&this.szRanges.length)if(eb=!1,this.szFlag.match(/DOMINANT/)){for(var Ba=
0,rb=0,L=-1,q=0;q<this.itemA[c].nValuesA.length;q++){var r=this.itemA[c].nValuesA[q],Yb=100/this.nMeanA[q]*r,Zb=100/this.nMedianA[q]*r,$b=(r-this.nMeanA[q])/this.nDeviationA[q],Ba=r;this.szFlag.match(/PERCENTOFMEAN/)&&(Ba=Yb);this.szFlag.match(/PERCENTOFMEDIAN/)&&(Ba=Zb);this.szFlag.match(/DEVIATION/)&&(Ba=$b);r>this.nFilterA[q]&&Ba>rb&&(this.itemA[c].nClass=q,rb=Ba,L=q)}if(0<=L){this.itemA[c].nDominant=L;r=this.itemA[c].nValuesA[L];ka=" "+this.szFieldsA[L]+" ";this.szLabelA&&this.szLabelA[L]&&(ka=
" "+this.szLabelA[L]+" ");if(this.szFlag.match(/PERCENTOFMEAN/)||this.szFlag.match(/DEVIATION/))szRelevanz=map.Dictionary.getLocalText(" ( mean: ")+this.formatValue(this.nMeanA[L],1)+this.szUnit+")";this.szFlag.match(/PERCENTOFMEDIAN/)&&(szRelevanz=map.Dictionary.getLocalText(" ( median: ")+this.formatValue(this.nMedianA[L],1)+this.szUnit+")");this.itemA[c].nValue=this.itemA[c].nValuesA[L];this.itemA[c].szLabel=ka;I=this.colorScheme[L];w=__maptheme_getChartColors(I);N=d.match(/NOLINES/)?"none":w.textColor;
e.setAttributeNS(szMapNs,"value","seechilds");T=L;eb=!0}}else for(q=0;q<this.partsA.length;q++)if(r<this.partsA[q].max){I=this.colorScheme[q];w=__maptheme_getChartColors(I);N=d.match(/NOLINES/)?"none":w.textColor;d.match(/RANGE/)&&!d.match(/RANGES/)&&(v=map.Scale.normalX(2+5*(q+1)/this.partsA.length));d.match(/ZOOM/)||d.match(/MENUSIZE/)||d.match(/NORMSIZE/)||this.partsA[q].nCount++;e.setAttributeNS(szMapNs,"value","seechilds");T=q;eb=!0;break}Aa=this.szTextColor||N;N=this.szLineColor||N;if(eb){C=
this.nLineWidth||.1;C=d.match(/OUTLINE/)?map.Scale.normalX(Math.min(1,1/H*v)):map.Scale.normalX(C/H*v);if(d.match(/BUBBLE/))!this.fShadow&&this.fOrigShadow&&v>map.Scale.normalX(5)&&(E=map.Dom.newShape("circle",B,.02*v,.02*v,1.01*v,"fill:#000000;stroke:none;opacity:"+.6*(this.fillOpacity?this.fillOpacity:1)),E.setAttributeNS(szMapNs,"class",String(T)),E=map.Dom.newShape("circle",B,.03*v,.03*v,1.04*v,"fill:"+I+";stroke:none;opacity:"+.2*(this.fillOpacity?this.fillOpacity:1)),E.setAttributeNS(szMapNs,
"class",String(T))),d.match(/GLOW/)&&!d.match(/ZOOM/)&&(!this.szGlowUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nGlowUpper)?((E=map.Dom.newShape("circle",B,0,0,6*v,"fill:"+I+";stroke:none;fill-opacity:0.05;"))&&E.setAttributeNS(szMapNs,"class",String(T)),(E=map.Dom.newShape("circle",B,0,0,2*v,"fill:"+I+";stroke:none;fill-opacity:0.1;"))&&E.setAttributeNS(szMapNs,"class",String(T))):d.match(/AURA/)&&!d.match(/ZOOM/)&&(!this.szGlowUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=
this.nGlowUpper)&&(E=map.Dom.newShape("circle",B,0,0,1.3*v,"fill:"+(this.szLineColor||I)+";stroke:none;fill-opacity:0.3;"))&&E.setAttributeNS(szMapNs,"class",String(T)),E=map.Dom.newShape("circle",B,0,0,v,"fill:"+I+";stroke:"+N+";stroke-width:"+C+";");else if(d.match(/SQUARE/))E=map.Dom.newShape("rect",B,-v,-v,2*v,2*v,"fill:"+I+";stroke:"+N+";stroke-width:"+C+";");else if(d.match(/TEXTONLY/))E=map.Dom.newShape("rect",B,-v,-8,2.05*v,8,"fill:none;stroke:none;");else if(d.match(/LABEL/)){Y=this.formatValue(r,
this.szValueDecimals||(1>r||10>Q?1:0),"ROUND")+(5>=this.szUnit.length?this.szUnit:"");0<r&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/))&&(Y="+"+Y);var ib=Math.min(.8*v,3.4/Y.length*v);if(!this.fShadow&&this.fOrigShadow&&v>map.Scale.normalX(5)){if(E=map.Dom.newShape("rect",B,-v+.02*v,.83*-ib+.02*v,2.05*v,1.6*ib,"fill:#000000;stroke:none;opacity:"+.4*(this.fillOpacity?this.fillOpacity:1)))E.setAttributeNS(null,"rx",map.Scale.normalX(2*v/H)),E.setAttributeNS(null,"ry",map.Scale.normalX(2*
v/H));if(E=map.Dom.newShape("rect",B,-v+.03*v,.83*-ib+.03*v,2.05*v,1.6*ib,"fill:"+I+";stroke:none;opacity:"+.2*(this.fillOpacity?this.fillOpacity:1)))E.setAttributeNS(null,"rx",map.Scale.normalX(2*v/H)),E.setAttributeNS(null,"ry",map.Scale.normalX(2*v/H))}if(E=map.Dom.newShape("rect",B,-v,.83*-ib,2.05*v,1.6*ib,"fill:"+I+";stroke:"+N+";stroke-width:"+C+";"))E.setAttributeNS(null,"rx",map.Scale.normalX(2*v/H)),E.setAttributeNS(null,"ry",map.Scale.normalX(2*v/H))}if(E){d.match(/SILENT/)||(d.match(/EXACT/)&&
this.szLabelA&&this.szLabelA[q]?E.setAttributeNS(szMapNs,"tooltip",this.szLabelA[q]+" "+this.szTitle+""):E.setAttributeNS(szMapNs,"tooltip",this.formatValue(r,2)+this.szUnit+" "+this.szTitle+""));G=null;if(d.match(/VALUES/)&&(!this.szValueUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nValueUpper))if(Y=null,this.szValueField&&this.itemA[c]?Y=this.formatValue(this.itemA[c].szValue,this.szValueDecimals||(1>wa||10>Q?1:0),"ROUND")+(5>=this.szUnit.length?this.szUnit:""):d.match(/EXACT/)&&
this.szLabelA?Y=this.szLabelA[r-1]||"?":(Y=this.formatValue(r,this.szValueDecimals||(1>r||10>Q?1:0),"ROUND")+(5>=this.szUnit.length?this.szUnit:""),0<r&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/))&&(Y="+"+Y)),Z=String(Math.min(.8*v,3.3/Y.length*v)),d.match(/TEXTONLY/)){Aa=w.textColor;Z=String(Math.max(Math.min(.8*v,map.Scale.normalX(500)),map.Scale.normalX(2)));if(this.nValueSizeMin&&!d.match(/ZOOM/)&&Z*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin))return null;
var sb=this.szTextFont||"arial",Ha=map.Dom.newText(B,0,0,"font-family:"+sb+";font-size:"+Z+"px;font-weight:normal;text-anchor:middle;fill:none;stroke:"+I+";stroke-width:"+Z/7+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",Y);Ha.setAttributeNS(null,"id",this.szId+":"+c+":text:bg");G=map.Dom.newText(B,0,0,"font-family:"+sb+";font-size:"+Z+"px;font-weight:normal;text-anchor:middle;fill:"+(this.szTextColor||"#000000")+";opacity:"+va+";stroke:none;",Y);G.setAttributeNS(null,"id",this.szId+
":"+c+":text");E.parentNode.removeChild(E)}else if(d.match(/ZOOM/)&&Z<map.Scale.normalX(6))Aa="black",G=map.Dom.newText(B,v+.1*H,-v/2,this.szValuesTextStyle,Y);else if(d.match(/LABEL/)||Z>map.Scale.normalX(1))va=this.nValueSizeMin?Z/map.Scale.normalX(5):1,G=map.Dom.newText(B,0,.33*Z,"font-family:arial;font-size:"+Z+"px;font-weight:bold;text-anchor:middle;fill:"+Aa+";opacity:"+va+";stroke:none;pointer-events:none",Y);if(d.match(/DTEXT/)&&c&&!d.match(/ZOOM/)){var Ia=Math.pow(Math.abs(v),1/3)/Math.pow(H,
1/3);E.style.setProperty("fill-opacity",String(Ia),"");E.style.setProperty("stroke-opacity",String(Ia),"");G&&G.style.setProperty("fill-opacity",String(Ia),"")}else E.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:1),""),d.match(/OUTLINE/)||this.szLineColor?E.style.setProperty("stroke-opacity","1",""):E.style.setProperty("stroke-opacity",String(this.fillOpacity&&.5>this.fillOpacity?1:.3),"")}null!=T&&(E&&(E.setAttributeNS(szMapNs,"value",String(r)),E.setAttributeNS(szMapNs,
"class",String(T))),G&&(G.setAttributeNS(szMapNs,"value",String(r)),G.setAttributeNS(szMapNs,"class",String(T))),Ha&&(Ha.setAttributeNS(szMapNs,"value",String(r)),Ha.setAttributeNS(szMapNs,"class",String(T))));f=2*v/map.Scale.normalX(1);J.x=0;J.y=v+map.Scale.normalY(5);this.nRealizedCount++}else return this.nMissingRangeCount++,null}else if(d.match(/SYMBOL/)){if("undefined"!=typeof this.szSymbolBoxStyle){N="#dddddd";"undefined"!=typeof this.szBorderColor&&(N=this.szBorderColor);var tb="stroke-width:0;";
if("undefined"!=typeof this.szBorderStyle)switch(this.szBorderStyle){case "dotted":tb="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":tb="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":tb="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":tb="stroke-width:0;"}var bb=map.Dom.newShape("rect",B,0,0,1,1,"fill:white;stroke:"+N+";"+tb);switch(this.szSymbolBoxStyle){case "frame":bb.setAttributeNS(null,
"fill-opacity",0);break;case "field":bb.setAttributeNS(null,"fill-opacity",1)}}var vc=0,pa=0,fa=0;if(!this.szSymbolsA)for(this.szSymbolsA=[],q=0;q<k.length;q++)this.szSymbolsA.push("circle");else if(this.szSymbolsA.length<k.length)for(q=this.szSymbolsA.length;q<k.length;q++)this.szSymbolsA.push(this.szSymbolsA[0]);e.setAttributeNS(szMapNs,"value","seechilds");var Ja=null;d.match(/VALUES/)&&(Ja=map.Dom.newGroup(B,this.szId+":"+c+":textgroup"));this.initAngle=0;if(d.match(/SORT/))if(d.match(/MEAN/)){this.sortedIndex=
[];for(q=this.sortedMax=0;q<k.length;q++)this.sortedIndex[q]={index:q,value:k[q],tvalue:k[q],mean:this.nMeanA[q]},this.sortedMax=Math.max(this.sortedMax,k[q]);this.sortedIndex.sort(this.sortMeanUp);this.initAngle=0}else if(d.match(/MEDIAN/)){this.sortedIndex=[];for(q=this.sortedMax=0;q<k.length;q++)this.sortedIndex[q]={index:q,value:k[q],tvalue:k[q],mean:this.nMedianA[q]},this.sortedMax=Math.max(this.sortedMax,k[q]);this.sortedIndex.sort(this.sortMeanUp);this.initAngle=0}else if(d.match(/UP/)){this.sortedIndex=
[];for(q=this.sortedMax=0;q<k.length;q++)this.sortedIndex[q]={index:q,value:k[q],tvalue:k[q]},this.sortedMax=Math.max(this.sortedMax,k[q]);this.sortedIndex.sort(this.sortIndexUp);this.initAngle=0}else if(d.match(/DOWN/)){this.sortedIndex=[];for(q=this.sortedMax=0;q<k.length;q++)this.sortedIndex[q]={index:q,value:k[q],tvalue:k[q]},this.sortedMax=Math.max(this.sortedMax,k[q]);this.sortedIndex.sort(this.sortIndexDown);this.initAngle=0}else{if(d.match(/RANDOM/)){this.sortedIndex=[];this.sortedMax=0;if(this.nClipParts&&
this.nClipParts<k.length){for(var ac=[],q=0;q<k.length;q++)ac[q]={index:q,value:k[q],tvalue:k[q]};ac.sort(this.sortIndexDown);for(q=0;q<this.nClipParts;q++){var bc=ac[q].index;this.sortedIndex[q]={index:bc,value:k[bc],tvalue:k[bc]};this.sortedMax=Math.max(this.sortedMax,k[q])}}else for(q=0;q<k.length;q++)this.sortedIndex[q]={index:q,value:k[q],tvalue:k[q]},this.sortedMax=Math.max(this.sortedMax,k[q]);c?(this.itemA[c].randomA||(this.itemA[c].randomA=this.getRandomNumberArray(k.length+1)),this.shuffleArray(this.sortedIndex,
this.itemA[c].randomA),this.initAngle=Math.floor(360*this.itemA[c].randomA[0])):this.initAngle=0}}else this.sortedIndex=null;if(d.match(/RINGS/)){if(this.sortedIndex)for(var ub=0,q=0;q<this.sortedIndex.length;q++)this.sortedIndex[q].value&&(this.sortedIndex[q].value+=ub,ub=this.sortedIndex[q].value);else for(ub=0,this.sortedIndex=[],q=0;q<k.length;q++)this.sortedIndex[q]={index:q,value:k[q],tvalue:k[q]},this.sortedIndex[q].value&&(this.sortedIndex[q].value+=ub,ub=this.sortedIndex[q].value);this.sortedIndex.sort(this.sortIndexDown)}var Hb=
null,Ib=null,Da=T=0,jb=null,cc=null,kb=0,dc=0,wc=0,lb=!1,Ra=0,ab=k.length;this.nClipParts&&this.nClipParts<k.length&&(d.match(/UP/)?Ra=k.length-this.nClipParts:ab=this.nClipParts);if(this.szFlag.match(/DOMINANT/)){for(var rb=Ba=0,Jb=-1,q=0;q<this.itemA[c].nValuesA.length;q++)r=this.itemA[c].nValuesA[q],Yb=100/this.nMeanA[q]*r,Zb=100/this.nMedianA[q]*r,$b=(r-this.nMeanA[q])/this.nDeviationA[q],Ba=r,this.szFlag.match(/PERCENTOFMEAN/)&&(Ba=Yb),this.szFlag.match(/PERCENTOFMEDIAN/)&&(Ba=Zb),this.szFlag.match(/DEVIATION/)&&
(Ba=$b),r>this.nFilterA[q]&&Ba>rb&&(this.itemA[c].nClass=q,rb=Ba,Jb=q);0<=Jb&&(Ra=this.itemA[c].nDominant=Jb,ab=Ra+1,T=Jb)}for(q=Ra;q<ab;q++)dc+=0!=k[q],jb=Math.max(jb||this.nMaxA[q],this.nMaxA[q]),cc=Math.min(cc||this.nMinA[q],this.nMinA[q]),kb=Math.max(kb,k[q]);for(q=Ra;q<ab;q++){var L=q,r=k[L],Sa=k[L];this.sortedIndex&&(r=this.sortedIndex[L].value,Sa=this.sortedIndex[L].tvalue,L=this.sortedIndex[L].index);this.szValueField&&this.itemA[c]&&(Sa=__scanValue(this.itemA[c].szValue));if(this.szShowParts){var vb=
!0;for(ia in this.szShowPartsA)this.szShowPartsA[ia]==L%(this.nGridX||1E6)&&(vb=!1);if(vb)continue}T=L;if(d.match(/EXACT/)&&!d.match(/AGGREGATE/)){var ba="";if(this.nRangesA&&this.nRangesA.length)for(ii=0;ii<this.nRangesA.length;ii++)if(r==this.nRangesA[ii]||Number(r)==Number(this.nRangesA[ii])){ba=this.szSymbolsA[ii]||this.szSymbolsA[0]||"circle";T=ii;break}var Ea=String(r),ka=String(r);this.szLabelA&&this.szLabelA[T]&&(Ea=this.szLabelA[T],ka=this.szLabelA[T]);ba.length||0!=L||(ba="empty",Ea=ka=
"no data",T=0);if(ba.length){vc++;E=null;I=this.colorScheme[T];if(d.match(/NOLINES/))N="none";else if(N=this.colorScheme[T],"white"==I||"#ffffff"==I)N="gray";if("circle"==ba||"square"==ba||"carot"==ba||"diamond"==ba||"triangle"==ba||"hexagon"==ba||"empty"==ba){v=map.Scale.normalX(f/3);this.szSizeField&&c&&this.itemA[c]&&(v=v/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize));switch(ba){case "empty":E=map.Dom.newShape("circle",B,0,0,v,"fill:#888888;fill-opacity:0;stroke:#888888;stroke-width:"+
map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "circle":E=map.Dom.newShape("circle",B,0,0,v,"fill:"+I+";stroke:"+N+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "square":E=map.Dom.newShape("rect",B,.8*-v,.8*-v,1.6*v,1.6*v,"fill:"+I+";stroke:"+N+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "diamond":case "carot":(E=map.Dom.newShape("rect",B,.8*-v,.8*-v,1.6*v,1.6*v,"fill:"+I+";stroke:"+N+";stroke-width:"+
map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";"))&&E.setAttributeNS(null,"transform","rotate(45)");break;case "triangle":E=map.Dom.newShape("path",B,"M 0,"+v+" l"+1.2*v+",-"+2*v+" -"+2.4*v+",0 "+1.2*v+","+2*v+"z","fill:"+I+";stroke:"+N+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "hexagon":var Ka=v/2,La=v*Math.sin(60/180*Math.PI),wb=v,E=map.Dom.newShape("path",B,"M -"+v+",0 l "+Ka+",-"+La+" "+wb+",0 "+Ka+","+La+" -"+Ka+","+La+" -"+wb+",0 -"+Ka+",-"+La+
" z","fill:"+I+";stroke:"+N+";stroke-width:"+C+";")}if(d.match(/HORZ/)){d.match(/VALUES/)&&(w=__maptheme_getChartColors(I),N=w.textColor,G=map.Dom.newText(Ja,0,0,"font-family:arial;font-size:"+String(v/2)+"px;text-anchor:start;baseline-shift:-90%;fill:#bbbbbb;stroke:none;pointer-events:none",ka),G.fu.setPosition(L*v*2,-v-map.Scale.normalX(5)),1<k.length&&setRotate(G,-45));if(d.match(/AXIS/)&&this.szXaxisA){var w=__maptheme_getChartColors(I),N=w.textColor,Kb=this.szXaxisA[q],G=map.Dom.newText(Ja,0,
0,"font-family:arial;font-size:"+String(v/2)+"px;text-anchor:start;baseline-shift:-90%;fill:#bbbbbb;stroke:none;pointer-events:none",Kb);G.fu.setPosition(L*v*2+map.Scale.normalX(2),v+map.Scale.normalX(1));1<k.length&&setRotate(G,45)}E.setAttributeNS(szMapNs,"tooltip",Ea);E.fu.setPosition(L*v*2,0)}else!d.match(/VALUES/)||this.fHideValues&&!d.match(/ZOOM/)||(w=__maptheme_getChartColors(I),N=w.textColor,G=map.Dom.newText(Ja,0,0,"font-family:arial;font-size:"+String(v/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",
ka),G.fu.setPosition(v+map.Scale.normalX(3),-L*(2*v-map.Scale.normalY(0)))),E.setAttributeNS(szMapNs,"tooltip",Ea),E.fu.setPosition(0,-L*(2*v-map.Scale.normalY(0)))}else{v=map.Scale.normalX(.4*f);E=map.Dom.constructNode("use",B,{"xlink:href":"#"+ba+":antizoomandpan"});E.setAttributeNS(null,"style","fill:"+I+";stroke:"+N);if(this.szSizeField&&c&&this.itemA[c]){var M=1/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize);E.fu.scale(M,M)}E.fu.setPosition(map.Scale.normalX(0)+L*map.Scale.normalX(20),
map.Scale.normalY(0));0<L&&(map.Dom.newText(B,map.Scale.normalX(-9)+L*map.Scale.normalX(20),0,"font-family:arial;font-size:360px;text-anchor:middle;baseline-shift:-50%;fill:none;stroke:black;stroke-width:60;pointer-events:none;opacity:0.3;","+"),map.Dom.newText(B,map.Scale.normalX(-9)+L*map.Scale.normalX(20),0,"font-family:arial;font-size:360px;text-anchor:middle;baseline-shift:-50%;fill:white;stroke:none;pointer-events:none;opacity:0.8;","+"));d.match(/VALUES/)&&(w=__maptheme_getChartColors(I),N=
w.textColor,G=map.Dom.newText(Ja,0,0,"font-family:arial;font-size:"+String(v/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",ka),G.fu.setPosition(v/2+map.Scale.normalX(3),2*-L*v),this.szSizeField&&c&&this.itemA[c]&&(G=map.Dom.newText(Ja,0,0,"font-family:arial;font-size:"+String(v/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",String(this.itemA[c].nSize)+this.szSizeValueUnits),G.fu.setPosition(v/2+map.Scale.normalX(3),
2*-L*v+v/2)))}E.setAttributeNS(szMapNs,"value",String(r));E.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6)));this.nRealizedCount++}else this.nMissingRangeCount++}else{H=map.Scale.normalX(f/2);Q=jb;d.match(/MENUSIZE/)?Q=5*kb:!this.nNormalSizeValue||d.match(/SEQUENCE/)&&this.szSizeField||(this.nMaxSize=Q=this.nNormalSizeValue);d.match(/ZOOM/)&&d.match(/SEQUENCE/)&&(Q=kb/2+kb/2*Math.pow(Q,.5)/Math.pow(kb,.5));if(d.match(/INVERTSIZE/)&&0==Q-r&&!d.match(/ZEROISVALUE/))return null;this.szFlag.match(/CLIP/)&&
!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(r=this.nClipFrames==k.length?Number(k[this.nActualFrame]):k[L]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+k[k.length-1]*this.nActualFrame/(this.nClipFrames-1));v=0;if(d.match(/AUTOSIZE/))var xb=map.Layer.nDynamicObjectScale,yb=d.match(/RECT/)?d.match(/GAP/)?2.3:2:d.match(/GAP/)?1.6:1.5,Q=Math.max(jb,this.nMax),H=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/yb/xb:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/
yb/xb:H;d.match(/GRIDSIZE/)&&!d.match(/PLOT/)?(xb=map.Layer.nDynamicObjectScale,yb=d.match(/RECT/)?d.match(/GAP/)?2.3:2:d.match(/GAP/)?1.6:1.5,v=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/yb/this.nScale/xb:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/yb/this.nScale/xb:map.Scale.normalX(f/3)):v=d.match(/NOSIZE/)?map.Scale.normalX(f/3):d.match(/FIXSIZE/)?map.Scale.normalX(f/3)/(this.nNormalSizeValue||1):d.match(/LINEAR/)?H/Q*r:d.match(/SIZELOG/)?H/Math.log(Q)*Math.log(r):
d.match(/SIZEP4/)?H/Math.pow(Q,.25)*Math.pow(r,.25):d.match(/SIZEP3/)||d.match(/SIZEVOLUME/)?H/Math.pow(Q,1/3)*Math.pow(r,1/3):H/Math.sqrt(Q)*Math.sqrt(r);d.match(/SEQUENCE/)?d.match(/MENUSIZE/)||d.match(/SUM/)&&!c?v*=this.szField100?1:2:d.match(/ZOOM/)&&!d.match(/PLOT/)?v*=2:d.match(/AGGREGATE/)&&d.match(/EXACT/)||!this.szSizeField||!c||!this.itemA[c]||(v=d.match(/SIZELOG/)?v/Math.log(this.nMaxSize)*Math.log(this.itemA[c].nSize):d.match(/SIZEP4/)?v/Math.pow(this.nMaxSize,.25)*Math.pow(this.itemA[c].nSize,
.25):d.match(/SIZEP3/)||d.match(/SIZEVOLUME/)?v/Math.pow(this.nMaxSize,1/3)*Math.pow(this.itemA[c].nSize,1/3):v/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize)):d.match(/MENUSIZE/)||d.match(/SUM/)&&!c?v=1.5*H:d.match(/ZOOM/)&&!d.match(/PLOT/)?v=Math.max(v,2*H/3):this.szSizeField&&c&&this.itemA[c]&&(v=H/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize));if(isNaN(v)||!v)if(v=0,!d.match(/STAR/)&&!d.match(/STACKED/))continue;ba=this.szSymbolsA[L];this.szValueField&&d.match(/EXACT/)&&this.szValuesA&&
(Sa=this.szValuesA[L]);if((d.match(/SEQUENCE/)||d.match(/DOMINANT/))&&this.colorScheme.length==this.partsA.length)I=this.colorScheme[L%(this.nGridX||1E4)],N=this.colorScheme[L];else if(I=this.colorScheme[0],N=this.colorScheme[1]?this.colorScheme[1]:"none",2<this.colorScheme.length&&(I=this.colorScheme[this.colorScheme.length-1],N=this.colorScheme[0]),d.match(/NOLINES/)?N="none":"none"==N&&(w=__maptheme_getChartColors(I),N=w.textColor),2<this.colorScheme.length||this.szRanges&&this.szRanges.length){for(ii=
0;ii<this.partsA.length;ii++)if(d.match(/EXACT/)&&r==this.partsA[ii].min||!d.match(/EXACT/)&&r<this.partsA[ii].max){I=this.colorScheme[ii];w=__maptheme_getChartColors(I);N=w.textColor;d.match(/RANGE/)&&!d.match(/RANGES/)&&(v=map.Scale.normalX(2+5*(ii+1)/this.partsA.length));T=ii;e.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6)));break}d.match(/NOLINES/)&&(N="none")}if("circle"==ba||"square"==ba||"carot"==ba||"diamond"==ba||"triangle"==ba||"hexagon"==ba||"empty"==ba||"label"==ba){N=this.szLineColor||
N;C=(this.nLineWidth||1)*map.Scale.normalX(Math.min(2*v/H,.2));switch(ba){case "empty":E=map.Dom.newShape("circle",B,0,0,v,"fill:#888888;fill-opacity:0;stroke:#888888;stroke-width:"+C+";");break;case "circle":!this.fShadow&&this.fOrigShadow&&(ca=map.Dom.newShape("circle",B,map.Scale.normalX(.5)+.02*v,map.Scale.normalX(.5)+.02*v,1.02*v,"fill:#000000;stroke:none;opacity:"+.6*(this.fillOpacity?this.fillOpacity:1)));d.match(/GLOW/)&&!d.match(/ZOOM/)&&(!this.szGlowUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=
this.nGlowUpper)?((E=map.Dom.newShape("circle",B,0,0,6*v,"fill:"+I+";stroke:none;fill-opacity:0.05;"))&&E.setAttributeNS(szMapNs,"class",String(T)),(E=map.Dom.newShape("circle",B,0,0,2*v,"fill:"+I+";stroke:none;fill-opacity:0.1;"))&&E.setAttributeNS(szMapNs,"class",String(T))):d.match(/AURA/)&&!d.match(/ZOOM/)&&(!this.szGlowUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nGlowUpper)&&(E=map.Dom.newShape("circle",B,0,0,1.3*v,"fill:"+(this.szLineColor||I)+";stroke:none;fill-opacity:0.3;"))&&
E.setAttributeNS(szMapNs,"class",String(T));E=map.Dom.newShape("circle",B,0,0,v,"fill:"+I+";stroke:"+N+";stroke-width:"+C+";");break;case "square":E=map.Dom.newShape("rect",B,-v,-v,2*v,2*v,"fill:"+I+";stroke:"+N+";stroke-width:"+C+";");break;case "carot":case "diamond":(E=map.Dom.newShape("rect",B,-v,-v,2*v,2*v,"fill:"+I+";stroke:"+N+";stroke-width:"+C+";"))&&E.setAttributeNS(null,"transform","rotate(45)");break;case "triangle":E=map.Dom.newShape("path",B,"M 0,"+v+" l"+1.2*v+",-"+2*v+" -"+2.4*v+",0 "+
1.2*v+","+2*v+"z","fill:"+I+";stroke:"+N+";stroke-width:"+C+";");break;case "hexagon":Ka=v/2;La=v*Math.sin(60/180*Math.PI);wb=v;E=map.Dom.newShape("path",B,"M -"+v+",0 l "+Ka+",-"+La+" "+wb+",0 "+Ka+","+La+" -"+Ka+","+La+" -"+wb+",0 -"+Ka+",-"+La+" z","fill:"+I+";stroke:"+N+";stroke-width:"+C+";");break;case "label":if(Y=this.formatValue(Sa,this.szValueDecimals||(1>Sa||10>Q?1:0),"ROUND")+(5>=this.szUnit.length?this.szUnit:""),d.match(/TEXTONLY/)){Aa=__maptheme_getChartColors(I).textColor;Z=String(Math.max(Math.min(.8*
v,map.Scale.normalX(500)),map.Scale.normalX(2)));if(this.nValueSizeMin&&!d.match(/ZOOM/)&&Z*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin)){E=map.Dom.newShape("rect",B,0,0,0,0,"fill:none;");ca=map.Dom.newShape("rect",B,0,0,0,0,"fill:none;");break}sb=this.szTextFont||"arial";ca=map.Dom.newText(B,0,0,"font-family:"+sb+";font-size:"+Z+"px;font-weight:bold;text-anchor:middle;fill:none;stroke:"+I+";stroke-width:"+Z/7+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",
Y);ca.setAttributeNS(null,"id",this.szId+":"+c+":text:bg");E=map.Dom.newText(B,0,0,"font-family:"+sb+";font-size:"+Z+"px;font-weight:bold;text-anchor:middle;fill:#000000;opacity:"+va+";stroke:none;",Y);E.setAttributeNS(null,"id",this.szId+":"+c+":text")}else{Z=String(Math.max(1,Math.min(.8*v,3.4/Y.length*v)));if(this.nValueSizeMin&&!d.match(/ZOOM/)&&Z*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin)){E=map.Dom.newShape("rect",B,0,0,0,0,"fill:none;");break}E=map.Dom.newShape("rect",
B,-v,.83*-Z,2.05*v,1.6*Z,"fill:"+I+";stroke:"+N+";stroke-width:"+C+";");E.setAttributeNS(null,"rx",map.Scale.normalX(2*v/H));E.setAttributeNS(null,"ry",map.Scale.normalX(2*v/H))}}if(E){d.match(/OUTLINE/)?(E.style.setProperty("stroke-width",String(map.Scale.normalX(.5))),E.style.setProperty("stroke-opacity","1"),E.style.setProperty("fill-opacity","0.7")):d.match(/RANDOM/)?(E.style.setProperty("stroke-opacity",String(this.nOpacity?this.nOpacity:1),""),E.style.setProperty("fill-opacity",String(this.fillOpacity?
this.fillOpacity:this.nOpacity?this.nOpacity:1),""),d.match(/DOPACITY/)&&(ma=1/(this.nDopacityPow||1),va=Math.pow(r,ma)/Math.pow(this.sortedMax,ma)*(this.nOpacity||1)*(this.nDopacityScale||1),E.style.setProperty("fill-opacity",String(va),""))):d.match(/SORT/)&&d.match(/DOPACITY/)?(E.style.setProperty("stroke-opacity",String(this.nOpacity?this.nOpacity:1),""),ma=1/(this.nDopacityPow||1),va=Math.pow(r,ma)/Math.pow(this.sortedMax,ma)*(this.nOpacity||1)*(this.nDopacityScale||1),E.style.setProperty("fill-opacity",
String(va),"")):d.match(/DOPACITY/)&&this.szAlphaField?c&&"undefined"!=typeof this.itemA[c].nAlpha&&(ma=1/(this.nDopacityPow||1),va=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,ma)*Math.pow(this.itemA[c].nAlpha,ma),E.style.setProperty("fill-opacity",String(va),"")):d.match(/DOPACITY/)?(ma=1/(this.nDopacityPow||1),va=Math.pow(r-this.nMin,ma)/Math.pow(this.nMax-this.nMin,ma)*(this.fillOpacity||1)*(this.nDopacityScale||1),E.style.setProperty("fill-opacity",String(va),"")):E.style.setProperty("fill-opacity",
String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:1),"");this.chartGroup&&this.chartGroup.style.setProperty("opacity","1","");if((d.match(/ZOOM/)||d.match(/NORMSIZE/))&&this.szLabelA){var wa=this.formatValue(Sa,2),Ea=wa+this.szUnit,Ea=Ea+(" - "+this.szLabelA[L%(this.nGridX||1E7)]);this.szXaxisA&&this.szXaxisA.length&&(Ea+=" ("+this.szXaxisA[Math.floor(L/(this.nGridX||1))]+")")}else wa=this.formatValue(Sa,2),Ea=" "+wa+this.szUnit;E.setAttributeNS(szMapNs,"tooltip",Ea)}}else if(!d.match(/MULTIPLE/)||
d.match(/NORMSIZE/)||d.match(/MENUSIZE/))E=map.Dom.constructNode("use",B,{"xlink:href":"#"+ba+":antizoomandpan"}),map.Dom.newShape("circle",B,0,0,.5*v,"fill:white;stroke:none;opacity:0"),E.fu.scale(v/H,v/H),E.setAttributeNS(null,"style","fill:"+I+";stroke:"+N);else for(var E=map.Dom.newGroup(B,B.getAttributeNS(null,"id")+":multiple"),Lb=0;Lb<r;Lb++){var ec=map.Dom.constructNode("use",E,{"xlink:href":"#"+ba+":antizoomandpan"});ec.fu.setPosition(Lb*(H+map.Scale.normalX(1)),0);ec.fu.scale(1,1);ec.setAttributeNS(null,
"style","fill:"+I+";stroke:"+N);map.Dom.newShape("circle",E,Lb*H,0,.5*v,"fill:white;stroke:none;opacity:0")}if(E&&d.match(/VALUES/)&&(!this.fHideValues||d.match(/ZOOM/))){var G=null,Y=this.formatValue(Sa,this.szValueDecimals||"")+(5>=this.szUnit.length?this.szUnit:""),Gc=this.formatValue(jb,this.szValueDecimals||"")+(5>=this.szUnit.length?this.szUnit:""),w=__maptheme_getChartColors(I),Aa=this.szTextColor||w.textColor,Z=String(Math.min(.5*v,("hexagon"==ba?2.7:3.2)/Gc.length*v));if(d.match(/ZOOM/)&&
d.match(/LINES/)&&(null==this.nGridX||1>=this.nGridX||d.match(/STACKED/)))Aa="black",K||(K=map.Dom.newGroup(e,this.szId+":"+c+":chartontop")),Z=4+.5*k.length/(this.nGridX?2*this.nGridX:1),G=this.createTextLabel(SVGDocument,K,"",Y,Z,"",w.lowColor,"white"),G.setAttributeNS(null,"opacity","0.5");else if(d.match(/ZOOM/)&&!d.match(/SEQUENCE/))Aa="black",G=map.Dom.newText(B,.5*v+.2*H,-v/2,this.szValuesTextStyle,Y);else if("circle"==ba||"square"==ba||"triangle"==ba||"hexagon"==ba||"label"==ba||"empty"==
ba)if(d.match(/CENTER/)||d.match(/TOP/)||d.match(/BOTTOM/)){if(r){var P=6;this.szChartFlag+="|VALUEBACKGROUND";K||(K=map.Dom.newGroup(e,this.szId+":"+c+":chartontop"));Da=Da?Da:v;l=-map.Scale.normalX(1);g=-map.Scale.normalX(1.33*P)*(dc-wc-1);G=this.createTextLabel(SVGDocument,K,"",Y,P,"",I);G.fu.setPosition(l,g);if(c&&(d.match(/ZOOM/)||d.match(/NORMSIZE/))&&this.szLabelA){var Hc=G.fu.getBox().width,G=map.Dom.newText(K,0,0,this.szValuesTextStyle+";color:#000;",this.szLabelA[L]);G.fu.setPosition(l+
Hc+map.Scale.normalX(6),g-map.Scale.normalX(-1));G.fu.scale(.6,.6)}G.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6)));G=null;wc++}}else G=map.Dom.newText(B,0,.33*Z,"font-family:arial;font-size:"+Z+"px;text-anchor:middle;fill:"+Aa+";stroke:none;pointer-events:none",Y);else Z=String(Math.min(.8*v,v/2)),Z=Math.max(Z,1),G=this.createTextLabel(SVGDocument,B,"",Y,Z/map.Scale.normalX(1),"",I),G.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa)}if(E&&(E.setAttributeNS(szMapNs,"class",
String(T%(this.nGridX||1E6))),G&&G.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6))),ca&&ca.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6))),!d.match(/CENTER/)))if(d.match(/STAR/)){if(0==q&&(Hb=E,Ib=G,Da=v,d.match(/EXPAND/)&&d.match(/SORT/)&&d.match(/UP/)&&(Da=d.match(/LINEAR/)?(d.match(/EXPANDMAX/)?2:.5)*H/Q*this.sortedIndex[k.length-1].value:(d.match(/EXPANDMAX/)?2:.5)*H/Math.sqrt(Q)*Math.sqrt(this.sortedIndex[k.length-1].value)),d.match(/ZOOM/)&&d.match(/STAR/)&&d.match(/UP/)?
Da*=2:d.match(/COMPRESS/)&&(Da*=d.match(/COMPRESSMAX/)?.25:.5)),(0<q||d.match(/UP/))&&v){var Ic=this.nClipParts&&this.nClipParts<this.partsA.length?this.nClipParts:this.partsA.length,fc=v,xc=Da+v,Jc=Math.sqrt(Math.pow(xc,2)-Math.pow(fc,2)),Mb=90-Math.asin(fc*Jc/xc/fc)/Math.PI*180,Ta=Da+v;d.match(/UP/)&&(5<q&&(Mb/=1+v/H*2),Ta=Da*(1+Ic/5));d.match(/ZOOM/)||(Ta=this.nRangeScale?Ta*this.nRangeScale:d.match(/EXPANDMAX/)?2*Ta:d.match(/EXPAND/)?1.5*Ta:Ta);this.initAngle+=Mb;pa=Math.cos(this.initAngle/180*
Math.PI)*Ta;fa=Math.sin(this.initAngle/180*Math.PI)*Ta;this.initAngle+=Mb;E.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa);ca&&ca.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa);G&&G.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa)}}else if(d.match(/RANDOM/)){var Nb=d.match(/EXPANDMAX/)?2*v:d.match(/EXPAND/)?1.5*v:v;d.match(/ZOOM/)&&(H*=2,Nb*=2);pa=Math.cos(this.initAngle+360/this.partsA.length*q/180*Math.PI)*Math.min(H,Nb);fa=Math.sin(this.initAngle+
360/this.partsA.length*q/180*Math.PI)*Math.min(H,Nb);E.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa);ca&&ca.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa);G&&G.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa)}else if(d.match(/HORZ/))pa+=v,E.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa),ca&&ca.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa),G&&G.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa),pa+=v;
else if(d.match(/BOTTOM/))E.fu.setPosition(map.Scale.normalX(0),-v),ca&&ca.fu.setPosition(map.Scale.normalX(0),-v),G&&G.fu.setPosition(map.Scale.normalX(0),-v);else if(d.match(/TOP/))E.fu.setPosition(.3*-v,.7*v-H),ca&&ca.fu.setPosition(.3*-v,.7*v-H),G&&G.fu.setPosition(.3*-v,.7*v-H);else if(d.match(/CONE/))E.fu.setPosition(map.Scale.normalY(.33*q),-map.Scale.normalY(1*q)),ca&&ca.fu.setPosition(map.Scale.normalY(.33*q),-map.Scale.normalY(1*q)),G&&G.fu.setPosition(map.Scale.normalY(.33*q),-map.Scale.normalY(1*
q));else if(d.match(/BASE/))E.fu.setPosition(map.Scale.normalX(0),fa-v),ca&&ca.fu.setPosition(map.Scale.normalX(0),fa-v),G&&G.fu.setPosition(map.Scale.normalX(0),fa-v),fa-=v*(d.match(/VALUES/)?1.25:1);else if(d.match(/PLOT/)){0!=r||d.match(/STACKED/)||(E.parentNode.removeChild(E),ca&&ca.parentNode.removeChild(ca),G&&G.parentNode.removeChild(G));var F=map.Scale.normalX(f)*(d.match(/LINES/)?1:2/3),W=q*F;this.nGridX&&(W=d.match(/PLOTVAR/)?Math.floor(q%this.nGridX)*F:Math.floor(q/this.nGridX)*F);var Q=
this.nMaxValue||jb||this.nMax,xa=this.nMinValue||Math.min(this.nMin,cc),M=map.Scale.normalX(f)/(Q-xa)*(d.match(/ZOOM/),5)*(this.nRangeScale||1);K||(K=map.Dom.newGroup(e,this.szId+":"+c+":chartontop"));if(d.match(/AREA/))var na=map.Dom.newGroup(K,"");else na=map.Dom.newGroup(B,""),na.parentNode.insertBefore(na,na.parentNode.firstChild);la=map.Dom.newGroup(K,"");if(d.match(/PLOTYX/))E.fu.setPosition((Q+Math.abs(Q-r))*M,W),ca&&ca.fu.setPosition((Q+Math.abs(Q-r))*M,W),G&&G.fu.setPosition((Q+Math.abs(Q-
r))*M,W);else if(d.match(/PLOTY/)){E.fu.setPosition(0,(-Q+Math.abs(Q-r))*M);ca&&ca.fu.setPosition(0,(-Q+Math.abs(Q-r))*M);G&&G.fu.setPosition(0,(-Q+Math.abs(Q-r))*M);var da=1,da=Q/5,da=10*Math.ceil(da/(10*Math.floor(Math.log(da))))*Math.floor(Math.log(da))||1,Q=Math.ceil(Q/da)*da;if(!lb&&(lb=!0,d.match(/BOX/)&&d.match(/GRID/)))for(var aa=map.Scale.normalX(f)/2;aa<Q*M;aa+=M*da)map.Dom.newShape("line",na,-20,-aa,20,-aa,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";")}else if(d.match(/PLOTX/)){if(E.fu.setPosition((Q-
Math.abs(Q-r))*M,0),ca&&ca.fu.setPosition((Q-Math.abs(Q-r))*M,0),G&&G.fu.setPosition((Q-Math.abs(Q-r))*M,0),da=1,da=Q/5,da=10*Math.ceil(da/(10*Math.floor(Math.log(da))))*Math.floor(Math.log(da))||1,Q=Math.ceil(Q/da)*da,!lb&&(lb=!0,d.match(/BOX/)&&d.match(/GRID/)))for(aa=map.Scale.normalX(f);aa<Q*M+map.Scale.normalX(f);aa+=M*da)map.Dom.newShape("line",na,aa,-20,aa,20,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";")}else{da=1;da=Math.ceil(Q-xa)/5.1;1<da&&(da=10*Math.ceil(da/(10*Math.floor(Math.log(da))))*
Math.floor(Math.log(da))||1);Q=Math.ceil(Q/da)*da;xa=Math.floor(xa/da)*da;if(!lb){lb=!0;this.plot_last_last_position=[];this.plot_last_position=[];this.plot_last_value=[];this.plot_last_stacked_value=[];this.plot_last_shape=[];this.plot_last_mean=[];this.plot_last_areaValue=[];this.plot_area_points=[];this.plot_area_shapes=[];this.plot_area_shapes[0]=map.Dom.newShape("path",B,"M0,0","fill:"+I+";fill-opacity:"+(this.fillOpacity||1)+";stroke:none");var zb=map.Scale.normalX(d.match(/ZOOM/)?7:10);if(d.match(/BOX/)&&
d.match(/GRID/)){for(var gc=.8,aa=0;aa<=(Q-xa)*M;aa+=M*da){var Ab=-F/(d.match(/LINES/)?3:1),hc=F*(this.nGridX?k.length/this.nGridX-1:k.length-1);d.match(/PLOTVAR/)&&1<k.length/this.nGridX&&(hc=F*this.nGridX);if(d.match(/GRADIENT/)&&0!=aa)var yc=hc+(d.match(/LINES/),0),R=map.Dom.newShape("path",B,"M"+Ab+","+-aa+" L "+yc+","+-aa+" "+yc+","+(-aa+M*da)+" "+Ab+","+(-aa+M*da)+" z","fill:#d8d8dd;fill-opacity:"+gc+";stroke:none;"),gc=gc-.3;map.Dom.newShape("line",na,Ab,-aa,hc,-aa,"stroke:#aaaaaa;stroke-width:"+
(0==aa?map.Scale.normalX(.5):map.Scale.normalX(.2))+";");5<Q?map.Dom.newText(na,1.1*Ab,-aa+.3*zb,"font-family:arial;font-size:"+zb+"px;text-anchor:end;fill:#888888;stroke:none;pointer-events:none;",String(Math.round(d.match(/INVERT/)?Q-aa/M+xa:aa/M+xa))):map.Dom.newText(na,1.1*Ab,-aa+.3*zb,"font-family:arial;font-size:"+zb+"px;text-anchor:end;fill:#888888;stroke:none;pointer-events:none;",this.formatValue(Math.round(d.match(/INVERT/)?Q-aa/M+xa:10*(aa/M+xa))/10,1));this.nPlotHeight=aa}map.Dom.newShape("line",
na,W,0,W,-(Q-xa)*M,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(.1)+";");if(this.szXaxisA&&this.szXaxisA.length)for(aa=0;aa<this.szXaxisA.length;aa++)map.Dom.newShape("line",na,F*aa,100,F*aa,-(Q-xa)*M,"stroke:#444444;stroke-width:"+map.Scale.normalX(.5)+";stroke-dasharray:20 80;"),map.Dom.newText(na,F*aa,250,"font-family:arial;font-size:"+zb+"px;text-anchor:middle;fill:#888888;stroke:none;pointer-events:none;",this.szXaxisA[aa])}}var Ua=this.nGridX?Math.floor(q/this.nGridX)+1:1,U=this.nGridX?
q%this.nGridX:1,qa=d.match(/INVERT/)?Q-r:r,qa=qa-xa,qa=qa+(d.match(/STACKED/)?this.plot_last_stacked_value[Ua]||0:0);E.fu.setPosition(W,-qa*M);ca&&ca.fu.setPosition(W,-qa*M);G&&(d.match(/LINES/)&&(null==this.nGridX||1>=this.nGridX||d.match(/STACKED/))?G.fu.setPosition(W-map.Scale.normalX(f/4),-qa*M-map.Scale.normalY(f/4)/(this.nGridX||1)):G.fu.setPosition(W,-qa*M));if(d.match(/LINES/)){var R=null;if(d.match(/ZEROISVALUE/)&&this.plot_last_position[U]&&(r||this.plot_last_position[U].y)||r&&this.plot_last_position[U]&&
this.plot_last_position[U].y)if(d.match(/AREA/))R=map.Dom.newShape("path",B,"M"+(this.plot_last_position[U].x-2)+","+this.plot_last_position[U].y+" L "+W+","+-qa*M+" "+W+","+(-qa+r-xa)*M+" "+(this.plot_last_position[U].x-2)+","+(this.plot_last_last_position[U-1]?this.plot_last_last_position[U-1].y:0)+" z","fill:"+I+";fill-opacity:"+(this.fillOpacity||1)+";"),R.setAttributeNS(szMapNs,"value",String(r)),R.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6))),R.setAttributeNS(szMapNs,"tooltip",
(this.szLabelA?this.szLabelA[T%(this.nGridX||1E6)]+": ":"")+this.formatValue(this.plot_last_areaValue[U],this.szValueDecimals||2)+this.szUnit+" ... "+this.formatValue(r,this.szValueDecimals||2)+this.szUnit),R=map.Dom.newShape("line",B,this.plot_last_position[U].x,this.plot_last_position[U].y,W,-qa*M,"stroke:"+I+";stroke-width:"+map.Scale.normalX(d.match(/STACKED/)?1:3)+";"),R.setAttributeNS(szMapNs,"value",String(r));else{R=map.Dom.newShape("line",B,this.plot_last_position[U].x,this.plot_last_position[U].y,
W,-qa*M,"stroke:"+I+";stroke-width:"+map.Scale.normalX(3)+";stroke-linecap:round;");R.setAttributeNS(szMapNs,"value",String(r));R.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6)));try{B.insertBefore(R,this.plot_last_shape[U])}catch(Sc){}}if(d.match(/PLOTVAR/)){var ra=d.match(/MEDIAN/)?this.nMedianA[L]:this.nMeanA[L],ra=ra-xa;this.plot_last_mean[U]&&(R=map.Dom.newShape("path",na,"M"+this.plot_last_mean[U].x+","+(this.plot_last_mean[U].y-this.nDeviationA[L-1]*M)+" L "+W+","+(-ra-this.nDeviationA[L])*
M+" "+W+","+(-ra+this.nDeviationA[L])*M+" "+this.plot_last_mean[U].x+","+(this.plot_last_mean[U].y+this.nDeviationA[L-1]*M)+" z","fill:#d8d8dd;fill-opacity:0.2;stroke:none;"),R.setAttributeNS(szMapNs,"tooltip","standard deviation"),R=map.Dom.newShape("line",B,this.plot_last_mean[U].x,this.plot_last_mean[U].y,W,-ra*M,"stroke:#888888;stroke-width:"+map.Scale.normalX(2)+";stroke-linecap:round;stroke-dasharray:10 80;"),R.setAttributeNS(szMapNs,"tooltip","mean"));this.plot_last_mean[U]=new point(W,-ra*
M)}this.plot_last_last_position[U]=d.match(/STACKED/)?this.plot_last_position[U]||new point(0,0):new point(0,0);this.plot_last_position[U]=0<=qa?new point(W,-qa*M):new point(W,0);this.plot_last_shape[U]=E;this.plot_last_areaValue[U]=r;this.plot_area_points.push(new point(W,-qa*M))}else 1<k.length/this.nGridX?d.match(/PLOTVAR/)?(E.style.setProperty("fill-opacity",Ua==k.length/this.nGridX?"1":"0.2",""),E.style.setProperty("stroke-width",Ua==k.length/this.nGridX?"0":"3",""),R=null,this.plot_last_position[U]&&
(d.match(/PLOTVAR/)?(R=map.Dom.newShape("line",B,this.plot_last_position[U].x,this.plot_last_position[U].y,W,-qa*M,"stroke:"+I+";stroke-width:"+map.Scale.normalX(2)+";"),R.setAttributeNS(szMapNs,"value",String(r)),R.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6))),R.parentNode.insertBefore(R,R.parentNode.firstChild),R=map.Dom.newShape("line",B,this.plot_last_position[U].x-40,this.plot_last_position[U].y,this.plot_last_position[U].x+40,this.plot_last_position[U].y,"stroke:"+I+";stroke-width:"+
map.Scale.normalX(3)+";"),R.setAttributeNS(szMapNs,"value",String(r)),R.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6))),R.parentNode.insertBefore(R,R.parentNode.firstChild),R=map.Dom.newShape("line",B,W,0,W,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";"),R.setAttributeNS(szMapNs,"value",String(r)),R.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6))),R.parentNode.insertBefore(R,R.parentNode.firstChild)):(R=map.Dom.newShape("line",B,this.plot_last_position[U].x,
this.plot_last_position[U].y,W,-qa*M,"stroke:"+I+";stroke-width:"+map.Scale.normalX(3)+";"),R.setAttributeNS(szMapNs,"value",String(r)),R.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6))),B.insertBefore(R,this.plot_last_shape[U]))),this.plot_last_last_position[U]=this.plot_last_position[U]||new point(0,0),this.plot_last_position[U]=new point(W,-qa*M),this.plot_last_shape[U]=E):d.match(/BOX/)&&map.Dom.newShape("line",na,W,0,W,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+
";"):d.match(/PLOTVAR/)?(R=null,ra=d.match(/MEDIAN/)?this.nMedianA[L]:this.nMeanA[L],ra-=xa,R=map.Dom.newShape("line",na,W,-(ra-this.nDeviationA[L])*M,W,-(ra+this.nDeviationA[L])*M,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(1)+";"),R.setAttributeNS(szMapNs,"value",String(r)),R.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6))),R=map.Dom.newShape("line",na,W-40,-ra*M,W+40,-ra*M,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(2)+";"),R.setAttributeNS(szMapNs,"value",String(r)),R.setAttributeNS(szMapNs,
"class",String(T%(this.nGridX||1E6))),R=map.Dom.newShape("line",na,W-80,-(ra-this.nDeviationA[L])*M,W+80,-(ra-this.nDeviationA[L])*M,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(1)+";"),R.setAttributeNS(szMapNs,"value",String(r)),R.setAttributeNS(szMapNs,"class",String(T%(this.nGridX||1E6))),R=map.Dom.newShape("line",na,W-80,-(ra+this.nDeviationA[L])*M,W+80,-(ra+this.nDeviationA[L])*M,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(1)+";"),R.setAttributeNS(szMapNs,"value",String(r)),R.setAttributeNS(szMapNs,
"class",String(T%(this.nGridX||1E6))),map.Dom.newShape("line",na,W,0,W,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";"),this.plot_last_position[U]&&(R=map.Dom.newShape("line",na,this.plot_last_position[U].x,this.plot_last_position[U].y,W,-ra*M,"stroke:#888888;stroke-width:"+map.Scale.normalX(1)+";")),this.plot_last_last_position[U]=this.plot_last_position[U]||new point(0,0),this.plot_last_position[U]=new point(W,-ra*M)):d.match(/BOX/)&&map.Dom.newShape("line",na,W,0,W,
-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";");this.plot_last_value[Ua]=r;this.plot_last_stacked_value[Ua]=qa}fa=0}else"label"==ba&&(fa-=1.2*Z),E.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa),ca&&ca.fu.setPosition(map.Scale.normalX(0)+pa,map.Scale.normalY(0)+fa),G&&G.fu.setPosition(pa,map.Scale.normalY(0)+fa),fa="label"==ba?fa-.33*Z:fa-v}}Ja&&Ja.parentNode.appendChild(Ja);Hb&&Hb.parentNode.appendChild(Hb);Ib&&Ib.parentNode.appendChild(Ib);la&&la.parentNode.appendChild(la);
if(0&d.match(/AREA/)&&!this.nGridX&&this.plot_area_points&&this.plot_area_points.length){for(var zc=!0,ic=this.plot_area_points.length,ia=0;ia<ic;ia++)0==this.plot_area_points[ia].y&&(zc=!1);if(zc||d.match(/ZEROISVALUE/)){for(var Ma="M"+this.plot_area_points[0].x+","+this.plot_area_points[0].y+" L ",ia=1;ia<ic;ia++)Ma+=this.plot_area_points[ia].x+","+this.plot_area_points[ia].y+" ";Ma+=this.plot_area_points[ic-1].x+",0 ";Ma+="0,0 ";Ma+="z ";this.plot_area_shapes[0].setAttributeNS(null,"d",Ma)}}if("undefined"!=
typeof this.szSymbolBoxStyle){var Ac=map.Dom.getBox(B);bb.setAttributeNS(null,"x",-map.Scale.normalX(15));bb.setAttributeNS(null,"y",-map.Scale.normalY(15));bb.setAttributeNS(null,"width",map.Scale.normalX(30*vc));bb.setAttributeNS(null,"height",map.Scale.normalY(30));bb.setAttributeNS(null,"fill-opacity",1)}J.x=map.Scale.normalY(0);J.y=map.Scale.normalY(d.match(/ZOOM/)||d.match(/MENUSIZE/)?20:0)}else if(d.match(/BUFFER/)){Q=this.nMaxA[0];r=k[0];v=this.nBufferSize?this.nBufferSize:1E3;this.szShapeType.match(/line/)&&
(v*=this.nScale);v=map.Scale.getDeltaXofDistanceInMeter(v);I=this.colorScheme[0];if(this.szFields&&this.szFields.length&&this.nRangesA&&this.nRangesA.length&&(I=null,this.nRangesA.length==this.colorScheme.length))for(q=0;q<this.nRangesA.length;q++)if(r==this.nRangesA[q]||Number(r)==Number(this.nRangesA[q])){I=this.colorScheme[q];w=__maptheme_getChartColors(I);N="undefined"!=typeof this.szBorderColor?this.szBorderColor:.8>this.fillOpacity?"#888888":w.textColor;break}if(this.szShapeType.match(/point/))if(I){f=
2*v/map.Scale.normalX(1);J.x=0;J.y=v+map.Scale.normalY(5);this.szFlag.match(/OVERLAY/);E=map.Dom.newShape("circle",B,0,0,v,"");if(this.szFlag.match(/VALUE/))var mb="font-family:arial;font-size:"+map.Scale.normalX(5)+"px;fill:#222222;stroke-dasharray:none;pointer-events:none;",G=map.Dom.newText(B,v-map.Scale.normalX(5),0,mb,Map.Scale.prototype.formatDistanceString(this.nBufferSize));this.nRealizedCount++}else return new point(0,0);if(this.szShapeType.match(/line/)){var Ob=SVGDocument.getElementById(c),
jc=Ob.getAttributeNS(null,"id");if(!jc.match(":paint")){var Bb=SVGDocument.getElementById(jc+":paint");Bb||(Bb=Ob.cloneNode(1E3),B.appendChild(Bb),Bb.setAttributeNS(null,"id",jc+":paint"));Ob=Bb;this.nRealizedCount++}var Kc=2*v/map.Scale.normalX(1);Ob.setAttributeNS(null,"style","fill:none;stroke:"+I+";stroke-linejoin:round;stroke-linecap:round;stroke-width:"+map.Scale.normalX(Kc)*map.Scale.nZoomScale+";stroke-opacity:"+String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0)+"");return null}}else if(d.match(/BAR/)||
d.match(/BARS/)){var O=0,ga=0,Lc=f,Fa=1,oa=0,D=1,ta=this.nMax-this.nMin,Fb=this.nMax100-this.nMin100;this.nNormalSizeValue&&(ta=Fb=this.nMaxSize=this.nNormalSizeValue);if(d.match(/SIZE/)&&!d.match(/NORMSIZE/)&&this.szSizeField&&c&&this.itemA[c])Fa=d.match(/SIZELOG/)?1/Math.log(this.nMaxSize)*Math.log(this.itemA[c].nSize):d.match(/SIZEP4/)?1/Math.pow(this.nMaxSize,.25)*Math.pow(this.itemA[c].nSize,.25):d.match(/3D/)||d.match(/SIZEP3/)||d.match(/SIZEVOLUME/)?1/Math.pow(this.nMaxSize,1/3)*Math.pow(this.itemA[c].nSize,
1/3):1/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize);else if(d.match(/SIZE/)&&!d.match(/NORMSIZE/)){var Na=z;d.match(/POINTER/)&&(Na/=k.length);Fa=d.match(/SIZELOG/)?1/Math.log(ta)*Math.log(Math.abs(Na)):d.match(/SIZEP4/)?1/Math.pow(ta,.25)*Math.pow(Math.abs(Na),.25):d.match(/3D/)||d.match(/SIZEP3/)||d.match(/SIZEVOLUME/)?1/Math.pow(ta,1/3)*Math.pow(Math.abs(Na),1/3):1/Math.pow(ta,.5)*Math.pow(Math.abs(Na),.5)}0==Fa&&0!=z&&(Fa=30/f);f*=Fa;var A=map.Scale.normalX(f/k.length*.66);d.match(/STACKED/)&&
(A=map.Scale.normalX(f/3),this.nGridX&&!d.match(/MULTI/)&&(A/=2));d.match(/MENUSIZE/)&&1==k.length&&(A=map.Scale.normalX(f/2));P=A<map.Scale.normalX(5)?4*A/5:5*A/5;Ia=1;d.match(/COLUMN/)&&(A*=d.match(/THICK/)?2:d.match(/THIN/)?1:1.5);d.match(/THIN/)&&(A*=.6,P*=.75);d.match(/THICK/)&&(A*=1.5,P*=1.5);d.match(/STACKED/)?P=map.Scale.normalX(5):(d.match(/ZOOM/)||d.match(/NORMSIZE/))&&1==k.length&&(P*=2.5);d.match(/STACKED/)&&!d.match(/ZOOM/)&&(P*=Fa);mb="font-family:arial;font-size:"+.95*P+"px;fill:#606060;pointer-events:none;";
mb=map.Scale.tStyle.Values.szStyle+"font-size:"+.95*P+"px";d.match(/NORMSIZE/)||d.match(/MENUSIZE/)||this.szFlag.match(/NORMSIZE/)||this.szFlag.match(/MENUSIZE/)||!this.nNormalSizeValue||this.szField100&&!d.match(/POINTER/)||(u=this.nNormalSizeValue);this.nOverrideMax&&(u=this.nOverrideMax);F=map.Scale.normalX(Lc)/u;if(d.match(/OFFSETMEAN/)||d.match(/OFFSETMEDIAN/)||d.match(/DEVIATION/))F=map.Scale.normalX(f)/300;d.match(/SIZE/)&&d.match(/SEQUENCE/)&&c&&1<k.length&&!this.szSizeField&&!this.szField100?
F=F*k.length/Fa:d.match(/SIZE/)&&c&&1<k.length&&!d.match(/EXPAND/)&&(F=this.szField100||d.match(/POINTER/)?F*Fa:F/(d.match(/SIZEP4/)?Fa*Fa:Fa));!this.nRangeScale||d.match(/ZOOM/)&&d.match(/HORZ/)||(F*=this.nRangeScale);d.match(/COMPRESSMAX/)?F/=4:d.match(/COMPRESSMORE/)?F/=3:d.match(/COMPRESS/)?F/=2:d.match(/EXPANDMAX/)?F*=4:d.match(/EXPANDMORE/)?F*=3:d.match(/EXPAND/)&&(F*=2);d.match(/POINTER/)&&!d.match(/NORMSIZE/)&&(F*=1.2);var kc=map.Dom.newGroup(B,"");if(d.match(/SORT/)){this.sortedIndex=[];
for(q=0;q<k.length;q++)this.sortedIndex[q]={index:q,value:k[q]};this.sortedIndex.sort(d.match(/STACKED/)?this.sortIndexUp:this.sortIndexDown)}else this.sortedIndex=null;Ra=0;d.match(/UP/)&&(Ra=k.length-1);var ea=1;d.match(/CENTER/)&&(ea=2);for(var cb=new point(0,0),Pb=null,Ga=null,Oa=null,Pa=null,ya=null,lc=null,Qb=Na=0,T=null,Mc=F,q=this.nClipParts&&this.nClipParts<k.length?k.length-this.nClipParts:0;q<k.length;q++){if(this.szShowParts){vb=!0;for(ia in this.szShowPartsA)this.szShowPartsA[ia]==q&&
(vb=!1);if(vb)continue}F=Mc;L=Math.abs(Ra-q);this.sortedIndex&&(L=this.sortedIndex[L].index);T=L;r=k[L];this.szFlag.match(/CLIP/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(r=this.nClipFrames==k.length?Number(k[this.nActualFrame]):k[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+k[k.length-1]*this.nActualFrame/(this.nClipFrames-1),L=this.nActualFrame,q=k.length);var za=r;d.match(/INVERT/)&&(0!=r||d.match(/ZEROISVALUE/))&&(r=this.nMax-r);d.match(/DIFFERENCE/)&&d.match(/SUM/)&&
(za=Na+=r);wa=this.formatValue(r,this.szValueDecimals||2);d.match(/OFFSETMEAN/)||d.match(/OFFSETMEDIAN/)?(d.match(/OFFSETMEAN/)&&(r*=100/this.nMeanA[L]),d.match(/OFFSETMEDIAN/)&&(r*=100/this.nMedianA[L]),r-=100,za=r=isFinite(r)&&!isNaN(r)?r:0,u=100,wa=this.formatValue(r,this.szValueDecimals||2),0<r&&(wa="+"+wa)):d.match(/DEVIATION/)&&(r=(r-this.nMeanA[L])/this.nDeviationA[L],za=r=isFinite(r)&&!isNaN(r)?r:0,r*=100,wa=this.formatValue(r,this.szValueDecimals||2),0<r&&(wa="+"+wa));var ha=this.colorScheme[L];
if((d.match(/SEQUENCE/)||1==k.length)&&2<=this.colorScheme.length)for(ha=this.colorScheme[this.partsA.length-1],ii=0;ii<this.partsA.length;ii++)if(r<this.partsA[ii].max){ha=this.colorScheme[ii];this.partsA[ii].nCount++;T=ii;break}d.match(/LEFT/)&&d.match(/HORZ/)&&(r=-r);0>r&&!d.match(/STACKED/)&&(ga=-r*F,r=-r);d.match(/VOLUME/)&&d.match(/3D/)?(F=1,r=this.szSizeField&&c?A=map.Scale.normalX(f/3*2)*Math.pow(1/this.nMaxSize*this.itemA[c].nSize,1/3):A=map.Scale.normalX(f/3*2)*Math.pow(1/u*r,1/3)):(d.match(/POINTER/)&&
d.match(/SIZE/)&&c&&(A=d.match(/WIDTH/)&&m&&(!(d.match(/DIFFERENCE/)||d.match(/RELATIVE/)||d.match(/FRACTION/))||d.match(/OFFSETMEAN/)||d.match(/OFFSETMEDIAN/)||d.match(/DEVIATION/))?map.Scale.normalX(f)*Math.pow(Math.abs(1/this.nMax100*m),.5):map.Scale.normalX(f)*Math.pow(Math.abs(1/u*r),1/3),P=.6*A,this.nValueSizeMin&&!d.match(/ZOOM/)&&(P=P*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?P:0),d.match(/ZOOM/)||(Ia=Math.pow(Math.abs(r),.5)/Math.pow(u,.5),this.szFadeValuePow&&Number(this.szFadeValuePow)&&
(Ia=Math.pow(Math.abs(r),Number(this.szFadeValuePow))/Math.pow(u,Number(this.szFadeValuePow))))),d.match(/DTEXT/)&&c&&!d.match(/ZOOM/)?(P=map.Scale.normalX(f/3*2)*Math.pow(Math.abs(1/u*r),.5)*.75,this.nValueSizeMin&&!d.match(/ZOOM/)&&(P=P*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?P:0),Ia=Math.pow(Math.abs(r),1/3)/Math.pow(u,1/3)):this.nValueSizeMin&&!d.match(/ZOOM/)&&(P=P*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?P:0));r=isFinite(r)&&!isNaN(r)?r:
0;if(0==r&&d.match(/NOZERO/))ga=0;else if(0>za&&d.match(/NONEGATIVE/))ga=0;else if(0<za&&d.match(/ONLYNEGATIVE/))ga=0;else{var S=map.Dom.newGroup(kc,"");e.setAttributeNS(szMapNs,"value","seechilds");this.szFlag.match(/MENUSIZE/)&&1==k.length&&!d.match(/VOLUME/)&&(A*=.8,r=A/F*1.7,map.Dom.newShape("rect",S,0,-map.Scale.normalY(.75*f),map.Scale.normalX(.5*f),map.Scale.normalY(.75*f),"fill:red;stroke:none;fill-opacity:0"));var ja=r;if(d.match(/COLUMN/))0<r*F&&(X=DonutCharts.newChart(SVGDocument,S,O+A/
2,0,A/2,0),X.setStyle("3D"),X.addStyle("SILENT"),X.addPart(100,r*F*2-(d.match(/SPACED/)?A/2:A/5),ha,0,(this.szAggregation&&this.szAggregation.match(/sum/),this.formatValue(k[ua],this.szValueDecimals||(5>k[ua]?1:0),"ROUND")+this.szUnit),this.formatValue(k[ua],2)+this.szUnit+ka),X.realize());else if(d.match(/3D/)){w=__maptheme_getChartColors(ha);if(d.match(/VOLUME/)&&Ga){var sa=(r*F-Ga)/15,ga=ga+sa,I="white",I="#444444",I=lc.borderColor;szFillColor=lc.mainColor;szFillOpacity=.3;Ga<r*F&&(szFillOpacity=
.2);map.Dom.newShape("line",S,Oa+ya,Pa-sa,O,ga-sa,"stroke:"+I+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",S,Oa+ya,Pa-Ga-sa,O,ga-r*F-sa,"stroke:"+I+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",S,Oa+ya+ya/3,Pa-ya/4-sa,O+A/3,ga-A/4-sa,"stroke:"+I+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",S,Oa+ya+ya/3,Pa-Ga-ya/4-sa,O+A/3,ga-r*F-A/4-sa,"stroke:"+I+";stroke-width:"+map.Scale.normalX(.25)+"");map.Dom.newShape("path",S,"M"+(Oa+ya)+
","+(Pa-sa)+" L "+O+","+(ga-sa)+" "+O+","+(ga-r*F-sa)+" "+(Oa+ya)+","+(Pa-Ga-sa)+" z","fill:"+szFillColor+";stroke:"+I+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:"+szFillOpacity);Ga-r*F>-A/4&&map.Dom.newShape("path",S,"M"+(Oa+ya)+","+(Pa-Ga-sa)+" L "+O+","+(ga-r*F-sa)+" "+(O+A/3)+","+(ga-r*F-A/4-sa)+" "+(Oa+ya+ya/3)+","+(Pa-Ga-ya/4-sa)+" z","fill:"+szFillColor+";stroke:"+I+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:"+szFillOpacity)}Ga=r*F;Oa=O;Pa=ga;ya=A;lc=w;if(ja=this.nFilterA[L]){var Cb=
"fill:#FFFFFF;stroke:gray;stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:0.1;stroke-opacity:0.1";map.Dom.newShape("path",S,"M"+O+",0 l "+A+",0 "+A/3+","+-A/4+" "+-A+" 0 z",Cb);map.Dom.newShape("rect",S,O+A/3,-ja*F/ea-A/4,A,ja*F,Cb);map.Dom.newShape("path",S,"M"+O+",0 l 0,"+-ja*F/ea+" "+A/3+","+-A/4+" 0,"+ja*F+" z",Cb);map.Dom.newShape("rect",S,O,-ja*F/ea,A,ja*F,Cb);map.Dom.newShape("path",S,"M"+(O+A)+",0 l 0,"+-ja*F/ea+" "+A/3+","+-A/4+" 0,"+ja*F+" z",Cb);w.highColor=ColorScheme.getDerivateColor(ha,
.9)}0>=ga||d.match(/LEFT/)||d.match(/VOLUME/)?(r&&(0==r&&(w=__maptheme_getChartColors("none")),map.Dom.newShape("rect",S,O,-r*F/ea,A,r*F,"fill:"+w.mainColor+";stroke:"+w.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:0.3"),map.Dom.newShape("path",S,"M"+(O+A)+",0 l 0,"+-r*F/ea+" "+A/3+","+-A/4+" 0,"+r*F+" z","fill:"+w.lowColor+";stroke:"+w.borderColor+";stroke-width:"+map.Scale.normalX(.05)+""),w.highColor=ColorScheme.getDerivateColor(ha,.9)),map.Dom.newShape("path",S,"M"+O+","+
-r*F/ea+" l "+A+",0 "+A/3+","+-A/4+" "+-A+" 0 z","fill:"+w.highColor+";stroke:"+w.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:1")):(map.Dom.newShape("path",S,"M"+O+",0 l "+A+",0 "+A/3+","+-A/4+" "+-A+" 0 z","fill:"+w.highColor+";stroke:"+w.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.2"),map.Dom.newShape("rect",S,O+A/3,-r*F/ea-A/4,A,r*F,"fill:"+w.mainColor+";stroke:"+w.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),map.Dom.newShape("path",
S,"M"+O+",0 l 0,"+-r*F/ea+" "+A/3+","+-A/4+" 0,"+r*F+" z","fill:"+w.lowColor+";stroke:"+w.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),w.highColor=ColorScheme.getDerivateColor(ha,.9),map.Dom.newShape("rect",S,O,-r*F/ea,A,r*F,"fill:"+w.mainColor+";stroke:"+w.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),map.Dom.newShape("path",S,"M"+(O+A)+",0 l 0,"+-r*F/ea+" "+A/3+","+-A/4+" 0,"+r*F+" z","fill:"+w.lowColor+";stroke:"+w.borderColor+";stroke-width:"+
map.Scale.normalX(.05)+";fill-opacity:0.4"),w.highColor=ColorScheme.getDerivateColor(ha,.9));ja&&(map.Dom.newShape("rect",S,O,-ja*F/ea,A,ja*F,"fill:#FFFFFF;stroke:none;stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.25"),ja>r?map.Dom.newShape("path",S,"M"+O+","+-ja*F/ea+" l "+A+",0 "+A/3+","+-A/4+" "+-A+" 0 z","fill:#8888FF;stroke:#444488;stroke-width:"+map.Scale.normalX(.1)+";fill-opacity:0.2"):map.Dom.newShape("path",S,"M"+O+","+-ja*F/ea+" l "+A+",0 "+A/3+","+-A/4+" "+-A+" 0 z","fill:#8888FF;stroke:"+
w.borderColor+";stroke-width:"+map.Scale.normalX(.1)+";fill-opacity:0.1;stroke-opacity:0.4"))}else if(d.match(/Border/)){map.Dom.newShape("rect",S,O,-r*F/ea,A,r*F,"fill:"+ha+";stroke:none;");var nb=O+2,ob=O+A-2,Db=2-r*F/ea,Rb=Db+r*F-2,w=__maptheme_getChartColors(ha);map.Dom.newShape("line",S,nb,Db,nb,Rb,"stroke:white;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:1.0");map.Dom.newShape("line",S,nb,Db,ob,Db,"stroke:white;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:1.0");map.Dom.newShape("line",
S,nb,Rb,ob,Rb,"stroke:black;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:0.9");map.Dom.newShape("line",S,ob,Db,ob,Rb,"stroke:black;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:0.9")}else if(d.match(/POINTER/)&&r){(d.match(/OFFSETMEAN/)||d.match(/OFFSETMEDIAN/)||d.match(/DEVIATION/))&&1E3<Math.abs(r*F)&&(F=(1E3+(Math.abs(r*F)-1E3)/10+Math.abs(r*F)%1E3)/Math.abs(r));var Eb="fill:"+ha+";fill-opacity:"+(this.fillOpacity||1)+";stroke:black;stroke-opacity:0.5;stroke-width:"+map.Scale.normalX(.25)+
"";0>=ga?(!this.fShadow&&this.fOrigShadow&&map.Dom.newShape("path",S,"M"+(O+A/7+10)+","+(-r*F/ea+10)+" l "+-A/7+",0 0,"+-A/15+" "+A/2+","+-A/3+" "+A/2+","+A/3+" 0,"+A/15+" "+-A/7+",0 0,"+r*F+" "+5*-A/7+",0 z","fill:000000;fill-opacity:0.5;stroke:none;"),map.Dom.newShape("path",S,"M"+(O+A/7)+","+-r*F/ea+" l "+-A/7+",0 0,"+-A/15+" "+A/2+","+-A/3+" "+A/2+","+A/3+" 0,"+A/15+" "+-A/7+",0 0,"+r*F+" "+5*-A/7+",0 z",Eb)):d.match(/NONEGATIVE/)||(d.match(/LEFT/)||(d.match(/ZOOM/)||d.match(/NORMSIZE/)?Eb="fill:"+
ha+";stroke:"+ha+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.5":2<this.partsA.length?(w=__maptheme_getChartColors(ha),Eb="fill:"+ha+";stroke:"+w.lowColor+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:"+(this.nFadeNegative||.1)+";stroke-opacity:0.8"):(w=__maptheme_getChartColors(ha),Eb="fill:"+ha+";stroke:"+w.highColor+";stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:"+(this.nFadeNegative||.1)+";stroke-opacity:1")),map.Dom.newShape("path",S,"M"+(O+A/7)+","+-r*F/ea+" l "+
5*A/7+",0 0,"+r*F+" "+A/7+",0 "+-A/2+","+A/4+" "+-A/2+","+-A/4+" "+A/7+",0 z",Eb))}else 0>=ga||d.match(/LEFT/)?map.Dom.newShape("rect",S,O,-r*F/ea,A,r*F,"fill:"+ha+";stroke:black;stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:0.1"):map.Dom.newShape("rect",S,O,-r*F/ea,A,r*F,"fill:"+ha+";stroke:"+ha+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.3"),(ja=this.nFilterA[L])&&(0>=ga||d.match(/LEFT/)?map.Dom.newShape("rect",S,O,-ja*F/ea,A,ja*F,"fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.5)+
";stroke-opacity:0.1"):map.Dom.newShape("rect",S,O,-ja*F/ea,A,ja*F,"fill:none;stroke:"+ha+";stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:0.3"));if((d.match(/VALUES/)||this.szXaxisA)&&!(0<ga&&d.match(/NONEGATIVE/))&&(d.match(/ZOOM/)||!this.szValueUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nValueUpper)){r||(r=0);if(d.match(/AXIS/)&&!d.match(/STACKED/)&&(this.szLabelA||this.szXaxisA)){var Ua=L,Kb=this.szXaxisA?this.szXaxisA[Ua]:this.szLabelA?this.szLabelA[Ua]:"",Bc=.8*P;d.match(/UP/)&&
(Bc=.9*P);var G=map.Dom.newText(S,0,0,mb+";fill:#666666;text-anchor:end;font-size:"+Bc+"px"," "+Kb+" "),V=new point(map.Scale.normalX(.8),A/2+P/5*2);this.fNegativeValues?G.setAttributeNS(null,"transform","translate("+(O+V.y)+","+(-V.x+.9*P+10)+") rotate(270)"):d.match(/CENTER/)?G.setAttributeNS(null,"transform","translate("+(O+V.y)+","+(map.Scale.normalX(f/2)+.9*P)+") rotate(270)"):d.match(/HORZ/)?G.setAttributeNS(null,"transform","translate("+(O+V.y)+","+(-V.x+.9*P+10)+") rotate(270)"):(G.style.setProperty("text-anchor",
"end",""),1==k.length?G.setAttributeNS(null,"transform","translate("+(O+(d.match(/VOLUME/)?1.3*A:1.5*V.y))+","+-V.x+") "):1<Kb.length?G.setAttributeNS(null,"transform","translate("+(O+V.y)+","+(-V.x+.8*P)+") rotate(315)"):G.setAttributeNS(null,"transform","translate("+(O+.1*V.y)+","+(-V.x+P)+")"))}if(d.match(/VALUES/)&&0<P&&!(this.nGridX&&2<this.partsA.length/this.nGridX)){Y=this.formatValue(za,this.szValueDecimals||(10>this.nMax?1:0));d.match(/POINTER/)&&0<za&&(0>this.nMin||d.match(/OFFSETMEAN/)||
d.match(/OFFSETMEDIAN/))&&(Y="+"+Y);d.match(/VOLUME/)||(Y+=this.szUnit?" "+this.szUnit+" ":"");!d.match(/STACKED/)||0==za||m||this.nGridX||(Y=Y+" ("+Math.round(za/z*100)+"%)");var Sb=Y.length*P*4/8,G=this.createTextLabel(SVGDocument,S,"",Y,P/map.Scale.normalX(1),null,0<za&&(d.match(/CTEXT/)||d.match(/VALUEBACKGROUND/))?ha:null,this.szTextColor);G.style.setProperty("opacity",String(Ia),"");var mc=Ha=null;this.szXaxisA&&d.match(/EXACT/)&&!d.match(/AXIS/)&&(mc=map.Dom.newTSpan(G,"fill:fill:#444444;font-size:"+
P+"px"," "+this.szXaxisA[q]));var pb=G.fu.getBox().width,V=new point(map.Scale.normalX(-4),A/2+.15*P),Cc=!0;if(d.match(/DOINLINETEXT/)&&!d.match(/ZOOM/)&&!d.match(/NORMSIZE/)||!d.match(/VALUE/)||d.match(/VOLUME/)&&!d.match(/ZOOM/)||!(d.match(/THIN/)||d.match(/NOINLINETEXT/)||d.match(/DTEXT/)||d.match(/SIZE/)||pb+map.Scale.normalX(1)>r*F/ea||d.match(/STACKED/)||d.match(/NORMSIZE/)||d.match(/ZOOM/))){w=__maptheme_getChartColors(ha);G.removeChild(G.firstChild);G.firstChild.style.setProperty("fill",w.textColor,
"");mc&&mc.style.setProperty("fill",w.textColor,"");Ha&&Ha.parentNode.removeChild(Ha);var Nc=map.Scale.normalX(0),db=map.Scale.normalY(.5);d.match(/VOLUME/)?(M=r*F/(pb+map.Scale.normalX(2)),G.parentNode.removeChild(G),G=map.Dom.newText(S,O+r*F/2,P*M/4-r*F/2,"font-family:arial;font-size:"+P*M+"px;text-anchor:middle;fill:"+w.textColor+";opacity:"+va+";stroke:none;pointer-events:none",Y)):(M=Math.min(1,r*F/pb),.33>M?G.parentNode.removeChild(G):(0<za&&(V.x+=r*F-(pb+map.Scale.normalX(3))*M),db/=M,G.firstChild.style.setProperty("font-size",
String(P*M)),G.firstChild.setAttributeNS(null,"transform","translate("+(O+V.y-db)+","+(-V.x-Nc)+") rotate(270)\t")));cb.x=Math.max(0,cb.x-r*F)}else if(Cc=!1,d.match(/STACKED/))if(0!=r||d.match(/ZEROISVALUE/)){V.x=0;d.match(/3D/)&&(V.x+=A/4,V.y+=A/3);var Tb=r*F/(d.match(/SUM/),2);cb.x=Math.max(0,cb.x+(.75*P-Tb));var Ub=new point(cb.x+V.x+Tb-P/3,0),Qa=map.Scale.normalX(1.5),Va=O+V.y+A/3,Wa=O+V.y+7*A/8,Xa=-V.x-Tb,Ya=-Ub.x-P/3;if(this.nGridX&&Qb<this.nGridX){V.y-=2*A+G.fu.getBox().width;var Oc=Wa,Wa=
Va-(d.match(/3D/)?1.5*A:1.4*A),Va=Oc-(d.match(/3D/)?7*A/4:1.4*A);d.match(/3D/)&&(Xa+=A/5,Ya+=A/5,Ub.x-=A/7);Qa=-Qa}G.setAttributeNS(null,"transform","translate("+(O+V.y+A+Qa-P)+","+(-Ub.x-.25*P)+") ");var nc=map.Dom.newGroup(S,""),oc=map.Dom.newGroup(S,"");map.Dom.newShape("line",nc,Va,Xa,Va+Qa,Xa,"stroke-width:"+map.Scale.normalX(1.5)+";stroke:white;opacity:0.2;");map.Dom.newShape("line",oc,Va,Xa,Va+Qa,Xa,"stroke-width:"+map.Scale.normalX(.5)+";stroke:#888888;");map.Dom.newShape("line",nc,Va+Qa,
Xa,Wa,Ya,"stroke-width:"+map.Scale.normalX(1.5)+";stroke:white;opacity:0.2;stroke-linecap:round;");map.Dom.newShape("line",oc,Va+Qa,Xa,Wa,Ya,"stroke-width:"+map.Scale.normalX(.5)+";stroke:#888888;");map.Dom.newShape("line",nc,Wa,Ya,Wa+Qa,Ya,"stroke-width:"+map.Scale.normalX(1.5)+";stroke:white;opacity:0.2;");map.Dom.newShape("line",oc,Wa,Ya,Wa+Qa,Ya,"stroke-width:"+map.Scale.normalX(.5)+";stroke:#888888;");cb.x=Math.max(0,cb.x+(2*P/3-(r*F-Tb)))}else G.parentNode.removeChild(G);else{V.x+=A/4;d.match(/3D/)&&
(V.x+=A/4,V.y=.3*A+P/2);d.match(/POINTER/)&&0<za&&(V.x+=.25*A);var Za=r;pb+map.Scale.normalX(1)>(ja-r)*F/ea&&(Za=Math.max(r,ja),ja>r&&(Za+=A/F*.2,map.Dom.newShape("line",S,O+.6*A,-V.x-r*F/ea+A/3,O+.6*A,-V.x-ja*F/ea-.4*A,"stroke:white;")));d.match(/VOLUME/)&&(Za+=A/5);if(1!=k.length||d.match(/HORZ/)||d.match(/VOLUME/))d.match(/VOLUME/)?G.setAttributeNS(null,"transform","translate("+(O+V.y)+","+(-V.x-Za*F/ea)+")  scale(0.9,0.9)"):G.setAttributeNS(null,"transform","translate("+(O+V.y)+","+(-0-Za*F/ea)+
") rotate(270) scale(0.9,0.9)");else{if(d.match(/ZOOM/)||d.match(/NORMSIZE/)){V.y+=d.match(/3D/)?.75*A:.5*A;var Pc=Math.min(0,.55*P-r*F),Dc=P;!d.match(/3D/)&&!d.match(/ZOOM/)||d.match(/SIZE/)||(Dc=0);G.setAttributeNS(null,"transform","translate("+(O+Dc)+","+(Pc-.5*P)+")")}else V.y+=d.match(/3D/)?d.match(/VOLUME/)?.75*A:.6*A:.2*A,G.setAttributeNS(null,"transform","translate("+(O-.8*A)+","+(-Za*F/ea-.8*P-(d.match(/POINTER/)&&0<za?.3*A:0))+")");0>za&&G.style.setProperty("opacity",String(.75*Ia),"")}G.style.setProperty("fill",
"#404040","")}}}null!=h&&q==h&&(D=2*P,w=__maptheme_getChartColors(ha),map.Dom.newShape("path",S,"M5,0 l 35,-45 -25,0 0,-30 -20,0 0,30 -25,0 35,45","fill:#404040;stroke:white;stroke-width:"+map.Scale.normalX(.2)+"").fu.setPosition(q*(A+1.5)+.5*A,-r*F+(Cc?-map.Scale.normalX(3):-pb-map.Scale.normalX(5.5))));d.match(/TRENDLINE/)&&(db=Math.min(r*F/2,map.Scale.normalY(1.5)),w=__maptheme_getChartColors(ha),I=w.lowColor,D=P/5,0<q&&(nb=(q-1)*(A+(d.match(/SPACED/)?A/5:1))+A/2,ob=q*(A+(d.match(/SPACED/)?A/5:
1))+A/2,I="white",I=Pb>r?"#CC3333":Pb<r?"#22BB22":w.lowColor,map.Dom.newShape("line",S,nb,-Pb*F+db,ob,-r*F+db,"stroke:#666666;stroke-width:"+map.Scale.normalX(1/k.length*1.2)+";opacity:0.8")),map.Dom.newShape("circle",S,0,0,D,"fill:"+I+";stroke:none;opacity:0.8").fu.setPosition(q*(A+(d.match(/SPACED/)?A/5:0))+A/2,-r*F+db));d.match(/SILENT/)||(this.szFlag.match(/SEQUENCE/)?S.setAttributeNS(szMapNs,"tooltip",wa+" ("+(this.szLabelA?this.szLabelA[T]:"")+") ["+this.szFieldsA[L]+"]"):(ka=this.szFieldsA[L],
this.szLabelA&&this.szLabelA[L]&&(ka=this.szLabelA[L]),!z||this.szField100&&!this.szFlag.match(/FRACTION/)||(wa=wa+" ("+this.formatValue(100/z*r,2)+"%)"),S.setAttributeNS(szMapNs,"tooltip",wa+this.szUnit+" "+ka+"")));d.match(/FADEIN/)&&(2==k.length&&0==q?S.style.setProperty("opacity","0.6",""):d.match(/NORMSIZE/)||(ma=d.match(/FADEINP4/)?10:3,S.style.setProperty("opacity",String(.1+.9*Math.pow(q+1,ma)/Math.pow(k.length,ma)),"")));d.match(/FADENEGATIVE/)&&0>za&&S.style.setProperty("opacity","0.5",
"");S.setAttributeNS(szMapNs,"class",String(T));S.fu.setPosition(0,ga);d.match(/STACKED/)?ga-=r*F:(ga=0,O+=A,d.match(/VOLUME/)&&d.match(/SPACED/)?O+=A/(2==k.length?2:4):d.match(/SPACED/)?O+=A/5:d.match(/UP/)||(O+=1));Qb++;d.match(/STACKED/)&&!d.match(/MULTI/)&&this.nGridX&&0==Qb%this.nGridX&&(ga=0,O+=A+A/20);Pb=r}}d.match(/HOR/)&&kc.setAttributeNS(null,"transform","rotate(90) translate("+-O+",0)");J.y=0;J.x=0;d.match(/HOR/)?(J.y-=1*A/2,d.match(/3D/)&&(J.y-=1*A/3)):d.match(/STACKED/)?J.x=A/2:d.match(/Up/)||
d.match(/HOR/)?J.x=0:J.x=A*Qb/2;d.match(/MENUSIZE/)&&(J.x+=A*(d.match(/HORZ/)?1:0),J.y+=A*(d.match(/HORZ/)?.3:0),J.y+=A*(d.match(/HORZ/)&&d.match(/3D/)?1:d.match(/VOLUME/)?.3:.6));this.nRealizedCount++;var pc=map.Dom.newGroup(B,"");pc.appendChild(kc);d.match(/ZOOM/)&&(M=240/P/(1<k.length?2:1),pc.fu.scale(M,M));pc.fu.setPosition(B.fu.getPosition().x-J.x,-J.y);J.x=0;J.y=0;d.match(/HOR/)&&(J.y=1*A/2)}if(d.match(/EXTEND/)&&HTMLWindow.ixmaps.htmlgui_drawChartAfter)try{qb=this.objThemesA[this.szThemesA[0]],
HTMLWindow.ixmaps.htmlgui_drawChartAfter(SVGDocument,{target:B,theme:this,item:c,values:k,maxSize:f,flag:d,mark:h,dbRecord:qb.dbRecords?qb.dbRecords[this.itemA[c].dbIndex]:null})}catch(Tc){}if(!d.match(/NORMSIZE/)){var Ca=new point(J.x,J.y);J.y=0;J.x=0;this.szAlign&&!d.match(/PLOT/)&&(this.szAlign.match(/center/)&&(J.y=0),this.szAlign.match(/top/)&&(J.y=Ca.y?Ca.y:map.Scale.normalX(f/5)),this.szAlign.match(/above/)&&(J.y=Ca.y?Ca.y:map.Scale.normalX(f/2)),this.szAlign.match(/2above/)&&(J.y+=map.Scale.normalX(f/
2)),this.szAlign.match(/below/)&&(J.y=-(Ca.y?Ca.y:map.Scale.normalX(f/2))),this.szAlign.match(/2below/)&&(J.y-=map.Scale.normalX(f/2)),this.szAlign.match(/bottom/)&&(J.y=-(Ca.y?Ca.y:map.Scale.normalX(f/2))),this.szAlign.match(/2bottom/)&&(J.y-=map.Scale.normalX(f/2)),this.szAlign.match(/right/)&&(J.x=-(Ca.y?Ca.y:map.Scale.normalX(f/2))),this.szAlign.match(/2right/)&&(J.x-=map.Scale.normalX(f/2)),this.szAlign.match(/left/)&&(J.x=Ca.y?Ca.y:map.Scale.normalX(f/2)),this.szAlign.match(/2left/)&&(J.x+=
map.Scale.normalX(f/2)),this.szAlign.match(/baseline/)&&(J.y+=map.Scale.normalY(f/5)))}if(c&&this.szLabelField&&!d.match(/NORMSIZE/)&&!d.match(/ZOOM/)&&(!this.nLabelUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nLabelUpper)){var ka=(ka=this.itemA[c].szLabel)?isNaN(__scanValue(ka))?ka+(this.szLabelUnits||""):this.formatValue(__scanValue(ka),2)+(this.szLabelUnits||""):this.szLabelField+"?",P=map.Scale.normalX(6),mb="opacity:0.7;font-family:arial;font-size:"+P+"px;text-anchor:middle;fill:#000000;pointer-events:none",
Qc="opacity:1;fill:white;fill-opacity:0.4;stroke:#000000;stroke-width:"+map.Scale.normalX(1)+"pointer-events:none;",Sb=(ka.length+2)*P*.5,$a=map.Dom.newGroup(B,"");$a.parentNode.insertBefore($a,$a.parentNode.firstChild);d.match(/MULTI/)||$a.setAttributeNS(szMapNs,"class",String(T));var Vb=map.Dom.newShape("rect",$a,-Sb/2,.95*-P,Sb,1.2*P,Qc);Vb.setAttributeNS(null,"rx",.2*P);Vb.setAttributeNS(null,"ry",.2*P);G=map.Dom.newText($a,0,0,mb,ka);Ac=G.fu.getBox();A=Math.max(Ac.width,Sb);Vb.setAttributeNS(null,
"x",-A/2);Vb.setAttributeNS(null,"width",A);$a.fu.setPosition(A/3,P/1.5+Ca.y);this.itemA[c].labelGroup=$a}if(d.match(/MENU/)){var Wb=B.fu.getBox();B.fu.setPosition(-Wb.x-Wb.width/2,-Wb.y-Wb.height/2-map.Scale.normalY(f/2)-map.Scale.normalY(2))}else B.fu.setPosition(B.fu.getPosition().x-J.x,B.fu.getPosition().y-J.y);if(d.match(/ZOOM/)){var qc=map.Dom.getBox(e);qc.height>map.Scale.normalY(150)&&(M=Math.min(1,map.Scale.normalY(150)/qc.height),M=Math.max(M,map.Scale.normalY(30)/qc.height),B.fu.scale(M,
M),K&&K.fu.scale(M,M))}J.x=0;J.y=0;c&&(this.itemA[c].fDone=!0);return J};MapTheme.prototype.getShapes=function(){var e=map.Layer.getLayerObj(this.szThemesA[0]);if(!e||!e.szFlag.match(/tiled/))for(a in this.itemA)this.parent.themeNodesA[a]||(this.parent.themeNodesA[a]=this.getShapeA(a))};MapTheme.prototype.getItemNodes=function(e){this.parent.themeNodesA[e]&&this.parent.themeNodesA[e].length||(this.parent.themeNodesA[e]=this.getShapeA(e));return this.parent.themeNodesA[e]||[]};
MapTheme.prototype.getShapeA=function(e){e=__mpap_decode_utf8(e);return(e=SVGDocument.getElementById(e.trim()))?Array(e):[]};MapTheme.prototype.getPositions=function(){for(a in this.itemA)this.getNodePosition(this.itemA[a].szSelectionId)};
MapTheme.prototype.getNodePosition=function(e){if("undefined"==typeof e)return null;var c=this.nGridWidth||this.szAggregationField?this.themeNodesPosA:this.parent.themeNodesPosA;if(!c[e]){if(e.match(/:clone/))return null;if(e.match(/(-?[0-9\.]+) ?, ?(-?[0-9\.]+)/)){var f=this.getMapPosition(e);c[e]=new point(f.x,f.y);return c[e]}this.parent.themeNodesA[e]||(this.parent.themeNodesA[e]=this.getShapeA(e));f=this.parent.themeNodesA[e][0];if(1<this.parent.themeNodesA[e].length)for(var d=parseFloat(f.getAttributeNS(szMapNs,
"area")),h=1;h<this.parent.themeNodesA[e].length;h++){var g=this.parent.themeNodesA[e][h],l=parseFloat(g.getAttributeNS(szMapNs,"area"));l>d&&(d=l,f=g)}f&&(this.szShapeType.match(/line/)?d=map.Dom.getBox(f):((d=f.getAttributeNS(szMapNs,"center"))||(d=f.parentNode.getAttributeNS(szMapNs,"center")),d&&2<d.length?(d=d.split(","),d=new box(Number(d[0].split(":")[1]),Number(d[1].split(":")[1]),0,0)):d=map.Dom.getBox(f)),f=map.Scale.getMapOffset(f),c[e]=new point(f.x+d.x+d.width/2,f.y+d.y+d.height/2))}return c[e]&&
"undefined"!=typeof c[e].x&&"undefined"!=typeof c[e].y?c[e]:null};
MapTheme.prototype.getNodeBox=function(e){if("undefined"==typeof e)return null;if(!this.parent.themeNodesBoxA[e]){if(e.match(/:clone/))return null;this.parent.themeNodesA[e]||(this.parent.themeNodesA[e]=this.getShapeA(e));var c=this.parent.themeNodesA[e][0];if(1<this.parent.themeNodesA[e].length)for(var f=parseFloat(c.getAttributeNS(szMapNs,"area")),d=1;d<this.parent.themeNodesA[e].length;d++){var h=this.parent.themeNodesA[e][d],g=parseFloat(h.getAttributeNS(szMapNs,"area"));g>f&&(f=g,c=h)}c&&(f=
map.Dom.getBox(c),c=map.Scale.getMapOffset(c),this.parent.themeNodesBoxA[e]=new box(c.x+f.x,c.y+f.y,f.width,f.height))}return this.parent.themeNodesBoxA[e]};MapTheme.prototype.getNodeArea=function(e){return(e=this.getItemNodes(e)[0])?Number(e.getAttributeNS(szMapNs,"area"))/1E6:0};positionRegExp=/(-?[0-9\.]+) ?, ?(-?[0-9\.]+)/;
MapTheme.prototype.getMapPosition=function(e){if(e){var c=null;if(e&&(c=e.match(positionRegExp)))return map.Scale.getMapPositionOfLatLon(parseFloat(c[1]),parseFloat(c[2])),map.Scale.getMapPositionOfLatLon(parseFloat(c[1]),parseFloat(c[2]))}return new point(0,0)};MapTheme.prototype.onClick=function(e){this.fRemove||(this.widgetNode&&this.enable(),this.fToFront=!0,executeWithMessage("map.Themes.execute()","... processing ..."),map.Themes.onclickInfo(e,this.szId))};
MapTheme.prototype.showErrorInfo=function(){if(0!=this.nMissingPositionCount){var e=this.szId+":errordisplay:widget",c=map.Dictionary.getLocalText("Chart statistic"),c=new InfoContainer(SVGDocument,this.widgetNode,e+":movable",new point(map.Scale.normalX(0),map.Scale.normalX(0)),new point(-map.Scale.normalX(15),map.Scale.normalX(80)),"fixed",c),f=c.workspaceNode,d=[map.Dictionary.getLocalText("total items"),map.Dictionary.getLocalText("charts drawn"),map.Dictionary.getLocalText("missing positions"),
map.Dictionary.getLocalText("missing value match"),map.Dictionary.getLocalText("zero values"),String(this.nCount),String(this.nRealizedCount),String(this.nMissingPositionCount),String(this.nMissingRangeCount),String(this.nZeroValueCount)],f=map.Dom.newGroup(f,"");f.fu.setPosition(0,map.Scale.normalY(3));createTextGrid(SVGDocument,f,e+":textgrid",d,2);c.reformat()}};
MapTheme.prototype.getDataGrid=function(e,c){var f=map.Themes.getDataRow(e,this);if(f&&f.length){for(var d=0;d<f.length;d++)f[d]=f[d]||"---";(d=new ScrollArea(null,c,null,10,10,10))?(d.reformat(),gridGroup=d.workspaceNode):gridGroup=c;for(var h=[],g=map.Themes.getFieldIndexArray(this),l=0;l<g.length;l++)h[g[l]]="font-weight:bold;fill:#087BBB",h[g[l+f.length/2]]="font-weight:bold;fill:#087BBB";f=createTextGrid(SVGDocument,gridGroup,":textgrid",f,2,12,h);return d?(d.setWidth(Math.min(f.fu.getBox().width/
map.Scale.normalX(1)+15,map.Scale.bBox.width/map.Scale.normalY(2.2))),d.setHeight(Math.min(f.fu.getBox().height/map.Scale.normalY(1)+15,map.Scale.bBox.height/map.Scale.normalY(2.2))),d.reformat(),d.hasScrollBars()&&d.setScrollPosition(new point(0,0)),d):f.fu}};function __sortYposUp(e,c){return e.y>c.y?1:-1}function __sortYposDown(e,c){return e.y<c.y?1:-1}
MapTheme.prototype.drawTextforOneQuadrant=function(e,c,f,d,h,g,l,k){var m=e.szStyle.match(/3D/)?2.4*f:1.2*f,u=m/2;k-=m*(c.length-2);for(i=0;i<c.length;i++){var z=c[i].y/c[i].ly,q=Math.max(u,Math.min(c[i].y,k)),u=q+m;k+=f;var y=1.2*c[i].x,y=l+map.Scale.normalX(2);q>c[i].y&&(z=Math.max(z,q/c[i].y));var r=e.mX+c[i].lx*h,D=e.mY+c[i].ly*g,w=e.mX+c[i].x*h,C=e.mY+c[i].y*g,y=e.mX+y*h,q=e.mY+q*g,B=map.Dom.newGroup(e.frameGroup,"");e.donutPartsA[c[i].index].textNode=B;var J=map.Dom.newGroup(B,""),K=map.Dom.newGroup(B,
"");z&&(map.Dom.newShape("line",J,r,D,w,C,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;"),map.Dom.newShape("line",K,r,D,w,C,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;"),r=w,D=C);c[i].x<l-map.Scale.normalX(3)&&(map.Dom.newShape("line",J,r,D,e.mX+(l-map.Scale.normalX(3))*h,D,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;stroke-linecap:round;"),map.Dom.newShape("line",K,r,D,e.mX+(l-map.Scale.normalX(3))*h,D,"stroke:#888888;stroke-width:"+
map.Scale.normalX(.5)+";opacity:1;"),r=e.mX+(l-map.Scale.normalX(3))*h);map.Dom.newShape("line",J,r,D,y,q,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;stroke-linecap:round;");map.Dom.newShape("line",K,r,D,y,q,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;");r=y;y+=map.Scale.normalX(2)*h;map.Dom.newShape("line",J,r,q,y,q,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;");map.Dom.newShape("line",K,r,q,y,q,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+
";opacity:1;");y+=map.Scale.normalX(1.5)*h;(szText=e.partsA[c[i].index].szText?e.partsA[c[i].index].szText:null)||(szText=e.partsA[c[i].index].szInfo?e.partsA[c[i].index].szInfo:Math.round(10*e.partsA[c[i].index].nInfoValue)/10+" % ");z=this.createTextLabel(SVGDocument,B,"",szText,f/map.Scale.normalX(1),d,e.partsA[c[i].index].color,this.szChartFlag.match(/ZOOM/)?null:this.szTextColor);z.fu.setPosition(y-f,q-0*f);z.setAttributeNS(szMapNs,"tooltip",e.partsA[c[i].index].szInfo);e.szStyle.match(/3D/)&&
z.fu.scale(1,2)}};
MapTheme.prototype.drawDonutText=function(e,c){var f=0,d=0,h=0,g=[],l=[],k=[],m=[];for(i=0;i<this.partsA.length;i++){var u=e.getTextPosition(i);if(u){if(this.szShowPartsA){var z=!1;for(p in this.szShowPartsA)this.szShowPartsA[p]==i&&(z=!0);if(!z)continue}f=Math.max(f,Math.abs(u.y));d=Math.max(d,u.x);h=Math.min(h,u.x);e.szStyle.match(/STARBURST/)?(d=Math.max(d,u.x),h=Math.min(h,u.x)):(d=e.nRadOuter,h=-e.nRadOuter);0<u.x?0<u.y?l[l.length]={index:i,x:u.x,y:u.y,lx:u.lx,ly:u.ly}:g[g.length]={index:i,x:u.x,
y:-u.y,lx:u.lx,ly:-u.ly}:0<u.y?k[k.length]={index:i,x:-u.x,y:u.y,lx:-u.lx,ly:u.ly}:m[m.length]={index:i,x:-u.x,y:-u.y,lx:-u.lx,ly:-u.ly}}}g.sort(__sortYposUp);l.sort(__sortYposUp);k.sort(__sortYposUp);m.sort(__sortYposUp);c||(c=map.Scale.normalX(12));this.drawTextforOneQuadrant(e,g,c,"text-anchor:start;",1,-1,d,f);this.drawTextforOneQuadrant(e,l,c,"text-anchor:start;",1,1,d,f);this.drawTextforOneQuadrant(e,k,c,"text-anchor:end;",-1,1,-h,f);this.drawTextforOneQuadrant(e,m,c,"text-anchor:end;",-1,-1,
-h,f)};
MapTheme.prototype.createTextLabel=function(e,c,f,d,h,g,l,k){var m="#555555",u=!0,z=!0,q=1,y=" "+this.szChartFlag+"|"+this.szFlag;if(y.match(/ZOOM/)||y.match(/MENUSIZE/)||y.match(/NORMSIZE/)||y.match(/INFOSIZE/)||y.match(/AXIS/)||y.match(/SELECTION/))u=l?u:!1,z=!1;y.match(/VALUEBACKGROUND/)&&(u=!0);h||(h=12);g||(g="");l&&u?(m=k||ColorScheme.getTextColor(l),q=y.match(/ZOOM/)?.9:.5):(l="#fefeff",m=0>Number(d)?"#ee3333":m);if(e&&c)return e=map.Dom.newGroup(c,f),c=null,z&&!this.fShadow&&this.fOrigShadow&&(c=
map.Dom.newShape("rect",e,1,1,1,1,"fill:#444444;fill-opacity:0.4;stroke:none;")),l=map.Dom.newShape("rect",e,1,1,1,1,"fill:"+l+";fill-opacity:"+q+";stroke:#dddddd;stroke-width:"+map.Scale.normalX(.2)+""),g=map.Scale.tStyle.Values.szStyle+(this.szTextFont?"font-family:"+this.szTextFont:"")+";font-size:"+map.Scale.normalY(h)+"px;fill:"+m+";"+g,d=map.Dom.newText(e,map.Scale.normalX(h),map.Scale.normalY(.25*h),g,d),d=map.Dom.getBox(d),l.setAttributeNS(null,"rx",map.Scale.normalX(1)),l.setAttributeNS(null,
"ry",map.Scale.normalX(1)),l.setAttributeNS(null,"x",d.x-map.Scale.normalX(.3*h)),l.setAttributeNS(null,"y",d.y-map.Scale.normalY(0*h)),l.setAttributeNS(null,"width",d.width+map.Scale.normalX(.7*h)),l.setAttributeNS(null,"height",d.height+.1*map.Scale.normalY(h)),c&&(c.setAttributeNS(null,"rx",map.Scale.normalX(1)),c.setAttributeNS(null,"ry",map.Scale.normalX(1)),c.setAttributeNS(null,"x",d.x-map.Scale.normalX(.3*h)+map.Scale.normalX(1+.02*h)),c.setAttributeNS(null,"y",d.y+map.Scale.normalY(0*h)+
map.Scale.normalY(1+.02*h)),c.setAttributeNS(null,"width",d.width+map.Scale.normalX(.7*h)),c.setAttributeNS(null,"height",d.height+.1*map.Scale.normalY(h))),u||(l.style.setProperty("display","none",""),c&&c.style.setProperty("display","none","")),e};
MapTheme.prototype.getOverviewChart=function(e,c){e.fu=new Methods(e);var f=30;this.szChartFlag+="|MENUSIZE";if(this.szOverviewChart&&"NONE"!=this.szOverviewChart&&this.nCount){var f=map.Scale.normalX(100),d=map.Scale.normalY(100),h=map.Scale.normalX(75),g=map.Scale.normalX(50);if("undefined"!=typeof DonutCharts){var l=map.Dom.newGroup(e),f=DonutCharts.newChart(SVGDocument,l,f,d,h,g);this.szOverviewChart.match(/PIE/)&&(f.setStyle("flat"),f.setRadInner(0),f.setRadOuter(map.Scale.normalX(55)),f.setCenter(map.Scale.normalX(80),
map.Scale.normalY(55)));if(this.szOverviewChart.match(/DONUT/)||this.szOverviewChart.match(/3D/))f.setStyle("3D"),f.setCenter(map.Scale.normalX(80),map.Scale.normalY(100));f.setLine("white");f.setLineWidth(map.Scale.normalX(.1));d=map.Scale.normalY(20);for(h=0;h<this.partsA.length;h++){g=this.partsA[h].nCount/this.nCount*100;l=100/this.nSum*this.partsA[h].nSum;this.nRealizedCount&&this.szFlag.match(/CHART/)&&(g=this.partsA[h].nCount/this.nRealizedCount*100);this.nExactCount&&this.exactSizeA&&(g=this.partsA[h].nCount/
this.nExactCount*100,l=this.exactSizeA[h]);this.szOverviewChart.match(/DONUT/)&&(d=map.Scale.normalY(this.partsA[h].nSum/this.nSum*80));var k=String(this.partsA[h].nCount),m=g?String(" = "+this.formatValue(g,1)+" %"):"",u=l?String(", "+this.formatValue(l,1)+" % of value"):"";this.szOverviewChart.match(/PERCENTOFVALUE/)?(g=l,m="",k=String(this.formatValue(g,1)+(this.szFlag.match(/CHART/)?this.szUnit:" %"))):this.szOverviewChart.match(/DONUT/)||(u="");this.szFlag.match(/EXACT/)?(m+=" ("+this.szLabelA[h]+
")",u=""):this.szLegendLabelA&&this.szLegendLabelA.length&&(m+=" ["+this.szLegendLabelA[h]+"])");f.addPart(g,d,this.partsA[h].color,0,k,String(this.partsA[h].nCount)+" member(s)"+m+u,"map.Themes.markClass(evt,'"+this.szId+"','"+h+"')","map.Themes.unmarkClass(evt,'"+this.szId+"')")}f.realize();this.drawDonutText(f);f=map.Dom.getBox(e);if(0<f.width&&0<f.height){u=e.fu.getPosition();l=this.szOverviewChart.match(/PERCENTOFVALUE/)?"*  value / class":"*  members / class";d=map.Scale.normalY(10);if(this.szOverviewChart.match(/DONUT/)||
this.szOverviewChart.match(/3D/))d=map.Scale.normalY(15);map.Dom.newText(e,map.Scale.normalX(80),f.y+f.height+d,map.Scale.tStyle.Note.szStyle+";text-anchor:middle;",l)}}}else{if((this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/SYMBOL/))&&(!this.szFlag.match(/EXACT/)||!this.szFlag.match(/SYMBOL/))){h=this.nMinA[0];k=this.nMaxA[0];this.szSizeField&&(h=this.nMinSize,k=this.nMaxSize);d=map.Scale.normalX(f/2);g=d/Math.sqrt(k)*Math.sqrt(h);this.szFlag.match(/LINEAR/)&&(g=d/
k*h);l=this.szFlag.match(/SUM/)?"sum":"mean";nLinePos=5;nXPos=20;m=map.Dom.newGroup(e);if(!this.szFlag.match(/EXACT/)){var z=map.Dom.newGroup(m);this.drawChart(z,null,1.5*f,"VALUES|ZOOM|NORMSIZE");this.szFlag.match(/SEQUENCE/)&&(sChartBox=map.Dom.getBox(z),u=z.fu.getPosition(),z.fu.setPosition(sChartBox.width/1.5+u.x,-sChartBox.height/2+u.y),u=map.Scale.normalX(7*f)/sChartBox.height,z.fu.scale(u,u),f*=7);map.Dom.newText(m,map.Scale.normalX(0),map.Scale.normalY(5),map.Scale.tStyle.Note.szStyle+";text-anchor:left;",
map.Dictionary.getLocalText(l));m.fu.setPosition(map.Scale.normalX(nXPos),map.Scale.normalY(f));nLinePos=f+15}this.szFlag.match(/SEQUENCE/)||(l=map.Dom.newGroup(e),sumBox=map.Dom.getBox(m),l.fu.setPosition(sumBox.x+sumBox.width+map.Scale.normalX(.66*f),map.Scale.normalY(-5)),nLinePos=0,m="fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.25)+"px",u=map.Dom.newGroup(l),this.szFlag.match(/BUBBLE/)?map.Dom.newShape("circle",u,0,0,d,m):this.szFlag.match(/SQUARE/)&&map.Dom.newShape("rect",u,-d,
-d,2*d,2*d,m),map.Dom.newShape("line",u,0,-d,1.1*d,-d,m),map.Dom.newText(u,1.1*d+map.Scale.normalX(2),-d,"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-10%;fill:black;stroke:none;pointer-events:none",this.formatValue(k,1)+this.szUnit),u.fu.setPosition(map.Scale.normalX(nXPos),map.Scale.normalY(nLinePos+f/2)),0<g&&g!=d&&(k=map.Dom.newGroup(l),this.szFlag.match(/BUBBLE/)?map.Dom.newShape("circle",k,0,0,g,m):this.szFlag.match(/SQUARE/)&&map.Dom.newShape("rect",
k,-g,-g,2*g,2*g,m),map.Dom.newShape("line",k,0,-g,1.1*d,-g,m),map.Dom.newText(k,1.1*d+map.Scale.normalX(2),-g,"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-60%;fill:black;stroke:none;pointer-events:none",this.formatValue(h,1)+this.szUnit),k.fu.setPosition(map.Scale.normalX(nXPos),map.Scale.normalY(nLinePos)+2*d-g)),map.Dom.newText(l,map.Scale.normalX(nXPos),map.Scale.normalY(nLinePos+f+15),map.Scale.tStyle.Note.szStyle+";text-anchor:left;",map.Dictionary.getLocalText("min / max size-values")));
e.fu.scale(1,1)}this.szFlag.match(/CHART/)&&this.szFlag.match(/BUFFER/)&&(d=map.Scale.normalX(f/2),h=map.Dom.getBox(e.parentNode),h=0<h.width?h.width/map.Scale.normalX(1)+10:10,u=map.Dom.newGroup(e.parentNode),map.Dom.newShape("circle",u,0,0,d,"fill:none;stroke:black;"),m="fill:none;stroke:black;stroke-width:"+map.Scale.normalX(1)+";",map.Dom.newShape("line",u,0,0,d,0,m),map.Dom.newShape("line",u,0,map.Scale.normalY(-2),0,map.Scale.normalY(2.5),m),map.Dom.newShape("line",u,d,0,d+map.Scale.normalX(-3),
map.Scale.normalY(-3),m),map.Dom.newShape("line",u,d,0,d+map.Scale.normalX(-3),map.Scale.normalY(3),m),map.Dom.newText(u,1.1*d+map.Scale.normalX(2),map.Scale.normalX(-10),"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-10%;fill:black;stroke:none;pointer-events:none",Map.Scale.prototype.formatDistanceString(this.nBufferSize*this.nScale)),u.fu.setPosition(map.Scale.normalX(f/2+h),map.Scale.normalY(f/2)),chartButtonObj=new Button(e.parentNode,c+":bufferselectbutton",
"BUTTON","#bufferselect_button","map.Selections.newSelection('activeLayer','activeBuffer','type:BUFFER;buffersize:200','test');","","select active layer with this buffer"),chartButtonObj.setPosition(map.Scale.normalX(f+h+10),map.Scale.normalY(f)),chartButtonObj.scale(1.4,1.4),chartButtonObj=null,_activeTheme&&map.Dom.newText(e.parentNode,map.Scale.normalX(f+h+20),map.Scale.normalY(f+6),"font-family:arial;font-size:"+map.Scale.normalX(8)+"px;text-anchor:left;baseline-shift:-10%;fill:gray;stroke:none;pointer-events:none",
"... "+_activeTheme+""));if(!(!this.szFlag.match(/CHART/)||this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/EXACT/)||this.szFlag.match(/BUFFER/)||this.szFlag.match(/SYMBOL/))){d=map.Dom.getBox(e.parentNode);0>d.width&&(d=new box(0,0,0,0));f=30;this.szFlag.match(/BAR/)&&5<this.nOrigSumA.length&&!this.szFlag.match(/STACKED/)&&(f=15*this.nOrigSumA.length/Math.log(this.nOrigSumA.length));this.drawChart(e,null,f,"VALUES|NORMSIZE"+(this.szFlag.match(/STACKED/)?"|EXPANDMAX":""));
f=map.Dom.getBox(e);h=1;h=Math.min(2.5,Math.max(d.height/f.height,map.Scale.normalX(100)/f.height));e.fu=new Methods(e);e.fu.scale(h,h);summarizeGroup=map.Dom.newGroup(e,"textGroup");summarizeGroup.fu.scale(1/h,1/h);f=e.fu.getBox();this.szFlag.match(/BAR/)?e.fu.setPosition(d.width-f.x+map.Scale.normalX(10),-f.y+Math.max(10,.95*d.height-f.height)):e.fu.setPosition(d.width-f.x+map.Scale.normalX(10),-f.y+Math.max(10,d.height/2-f.height/2));l=" * overall sum";this.szAggregation&&this.szAggregation.match(/mean/)&&
(l=" * arithmetic mean");d="middle";if(this.szFlag.match(/RIGHT/)||this.szFlag.match(/STACKED/)||this.szFlag.match(/CENTER/)||this.szFlag.match(/POINTER/)||2>=this.partsA.length)d="start";map.Dom.newText(summarizeGroup,0,f.height+f.y+map.Scale.normalY(5),map.Scale.tStyle.Note.szStyle+"baseline-shift:-100%;text-anchor:"+d+";",l)}}};
MapTheme.prototype.drawColorSchemeLegend=function(e,c){var f=null,d=map.Scale.nButtonSize?.66*map.Scale.nButtonSize:12,h=map.Scale.nButtonSize||12,g=map.Scale.nButtonSize?1.2*map.Scale.nButtonSize:18,l=g,k="font-family:arial;font-size:"+map.Scale.normalY(d)+"px;fill:#666666;pointer-events:none;",m=1.2*h;this.szFlag.match(/BAR/)&&this.szFlag.match(/UP/)&&(m=h);var u=1.15*d,z=0*m,q=0;this.szFlag.match(/BAR/)&&(this.szFlag.match(/UP/)||this.szFlag.match(/STACKED/))&&(q=this.partsA.length-1);this.showInfoMore||
this.szFlag.match(/EXACT/)||this.szFlag.match(/UP/)||this.szFlag.match(/SYMBOL/)||this.szLabelA&&!this.szFlag.match(/CLIP/)||2>=this.partsA.length?this.szLegendStyle="large":this.szLegendStyle="compact";var y=new ScrollArea(null,e,null,10,10,10);y?(y.reformat(),f=y.workspaceNode):f=map.Dom.newGroup(e,c+":legend");for(var r=1,D=0;D<this.partsA.length;D++)this.partsA[D].min&&(this.partsA[D].min.toFixed(0)!=this.partsA[D].min&&(r=Math.min(r,.1)),this.partsA[D].min.toFixed(1)!=this.partsA[D].min&&(r=
Math.min(r,.01)));for(var w=[],D=0;D<this.partsA.length;D++)w[D]={},w[D].i=D,w[D].value=this.partsA[D].nCount;this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/EXACT/)&&this.szFlag.match(/SORTDOWN/)&&w.sort(this.sortIndexDown);!this.szFlag.match(/POINTER/)&&!this.szFlag.match(/INVERT/)||this.szLegendStyle.match(/compact/)||w.reverse();var C=1;!this.szLabelA&&15<w.length&&(C=Math.floor(w.length/10),h*=1.5);var B=this.showInfoMore&&this.isMarkable?18:10,J=!1;if(this.szFlag.match(/CHART/)&&1<this.szFieldsA.length&&
!this.szFlag.match(/OFFSET/)&&!this.szFlag.match(/DEVIATION/)){for(var K=J=0;K<this.nOrigSumA.length;K++)this.partsA[K]&&"undefined"!=typeof this.partsA[K].nSum&&J++;J=J==this.nOrigSumA.length}for(var la=0;la<w.length;la+=C){var D=w[la].i,H=Math.min(Math.abs(q-D),this.partsA.length-C),v=null,K=null;if(this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/EXACT/))g=0==this.nSkipCount?3*this.partsA[D].nCount/this.nCount*100:30/this.nCount*10*this.partsA[D].nCount;else if(J){K=g=0;if(this.szFlag.match(/MORPH/)){for(K=
0;K<this.nOrigSumA.length/2;K++)g=Math.max(g,this.nOrigSumA[K]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[K+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1));K=(this.nOrigSumA[H]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[H+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1))/g}else{for(K=0;K<this.nOrigSumA.length;K++)g=Math.max(g,this.partsA[K].nSum);K=this.partsA[H].nSum/g}g=60*K}g=isNaN(g)?l:g;if(this.szFlag.match(/BUBBLE/))K=
this.szFlag.match(/EXACT/)||this.szSizeField?h/2:h/4+h/4*(D+1)/this.partsA.length,K=map.Dom.newShape("circle",f,map.Scale.normalX(B+h/2),map.Scale.normalY(z+h/2),map.Scale.normalY(K),"fill:"+this.colorScheme[H]+";stroke:#eeeeee;stroke-width:"+map.Scale.normalX(.1)+";");else if(1<C)for(K=map.Dom.newGroup(f,""),v=0;v<C;v++)map.Dom.newShape("rect",K,map.Scale.normalX(B),map.Scale.normalY(z+h/C*v),map.Scale.normalX(g),map.Scale.normalY(h/C),"fill:"+this.colorScheme[H+v]+";stroke:none;");else K=map.Dom.newShape("rect",
f,map.Scale.normalX(B),map.Scale.normalY(z),map.Scale.normalX(g),map.Scale.normalY(h),"fill:"+this.colorScheme[H]+";stroke:#eeeeee;stroke-width:"+map.Scale.normalX(.1)+";");if(K){for(var I=this.partsA[H].nCount,v=1;v<C;v++)I+=this.partsA[H+v].nCount;this.isMarkable&&this.showInfoMore&&(map.Dom.newShape("rect",f,map.Scale.normalX(-5),map.Scale.normalY(z-2),map.Scale.normalX(g),map.Scale.normalY(h+4),"fill:white;stroke:none;opacity:0;").setAttributeNS(null,"id",this.szId+":widget:background:"+H),buttonObj=
new Button(f,this.szId+":class:"+H,"CHECKBOX|SELECTED","","map.Themes.showClass(evt,'"+this.szId+"','"+H+"','"+C+"')","map.Themes.hideClass(evt,'"+this.szId+"','"+H+"','"+C+"')","show/hide class"),buttonObj.setPosition(map.Scale.normalX(map.Scale.nButtonSize/2-1),map.Scale.normalY(z+map.Scale.nButtonSize/2-1)),buttonObj.scale(.75,.75));var v=this.partsA[H].min+(la?r:0),N=this.partsA[H+C-1].max,E=100<N-v?0:2;szMin=this.formatValue(v,E);szMax=this.formatValue(N,E);szMembers="";this.szFlag.match(/SHOWMEMBERS/)&&
(szMembers="  ["+I+"]");szLabel=szMin!=szMax?szMin+"..."+szMax+(this.szLegendUnits?this.szLegendUnits:"")+this.szUnit+szMembers:szMin+(this.szLegendUnits?this.szLegendUnits:"")+this.szUnit+szMembers;(!this.szFlag.match(/CLIP/)||this.szFlag.match(/MORPH/))&&this.szLabelA&&this.szLabelA[H]&&(szLabel=this.szLabelA[H]);this.szLegendLabelA[H]=szLabel;if(this.szLegendStyle.match(/compact/))this.fGrayNoMember&&0==I&&this.szFlag.match(/CHOROPLETHE/)&&this.szFlag.match(/DOMINANT/)&&(K.style.setProperty("fill-opacity",
"0.03",""),K.style.getPropertyValue("fill"),K.style.setProperty("stroke-opacity","0.2",""),K.style.setProperty("stroke","black",""),K.style.setProperty("stroke-width",map.Scale.normalX(.3),"")),this.szFlag.match(/EXACT/)||this.szFlag.match(/DOMINANT/)&&15<szLabel.length||(v=";font-size:"+map.Scale.normalX(.9*d)+"px;",0==la?(szLabel=0<szLabel.length?szMin+this.szUnit:szLabel,map.Dom.newText(f,map.Scale.normalX(B+2),map.Scale.normalY(z+u*(C+1.5)),k+v,szLabel)):la==w.length-C&&(szLabel=0<szLabel.length?
szMax+this.szUnit:szLabel,map.Dom.newText(f,map.Scale.normalX(B+2),map.Scale.normalY(z+u*(C+1.5)),k+v,szLabel)));else if(this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/EXACT/))v=g+2,N=String(this.partsA[D].nCount),0==this.nSkipCount&&(N=String(Math.round(100/this.nCount*this.partsA[D].nCount))+"%"),E=5*N.length/7*d,"dynamic"==this.szTextPlacement&&E<g&&(v-=5*String(this.partsA[D].nCount).length/7*d),map.Dom.newText(f,map.Scale.normalX(B+v),map.Scale.normalY(z+u+1),k,N),v+=E,this.szSymbolsA[D]&&this.szSymbolsA[D].match(/symbol/)&&
(N=map.Dom.constructNode("use",f,{"xlink:href":"#"+this.szSymbolsA[D]+":antizoomandpan"}),N.setAttributeNS(null,"style","fill:"+this.colorScheme[H]),N.fu.scale(.5,.5),N.fu.setPosition(map.Scale.normalX(B+v+10),map.Scale.normalY(z+u-3)),v+=20),v=map.Dom.newText(f,map.Scale.normalX(B+v),map.Scale.normalY(z+u),k,"("+szLabel+")"),v.style.setProperty("fill","#bbbbdd","");else{v=g+4;if(J){N=this.partsA[H].nSum;this.szFlag.match(/MORPH/)&&(N=this.nOrigSumA[H]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-
1)+this.nOrigSumA[H+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1));if(this.szField100&&!this.szFlag.match(/SUM/)||this.szAggregation&&!this.szAggregation.match(/sum/))N/=this.partsA[H].nCount;szLabel=szLabel+"  ("+this.formatValue(N,1)+this.szUnit+")"}v=map.Dom.newText(f,map.Scale.normalX(B+v),map.Scale.normalY(z+u),k,szLabel);this.fGrayNoMember&&0==I&&this.szFlag.match(/CHOROPLETHE/)&&(v.style.setProperty("fill","#bbbbdd",""),K.style.setProperty("opacity","0.1",""))}this.szFlag.match(/BUFFER/)&&
K.style.setProperty("fill-opacity",this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0,"");1==this.szFieldsA.length||!this.szFlag.match(/CHART/)||this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/EXACT/)?(this.szLegendStyle.match(/compact/)?K.setAttributeNS(szMapNs,"tooltip",szLabel+" ("+I+" member(s))"):K.setAttributeNS(szMapNs,"tooltip",I+" member(s)"),D=K.getAttributeNS(null,"style"),K.setAttributeNS(szMapNs,"onoverstyle",D+";stroke:black;stroke-width:"+map.Scale.normalX(.5)+";"),K.setAttributeNS(null,
"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+H+"','"+C+"')"),K.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"),K.setAttributeNS(null,"onclick","map.Themes.zoomToClass(evt,'"+this.szId+"','"+H+"','"+C+"')"),K.setAttributeNS(null,"id",c+":widget:classrect:"+H)):this.szFlag.match(/SYMBOL/)?this.szFlag.match(/EXACT/)?K.setAttributeNS(szMapNs,"tooltip",this.partsA[D].nCount+" ("+this.formatValue(this.partsA[D].nCount/this.nCount*100,1)+" %)"):this.szFlag.match(/SEQUENCE/)&&
K.setAttributeNS(szMapNs,"tooltip",this.nOrigSumA[D]+" ("+this.formatValue(this.nOrigSumA[D]/this.nSum*100,1)+" %)"):1<this.szFieldsA.length&&!this.szFlag.match(/SEQUENCE/)&&(this.nSum100?K.setAttributeNS(szMapNs,"tooltip",this.formatValue(100/this.nSum100*this.nOrigSumA[H],1)+" %"):this.nSum&&K.setAttributeNS(szMapNs,"tooltip",this.nOrigSumA[H]+" ("+this.formatValue(100/this.nSum*this.nOrigSumA[H],1)+" %)"),K.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+H+"','"+
C+"')"),K.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"))}this.szLegendStyle.match(/compact/)?B+=g:z+=9*m/10}this.szLegendStyle.match(/compact/)?z+=m*C*2:this.nNoData&&(z+=1.5*m/10,K=map.Dom.newShape("rect",f,0,map.Scale.normalY(z),map.Scale.normalX(g),map.Scale.normalY(h),"fill:"+(this.szNoDataColor?this.szNoDataColor:"#ffffff")+";stroke:#000000;stroke-width:"+map.Scale.normalX(.1)+";"),K.setAttributeNS(szMapNs,"tooltip",this.nNoData+" member(s)"),K.setAttributeNS(null,
"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+H+"')"),K.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"),map.Dom.newText(f,map.Scale.normalX(22),map.Scale.normalY(z+u),k,map.Dictionary.getLocalText("no data")),z+=9*m/10);y&&(y.setWidth(-1),y.setHeight(Math.min(z+m,map.Scale.bBox.height/map.Scale.normalY(2.2))),this.nClipColorLegend&&y.setHeight(this.nClipColorLegend),y.reformat(),y.hasScrollBars()&&(f.style.setProperty("display","none",""),map.Dom.newShape("rect",
e,0,0,map.Scale.normalX(y.getWidth()),map.Scale.normalY(y.getHeight()),"fill:none;stroke:none;")));return f};
MapTheme.prototype.showInfo=function(){var e;if(!this.szFlag.match(/NOINFO/)&&0!=this.nCount&&(!this.widgetNode||this.fRedrawInfo)){this.fRedrawInfo=!1;var c=12,f=SVGDocument.getElementById("legend:param");f&&(c=Number(f.getAttributeNS(szMapNs,"fontsize")),f.getAttributeNS(szMapNs,"swatchheight"),f.getAttributeNS(szMapNs,"swatchwidth"));map.Scale.normalX(1);map.Scale.normalX(5);var d="fill:white;stroke:blue;stroke-width:"+map.Scale.normalX(.1)+";opacity:0.8",h="font-family:arial;font-size:"+map.Scale.normalY(c)+
"px;fill:black;pointer-events:none;",f=this.szId+":display:widget",g=null,l=!0,k=null,m=null,u=null;this.widgetNode?(g=this.widgetNode.firstChild,map.Dom.clearGroup(g),this.fRepositionInfo||(l=!1),this.fRepositionInfo=!1,f=this.widgetNode.getAttributeNS(null,"id"),f=f.substr(0,f.length-8),this.enable()):(g=map.Dom.newGroup(SVGThemeGroup,f+":movable"),this.szFlag.match(/BUBBLE/)?g.setAttributeNS(szMapNs,"menu","thememenu"):this.szFlag.match(/DOMINANT/)?g.setAttributeNS(szMapNs,"menu","chartmenu"):
this.szFlag.match(/CHART/)?g.setAttributeNS(szMapNs,"menu","chartmenu"):g.setAttributeNS(szMapNs,"menu","thememenu"),new Widget(g,this),this.widgetNode=g,g=map.Dom.newGroup(g,f+":workspace:noobject"));var z=3*c/2,q=7*c/8,c=0*z,d=map.Dom.newShape("rect",g,0,0,1,1,d);d.setAttributeNS(null,"id",f+":backgroundrect:noobject");d.setAttributeNS(null,"rx",map.Scale.normalX(3));d.setAttributeNS(null,"ry",map.Scale.normalX(3));var y=this.szThemes;30<y.length&&(y=y.substr(0,30)+"...");var c=c+.2*z,r=map.Dom.newGroup(g,
f+":title"),h=map.Scale.tStyle?map.Scale.tStyle.ContainerTitle.szStyle:"";this.szTitle?e=map.Dom.newText(r,map.Scale.normalX(10),map.Scale.normalY(c+q),h,this.szTitle):(e=map.Dom.newText(r,map.Scale.normalX(10),map.Scale.normalY(c+q),h,"Theme: "+y),c+=z,map.Dom.newText(r,map.Scale.normalX(0),map.Scale.normalY(c+q),h,"Value: "+this.szFields));c+=z;map.Dom.newShape("rect",r,e.fu.getTextLength()+map.Scale.normalX(30),map.Scale.normalY(c+q),1,1,"fill:none;stroke:none");c+=z/5;g.setAttributeNS(szMapNs,
"titleheight",String(map.Scale.normalY(c)));this.szSnippetn&&map.Scale.tStyle&&(h=map.Scale.tStyle.Snippet.szStyle,c+=1,map.Dom.newText(r,map.Scale.normalX(10),map.Scale.normalY(c+2),h,this.szSnippet),c+=map.Scale.tStyle.Snippet.nFontHeight/map.Scale.normalY(1)+1);q=map.Dom.newGroup(g,f+":body");q.fu.setPosition(0,map.Scale.normalY(c));q.fu.scale(1/map.Scale.getEmbedScale(),1/map.Scale.getEmbedScale());1<this.nOrigSumA.length&&this.szFlag.match(/BAR/)&&this.szFlag.match(/HOR/)&&!this.szFlag.match(/SPACED/)&&
this.szFlag.match(/STACKED/);c=!0;h=null;this.szFlag.match(/CHART/)&&!this.szFlag.match(/EXACT/)&&this.nOrigSumA.length!=this.colorScheme.length&&2>=this.colorScheme.length&&(c=!1);this.szFlag.match(/CHART/)&&this.szFlag.match(/OFFSETMEAN/)&&(c=!0);c&&(h=this.drawColorSchemeLegend(q,f));z=map.Dom.getBox(q);if(!c||this.showInfoMore||this.szFlag.match(/UP/)){c=new box(0,0,0,0);r=null;this.szFlag.match(/CHOROPLETHE/)&&!this.szFlag.match(/DOMINANT/)&&(r=map.Dom.newGroup(q,"histogram"+String(Math.random())),
r.fu.setPosition(0<z.width?z.width+map.Scale.normalX(15):0,map.Scale.normalY(15)),r.fu.scale(2,2),map.Themes.getHistogram(null,r,"DISTRIBUTION|INTERACTIVE",this),c=map.Dom.getBox(r),c.height+=map.Scale.normalX(30));if(!this.szFlag.match(/OFFSETMEAN/)){var D=map.Dom.newGroup(q,"donut"+String(Math.random()));D.fu.setPosition(0<z.width?z.width+map.Scale.normalX(15):map.Scale.normalX(5),map.Scale.normalX(10)+c.height);D.fu.scale(.75,.75);this.getOverviewChart(D,f)}r&&(cBox=map.Dom.getBox(D),D.fu.setPosition((0<
z.width?z.width+map.Scale.normalX(15):0)-cBox.x/2,map.Scale.normalX(10)-cBox.y+c.height))}map.Dom.getBox(g);var z=map.Dom.getBox(g),w=map.Scale.normalX(map.Scale.nButtonSize),c=map.Scale.normalY(.6*map.Scale.nButtonSize),y="font-family:arial;font-size:"+c+"px;fill:#666666;baseline-shift:-30%;pointer-events:none",D=map.Dom.newGroup(g,f+":infobuttons"),q=map.Dom.newGroup(D,f+":footer");q.fu.setPosition(0,z.height);if(this.szFlag.match(/CLIP/)){q.fu.setPosition(0,z.height+map.Scale.normalX(10));r=map.Dom.newGroup(g,
f+":frameslider");clipButtonObj=new Button(r,f+":clipstartbutton","BUTTON","#start_button","map.Themes.startClip('"+this.szId+"')","","start clip");clipButtonObj.setPosition(map.Scale.normalX(3),map.Scale.normalX(10));clipButtonObj.scale(.8,.8);clipButtonObj.nodeObj.style.setProperty("display","none","");clipButtonObj=new Button(r,f+":clippausebutton","BUTTON","#pause_button","map.Themes.pauseClip('"+this.szId+"')","","pause clip");clipButtonObj.setPosition(map.Scale.normalX(3),map.Scale.normalX(10));
clipButtonObj.scale(.8,.8);r.fu.setPosition(map.Scale.normalX(15),z.height);var C=z.width-map.Scale.normalX(30);e=map.Scale.normalY(5);map.Dom.newShape("rect",r,map.Scale.normalX(11),map.Scale.normalY(10)-.5*e,C,e,"fill:lightgray;stroke:none;");C=C/this.nClipFrames*(this.nActualFrame+1);map.Dom.newShape("rect",r,map.Scale.normalX(11),map.Scale.normalY(10)-.5*e,C,e,"fill:darkgray;stroke:none")}if(this.showInfoMore||this.parent.autoHideInfoTools){if(this.szFlag.match(/CHART/)){if(C=null,m=map.Scale.normalX(map.Scale.nButtonSize/
2),r=map.Scale.normalY(map.Scale.nButtonSize+7),e=new Button(q,this.szId,"CHECKBOX|SELECTED","","map.Themes.toggleChartDisplay(evt,'"+this.szId+"',1)","map.Themes.toggleChartDisplay(evt,'"+this.szId+"',0)","show/hide objects"),e.setPosition(m,r),e.scale(.8,.8),m+=map.Scale.normalX(25),nXoff=0,C=map.Dom.newGroup(q,"opacitybuttons"+String(Math.random())),e=new Button(C,this.szId,"BUTTON","#minus_button","map.Themes.changeChartOpacity(evt,'"+this.szId+"',0.66)","","fade out"),e.scale(1,1),e.setPosition(nXoff,
0),nXoff+=map.Scale.normalX(11),e=map.Dom.newText(C,nXoff,0,y,map.Dictionary.getLocalText("opacity")),nXoff+=e.fu.getTextLength()+map.Scale.normalX(11),e=new Button(C,this.szId,"BUTTON","#plus_button","map.Themes.changeChartOpacity(evt,'"+this.szId+"',1.5)","","fade in"),e.scale(1,1),e.setPosition(nXoff,0),nXoff+=map.Scale.normalX(10),this.szFlag.match(/PIE/)||(nXoff+=map.Scale.normalX(10),e=new Button(C,this.szId+":text","CHECKBOX"+(this.szFlag.match(/VALUES/)?"|SELECTED":""),"","map.Themes.toggleValueDisplay(evt,'"+
this.szId+":text',1)","map.Themes.toggleValueDisplay(evt,'"+this.szId+":text',0)","text values"),e.setPosition(nXoff,0),e.scale(.8,.8),nXoff+=map.Scale.normalX(12),e=map.Dom.newText(C,nXoff,0,y,map.Dictionary.getLocalText("values")),nXoff+=e.fu.getTextLength()+map.Scale.normalX(7)),C.fu.setPosition(m,r),nMinXpos=m=m+nXoff+map.Scale.normalX(6),nXoff=0,e=.9,w=1.1,this.szFlag.match(/BUFFER/)&&(w=this.nBufferSizeStep?this.nBufferSizeStep/this.nBufferSize:.1,e=1-w/this.nScale,w=1+w/this.nScale),C=map.Dom.newGroup(q,
"sizebuttons"+String(Math.random())),e=new Button(C,this.szId,"BUTTON","#minus_button","map.Themes.changeChartScaling(evt,'"+this.szId+"',"+e+")","","smaller charts"),e.scale(1,1),e.setPosition(nXoff,0),nXoff+=map.Scale.normalX(12),e=map.Dom.newText(C,nXoff,0,y,map.Dictionary.getLocalText("size")),nXoff+=e.fu.getTextLength()+map.Scale.normalX(12),e=new Button(C,this.szId,"BUTTON","#plus_button","map.Themes.changeChartScaling(evt,'"+this.szId+"',"+w+")","","bigger charts"),e.scale(1,1),e.setPosition(nXoff,
0),C.fu.setPosition(m+map.Scale.normalX(5),r),nMinXpos=m+nXoff+map.Scale.normalX(map.Scale.nButtonSize),this.showInfoMore&&!this.szFlag.match(/BUFFER/)&&!this.szFlag.match(/SYMBOL/)){r-=map.Scale.normalY(4);y=this.szFlag.match(/STARBURST/)||this.szFlag.match(/BAR/)?30:20;w=this.chartButton(q,y,"");m=w.fu.getPosition();C=w.fu.getBox();w.fu.setPosition(nMinXpos+m.x,r+m.y);m="";if(this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/LABEL/))m="FIXSIZE";w.setAttributeNS(null,"onclick",
"map.Themes.setChartSizeType(evt,'"+this.szId+"','"+m+"')");nMinXpos+=C.width+map.Scale.normalX(10);w=this.chartButton(q,y,"SIZE");m=w.fu.getPosition();C=w.fu.getBox();w.fu.setPosition(nMinXpos+m.x,r+m.y);w.setAttributeNS(null,"onclick","map.Themes.setChartSizeType(evt,'"+this.szId+"','SIZE')");nMinXpos+=C.width+map.Scale.normalX(10);if(this.szFlag.match(/BAR/)||this.szFlag.match(/PIE/)||this.szFlag.match(/DONUT/))this.szFlag.match(/3D/)?(w=this.chartButton(q,y,"HEIGHT"),m=w.fu.getPosition(),C=w.fu.getBox(),
w.fu.setPosition(nMinXpos+m.x,r+m.y),w.setAttributeNS(null,"onclick","map.Themes.setChartSizeType(evt,'"+this.szId+"','HEIGHT')"),nMinXpos+=C.width+map.Scale.normalX(10),w=this.chartButton(q,y,"2D"),m=w.fu.getPosition(),w.fu.setPosition(nMinXpos+m.x,r+m.y),w.setAttributeNS(null,"onclick","map.Themes.setChartSizeType(evt,'"+this.szId+"','2D')")):(w=this.chartButton(q,y,"3D"),m=w.fu.getPosition(),w.fu.setPosition(nMinXpos+m.x,r+m.y),w.setAttributeNS(null,"onclick","map.Themes.setChartSizeType(evt,'"+
this.szId+"','3D')"));r+=map.Scale.normalY(6)}}else{m=map.Scale.normalX(0);r=map.Scale.normalY(map.Scale.nButtonSize+7);e=null;C="TEXTBUTTON";if(this.szFlag.match(/DOMINANT/)){e=map.Dictionary.getLocalText("Filter: ");e=map.Dom.newText(q,m,r,y,e);m+=e.fu.getTextLength()+c/2;this.szFlag.match(/PERCENTOFMEAN/)?(e=map.Dictionary.getLocalText("% of mean "),e=map.Dom.newText(q,m,r,y,e),m+=e.fu.getTextLength()+c/2):this.szFlag.match(/PERCENTOFMEDIAN/)?(e=map.Dictionary.getLocalText("% of median "),e=map.Dom.newText(q,
m,r,y,e),m+=e.fu.getTextLength()+c/2):(e=map.Dictionary.getLocalText("min"),C="min"==this.szDominantFilter?"TEXTBUTTON|SELECTED":"TEXTBUTTON",e=new Button(q,this.szId,C,e,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','filter:min;dfilter:0')","","change method"),e.setPosition(m,r),m+=e.bBox.width,e=map.Dictionary.getLocalText("mean"),C="mean"==this.szDominantFilter?"TEXTBUTTON|SELECTED":"TEXTBUTTON",e=new Button(q,this.szId,C,e,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','filter:mean;dfilter:0')",
"","change method"),e.setPosition(m,r),m+=e.bBox.width,m+=map.Scale.normalX(2));e=map.Dictionary.getLocalText("+");e=map.Dom.newText(q,m,r,y,e);for(var m=m+(e.fu.getTextLength()+c/2),B=0;90>=B;B+=10)C=B==this.nDominantDFilter?"TEXTBUTTON|SELECTED":"TEXTBUTTON",e=new Button(q,this.szId,C,(0<B?".":"")+String(B/10),"map.Themes.changeThemeStyle(evt,'"+this.szId+"','dfilter:"+String(B)+"')","","add "+String(B/100)+"*max.value to the filter"),e.setPosition(m,r),m+=e.bBox.width;e=map.Dictionary.getLocalText("[max]");
e=map.Dom.newText(q,m,r,y,e);m+=e.fu.getTextLength()+c/2}else if(this.szFlag.match(/DOMINANTXXX/)){e=map.Dictionary.getLocalText("Filter: ")+map.Dictionary.getLocalText(this.szDominantFilter);e=map.Dom.newText(q,m,r,y,e);m+=e.fu.getTextLength()+c/2;for(B=0;90>=B;B+=10)C="TEXTBUTTON",B==this.nDominantDFilter&&(C+="|SELECTED"),e=new Button(q,this.szId,C,"."+String(B/10),"map.Themes.changeThemeStyle(evt,'"+this.szId+"','dfilter:"+String(B)+"')","","set lower limit in % of maximum"),e.setPosition(m,r),
m+=e.bBox.width;e=map.Dictionary.getLocalText("max");e=map.Dom.newText(q,m,r,y,e);m+=e.fu.getTextLength()+c/2}else if(!this.szFlag.match(/BUBBLE/)){if(Number(this.origColorScheme[0])){e=map.Dictionary.getLocalText("classes")+":";e=map.Dom.newText(q,m,r,y,e);m+=e.fu.getTextLength()+c/2;for(B=2;20>=B;B++)10<B&&0!=B%10||(C="TEXTBUTTON",B==this.partsA.length&&(C+="|SELECTED"),e=new Button(q,this.szId,C,String(B),"map.Themes.changeThemeStyle(evt,'"+this.szId+"','classes:"+String(B)+"')","","change classes"),
e.setPosition(m,r),m+=e.bBox.width);m+=c}else C=map.Dom.newGroup(q,"sizebuttons"+String(Math.random())),m=map.Scale.normalX(8),e=new Button(C,this.szId,"BUTTON","#minus_button","map.Themes.changeChartOpacity(evt,'"+this.szId+"',0.66)","","fade out"),e.scale(1,1),e.setPosition(m,r),m+=map.Scale.normalX(12),e=map.Dom.newText(C,m,r,y,map.Dictionary.getLocalText("opacity")),m+=e.fu.getTextLength()+map.Scale.normalX(12),e=new Button(C,this.szId,"BUTTON","#plus_button","map.Themes.changeChartOpacity(evt,'"+
this.szId+"',1.5)","","fade in"),e.scale(1,1),e.setPosition(m,r),m+=1.5*w;this.szFlag.match(/QUANTILE/)||this.szFlag.match(/LOG/)||this.szRanges||(this.szFlag+="|EQUIDISTANT");e=map.Dictionary.getLocalText("equidistant");C=!this.szRanges&&this.szFlag.match(/EQUIDISTANT/)?"TEXTBUTTON|SELECTED":"TEXTBUTTON";e=new Button(q,this.szId,C,e,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','type:CHOROPLETHE|EQUIDISTANT')","","change method");e.setPosition(m,r);m+=e.bBox.width;e=map.Dictionary.getLocalText("log");
C=!this.szRanges&&this.szFlag.match(/LOG/)?"TEXTBUTTON|SELECTED":"TEXTBUTTON";e=new Button(q,this.szId,C,e,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','type:CHOROPLETHE|LOG')","","change method");e.setPosition(m,r);m+=e.bBox.width;e=map.Dictionary.getLocalText("quantile");C=!this.szRanges&&this.szFlag.match(/QUANTILE/)?"TEXTBUTTON|SELECTED":"TEXTBUTTON";e=new Button(q,this.szId,C,e,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','type:CHOROPLETHE|QUANTILE')","","change method");e.setPosition(m,
r);m+=e.bBox.width;if(this.szRanges||this.szOldRanges)e=map.Dictionary.getLocalText("ranges"),C=this.szRanges?"TEXTBUTTON|SELECTED":"TEXTBUTTON",e=new Button(q,this.szId,C,e,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','type:CHOROPLETHE|RANGES')","","change method"),e.setPosition(m,r),m+=e.bBox.width}Number(this.origColorScheme[0])&&(m=map.Scale.normalX(8),r+=c+map.Scale.normalY(9),C=map.Dom.newGroup(q,"sizebuttons"+String(Math.random())),e=new Button(C,this.szId,"BUTTON","#minus_button","map.Themes.changeChartOpacity(evt,'"+
this.szId+"',0.66)","","fade out"),e.scale(1,1),e.setPosition(m,r),m+=map.Scale.normalX(11),e=map.Dom.newText(C,m,r,y,map.Dictionary.getLocalText("opacity")),m+=e.fu.getTextLength()+map.Scale.normalX(10),e=new Button(C,this.szId,"BUTTON","#plus_button","map.Themes.changeChartOpacity(evt,'"+this.szId+"',1.5)","","fade in"),e.scale(1,1),e.setPosition(m,r),m+=w);m+=map.Scale.normalX(10);e=new Button(q,this.szId+":text","CHECKBOX"+(this.szFlag.match(/VALUES/)?"|SELECTED":""),"","map.Themes.toggleValueDisplay(evt,'"+
this.szId+":text',1)","map.Themes.toggleValueDisplay(evt,'"+this.szId+":text',0)","text values");e.setPosition(m,r);e.scale(.9,.9);m+=map.Scale.normalX(12);e=map.Dom.newText(q,m,r,y,map.Dictionary.getLocalText("values"));m+=e.fu.getTextLength()+map.Scale.normalX(8);m+=map.Scale.normalX(10);e=new Button(q,this.szId+":dopacity","CHECKBOX"+(this.szFlag.match(/DOPACITY/)?"|SELECTED":""),"","map.Themes.toggleDopacity(evt,'"+this.szId+":dop',1)","map.Themes.toggleDopacity(evt,'"+this.szId+":dop',0)","dynamic opacity");
e.setPosition(m,r);e.scale(.9,.9);m+=map.Scale.normalX(12);e=map.Dom.newText(q,m,r,y,map.Dictionary.getLocalText("dyn.opacity"));m+=e.fu.getTextLength()+map.Scale.normalX(8);m+=map.Scale.normalX(5);C=map.Dom.newGroup(q,"dopacitybuttons"+String(Math.random()));e=new Button(C,this.szId,"BUTTON","#minus_button","map.Themes.changeDopacityAlphaRamp(evt,'"+this.szId+"',(2/3))","","fade out");e.scale(1,1);e.setPosition(m,r);m+=1.1*w;e=new Button(C,this.szId,"BUTTON","#plus_button","map.Themes.changeDopacityAlphaRamp(evt,'"+
this.szId+"',(3/2))","","fade in");e.scale(1,1);e.setPosition(m,r);z.width=Math.max(z.width,m+2*c-c/2)}this.szFlag.match(/DOMINANT/)?(k=new Button(q,f+":chartcolorbutton","BUTTON","#tools_button","map.Themes.chartColorMenu(evt,'"+this.szId+"','"+f+"','"+this.szOrigFlag+"')","","change chart color"),k.scale(1.2,1.2)):this.szFlag.match(/CHART/)&&this.szFlag.match(/BUFFER/)||(k=new Button(q,f+":chartselectbutton","BUTTON","#tools_button","map.Themes.chartTypeMenu(evt,'"+this.szId+"','"+f+"','"+this.szOrigFlag+
"')","","change chart type"),k.scale(1.2,1.2));this.chartbutton=k;map.Dictionary.getLocalText("close");m=new Button(q,this.szId,"BUTTON",this.showInfoMore?"#minus_button":"#plus_button","map.Themes.toggleMore(evt,'"+this.szId+"')","","hide tools");m.setPosition(z.width-map.Scale.normalX(25),e.getPosition().y-map.Scale.normalY(10));m.scale(1,1);this.morebutton=m}else r=map.Scale.normalY(0),map.Dictionary.getLocalText("more"),szButton="plus_button",nButtonOpacity=.65,u=new Button(q,this.szId,"BUTTON",
"#"+szButton,"map.Themes.toggleMore(evt,'"+this.szId+"')","","show tools"),u.scale(1,1),this.morebutton=u;this.nMissingPositionCount&&(e=map.Dictionary.getLocalText("(!)"),y=new Button(q,this.szId,"TEXTBUTTON",e,"map.Themes.showErrorInfo(evt,'"+this.szId+"')","","show warnings"),y.setPosition(z.width,y.getPosition().y-c),y.scale(1,1),y.nodeObj.style.setProperty("opacity","0.5",""));this.parent.autoHideInfoTools&&(this.showInfoMore||D.style.setProperty("display","none",""),"all"==this.parent.autoHideInfoTools&&
(g.setAttributeNS(null,"onmouseover","map.Themes.onoverInfo(null,'"+this.szId+"')"),g.setAttributeNS(null,"onmouseout","map.Themes.onoutInfo(null,'"+this.szId+"')"),g.setAttributeNS(null,"onmousedown","map.Themes.ondownInfo(null,'"+this.szId+"')")));z=map.Dom.getBox(g);z.width+=map.Scale.normalX(25);d.setAttributeNS(null,"x",-map.Scale.normalX(5));d.setAttributeNS(null,"y",-map.Scale.normalY(5));d.setAttributeNS(null,"width",z.width+map.Scale.normalX(5)+map.Scale.normalX(10));d.setAttributeNS(null,
"height",z.height+map.Scale.normalY(5)+map.Scale.normalY(5));g=d.cloneNode(1E3);d.parentNode.insertBefore(g,d);g.setAttributeNS(null,"id",f+":shadowrect:noobject");g.setAttributeNS(null,"style","fill:#444444;stroke:none;opacity:0.2");g.setAttributeNS(null,"x",Number(g.getAttributeNS(null,"x"))+map.Scale.normalX(8));g.setAttributeNS(null,"y",Number(g.getAttributeNS(null,"y"))+map.Scale.normalY(9));g.setAttributeNS(null,"width",Number(g.getAttributeNS(null,"width"))-map.Scale.normalY(5));g.setAttributeNS(null,
"height",Number(g.getAttributeNS(null,"height"))-map.Scale.normalY(6));e=this.showInfoMore?new Button(D,f+":removebutton","BUTTON","#delete_button","map.Themes.toggleMore(evt,'"+this.szId+"')","","hide tools"):new Button(D,f+":removebutton","BUTTON","#delete_button","map.Themes.removeTheme(evt,'"+f+"')","","remove map theme");e.setPosition(z.width-map.Scale.normalX(2),map.Scale.normalY(7));this.removebutton=e;e=new Button(D,f+":maximizebutton","BUTTON","#maximize_button","map.Themes.maximizeInfo(evt,'"+
f+"')","","maximize");e.setPosition(z.width-map.Scale.normalX(map.Scale.nButtonSize+5),map.Scale.normalY(7));this.maximizebutton=e;e=new Button(D,f+":minimizebutton","BUTTON","#minimize_button","map.Themes.minimizeInfo(evt,'"+f+"')","","minimize");e.setPosition(z.width-map.Scale.normalX(map.Scale.nButtonSize+5),map.Scale.normalY(7));this.minimizebutton=e;m&&k&&m.setPosition(z.width-map.Scale.normalX(1),k.getPosition().y-map.Scale.normalX(3));k&&k.setPosition(z.width-map.Scale.normalX(1),r);u&&u.setPosition(z.width-
map.Scale.normalX(1),r);this.showInfoMore&&map.Dom.newShape("line",q,0,map.Scale.normalY(8),z.width+map.Scale.normalX(2*map.Scale.nButtonSize),map.Scale.normalY(8),"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");l&&(l=this.parent.getThemeIndex(this.szId),m=new point(160,map.Scale.mapPosition.y+220),k=map.Viewport.szPopupAlignment?map.Viewport.szPopupAlignment:"",u=map.Legend?map.Legend.getPosition():new point(0,0),k.match(/LEFT/)?(m.x=0==u.x?map.Scale.mapPosition.x+map.Scale.normalX(10):map.Scale.normalX(10),
m.x+=map.Scale.normalX(10+10*(l-1))):(m=0==u.x?new point(map.Scale.viewBox.width-z.width-map.Scale.normalX(5)-map.Scale.normalX(10),map.Scale.normalY(10)):new point(map.Scale.mapPosition.x+map.Scale.bBox.width-z.width-map.Scale.normalX(5)-map.Scale.normalX(10),map.Scale.normalY(10)),m.x-=map.Scale.normalX(4),m.x-=map.Scale.normalX(10*l)),!k.match(/BOTTOM/)||this.parent.fMinimizedLegends||this.szFlag.match(/MINIMIZED/)?m.y+=map.Scale.normalY(20*l):(this.parent.minY?(m.y=this.parent.minY-map.Scale.normalY(10),
m.x+=map.Scale.normalX(10*l)):(m.y=map.Scale.mapPosition.y+map.Scale.bBox.height-z.height-map.Scale.normalX(10),m.y-=map.Scale.normalY(10*(l-1))),m.y-=map.Scale.normalY(20),0>=map.Scale.viewBox.height-(map.Scale.mapPosition.y+map.Scale.bBox.height)&&(m.y-=map.Scale.normalY(15))),this.widgetNode.fu.setPosition(m.x,m.y),this.ptWidget=this.widgetNode.fu.getPosition(),this.parent.minX=m.x,this.parent.minY=m.y);h&&h.style.setProperty("display","inline","");(this.parent.fMinimizedLegends||this.szFlag.match(/MINIMIZED/))&&
map.Themes.minimizeInfo(null,f)}};MapTheme.prototype.chartButton=function(e,c,f){e=map.Dom.newGroup(e,"chartvari"+String(Math.random()));var d=this.szFlag;"2D"==f&&this.removeDefinitionFromFlag("3D");this.szFlag+="|NORMSIZE|SILENT|MENUSIZE|"+f;this.drawChart(e,null,c);this.szFlag=d;d=map.Dom.getBox(e);this.addChartTypeSign(e,f);f=Math.min(map.Scale.normalX(c)/d.width,map.Scale.normalY(c)/d.height);e.fu.scale(f,f);e.fu.setPosition(map.Scale.normalX(c+10),map.Scale.normalY(c)*f);return e};
MapTheme.prototype.addDefinitionToFlag=function(e){return this.szFlag=this.szFlag+"|"+e};MapTheme.prototype.removeDefinitionFromFlag=function(e){for(var c="",f=this.szFlag.split("|"),d=0;d<f.length;d++)f[d]!=e&&(c+=(c.length?"|":"")+f[d]);return this.szFlag=c};MapTheme.prototype.removeDefinition=function(e,c){for(var f="",d=e.split("|"),h=0;h<d.length;h++)d[h]!=c&&(f+=(f.length?"|":"")+d[h]);return f};
MapTheme.prototype.chartMenu=function(e,c,f){f||(f="variation");var d=e+":menu",h=new point(0,0);if(!SVGDocument.getElementById(d)){var g=SVGDocument.getElementById(e+":movable");g||(g=map.Dom.newGroup(SVGThemeGroup,"chartmenu:movable"),SVGThemeGroup.style.setProperty("display","inline",""),h=new point(map.Scale.normalX(50),map.Scale.normalY(150)));var l=map.Dictionary.getLocalText("Chart toolbox");this.toolBoxContainer&&SVGDocument.getElementById(this.toolBoxContainer.szId)?this.toolBoxContainer.setTitle(l):
this.toolBoxContainer=new InfoContainer(SVGDocument,g,d,h,new point(0,0),"fixed",l);map.Dom.clearGroup(this.toolBoxContainer.workspaceNode);d=this.toolBoxContainer;h=this.toolBoxContainer.workspaceNode;d.szTabSelected=f;f=map.Scale.normalX(10);g=map.Scale.normalY(30);szText=map.Dictionary.getLocalText("chart");szType="chart"==d.szTabSelected?"TEXTBUTTON|SELECTED":"TEXTBUTTON";buttonObj=new Button(d.titleTextNode,this.szId,szType,szText,"map.Themes.getTheme('"+this.szId+"').chartMenu('"+e+"','"+c+
"','chart')","","change menu");buttonObj.setPosition(f,g);f+=buttonObj.bBox.width+map.Scale.normalX(2);szText=map.Dictionary.getLocalText("color");szType="color"==d.szTabSelected?"TEXTBUTTON|SELECTED":"TEXTBUTTON";buttonObj=new Button(d.titleTextNode,this.szId,szType,szText,"map.Themes.getTheme('"+this.szId+"').chartMenu('"+e+"','"+c+"','color')","","change menu");buttonObj.setPosition(f,g);f+=buttonObj.bBox.width+map.Scale.normalX(2);szText=map.Dictionary.getLocalText("variation");szType="variation"==
d.szTabSelected?"TEXTBUTTON|SELECTED":"TEXTBUTTON";buttonObj=new Button(d.titleTextNode,this.szId,szType,szText,"map.Themes.getTheme('"+this.szId+"').chartMenu('"+e+"','"+c+"','variation')","","change menu");buttonObj.setPosition(f,g);map.Scale.normalX(2);switch(d.szTabSelected){case "chart":this.getChartTypeMenu(h);break;default:this.getChartColorMenu(h,d.szTabSelected)}this.toolBoxContainer.reformat()}};
MapTheme.prototype.addChartTypeSign=function(e,c){var f="M0,0 l"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" 0,"+map.Scale.normalX(3)+" -"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" M"+map.Scale.normalX(2.5)+",0 l"+map.Scale.normalX(17.5)+",0 M"+map.Scale.normalX(22.5)+",0 l-"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" 0,"+map.Scale.normalX(3)+" "+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+"";if(c.match(/SIZE/)){var d=map.Dom.newGroup(e,"");map.Dom.newShape("path",
d,f,"stroke:white;stroke-width:"+map.Scale.normalX(4)+";stroke-opacity:0.5;stroke-linejoin:miter;");map.Dom.newShape("path",d,f,"stroke:#666666;stroke-width:"+map.Scale.normalX(1.5)+";stroke-linejoin:miter;");d.fu.setPosition(-map.Scale.normalX(10),map.Scale.normalX(-5))}c.match(/HEIGHT/)&&(d=map.Dom.newGroup(e,""),map.Dom.newShape("path",d,f,"stroke:white;stroke-width:"+map.Scale.normalX(4)+";stroke-opacity:0.5;stroke-linejoin:miter;"),map.Dom.newShape("path",d,f,"stroke:#666666;stroke-width:"+map.Scale.normalX(1.5)+
";stroke-linejoin:miter;"),d.setAttributeNS(null,"transform","translate(0,"+-map.Scale.normalX(25)+") rotate(90)"))};
MapTheme.prototype.getChartTypeMenu=function(e,c,f){"undefined"==typeof szChartTypeList&&(szChartTypeList="CHART|BAR CHART|BAR|3D CHART|BAR|3D|SORT CHART|BAR|HORZ|LEFT|UP CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|LEFT|UP|COMPRESS CHART|BAR|HORZ|RIGHT|UP|COMPRESS CHART|BAR|HORZ|LEFT|UP|3D CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|HORZ|LEFT|UP|COMPRESS|3D CHART|BAR|HORZ|RIGHT|UP|COMPRESS|3D CHART|BAR|HORZ|CENTER|UP CHART|BAR|STACKED CHART|BAR|STACKED|3D CHART|BAR|SORT|3D|COLUMNS|STACKED CHART|BAR|SORT|3D|COLUMNS|STACKED|SIZE CHART|PIE CHART|PIE|SIZE CHART|PIE|3D CHART|PIE|3D|SIZE CHART|PIE|3D|HEIGHT CHART|PIE|3D|VOLUME CHART|PIE|DONUT CHART|PIE|DONUT|SIZE CHART|PIE|DONUT|3D CHART|PIE|DONUT|3D|SIZE CHART|PIE|DONUT|3D|HEIGHT CHART|PIE|DONUT|3D|VOLUME CHART|PIE|STARBURST CHART|PIE|STARBURST|SIZE CHART|PIE|STARBURST|3D CHART|PIE|STARBURST|3D|SIZE CHART|PIE|STARBURST|3D|HEIGHT CHART|PIE|STARBURST|3D|VOLUME CHART|PIE|DONUT|STARBURST CHART|PIE|DONUT|STARBURST|SIZE CHART|PIE|DONUT|STARBURST|3D CHART|PIE|DONUT|STARBURST|3D|SIZE CHART|PIE|DONUT|STARBURST|3D|HEIGHT CHART|PIE|DONUT|STARBURST|3D|VOLUME".split(" "));"undefined"==
typeof szChartTypeListSingleValue_old&&(szChartTypeListSingleValue_old="CHART|BAR CHART|BAR|VALUES CHART|BAR|3D CHART|BAR|3D|VALUES CHART|BAR|3D|VOLUME CHART|BAR|3D|VOLUME|VALUES CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|RIGHT|UP|VALUES CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|HORZ|RIGHT|UP|VALUES|3D CHART|BAR|POINTER CHART|BAR|POINTER|VALUES CHART|BUBBLE|SURFACE CHART|BUBBLE|SURFACE|VALUES CHART|SQUARE|SURFACE CHART|SQUARE|SURFACE|VALUES".split(" "));"undefined"==typeof szChartTypeListSingleValue&&(szChartTypeListSingleValue=
"CHOROPLETHE CHART|BUBBLE CHART|SQUARE CHART|PIE|3D|SIZE CHART|PIE|3D|HEIGHT CHART|PIE|3D|SIZE|HEIGHT CHART|BAR|3D|VOLUME CHART|BAR CHART|BAR|3D CHART|BAR|3D|SIZE CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|POINTER CHART|BAR|POINTER|SIZE CHART|BAR|HORZ|RIGHT|UP|POINTER CHART|LABEL".split(" "));var d=this.szOrigFlag;c=szChartTypeListSingleValue;if(1<this.szFieldsA.length||this.szFlag.match(/EXACT/)&&this.szFlag.match(/AGGREGATE/))c=szChartTypeList;f=f?f/60:3;for(i=0;i<c.length;i++){merkFlag=
this.szFlag;var h=map.Dom.constructNode("a",e,{});map.Dom.newShape("rect",h,map.Scale.normalX(i%f*60),map.Scale.normalY(60*Math.floor(i/f)),map.Scale.normalX(60),map.Scale.normalY(60),"fill:#f8f8ff;stroke:lightgray;stroke-dasharray:50 50;stroke-width:"+map.Scale.normalX(1)+";");var g=map.Dom.newGroup(h,"szDisplayId:chart:"+String(Math.random()));map.Dom.setClipRect(g,new box(-map.Scale.normalX(25),-map.Scale.normalX(60),map.Scale.normalX(60),map.Scale.normalX(60)));this.szFlag=c[i]+"|NORMSIZE|SILENT|MENUSIZE";
merkFlag.match(/EXACT/)&&(this.szFlag+="|EXACT");merkFlag.match(/AGGREGATE/)&&(this.szFlag+="|AGGREGATE");merkFlag.match(/RELOCATE/)&&(this.szFlag+="|RELOCATE");merkFlag.match(/DIFFERENCE/)&&(this.szFlag+="|DIFFERENCE");merkFlag.match(/FRACTION/)&&(this.szFlag+="|FRACTION");merkFlag.match(/INVERT/)&&(this.szFlag+="|INVERT");merkFlag.match(/INVERTSIZE/)&&(this.szFlag+="|INVERTSIZE");merkFlag.match(/RELATIVE/)&&(this.szFlag+="|RELATIVE");merkFlag.match(/DENSITY/)&&(this.szFlag+="|DENSITY");merkFlag.match(/DOPACITYMAX/)?
this.szFlag+="|DOPACITYMAX":merkFlag.match(/DOPACITYLOGMAX/)?this.szFlag+="|DOPACITYLOGMAX":merkFlag.match(/DOPACITYPOWMAX/)?this.szFlag+="|DOPACITYPOWMAX":merkFlag.match(/DOPACITYMEAN/)?this.szFlag+="|DOPACITYMEAN":merkFlag.match(/DOPACITYLOGMEAN/)?this.szFlag+="|DOPACITYLOGMEAN":merkFlag.match(/DOPACITYPOWMEAN/)?this.szFlag+="|DOPACITYPOWMEAN":merkFlag.match(/DOPACITYLOG/)?this.szFlag+="|DOPACITYLOG":merkFlag.match(/DOPACITY/)&&(this.szFlag+="|DOPACITY");merkFlag.match(/AUTO100/)&&(this.szFlag+=
"|AUTO100");merkFlag.match(/AUTOCOMPLETE/)&&(this.szFlag+="|AUTOCOMPLETE");var l=this.szAggregation,k=this.drawChart(g,null,40);this.szAggregation=l;if(k){this.szFlag=merkFlag;var m=map.Scale.normalX(10);k.x-=map.Scale.normalX(60/f);g.fu.setPosition(m-k.x+i%f*map.Scale.normalX(60),map.Scale.normalY(40)+m+k.y+Math.floor(i/f)*map.Scale.normalY(60));m="";d.match(/UNDEFINEDISVALUE/)&&(m+="|UNDEFINEDISVALUE");d.match(/ZEROISVALUE/)&&(m+="|ZEROISVALUE");d.match(/NEGATIVEISVALUE/)&&(m+="|NEGATIVEISVALUE");
d.match(/NONEGATIVE/)&&(m+="|NEGATIVEISVALUE");d.match(/AGGREGATE/)&&(m+="|AGGREGATE");d.match(/RELOCATE/)&&(m+="|RELOCATE");d.match(/EXACT/)&&(m+="|EXACT");d.match(/SUM/)&&(m+="|SUM");d.match(/DIFFERENCE/)&&(m+="|DIFFERENCE");d.match(/RELATIVE/)&&(m+="|RELATIVE");d.match(/INVERT/)&&(m+="|INVERT");d.match(/INVERTSIZE/)&&(m+="|INVERTSIZE");d.match(/CALCMEAN/)&&(m+="|CALCMEAN");d.match(/CALC100/)&&(m+="|CALC100");d.match(/PRODUCT/)&&(m+="|PRODUCT");d.match(/AUTOCOMPLETE/)&&(m+="|AUTOCOMPLETE");d.match(/AUTO100/)&&
(m+="|AUTO100");d.match(/QUANTILE/)&&(m+="|QUANTILE");d.match(/DENSITY/)&&(m+="|DENSITY");d.match(/DOPACITY/)&&(m+="|DOPACITY");if(d.match(/VALUES/)||merkFlag.match(/VALUES/))m+="|VALUES";d.match(/VALUEBACKGROUND/)&&(m+="|VALUEBACKGROUND");c[i].match(/SIZE/)&&(merkFlag.match(/SIZELOG/)?m+="|SIZELOG":merkFlag.match(/SIZEP4/)?m+="|SIZEP4":merkFlag.match(/SIZEP3/)?m+="|SIZEP3":merkFlag.match(/SIZE/)&&(m+="|SIZE"));merkFlag.match(/SPACED/)&&(m+="|SPACED");h.setAttributeNS(null,"onclick","map.Themes.changeThemeStyle(evt,'"+
this.szId+"','type:"+c[i]+m+"')");this.addChartTypeSign(g,c[i])}}e=[];for(a in c)e.push(c[a]+m);return e};
MapTheme.prototype.chartColorMenu=function(e){"string"==typeof this.origColorScheme[0]&&this.origColorScheme[0].match(/#/)&&(this.origColorScheme[1]=this.origColorScheme[0],this.origColorScheme[2]=this.origColorScheme[this.origColorScheme.length-1],this.origColorScheme[0]=this.origColorScheme.length,this.origColorScheme.length=3);"undefined"==typeof szColorSchemeList&&(szColorSchemeList=[[null,"red","green","blue","cold"],[null,"blue","orange","yellow","2Colors"],[null,"spectrum","default","270",
"0"],[null,"spectrum","default","200","0"],[null,"spectrum","default","0","270"],[null,"spectrum","default","0","200"]]);"undefined"==typeof szColorSchemeVariantList&&(szColorSchemeVariantList=[[null,null,null,"linear","linear"],[null,null,null,"dynamic","dynamic"],[null,null,null,"auto","auto"],[null,null,null,"2colors","2colors"],[null,null,null,"2wide","2wide"],[null,null,null,"2narrow","2narrow"],[null,null,null,"2low","2low"],[null,null,null,"2high","2high"],[null," "," "," "," "],[null,"green",
"red","auto","cold"],[null,"red","green","auto","cold"],[null,"blue","orange","yellow","2Colors"],[null,"spectrum","default","270","0"],[null,"spectrum","default","200","0"],[null,"spectrum","default","0","270"],[null,"spectrum","default","0","200"]]);"undefined"==typeof szColorSchemeSpectrumVariantList&&(szColorSchemeSpectrumVariantList=[[null,null,"light",null,null],[null,null,"default",null,null],[null,null,"pastel",null,null],[null,null,"soft",null,null],[null,null,"pale",null,null],[null," ",
" "," "," "],[null,"spectrum","default","270","0"],[null,"spectrum","default","200","0"],[null,"spectrum","default","0","270"],[null,"spectrum","default","0","200"],[null,"green","red","auto","cold"],[null,"red","green","auto","cold"],[null,"blue","orange","yellow","2Colors"]]);var c=e+":colormenu";if(!SVGDocument.getElementById(c)&&(e=SVGDocument.getElementById(e+":movable"))){var f=map.Dictionary.getLocalText("Select color scheme variation"),c=new InfoContainer(SVGDocument,e,c,new point(0,0),new point(0,
0),"fixed",f);e=c.workspaceNode;var d=map.Scale.normalX(10),f=map.Scale.normalY(30);szText=map.Dictionary.getLocalText("chart");szType="TEXTBUTTON";buttonObj=new Button(c.titleTextNode,this.szId,szType,szText,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','filter:min;dfilter:0')","","change method");buttonObj.setPosition(d,f);d+=buttonObj.bBox.width+map.Scale.normalX(2);szText=map.Dictionary.getLocalText("color");szType="TEXTBUTTON|SELECTED";buttonObj=new Button(c.titleTextNode,this.szId,szType,
szText,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','filter:mean;dfilter:0')","","change method");buttonObj.setPosition(d,f);map.Scale.normalX(2);map.Dom.newShape("rect",e,0,0,350,350,"fill:white");f=szColorSchemeVariantList;"spectrum"==this.origColorScheme[1]&&(f=szColorSchemeSpectrumVariantList);var h=100,h=200;for(i=0;i<f.length;i++){map.Dom.newShape("rect",e,map.Scale.normalX(i%1*h),map.Scale.normalY(30*Math.floor(i/1)),map.Scale.normalX(h),map.Scale.normalY(30),"fill:#f8f8ff;stroke:lightgray;stroke-dasharray:50 50;stroke-width:"+
map.Scale.normalX(1)+";");for(var d=map.Dom.constructNode("a",e,{}),g=map.Dom.newGroup(d,"szDisplayId:chart:"+String(Math.random())),l=[],d=0;d<f[i].length;d++)l[d]=f[i][d]?f[i][d]:this.origColorScheme[d];for(var k=ColorScheme.createColorScheme(l[1],l[2],l[0],l[3],l[4]),m=map.Scale.normalX((h-10-10)/k.length),u=0;u<k.length;u++)d=map.Scale.normalX(10+i%1*h),map.Dom.newShape("rect",g,d+m*u,map.Scale.normalY(30*Math.floor(i/1)+10),m,map.Scale.normalY(10),"fill:"+k[u]+";stroke:lightgray;stroke-width:"+
map.Scale.normalX(1)+";");g.setAttributeNS(null,"onclick","map.Themes.changeThemeStyle(evt,'"+this.szId+"','colorscheme:"+l[1]+","+l[2]+","+l[3]+","+l[4]+"')")}c.reformat()}};
MapTheme.prototype.getChartColorMenu=function(e,c){for(var f=[],d=0;d<this.origColorScheme.length;d++)f[d]=this.origColorScheme[d];if("string"==typeof f[0]&&f[0].match(/#/)){var d=Math.min(this.origColorScheme.length,this.partsA.length),h=f[0],g=f[d-1],l=f[Math.floor((d-1)/2)];f[0]=d;f[1]=h;f[2]=g;f[3]=null;f[4]=l;f.length=5}"undefined"==typeof szColorSchemeList&&(szColorSchemeList=[[null,"#ffeeee","#dd0000","dynamic","cold"],[null,"#eeffee","#00dd00","dynamic","cold"],[null,"#eeeeff","#0000dd","dynamic",
"cold"],[null,"#FFFDD8","#952D44",null,null],[null,"#FEFDDF","#008A56",null,null],[null,"#FEFDDF","#00308F",null,null],[null,"#FEFDDF","#91308F",null,null],[null,"#FEFDDF","#E5891F",null,null],[null,"#EBF4FB","#00308F",null,null],[null,"#EBF4FB","#91308F",null,null],[null,"#FAE9D6","#E5891F",null,null],[null,"#F9DECA","#9C2700 ","2colors","#F4793B"],[null,"#9C2700","#F9DECA ","2colors","#F4793B"],[null,"#FFFDD8","#B5284B","2colors","#FCBA6C"],[null,"#FFFDB0","#800800","2colors","#F79E00"],[null,"#FFFDB0",
"#6B0601","2colors","#E69511"],[null,"#800800","#FFFDB0","2colors","#F79E00"],[null,"green","red",null,"warm"],[null,"green","#952D44",null,"warm"],[null,"#026622","#8A5195",null,null],[null,"#8A5195","#026622",null,null],[null,"green","red",null,"cold"],[null,"green","#952D44",null,"cold"],[null,"#026622","#8A5195",null,"cold"],[null,"#8A5195","#026622",null,"cold"],[null,"red","green",null,"warm"],[null,"#FF4800","#7CB832","auto","#F7FA7A"],[null,"blue","white","2colors","orange"],[null,"blue",
"red",null,null],[null,"blue","red","auto",null],[null,"blue","red","2colors","orange"],[null,"blue","orange","2low","red"],[null,"blue","#ffcc77","2low","red"],[null,"#ffcc77","blue","2high","red"],[null,"#D1EC6E","#F7C025",null,null],[null,"#D1EC6E","#FF8085",null,null],[null,"#ffffff","#444444","dynamic","cold"],[null,"#444444","#ffffff","dynamic","cold"],[null,"#444444","#444444","dynamic","cold"],[null," "," "," "," "],[null,"spectrum","default","270","0"],[null,"spectrum","default","230","0"],
[null,"spectrum","default","200","0"],[null,"spectrum","default","0","270"],[null,"spectrum","default","0","230"],[null,"spectrum","default","0","200"],[null,"office","","",""],[null,"pastel","","",""],[null,"mineral","","",""],[null,"harvest","","",""]]);"undefined"==typeof szColorSchemeVariantList&&(szColorSchemeVariantList=[[null,null,null,"linear",null],[null,null,null,"dynamic",null],[null,null,null,"auto",null],[null,null,null,"2colors",null],[null,null,null,"2wide",null],[null,null,null,"2narrow",
null],[null,null,null,"2low",null],[null,null,null,"2high",null]]);"undefined"==typeof szColorSchemeSpectrumVariantList&&(szColorSchemeSpectrumVariantList=[[null,null,"light",null,null],[null,null,"default",null,null],[null,null,"pastel",null,null],[null,null,"soft",null,null],[null,null,"pale",null,null]]);h=szColorSchemeList;switch(c){case "color":h=szColorSchemeList;break;case "variation":h=szColorSchemeVariantList,"spectrum"==f[1]&&(h=szColorSchemeSpectrumVariantList)}g=200;g=Math.min(200,15*
f[0]);for(d=0;d<h.length;d++){map.Dom.newShape("rect",e,map.Scale.normalX(d%1*g),map.Scale.normalY(30*Math.floor(d/1)),map.Scale.normalX(g),map.Scale.normalY(30),"fill:#f8f8ff;stroke:lightgray;stroke-dasharray:50 50;stroke-width:"+map.Scale.normalX(1)+";");for(var l=map.Dom.constructNode("a",e,{}),l=map.Dom.newGroup(l,"szDisplayId:chart:"+String(Math.random())),k=[],m=0;m<h[d].length;m++)k[m]=h[d][m]?h[d][m]:f[m];k[0]=Math.min(15,k[0]);for(var m=ColorScheme.createColorScheme(k[1],k[2],k[0],k[3],k[4]),
u=map.Scale.normalX((g-10-10)/m.length),z=0;z<m.length;z++){var q=map.Scale.normalX(10+d%1*g);map.Dom.newShape("rect",l,q+u*z,map.Scale.normalY(30*Math.floor(d/1)+10),u,map.Scale.normalY(10),"fill:"+m[z]+";stroke:lightgray;stroke-width:"+map.Scale.normalX(1)+";")}l.setAttributeNS(null,"onclick","map.Themes.changeThemeStyle(evt,'"+this.szId+"','colorscheme:"+k[1]+","+k[2]+","+k[3]+","+k[4]+"')");l.setAttributeNS(null,"tooltip",k[1]+","+k[2]+","+k[3]+","+k[4])}};
MapTheme.prototype.formatValue=function(e,c,f){return isNaN(e)?e:999<this.nMin&&3E3>this.nMax?__formatValue(e,c,f+"|NOBREAKS"):__formatValue(e,c,f)};MapTheme.prototype.remove=function(e){this.parent.removeTheme(e,this.szId)};MapTheme.prototype.removeElements=function(e){this.widgetNode&&(widgetList.removeWidget(this.widgetNode),this.widgetNode.parentNode.removeChild(this.widgetNode),this.widgetNode=null);this.clipTimeout&&clearTimeout(this.clipTimeout);this.unpaintMap();if(this.onremove)try{eval(this.onremove)}catch(c){}try{HTMLWindow.ixmaps.htmlgui_onRemoveTheme(this.szId)}catch(f){}};
MapTheme.prototype.removeMapThemeStyles=function(e){e=e.split("|");for(var c=SVGRootElement.getElementsByTagName("path"),f=0;f<c.length;f++)if(1==c.item(f).nodeType){var d=c.item(f).parentNode.getAttributeNS(null,"id"),h=!1;if(d&&0!==d.length)for(var d=map.Tiles.getMasterId(d).split(":")[0],g=0;g<e.length;g++)d==e[g]&&(h=!0);h&&c.item(f).parentNode.removeAttributeNS(null,"style")}};
MapTheme.prototype.disable=function(){if(!this.szFlag.match(/CHART/)&&this.widgetNode)for(var e=this.widgetNode.getElementsByTagName("g"),c=0;c<e.length;c++)e.item(c).setAttributeNS(null,"opacity","0.9")};MapTheme.prototype.enable=function(){if(this.widgetNode){for(var e=this.widgetNode.getElementsByTagName("g"),c=0;c<e.length;c++)e.item(c).setAttributeNS(null,"opacity","1.0");this.widgetNode.parentNode.appendChild(this.widgetNode)}map.Themes.setActive(this)};
MapTheme.prototype.makeVisible=function(){for(var e=0;e<this.szThemesA.length;e++)map.Layer.isLayerOn(this.szThemesA[e])||map.Layer.isScaleDependentLayer(this.szThemesA[e])||(map.Themes.switchedLayerA[this.szThemesA[e]]=!0,map.Api.switchMapTheme(this.szThemesA[e],"on")),map.Tiles.switchScaleDependentTiles()};
MapTheme.prototype.checkVisible=function(){for(var e=0;e<this.szThemesA.length;e++)map.Themes.isThemeLayerUsed(this.szThemesA[e])&&this.isVisible||!map.Themes.switchedLayerA[this.szThemesA[e]]||(map.Api.switchMapTheme(this.szThemesA[e],"off"),map.Themes.switchedLayerA[this.szThemesA[e]]=null)};
MapTheme.prototype.resize=function(e){999!=e&&(this.nScale*=e);if(this.szFlag.match(/BUFFER/)&&this.szShapeType.match(/line/))this.fRedrawInfo=this.fRedraw=!0,this.nSkipCount=1,map.Themes.execute();else{map.Layer.changeObjectScaling(null,e,this.chartGroup);this.szFlag.match(/DECLUTTER/)&&this.declutterCharts();if(this.szFlag.match(/BUFFER/)){var c=this.chartGroup.getElementsByTagName("circle");for(n=0;n<c.length;n++){var f=c.item(n).getAttributeNS(null,"style");f&&f.length&&(szNewStylesValue=__scaleStyleString(f,
1/e),c.item(n).setAttributeNS(null,"style",szNewStylesValue))}}this.f=!0;this.showInfo()}};MapTheme.prototype.offset=function(e){var c=this.chartGroup.fu.getPosition();this.chartGroup.fu.setPosition(c.x+e.x,c.y+e.y)};
MapTheme.prototype.opacity=function(e){this.fillOpacity=(this.fillOpacity?this.fillOpacity:1)*e;this.fillOpacity=Math.min(1,this.fillOpacity);this.fillOpacity=Math.max(0,this.fillOpacity);this.nOpacity=(this.nOpacity?this.nOpacity:1)*e;this.nOpacity=Math.min(1,this.nOpacity);this.nOpacity=Math.max(0,this.nOpacity);if(this.chartGroup)for(var c=this.chartGroup.childNodes,f=0;f<c.length;f++)map.Layer.changeNodeOpacity(c.item(f),e);else if(this.szShapeType.match(/line/))for(f=0;f<this.szThemesA.length;f++)map.Layer.changeLayerOpacity(this.szThemesA[f],
e);else for(a in this.itemA)for(c=this.getItemNodes(a),f=0;f<c.length;f++)map.Layer.changeNodeOpacity(c[f],e,"fill-opacity")};
MapTheme.prototype.blur=function(e){if(this.chartGroup)if(this.nBlur){szBlurFilterId="blur-3";var c=SVGDocument.getElementById(szBlurFilterId);c?c.firstChild.setAttributeNS(null,"stdDeviation",map.Scale.normalX(e)):(c=map.Dom.newNode("filter",this.chartGroup.parentNode),c.setAttributeNS(null,"id",szBlurFilterId),filter=map.Dom.newNode("feGaussianBlur",c),filter.setAttributeNS(null,"stdDeviation",map.Scale.normalX(e)));this.chartGroup.style.setProperty("filter","url(#"+szBlurFilterId+")","")}else this.chartGroup.style.removeProperty("filter");
else if(this.szThemesA[0]){var f=SVGDocument.getElementById("maplayer");f&&(this.nBlur?(szBlurFilterId="blur-map",(c=SVGDocument.getElementById(szBlurFilterId))?c.firstChild.setAttributeNS(null,"stdDeviation",map.Scale.normalX(e)/map.Zoom.nZoom):(c=map.Dom.newNode("filter",f.parentNode),c.setAttributeNS(null,"id",szBlurFilterId),c.setAttributeNS(null,"x",0),c.setAttributeNS(null,"y",0),c.setAttributeNS(null,"width","100%"),c.setAttributeNS(null,"height","100%"),filter=map.Dom.newNode("feGaussianBlur",
c),filter.setAttributeNS(null,"stdDeviation",map.Scale.normalX(e)/map.Zoom.nZoom)),f.style.setProperty("filter","url(#"+szBlurFilterId+")","")):f.style.removeProperty("filter"))}};
MapTheme.prototype.toggle=function(){this.chartGroup?"none"==this.chartGroup.style.getPropertyValue("display")?this.chartGroup.style.setProperty("display","inline",""):this.chartGroup.style.setProperty("display","none",""):this.isChecked?(this.unpaintMap(),this.isChecked=!1,map.Themes.activateNextPaint(this)&&(this.fToggle=!1,map.Themes.execute(),this.widgetNode&&(this.widgetNode.setAttributeNS(null,"opacity","1.0"),this.widgetNode.parentNode.appendChild(this.widgetNode)))):(this.fRedraw=this.isChecked=
!0,this.fToggle=!1,map.Themes.execute())};MapTheme.prototype.getHistogram=function(e,c,f){map.Themes.getHistogram(e,c,f,this)};var __maptheme_chartcolors=[];function __maptheme_getChartColors(e){__maptheme_chartcolors[e]||(__maptheme_chartcolors[e]=new ChartColors(e));return __maptheme_chartcolors[e]}
function ChartColors(e){"string"!=typeof e&&(e="#ffffff");this.mainColor=e;this.lowColor=ColorScheme.getDerivateColor(e,.7);this.highColor=ColorScheme.getDerivateColor(e,1.3);this.borderColor=ColorScheme.getBorderColor(e);this.textColor=ColorScheme.getTextColor(e)}function __mpap_hex2dec(e){return parseInt(e,16)}
function __mpap_decode_utf8(e){if("string"==typeof e&&e.match(/&#x/)){var c="";sA=e.split("&#x");c=sA[0];for(e=1;e<sA.length;e++)c+=String.fromCharCode(__mpap_hex2dec(sA[e].substr(0,2))),c+=sA[e].substr(3,sA[e].length-3);return c}return e};
