Map.Viewport=function(b){map.Scale.metadataNode&&(this.szPopupAlignment=(this.alignmentNode=map.Scale.metadataNode.getElementsByTagNameNS(szMapNs,"alignments").item(0))?this.alignmentNode.getAttributeNS(null,"popupwindow"):"",this.szPopupAlignment=szLocalPopupAlignment?szLocalPopupAlignment:this.szPopupAlignment);if(this.eventRect=SVGDocument.getElementById("mapbackground:eventrect"))szMapBackgroundStyle&&this.eventRect.setAttributeNS(null,"style",szMapBackgroundStyle+";pointer-events:all"),szMapBackgroundColor&&
this.eventRect.setAttributeNS(null,"style","fill:"+szMapBackgroundColor+";opacity:1;pointer-events:all");this.clipToolsGroup();this.createPanBorder();this.createNorthArrow();return!0};Map.Viewport.prototype=new Map;Map.Viewport.prototype.reformat=function(){this.clipToolsGroup();this.createPanBorder();this.createNorthArrow()};
Map.Viewport.prototype.clipToolsGroup=function(){map.Dom.setClipRect(SVGToolsGroup,new box(map.Scale.mapPosition.x+map.Scale.normalX(nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.normalY(nMapBorderWidth),map.Scale.bBox.width-2*map.Scale.normalX(nMapBorderWidth),map.Scale.bBox.height-2*map.Scale.normalY(nMapBorderWidth)));this.widgetBox=new box(map.Scale.mapPosition.x+map.Scale.normalX(nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.normalY(nMapBorderWidth+nToolMarginTop),map.Scale.bBox.width-
2*map.Scale.normalX(nMapBorderWidth),map.Scale.bBox.height-2*map.Scale.normalY(nMapBorderWidth))};
Map.Viewport.prototype.createPanBorder=function(){var b=SVGDocument;if(fMapBorder){var d=b.getElementById("widgets:antizoomandpan");if(d){var e=szMapBorderColor,f=map.Scale.normalX(nMapBorderWidth),g=b.getElementById("mapBorderClipCover");g&&g.parentNode.removeChild(g);g=map.Dom.newGroup(d,"mapBorderClipCover");g.setAttributeNS(null,"style","fill:white;opacity:1.0");d.insertBefore(g,d.firstChild);map.Dom.newShape("rect",g,0,0,map.Scale.mapPosition.x,map.Scale.viewBox.height,"");map.Dom.newShape("rect",
g,0,0,map.Scale.viewBox.width+1E4,map.Scale.mapPosition.y,"");map.Dom.newShape("rect",g,0,map.Scale.mapPosition.y+map.Scale.bBox.height,map.Scale.viewBox.width+1E4,map.Scale.viewBox.height-(map.Scale.mapPosition.y+map.Scale.bBox.height)+1E4,"");map.Dom.newShape("rect",g,map.Scale.mapPosition.x+map.Scale.bBox.width,0,map.Scale.viewBox.width-(map.Scale.mapPosition.x+map.Scale.bBox.width)+1E4,map.Scale.bBox.height,"");(g=b.getElementById("mapBorder"))&&g.parentNode.removeChild(g);g=map.Dom.newGroup(d,
"mapBorder");if(fMapBorder3D&&map.Scale.mapPosition.x)e="#ffffff",d.insertBefore(g,d.firstChild),g.fu.setPosition(0,0),f=map.Scale.normalX(250),b=map.Scale.normalX(-3),d=null,d=map.Dom.newShape("rect",g,map.Scale.mapPosition.x,map.Scale.mapPosition.y-f+b,map.Scale.bBox.width,f,"fill:"+e+";opacity:0.5"),d.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),d=map.Dom.newShape("rect",g,0,map.Scale.mapPosition.y+map.Scale.bBox.height-b,map.Scale.mapPosition.x+map.Scale.bBox.width,
f,"fill:"+e+";opacity:0.5"),d.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),d=map.Dom.newShape("rect",g,0,0,map.Scale.mapPosition.x,map.Scale.mapPosition.y+map.Scale.bBox.height,"fill:"+e+";opacity:0.5"),d.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),d=map.Dom.newShape("rect",g,map.Scale.mapPosition.x+map.Scale.bBox.width-b,0,f,map.Scale.mapPosition.y+map.Scale.bBox.height,"fill:"+e+";opacity:0.5"),d.setAttributeNS(null,"style",
"filter:url(#DropShadowFilterTools:antizoomandpan)");else if(g.setAttributeNS(null,"transform","matrix(1 0 0 1 "+map.Scale.mapPosition.x+" "+map.Scale.mapPosition.y+")"),map.Dom.newShape("rect",g,0,0,map.Scale.bBox.width,f,"fill:"+e+";opacity:1.0"),map.Dom.newShape("rect",g,0,map.Scale.bBox.height-f,map.Scale.bBox.width,f,"fill:"+e+";opacity:1.0"),map.Dom.newShape("rect",g,0,0,f,map.Scale.bBox.height,"fill:"+e+";opacity:1.0"),map.Dom.newShape("rect",g,map.Scale.bBox.width-f,0,f,map.Scale.bBox.height,
"fill:"+e+";opacity:1.0"),2<nMapBorderWidth){var e=szMapPanBorderStyle+";stroke-width:"+map.Scale.normalX(1)+";opacity:1.0",b=szMapPanBorderOnoverStyle+";stroke-width:"+map.Scale.normalX(1)+";opacity:1.0",d=null,h=map.Scale.bBox,k=h.width/10,m=h.width/3/+map.Scale.normalX(1),d=map.Dom.newShape("rect",g,k,0,h.width-2*k,f,e);d.setAttributeNS(null,"onclick","map.Viewport.doPanMap(0,"+m+")");d.setAttributeNS(szMapNs,"tooltip","pan");d.setAttributeNS(szMapNs,"onoverstyle",b);d=map.Dom.newShape("rect",
g,k,h.height-f-1,h.width-2*k,f,e);d.setAttributeNS(null,"onclick","map.Viewport.doPanMap(0,"+-m+")");d.setAttributeNS(szMapNs,"tooltip","pan");d.setAttributeNS(szMapNs,"onoverstyle",b);d=map.Dom.newShape("rect",g,0,k,f,h.height-2*k,e);d.setAttributeNS(szMapNs,"onoverstyle",b);d.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+m+",0)");d.setAttributeNS(szMapNs,"tooltip","pan");d.setAttributeNS(szMapNs,"onoverstyle",b);d=map.Dom.newShape("rect",g,h.width-f-1,k,f,h.height-2*k,e);d.setAttributeNS(null,
"onclick","map.Viewport.doPanMap("+-m+",0)");d.setAttributeNS(szMapNs,"onoverstyle",b);d.setAttributeNS(szMapNs,"tooltip","pan");d=map.Dom.newShape("path",g,"M0,0 l "+k+",0 0,"+f+" "+-(k-f)+",0 0,"+(k-f)+" "+-f+",0 z",e);d.setAttributeNS(szMapNs,"onoverstyle",b);d.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+m+","+m+")");d.setAttributeNS(szMapNs,"tooltip","pan");d.setAttributeNS(szMapNs,"onoverstyle",b);d=map.Dom.newShape("path",g,"M"+h.width+","+h.height+" l "+-k+",0 0,"+-f+" "+(k-f)+",0 0,"+
-(k-f)+" "+f+",0 z",e);d.setAttributeNS(szMapNs,"tooltip","pan");d.setAttributeNS(szMapNs,"onoverstyle",b);d.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-m+","+-m+")");d.setAttributeNS(szMapNs,"tooltip","pan");d.setAttributeNS(szMapNs,"onoverstyle",b);d=map.Dom.newShape("path",g,"M"+h.width+",0 l "+-k+",0 0,"+f+" "+(k-f)+",0 0,"+(k-f)+" "+f+",0 z",e);d.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-m+","+m+")");d.setAttributeNS(szMapNs,"onoverstyle",b);d.setAttributeNS(szMapNs,
"tooltip","pan");d=map.Dom.newShape("path",g,"M0,"+h.height+" l "+k+",0 0,"+-f+" "+-(k-f)+",0 0,"+-(k-f)+" "+-f+",0 z",e);d.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+m+","+-m+")");d.setAttributeNS(szMapNs,"tooltip","pan");d.setAttributeNS(szMapNs,"onoverstyle",b)}}}};Map.Viewport.prototype.doPanMap=function(b,d){executeWithMessage("map.Viewport.panMap("+b+","+d+")","please wait ...",100)};Map.Viewport.prototype.panMap=function(b,d){map.Zoom.setNewPan(b,d);map.Event.doDefaultZoom(null)};
Map.Viewport.prototype.setBackgroundColor=function(b){this.eventRect&&this.eventRect.setAttributeNS(null,"style","fill:"+b+";opacity:1;pointer-events:all")};Map.Viewport.prototype.togglePanBorder=function(){var b=SVGDocument.getElementById("mapBorder");b?b.parentNode.removeChild(b):map.Viewport.createPanBorder()};
Map.Viewport.prototype.createNorthArrow=function(){if(fNorthArrow){var b=SVGDocument.getElementById("widgets:antizoomandpan");if(b){var d="none";this.northGroup&&(d=this.northGroup.style.getPropertyValue("display"),this.northGroup.parentNode.removeChild(this.northGroup));this.northGroup=map.Dom.newGroup(b,"mapNorthArrow");d&&this.northGroup.style.setProperty("display",d);"TOP"==szNorthArrowPosition?this.northGroup.fu.setPosition(this.widgetBox.x+this.widgetBox.width-map.Scale.normalX(75),map.Scale.normalX(45+
nToolMarginTop)):this.northGroup.fu.setPosition(this.widgetBox.x+this.widgetBox.width-map.Scale.normalX(75),this.widgetBox.y+map.Scale.normalX((this.widgetBox.y?50:60)+nToolMarginTop));b=map.Scale.normalY(30);d=map.Scale.normalY(12);map.Dom.newShape("circle",this.northGroup,0,0,b,"fill:white;opacity:0.2");map.Dom.newShape("path",this.northGroup,"M0,"+-b/2+" l "+d/2+","+1.2*b+" "+-d/2+","+-b/5+" "+-d/2+","+b/5+" z","fill:#444444;stroke:#ffffff;stroke-width:"+map.Scale.normalX(.4)+";");map.Dom.newText(this.northGroup,
map.Scale.normalX(-5),map.Scale.normalY(-19),"font-family:arial;font-size:"+map.Scale.normalX(12)+"px;font-weight:bold;fill:#444444;stroke:white;stroke-width:0.2;pointer-events:none","N");map.Dom.newShape("rect",this.northGroup,-d/2,-b,d,b,"fill:green;opacity:0.0");"rotatable"==fNorthArrow&&(this.northGroup.setAttributeNS(null,"cursor","pointer"),this.northGroup.setAttributeNS(szMapNs,"tooltip",map.Dictionary.getLocalText("click to move it")),this.northArrowObj=new RotationSlider(this.northGroup,
100,"0,360","1",90,9))&&(this.northArrowObj.parent=this);b=new Button(this.northGroup,"mapNorthArrow:zoomin","BUTTON","#plus_button1","map.Zoom.doZoomMap(2)","","zoom in");b.setPosition(map.Scale.normalY(0),map.Scale.normalY(40));b.scale(1.3,1.3);b.nodeObj.style.setProperty("fill-opacity","0.5","");b=new Button(this.northGroup,"mapNorthArrow:zoomout","BUTTON","#minus_button1","map.Zoom.doZoomMap(0.5)","","zoom out");b.setPosition(map.Scale.normalY(0),map.Scale.normalY(40+2*nNormalButtonSize));b.scale(1.3,
1.3);b.nodeObj.style.setProperty("fill-opacity","0.5","")}}};Map.Viewport.prototype.onClick=function(b){this.northArrowObj&&executeWithMessage("map.Scale.setRotation(null,0)","...")};Map.Viewport.prototype.onMouseUp=function(b){this.northArrowObj&&!fRotateOnMouseMove&&executeWithMessage("map.Scale.setRotation(null,"+this.northArrowObj.getAngle()+")","...")};
Map.Viewport.prototype.onMouseMove=function(b){this.northArrowObj&&fRotateOnMouseMove&&(b=this.northArrowObj.getAngle(),b!=this.nAngle&&(map.Scale.setRotation(null,b),this.nAngle=b))};Map.Viewport.prototype.showNorthArrow=function(){this.northGroup&&this.northGroup.style.setProperty("display","inline","")};
Map.Viewport.prototype.hideNorthArrow=function(){this.northGroup&&"none"!=this.northGroup.style.getPropertyValue("display")&&(this.northGroup.style.setProperty("display","none",""),this.northArrowObj&&executeWithMessage("map.Scale.setRotation(null,0)","..."))};Map.Viewport.prototype.clipMap=function(b){var d=SVGDocument.getElementById("mapcliprect");d&&d.setAttributeNS(null,"width",map.Scale.normalX(b))};
Map.Viewport.prototype.clipLayer=function(b,d){b||(b=_activeTheme);var e=SVGDocument.getElementById(b),f=SVGDocument.getElementById(b+":values");"undefined"!=typeof this.lastClippedLayer&&this.lastClippedLayer!=e&&(map.Dom.setClipRect(this.lastClippedLayer,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.bBox.width,map.Scale.bBox.height)),this.lastClippedLayer=null);"undefined"!=typeof this.lastClippedLayerV&&this.lastClippedLayerV!=f&&(map.Dom.setClipRect(this.lastClippedLayerV,new box(-map.Scale.mapOffset.x,
-map.Scale.mapOffset.y,map.Scale.bBox.width,map.Scale.bBox.height)),this.lastClippedLayerV=null);e&&(map.Dom.setClipRect(e,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.normalX(d),map.Scale.bBox.height)),this.lastClippedLayer=e);f&&(map.Dom.setClipRect(f,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.normalX(d),map.Scale.bBox.height)),this.lastClippedLayerV=f)};
Map.Zoom=function(b){this.canvasNode=SVGDocument.getElementById("mapcanvas");this.zoomNode=SVGDocument.getElementById("mapzoomandpan");this.nZoomY=this.nZoomX=this.nZoom=1;this.doCenter=this.doArea=this.doZoom=null;this.fAreaSet=!1;b&&1<b&&this.doExecuteZoomMap(b,1)};Map.Zoom.prototype=new Map;
Map.Zoom.prototype.init=function(){if(map.Scale.initZoomNode){var b=Number(map.Scale.initZoomNode.getAttribute("MinBoundX")),d=Number(map.Scale.initZoomNode.getAttribute("MaxBoundX")),e=Number(map.Scale.initZoomNode.getAttribute("MinBoundY")),f=Number(map.Scale.initZoomNode.getAttribute("MaxBoundY"));"degree"==map.Scale.initZoomNode.getAttribute("units")?this.doZoomMapToGeoBounds(e,b,f,d):this.Zoom.doZoomMapToEnvelope(b,d,e,f)}};
Map.Zoom.prototype.toFullExtend=function(){setTimeout("map.Zoom.reset()",100)};Map.Zoom.prototype.setNewZoom=function(b){this.doZoom=b;map.Zoom.execute()};Map.Zoom.prototype.setNewPan=function(b,d){this.doPanMap(b,d)};Map.Zoom.prototype.setNewArea=function(b){this.fAreaSet=!0;this.doSetAreaByParentMap(b)||(this.doArea=new box(b.x,b.y,b.width,b.height),map.Zoom.execute())};Map.Zoom.prototype.setNewCenter=function(b){this.doCenterByParentMap(b)||(this.doCenter=new box(b.x,b.y,b.width,b.height),map.Zoom.execute())};
Map.Zoom.prototype.execute=function(){this.doZoom&&(this.doExecuteZoomMap(this.doZoom,this.nZoom),this.nZoom=this.doZoom,this.doZoom=null);this.doArea&&(this.doZoomMapToArea(this.doArea),this.doArea=null);this.doCenter&&(this.doCenterMapToArea(this.doCenter),this.doCenter=null);SVGPopupGroup&&SVGPopupGroup.fu.clear()};Map.Zoom.prototype.cancel=function(){this.doCenter=this.doArea=this.doZoom=null};
Map.Zoom.prototype.reset=function(){this.zoomNode.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)");SVGRootElement.currentTranslate.x=0;SVGRootElement.currentTranslate.y=0;this.nZoom=1;map.Event.doDefaultZoom(null);clearMessage(100)};
Map.Zoom.prototype.getBox=function(){var b=getMatrix(this.canvasNode),d=getMatrix(this.zoomNode),e=-b[4]/this.nZoomX,b=-b[5]/this.nZoomY,e=e-(map.Scale.normalX(SVGRootElement.currentTranslate.x)+d[4])/this.nZoomX,b=b-(map.Scale.normalY(SVGRootElement.currentTranslate.y)+d[5])/this.nZoomY;return new box(e,b,map.Scale.bBox.width/this.nZoomX,map.Scale.bBox.height/this.nZoomY)};
Map.Zoom.prototype.getEnvelope=function(){var b=this.getBox(),d=map.Scale.getMapCoordinate(b.x,b.y),b=map.Scale.getMapCoordinate(b.x+b.width,b.y+b.height);return[d,b]};Map.Zoom.prototype.getEnvelopeString=function(){var b=this.getEnvelope();return String("MinBoundX='"+b[0].x+"' MaxBoundX='"+b[1].x+"' MinBoundY='"+b[1].y+"' MaxBoundY='"+b[0].y+"'")};
Map.Zoom.prototype.getFractionBox=function(){var b=getMatrix(this.zoomNode),d=map.Scale.rotatePoint(new point(b[4],b[5]),-1);b[4]=d.x;b[5]=d.y;xOff=(map.Scale.normalX(SVGRootElement.currentTranslate.x)+b[4])/this.nZoomX;yOff=(map.Scale.normalY(SVGRootElement.currentTranslate.y)+b[5])/this.nZoomY;b=map.Scale.bBox.width-map.Scale.bBox.width/this.nZoomX;d=map.Scale.bBox.height-map.Scale.bBox.height/this.nZoomY;return 0<b&&0<d?new box(.5-xOff/b,.5-yOff/d,1/this.nZoomX,1/this.nZoomY):new box(0,0,1/this.nZoomX,
1/this.nZoomY)};Map.Zoom.prototype.setFractionBox=function(b){var d=map.Scale.bBox.width*b.width,e=map.Scale.bBox.height*b.height;b=new box((map.Scale.bBox.width-d)*b.x+map.Scale.bBox.x,(map.Scale.bBox.height-e)*b.y+map.Scale.bBox.y,d,e);map.Zoom.setNewCenter(b)};
Map.Zoom.prototype.clipArea=function(b){b.width/b.height!=map.Scale.bBox.width/map.Scale.bBox.height&&(b.width>b.height?b.height=b.width/map.Scale.bBox.width*map.Scale.bBox.height:b.width=b.height/map.Scale.bBox.height*map.Scale.bBox.width);var d=b.x-map.Scale.bBox.x,e=map.Scale.bBox.x+map.Scale.bBox.width-(b.x+b.width),f=b.y-map.Scale.bBox.y,g=map.Scale.bBox.y+map.Scale.bBox.height-(b.y+b.height);if(0>d||0>e||0>f||0>g){if(0>d&&0>e)b.x=map.Scale.bBox.x,b.width=map.Scale.bBox.width;else if(0>d)b.x+=
-d,b.width-=e>-d?0:-d-e;else if(0>e)return b.x-=-e,this.clipArea(b);if(0>f&&0>g)b.y=map.Scale.bBox.y,b.height=map.Scale.bBox.heigt;else if(0>f)b.y+=-f,b.height-=g>-f?0:-f-g;else if(0>g)return b.y-=-g,this.clipArea(b)}return b};Map.Zoom.prototype.isVisibleBox=function(b){try{var d=this.getBox();return b.x+b.width<d.x||b.x>d.x+d.width||b.y+b.height<d.y||b.y>d.y+d.height?!1:!0}catch(e){return!1}};
Map.Zoom.prototype.isCompletelyVisibleBox=function(b){var d=this.getBox();return b.x<d.x||b.x+b.width>d.x+d.width||b.y<d.y||b.y+b.height>d.y+d.height?!1:!0};
Map.Zoom.prototype.doExecuteZoomMap=function(b,d){b=this.checkZoomLimit(b);if(b!=this.nZoom){var e=getMatrix(this.zoomNode),f=(SVGRootElement.currentTranslate.x+map.Scale.embedX(e[4]))/d*b,e=(SVGRootElement.currentTranslate.y+map.Scale.embedX(e[5]))/d*b;this.nZoomX=this.nZoomX/d*b;this.nZoomY=this.nZoomY/d*b;fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix("+this.nZoomX+" 0 0 "+this.nZoomY+" 0 0)"),SVGRootElement.currentTranslate.x=f,SVGRootElement.currentTranslate.y=e):this.zoomNode.setAttributeNS(null,
"transform","matrix("+this.nZoomX+" 0 0 "+this.nZoomY+" "+map.Scale.normalX(f)+" "+map.Scale.normalY(e)+")");this.nZoom=b;map.Event.doDefaultZoom(null)}};
Map.Zoom.prototype.doZoomMapToArea=function(b){this.fAreaSet=!0;var d=getMatrix(this.canvasNode);new point(d[4],d[5]);var d=Math.min(map.Scale.bBox.width/b.width,map.Scale.bBox.height/b.height),e=map.Scale.bBox.width/b.width,f=map.Scale.bBox.height/b.height,d=Math.round(1E6*d)/1E6,e=Math.round(1E6*e)/1E6,f=Math.round(1E6*f)/1E6,g=this.checkZoomLimit(d);g!=d&&b.scale(d/g);d=g;d!=this.nZoom&&(fPreserveMapRatio&&(e=f=d),fZoomByViewer&&fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),
SVGRootElement.currentScale=d):fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix("+e+" 0 0 "+f+" 0 0)"),SVGRootElement.currentScale=1):this.zoomNode.setAttributeNS(null,"transform","matrix("+e+" 0 0 "+f+" 0 0)"),this.nZoom=d,this.nZoomX=e,this.nZoomY=f);this.doCenterMapToArea(b)};
Map.Zoom.prototype.doCenterMapToArea=function(b){this.fAreaSet=!0;this.fExternalZoom=!1;var d=getMatrix(this.canvasNode),e=new point(d[4],d[5]),f=getMatrix(this.zoomNode),d=f[0],f=f[3];b.x+=b.width/2;b.y+=b.height/2;b.x=b.x*d+e.x;b.y=b.y*f+e.y;var e=-b.x+map.Scale.bBox.width/2,g=-b.y+map.Scale.bBox.height/2,g=map.Scale.rotatePoint(new point(e,g)),e=g.x,g=g.y;fZoomByViewer&&fPanByViewer?(SVGRootElement.currentScale=nNewZoom,SVGRootElement.currentTranslate.x=map.Scale.embedX(e-b.width/2)*nNewZoomX,
SVGRootElement.currentTranslate.y=map.Scale.embedY(g-b.height/2)*nNewZoomY):fPanByViewer?(SVGRootElement.currentTranslate.x=map.Scale.embedX(e),SVGRootElement.currentTranslate.y=map.Scale.embedY(g)):(b=getTranslate(this.zoomNode),this.zoomNode.setAttributeNS(null,"transform","matrix("+d+" 0 0 "+f+" "+e+" "+g+")"),this.doPanFixed(e-b.x,g-b.y));fFroozeDynamicContent||(map.isIdle()?map.Event.doDefaultZoom(null):map.pushAction("map.Event.doDefaultZoom(null)"))};
Map.Zoom.prototype.doPanFixed=function(b,d){for(var e=SVGFixedGroup.childNodes,f=0;f<e.length;f++){var g=e.item(f).fu.getPosition();e.item(f).fu.setPosition(g.x+b,g.y+d)}e=SVGToolsGroup.childNodes;for(f=0;f<e.length;f++)g=e.item(f).fu.getPosition(),e.item(f).fu.setPosition(g.x+b,g.y+d)};
Map.Zoom.prototype.doZoomMapToWidgetRect=function(b){var d=Math.min(b.width,b.height)<map.Scale.normalX(25)?!0:!1;new point(b.x,b.y);new point(b.x-b.width,b.y-b.height);var e=getMatrix(map.Scale.zoomNode),f=e[0],g=e[3],h=antiZoomAndPanList.getActualMatrix(),k=map.Scale.rotatePoint(new point(e[4],e[5]),-1);e[4]=k.x;e[5]=k.y;b.x=b.x*h[0]+h[4];b.y=b.y*h[3]+h[5];b.width*=h[0];b.height*=h[3];b.x=b.x-map.Scale.mapPosition.x-map.Scale.mapOffset.x;b.y=b.y-map.Scale.mapPosition.y-map.Scale.mapOffset.y;b.x=
(b.x-e[4])/f;b.y=(b.y-e[5])/g;b.width/=f;b.height/=g;d?map.Zoom.setNewCenter(b):map.Zoom.setNewArea(b)};
Map.Zoom.prototype.doZoomMapToEnvelope=function(b,d,e,f){this.doCheckEnvelope(b,d,e,f)?(b=(b-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x,f=map.Scale.maxY-map.Scale.minY-(f-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y,map.Zoom.setNewArea(new box(b,f,(d-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x-b,map.Scale.maxY-map.Scale.minY-(e-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y-f),300)):map.Zoom.doZoomMapToLayer("maplayer")};
Map.Zoom.prototype.doCenterMapToEnvelope=function(b,d,e,f){this.doCheckEnvelope(b,d,e,f)&&(b=(b-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x,f=map.Scale.maxY-map.Scale.minY-(f-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y,map.Zoom.doCenterMapToArea(new box(b,f,(d-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x-b,map.Scale.maxY-map.Scale.minY-(e-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y-f)))};
Map.Zoom.prototype.doCenterMapToGeoPosition=function(b,d){var e=map.Scale.getMapCoordinateOfLatLon(b,d);e?this.doSetCenterByParentMap(e.x,e.y)||this.doCenterMapToEnvelope(e.x,e.x,e.y,e.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};
Map.Zoom.prototype.doCenterMapToGeoBounds=function(b,d,e,f){this.fExternalZoom=!1;b=map.Scale.getMapCoordinateOfLatLon(b,d);e=map.Scale.getMapCoordinateOfLatLon(e,f);b&&e?this.doCenterMapToEnvelope(b.x,e.x,b.y,e.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};
Map.Zoom.prototype.doZoomMapToGeoBounds=function(b,d,e,f){b=map.Scale.getMapCoordinateOfLatLon(b,d);e=map.Scale.getMapCoordinateOfLatLon(e,f);b&&e?this.doSetEnvelopeByParentMap(b.x,e.x,b.y,e.y)||this.doZoomMapToEnvelope(b.x,e.x,b.y,e.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};Map.Zoom.prototype.doZoomMapToView=function(b,d){try{HTMLWindow.ixmaps.htmlgui_setCenterAndZoom({lat:b[0],lng:b[1]},d)}catch(e){return!1}};
Map.Zoom.prototype.doZoomMapToLayer=function(b){if(fPendingNewGeoBounds)fPendingNewGeoBounds=!1;else{var d=SVGDocument.getElementById(b),e=map.Dom.getBox(d),d=map.Scale.getMapOffset(d);e.x+=d.x;e.y+=d.y;e=new box(e.x,e.y,e.width,e.height);e.scale(.8);if("maplayer"==b){var d=b=3E4,f=-3E4,g=-3E4,h=!1;for(a in map.Layer.listA)if(!a.match(/legend/)){var k=SVGDocument.getElementById(a+"::bbox");k&&(b=Math.min(b,Number(k.getAttributeNS(null,"minboundx"))),d=Math.min(d,Number(k.getAttributeNS(null,"minboundy"))),
f=Math.max(f,Number(k.getAttributeNS(null,"maxboundx"))),g=Math.max(g,Number(k.getAttributeNS(null,"maxboundy"))),h=!0)}h&&(e=new box(b,d,Math.abs(f-b),Math.abs(g-d)))}e.width&&e.height&&e.width<map.Scale.bBox.width&&e.height<map.Scale.bBox.height&&!map.Zoom.doSetAreaByParentMap(e)&&(map.hideMap(),map.Zoom.setNewArea(e))}};
Map.Zoom.prototype.doSetMapToGeoBounds=function(b,d,e,f){this.fExternalZoom=!1;b=map.Scale.getMapCoordinateOfLatLon(b,d);e=map.Scale.getMapCoordinateOfLatLon(e,f);b&&e?(map.hideMap(),this.doZoomMapToEnvelope(b.x,e.x,b.y,e.y)):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};Map.Zoom.prototype.getCenterOfMapInGeoPosition=function(){var b=this.getBox(),b=map.Scale.getMapCoordinate(b.x+b.width/2,b.y+b.height/2);return b=map.Scale.getGeoCoordinateOfPoint(b.x,b.y)};
Map.Zoom.prototype.getBoundsOfMapInGeoBounds=function(){var b=this.getBox(),d=map.Scale.getMapCoordinate(b.x,b.y+b.height),b=map.Scale.getMapCoordinate(b.x+b.width,b.y),d=map.Scale.getGeoCoordinateOfPoint(d.x,d.y),b=map.Scale.getGeoCoordinateOfPoint(b.x,b.y);return[d,b]};
Map.Zoom.prototype.doCheckEnvelope=function(b,d,e,f){return fLimitMapToExtent?b<map.Scale.minBoundX&&d>map.Scale.maxBoundX&&e<map.Scale.minBoundY&&f>map.Scale.maxBoundY&&d-b>2*(map.Scale.maxBoundX-map.Scale.minBoundX)||b>map.Scale.maxBoundX||d<map.Scale.minBoundX||e>map.Scale.maxBoundY||f<map.Scale.minBoundY?(displayMessage("position outside",500),!1):!0:!0};
Map.Zoom.prototype.doSetAreaByParentMap=function(b){var d=map.Scale.getMapCoordinate(b.x,b.y);b=map.Scale.getMapCoordinate(b.x+b.width,b.y+b.height);return this.doSetEnvelopeByParentMap(d.x,b.x,d.y,b.y)};Map.Zoom.prototype.doSetEnvelopeByParentMap=function(b,d,e,f){try{return ptSW=map.Scale.getGeoCoordinateOfPoint(b,e),ptNE=map.Scale.getGeoCoordinateOfPoint(d,f),this.fExternalZoom=!0,HTMLWindow.ixmaps.htmlgui_setCurrentEnvelopeByGeoBounds(ptSW,ptNE)}catch(g){return!1}};
Map.Zoom.prototype.doCenterByParentMap=function(b){b=map.Scale.getMapCoordinate(b.x+b.width/2,b.y+b.height/2);return this.doSetCenterByParentMap(b.x,b.y)};Map.Zoom.prototype.doSetCenterByParentMap=function(b,d){try{return ptCenter=map.Scale.getGeoCoordinateOfPoint(b,d),HTMLWindow.ixmaps.htmlgui_setCurrentCenterByGeoBounds(ptCenter)}catch(e){return!1}};
Map.Zoom.prototype.doZoomMap=function(b,d){if(this.zoomNode){displayMessage("please wait ...",500);var e=getMatrix(map.Zoom.zoomNode)[0];if(0==b)return this.toFullExtend(),Math.round(map.Scale.nMapScale);switch(d){case "absolute":e=b;break;case "byscale":e=map.Scale.nTrueMapScale/b;break;default:e*=b}this.setNewZoom(e);return Math.round(map.Scale.nMapScale/e)}};
Map.Zoom.prototype.doPanMap=function(b,d){var e=getMatrix(this.zoomNode),f=e[0],g=e[3],h=SVGRootElement.currentTranslate.x+b,k=SVGRootElement.currentTranslate.y+d,k=map.Scale.rotatePoint(new point(h,k)),h=k.x,k=k.y,h=h+map.Scale.embedX(e[4]),k=k+map.Scale.embedY(e[5]);fPanByViewer?(SVGRootElement.currentTranslate.x=h,SVGRootElement.currentTranslate.y=k):(h=map.Scale.normalX(h),k=map.Scale.normalY(k),e=getTranslate(this.zoomNode),this.zoomNode.setAttributeNS(null,"transform","matrix("+f+" 0 0 "+g+
" "+h+" "+k+")"),this.doPanFixed(h-e.x,k-e.y));try{var m=this.getBox(),p=map.Scale.getMapCoordinate(m.x+m.width/2,m.y+m.height/2);this.doSetCenterByParentMap(p.x,p.y)}catch(q){try{HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(this.getEnvelopeString(),!1)}catch(A){}}};Map.Zoom.prototype.doPanMapByViewer=function(b,d){var e=SVGRootElement.currentTranslate.y+d;SVGRootElement.currentTranslate.x+=b;SVGRootElement.currentTranslate.y=e};
Map.Zoom.prototype.checkZoomLimit=function(b){var d=1E6;fPDFEmbed&&(d=20,map.Tiles&&1<map.Tiles.nCount&&(d=20));return b>=d?(displayMessage("zoom limit !",1E3),d):b=Math.round(1E6*b)/1E6};Map.Zoom.prototype.removeClipping=function(b){fClipMapDynamic&&SVGDocument.getElementById("mapclip").setAttributeNS(null,"clip-path","")};Map.Zoom.prototype.activateClipping=function(b){fClipMapDynamic&&SVGDocument.getElementById("mapclip").setAttributeNS(null,"clip-path","url(#mapclippath)")};
Map.Zoom.prototype.onMouseMove=function(b){};Map.Zoom.prototype.onMouseDown=function(b){};Map.Zoom.prototype.onMouseUp=function(b){this.setFractionBox(new box(this.overviewThumbObj.fraction.x,this.overviewThumbObj.fraction.y,1/this.nZoomX,1/this.nZoomY))};
Map.Layer=function(b){this.document=b?b.target.ownerDocument:SVGDocument;this.layerNode=SVGDocument.getElementById("maplayer");this.listA=[];this.depListA=[];this.generatedLabelA=[];this.changedFeatureNodesA=[];this.objectGroup=SVGDocument.getElementById(szObjectGroupId);this.fSwitchSublayer=!0;this.nDynamicObjectScale=this.nObjectScale=this.nFeatureScale=1;b=0;var d=SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(d.length)for(this.listA.legend_body=new Map.Layer.Item(null),b=0;b<d.length;b++)this.listA[d.item(b).getAttributeNS(null,
"name")]=new Map.Layer.Item(d.item(b));d=SVGDocument.getElementsByTagNameNS(szMapNs,"scaledependency");if(!(0>=d.length))for(b=0;b<d.length;b++){var e=d.item(b).getAttributeNS(null,"feature");this.depListA[e]=new Map.Layer.Dependency(d.item(b))}};Map.Layer.prototype=new Map;
Map.Layer.Item=function(b){if(b){if(this.szName=b.getAttributeNS(null,"name"),this.szLegendName=b.getAttributeNS(null,"legendname"),this.szFlag=b.getAttributeNS(null,"flag"),this.szType=b.getAttributeNS(null,"type"),this.nItems=Number(b.getAttributeNS(null,"items")),this.nRenderer=b.getAttributeNS(null,"renderer"),this.szRenderer=b.getAttributeNS(null,"rendererfield"),this.szLabel=b.getAttributeNS(null,"label"),this.szSelection=b.getAttributeNS(null,"selection"),this.szFilter=b.getAttributeNS(null,
"filter"),this.szFilterValue=b.getAttributeNS(null,"filtervalue"),this.szHighlight=b.getAttributeNS(null,"highlightstyle"),this.szDisplay=b.getAttributeNS(null,"display"),this.szDisplayLabel=b.getAttributeNS(null,"displaylabel"),this.categoryA=this.labelBoxA=null,b=b.getElementsByTagNameNS(szMapNs,"category"),b.length){this.categoryA=[];for(var d=0;d<b.length;d++){var e=this.categoryA[b.item(d).getAttributeNS(null,"name")]={};e.legendname=b.item(d).getAttributeNS(null,"legendname");e.fill=b.item(d).getAttributeNS(null,
"fill");e.stroke=b.item(d).getAttributeNS(null,"stroke");e.style=b.item(d).getAttributeNS(null,"style");e.display="inline"}}}else this.szFlag="",this.szType="dummy",this.szDisplayLabel=this.szDisplay="inline"};
Map.Layer.Dependency=function(b){b&&(this.shapeId=b.getAttributeNS(null,"shape"),this.szFeature=b.getAttributeNS(null,"feature"),this.depClass=b.getAttributeNS(null,"classname"),this.nUpper=1E11,this.nLower=0,this.depLower=b.getAttributeNS(null,"lower"),(this.depUpper=b.getAttributeNS(null,"upper"))&&this.depUpper.length&&(this.nUpper=Number(this.depUpper.split(":")[1])),this.depLower&&this.depLower.length&&(this.nLower=Number(this.depLower.split(":")[1])),this.szDisplayAttribute="inline")};
function __doSwitchGroupTheme(b,d){var e=SVGDocument.getElementById("legend:"+d+":"+b);e&&map.Legend&&(map.Legend.execLegendMouseClick(null,e,b,d),map.Legend.execLegendMouseClick(null,e,b+":label",d))}
function __doSwitchGroupThemes(b,d){var e="legend:collapsable:"+b.split(":")[0];if(e=SVGDocument.getElementById(e))for(e=e.childNodes,i=0;i<e.length;i++)if(1==e.item(i).nodeType){var f=e.item(i).getAttributeNS(null,"id").split("legend:setactive:")[1];f||(f=e.item(i).getAttributeNS(null,"id").split("legend:item:")[1]);var g=d?"on":"off";f&&f!=b&&!f.match(/"/)&&SVGDocument.getElementById("legend:"+g+":"+f)&&(0==d||map.Layer.isScaleDependentLayerOn(f))&&setTimeout('__doSwitchGroupTheme("'+f+'","'+g+
'")',10*i)}}
Map.Layer.prototype.switchLayer=function(b,d,e,f){var g=f?"inline":"none",h=this.listA[d.split(":")[0]];if(e&&e.match(/legendgroup/))return!0;if(d&&!d.match(/label/)&&!d.match(/::/)&&(d.match(/group/)||this.fSwitchSublayer)){var k="legend:collapsable:"+d.split(":")[0];SVGDocument.getElementById(k)&&setTimeout('__doSwitchGroupThemes("'+d+'",'+f+")",250)}d&&!d.match(/label/)&&d.match(/::/)&&1==f&&(k=this.fSwitchSublayer,this.fSwitchSublayer=!1,this.switchLayer(b,d.split("::")[0],e,!0),this.fSwitchSublayer=k,
(k=SVGDocument.getElementById("legend:off:"+d.split("::")[0]))&&"inline"!=k.style.getPropertyValue("display")&&(k=SVGDocument.getElementById("legend:suboff:"+d.split("::")[0]))&&k.style.setProperty("display","inline",""));d.match(/label/)&&!d.match(/:bg/)&&this.switchLayer(b,d+":bg",e,f);d.split("::")[1]&&h.categoryA[d.split("::")[1]]?h.categoryA[d.split("::")[1]].display=g:(h.categoryA[null]&&(h.categoryA[null].display=g),h.display=g,h.nState="none"==g?!1:!0);return h&&(this.switchLayerByFeature(d,
f)||this.switchLayerOnTiles(d,f))?(d.match(/:label/)?h.szDisplayLabel=g:(h.nState=f,h.szDisplay=g),h.szLabel&&this.adaptLabel(b),setTimeout("map.Layer.adaptLabel()",100),!0):e&&!d.match(/:label/)?(this.switchLayerByCSS(null,d,e,f?"inline":"none"),h&&(h.szDisplay=g),setTimeout("map.Layer.adaptLabel()",100),!0):!1};
Map.Layer.prototype.switchLayerOnTiles=function(b,d){var e=!1;if(map.Tiles&&0<map.Tiles.nCount)for(var f=map.Tiles.getTileNodeIds(b),g=0;g<f.length;g++)e=this.switchLayerByFeature(f[g],d)?!0:e;return e};
Map.Layer.prototype.switchLayerByFeature=function(b,d){var e,f=!1,g=this.document.getElementById(b);if(g)if(this.addChangedFeatureNode(g),"linetemplate"==g.getAttributeNS(null,"class")||"linetemplate"==g.getAttributeNS(szMapNs,"class"))if(b.match(/#/)){var h=b.split("#");for(e=0;10>e;e++)if(g=this.document.getElementById(h[0]+"_"+e+"#"+h[1]))g.style.setProperty("display",d?"inline":"none",""),f=!0}else for(e=0;10>e;e++){if(g=this.document.getElementById(b+"_"+e))g.style.setProperty("display",d?"inline":
"none",""),f=!0}else g.style.setProperty("display",d?"inline":"none",""),f=!0;return f};
Map.Layer.prototype.switchLayerByCSS=function(b,d,e,f){if("(null)"!=e){if(d&&(d=d.split(":")[0],this.listA[d+"_1"])){var g=e.substr(d.length,e.length-d.length),h=parseInt(g),k=parseInt(g.substr(g.length-1,1)),g=e.substr(0,d.length);for(e=1;this.listA[d+"_"+e];)h++,this.switchLayerByCSS(b,null,g+"-"+e+h+"s"+k,f),e++;return}map.Scale.CSSStyleNodes&&(b=map.Scale.CSSStyleNodes,map.CSS=new Map.CSS(map.Scale.CSSStyleNodes),map.CSS.setStyle(e,"display",f),map.Scale.fCSSStyleNodeChanged=!0,b.firstChild.nextSibling.nodeValue=
map.CSS.getStyleString(),displayMessage("please wait ...",500),setTimeout("map.Scale.refreshCSSStyles()",200))}};
Map.Layer.prototype.switchScaleDependentLayer=function(b,d){if(fDynamicLayer){var e="";if(null!=this.depListA){var f=0;for(f in this.depListA){map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.depListA[f].nLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.depListA[f].nUpper?e="inline":(e="none",!this.depListA[f].shapeId.match(/:label/)&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.depListA[f].nUpper&&(map.Themes&&0!=map.Themes.getThemeCount()||displayMessage("'"+this.depListA[f].shapeId+
"' not visible at actual zoom level!",3E3,"notify")));if(this.depListA[f].szDisplayAttribute!=e){this.depListA[f].szDisplayAttribute=e;if(this.isChangedFeature(this.depListA[f].shapeId)){if(this.depListA[f].szOldDisplayAttribute==e)continue;this.depListA[f].szOldDisplayAttribute=this.depListA[f].szDisplayAttribute}var g=this.depListA[f].szFeature;map.Legend&&map.Legend.switchLegendCheckBox(b,g,e)}try{var h=this.depListA[f].shapeId;h.match(/label/)?(h.split(":"),this.listA[h.split(":")[0]].szDisplayLabel=
e):this.listA[h].szDisplay=e}catch(k){alert("Syntax error: "+h)}}if(map.Scale.CSSStyleNodes&&fSwitchByCSS){e=map.Scale.CSSStyleNodes;map.CSS=new Map.CSS(map.Scale.CSSStyleNodes);g=h=null;for(f in this.depListA)g=this.depListA[f],g.szDisplayAttribute!=g.szOldDisplayAttribute&&(h=g.depClass,3<h.length?(map.CSS.setStyle(h,"display",g.szDisplayAttribute),map.Scale.fCSSStyleNodeChanged=!0):(h=SVGDocument.getElementById(g.shapeId))&&h.style.setProperty("display",g.szDisplayAttribute,""));map.Scale.fCSSStyleNodeChanged&&
(e.firstChild.nextSibling.nodeValue=map.CSS.getStyleString())}else for(d=d?d:SVGRootElement,f=d.getElementsByTagName("g"),e=0;e<f.length;e++)g=f.item(e).getAttributeNS(null,"id"),g=map.Tiles.getMasterId(g),this.depListA[g]&&f.item(e).style.setProperty("display",this.depListA[g].szDisplayAttribute,"")}}};Map.Layer.prototype.isScaleDependentLayer=function(b){return this.depListA&&this.depListA[b]?!0:!1};
Map.Layer.prototype.isScaleDependentLayerOn=function(b){return this.depListA&&this.depListA[b]?this.depListA[b].szDisplayAttribute.match(/none/)?!1:!0:!0};
Map.Layer.prototype.zoomToScaleDependentLayerOn=function(b){if("undefined"!=typeof this.listA[b]){map.Event.doDefaultZoom(null);var d=map.Scale.nTrueMapScale*map.Scale.nZoomScale,e=0,e=this.depListA&&this.depListA[b]&&this.depListA[b].nUpper?this.depListA[b].nUpper:map.Tiles.depUpper?map.Tiles.depUpper.split(":")[1]:0,e=Math.ceil(d/e);b=map.Zoom.getBox();d=b.width/e;e=b.height/e;b.x+=(b.width-d)/2;b.y+=(b.height-e)/2;b.width=d;b.height=e;map.Zoom.setNewArea(b);setTimeout("map.Tiles.switchScaleDependentTiles()",
5E3)}};Map.Layer.prototype.isLayerOn=function(b){return this.listA[b]?this.listA[b].szDisplay.match(/none/)?!1:!0:!1};Map.Layer.prototype.changeLayerOpacity=function(b,d){var e=!1;(e=this.changeOpacity(b,d))||(e=this.changeOpacityOnTiles(b,d));return e};Map.Layer.prototype.changeOpacityOnTiles=function(b,d){var e=!1;if(map.Tiles&&0<map.Tiles.nCount)for(var f=map.Tiles.getTileNodeIds(b),g=0;g<f.length;g++)e=this.changeOpacity(f[g],d)?!0:e;else e=this.changeOpacity(b,d)?!0:e;return e};
Map.Layer.prototype.changeOpacity=function(b,d){var e,f=!1,g=this.document.getElementById(b);if(g)if("linetemplate"==g.getAttributeNS(null,"class")||"linetemplate"==g.getAttributeNS(szMapNs,"class"))if(b.match(/#/)){var h=b.split("#");for(e=0;10>e;e++)if(g=this.document.getElementById(h[0]+"_"+e+"#"+h[1]))this.changeNodeOpacity(g,d),f=!0}else for(e=0;10>e;e++){if(g=this.document.getElementById(b+"_"+e))this.changeNodeOpacity(g,d),f=!0}else this.changeNodeOpacity(g,d),f=!0;return f};
Map.Layer.prototype.changeNodeOpacity=function(b,d,e){var f=b.style.getPropertyValue(e?e:"opacity");f&&0!=f.length||(f="1");f=Number(f);f=Math.min(1,f*d);f=Math.max(0,f);b.style.setProperty(e?e:"opacity",String(f),"")};
Map.Layer.prototype.initPatternScaling=function(b,d){d||(d=SVGRootElement);var e=1/map.Scale.getEmbedScale()*map.Scale.nFeatureScaling;nodeA=d.getElementsByTagName("pattern");for(i=0;i<nodeA.length;i++)nodeA.item(i).getAttributeNS(null,"id").match(/antizoomandpan/)||(getPatternMatrix(nodeA.item(i)),nodeA.item(i).setAttributeNS(null,"patternTransform","matrix("+e+" 0 0 "+e+" 0 0)"))};Map.Layer.prototype.changeLineScaling=function(b,d){this.doFeatureScaling(d);map.Scale.nLineScaling*=d};
Map.Layer.prototype.changeLabelScaling=function(b,d){this.doLabelScaling(d);map.Scale.nLabelScaling*=d};
Map.Layer.prototype.changeFeatureScaling=function(b,d,e){if(!(1<=d&&1<=map.Scale.featureScaling_lastScale)||e){var f=d/map.Scale.getEmbedScale();e=d;if(fFeatureScalingDynamic){var g=Math.log(1/d);1<g&&(d*=g)}map.Layer.nFeatureScale=d;map.Layer.nDynamicScale=map.Layer.nFeatureScale/map.Scale.nZoomScale;g=d/map.Scale.featureScaling_lastScale;map.Scale.featureScaling_lastScale=d;if(0!==g&&1!==g)if(fFeatureScaling){for(var h=null,k=0,h=SVGRootElement.getElementsByTagName("pattern"),k=getMatrix(map.Scale.zoomNode),
m=k[4]+map.Scale.scaleX(SVGRootElement.currentTranslate.x),p=k[5]+map.Scale.scaleY(SVGRootElement.currentTranslate.y),m=-m*f,p=-p*f,k=0;k<h.length;k++)h.item(k).getAttributeNS(null,"id").match(/antizoomandpan/)||(getPatternMatrix(h.item(k)),h.item(k).setAttributeNS(null,"patternTransform","matrix("+f+" 0 0 "+f+" "+String(m)+" "+String(p)+")"));b=b?b.target.ownerDocument:SVGDocument;h=!0;1>map.Scale.nFeatureScaling&&(h=!1,1>g&&1<=map.Scale.nFeatureScaling*map.Zoom.nZoom&&(1>map.Scale.nFeatureScaling*
map.Zoom.nZoom*g&&(g=1/map.Scale.nFeatureScaling/map.Zoom.nZoom),h=!0),1<g&&1<=map.Scale.nFeatureScaling*map.Zoom.nZoom*g&&(1>map.Scale.nFeatureScaling*map.Zoom.nZoom&&(g=map.Zoom.nZoom*g/(1/map.Scale.nFeatureScaling)),h=!0));if(h){h=SVGRootElement.getElementsByTagName("filter");for(k=0;k<h.length;k++)if(!h.item(k).getAttributeNS(null,"id").match(/antizoomandpan/))for(f=h.item(k).childNodes,c=0;c<f.length;c++)"feMorphology"==f.item(c).nodeName&&f.item(c).setAttributeNS(null,"radius",Number(f.item(c).getAttributeNS(null,
"radius"))*g),"feOffset"==f.item(c).nodeName&&(f.item(c).setAttributeNS(null,"dx",Number(f.item(c).getAttributeNS(null,"dx"))*g),f.item(c).setAttributeNS(null,"dy",Number(f.item(c).getAttributeNS(null,"dy"))*g)),"feGaussianBlur"==f.item(c).nodeName&&f.item(c).setAttributeNS(null,"stdDeviation",Number(f.item(c).getAttributeNS(null,"stdDeviation"))*g);this.doFeatureScaling(g);this.doLabelScaling(g);f=g;if(h=SVGDocument.getElementById("marker_symbols"))for(h=h.childNodes,k=0;k<h.length;k++)1==h.item(k).nodeType&&
(m=h.item(k).getAttributeNS(null,"id"))&&m.length&&!m.match(/antizoomandpan/)&&(matrixA=getMatrix(h.item(k)))&&(matrixA[0]*=g,matrixA[3]*=g,setMatrix(h.item(k),matrixA),map.Scale.scaledSymbolsA["#"+m]=!0);if(h=SVGDocument.getElementById("symbolstore"))for(h=h.getElementsByTagName("g"),k=0;k<h.length;k++)(m=h.item(k).getAttributeNS(null,"id"))&&m.length&&m.match(/symbol/)&&!m.match(/antizoomandpan/)&&(matrixA=getMatrix(h.item(k)))&&(matrixA[0]*=g,matrixA[3]*=g,matrixA[4]*=g,matrixA[5]*=g,setMatrix(h.item(k),
matrixA),map.Scale.scaledSymbolsA["#"+m]=!0);h=SVGDocument.getElementById("widgets:antizoomandpan").getElementsByTagName("use");for(k=0;k<h.length;k++)m=h.item(k).getAttributeNS(szXlink,"href"),map.Scale.scaledSymbolsA[m]&&(matrixA=getMatrix(h.item(k)))&&(matrixA[0]/=g,matrixA[3]/=g,setMatrix(h.item(k),matrixA));h=SVGHiddenGroup.getElementsByTagName("use");for(k=0;k<h.length;k++)m=h.item(k).getAttributeNS(szXlink,"href"),map.Scale.scaledSymbolsA[m]&&(matrixA=getMatrix(h.item(k)))&&(matrixA[0]/=g,
matrixA[3]/=g,setMatrix(h.item(k),matrixA));this.scaleTextOffsets(SVGRootElement,d,f,b.getElementById("mapstyles"));this.scaleLineDecorations(SVGRootElement,d);this.doObjectScaling(e)}}else this.doObjectScaling(e)}};
Map.Layer.prototype.doFeatureScaling=function(b){var d=null,e=null,f=SVGDocument.getElementById("mapstyles");if(f)d=f.firstChild.nextSibling.nodeValue,e=__scaleLineStyleString(d,b),f.firstChild.nextSibling.nodeValue=e,map.Scale.fCSSStyleNodeChanged=!0;else if(fFeatureScalingByLayer){var g=null,f=[],d=[],e=!1;for(a in map.Layer.listA)if(g=map.Layer.listA[a],g.szFlag.match(/tiled/)){if(!e){var e=!0,h=map.Tiles.getTileInfo();if(h)for(var k=0;k<h.length;k++){var m=Number(h[k].tileGroup.getAttributeNS(szMapNs,
"deltaTBD"));if("inline"==h[k].tileGroup.style.getPropertyValue("display")){for(var g=h[k].tileGroup.getElementsByTagName("g"),p=0;p<g.length;p++)g.item(p).getAttributeNS(null,"id").match(/:label/)||(f[f.length]=g.item(p),d[f.length-1]=m?m:1);h[k].tileGroup.setAttributeNS(szMapNs,"deltaTBD","1")}else h[k].tileGroup.hasChildNodes()&&h[k].tileGroup.setAttributeNS(szMapNs,"deltaTBD",String(b*(m?m:1)))}}}else if(g.szName&&(g=SVGDocument.getElementById(g.szName)))for(f[f.length]=g,d[f.length-1]=1,g=g.getElementsByTagName("g"),
p=0;p<g.length;p++)g.item(p).getAttributeNS(null,"id").match(/:label/)||(f[f.length]=g.item(p),d[f.length-1]=1);g=SVGDocument.getElementById("mapobjects");g=g.getElementsByTagName("g");for(p=0;p<g.length;p++)f[f.length]=g.item(p),d[f.length-1]=1;for(n=0;n<f.length;n++)(e=f[n].getAttributeNS(null,"style"))&&e.length&&(e=__scaleLineStyleString(e,b*d[n]),f[n].setAttributeNS(null,"style",e))}else for(alert("B!!!"),nodeA=map.Scale.canvasNode.getElementsByTagName("g"),n=0;n<nodeA.length;n++)antiZoomAndPanList.isContained(nodeA.item(n))||
(e=nodeA.item(n).getAttributeNS(null,"style"))&&e.length&&(e=__scaleLineStyleString(e,b),nodeA.item(n).setAttributeNS(null,"style",e))};
Map.Layer.prototype.doObjectScaling=function(b){if(fObjectScaling&&(map.Layer.nObjectScale=b,"dynamic"==fObjectScaling&&(map.Layer.nObjectScale*=Math.pow(1/(map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale),1/map.Scale.nDynamicScalePow)),map.Layer.nDynamicObjectScale=map.Layer.nObjectScale/b,b=map.Layer.nObjectScale/map.Scale.objectScaling_lastScale,map.Scale.objectScaling_lastScale=map.Layer.nObjectScale,0!==b&&1!==b)){var d=!0;1>map.Scale.nObjectScaling&&(d=!1,1>b&&1<=map.Scale.nObjectScaling*
map.Zoom.nZoom&&(1>map.Scale.nObjectScaling*map.Zoom.nZoom*b&&(b=1/map.Scale.nObjectScaling/map.Zoom.nZoom),d=!0),1<b&&1<=map.Scale.nObjectScaling*map.Zoom.nZoom*b&&(1>map.Scale.nObjectScaling*map.Zoom.nZoom&&(b=map.Zoom.nZoom*b/(1/map.Scale.nObjectScaling)),d=!0));if(d)for(nodeA=map.Layer.objectGroup.childNodes,i=0;i<nodeA.length;i++)if(!antiZoomAndPanList.isContained(nodeA.item(i)))for(d=nodeA.item(i).childNodes,ii=0;ii<d.length;ii++)if(matrixA=getMatrix(d.item(ii)))matrixA[0]*=b,matrixA[3]*=b,
setMatrix(d.item(ii),matrixA)}};
Map.Layer.prototype.doStoredFeatureScaling=function(b){if(fFeatureScaling){var d=null;if(!(b?b.target.ownerDocument:SVGDocument).getElementById("mapstyles")){d=null;b=[];var e=[],f=map.Tiles.getTileInfo();if(f)for(var g=0;g<f.length;g++)if("inline"==f[g].tileGroup.style.getPropertyValue("display")){var h=Number(f[g].tileGroup.getAttributeNS(szMapNs,"deltaTBD"));if(h&&1!=h)for(var d=f[g].tileGroup.getElementsByTagName("g"),k=0;k<d.length;k++)b[b.length]=d.item(k),e[b.length-1]=h?h:1,f[g].tileGroup.setAttributeNS(szMapNs,
"deltaTBD","1")}for(n=0;n<b.length;n++)b[n].getAttributeNS(null,"id").match(/:label/)||(d=b[n].getAttributeNS(null,"style"))&&d.length&&(d=__scaleLineStyleString(d,e[n]),b[n].setAttributeNS(null,"style",d))}}};
Map.Layer.prototype.scaleTextOffsets=function(b,d,e,f){var g=b.getElementsByTagName("rect");for(i=0;i<g.length;i++){var h=g.item(i).getAttributeNS(null,"id");if(h&&h.match(/textbg/)&&(h=g.item(i).nextSibling.nextSibling)&&"text"==h.nodeName)if(h=map.Dom.getBox(h),0>h.width||0>h.height)g.item(i).setAttributeNS(null,"width",0),g.item(i).setAttributeNS(null,"height",0);else{f&&(h.x*=e,h.y*=e,h.width*=e,h.height*=e);var k=map.Scale.normalX(1)*d;g.item(i).setAttributeNS(null,"x",h.x-k);g.item(i).setAttributeNS(null,
"y",h.y-k);g.item(i).setAttributeNS(null,"width",h.width+2*k);g.item(i).setAttributeNS(null,"height",h.height+2*k)}}g=b.getElementsByTagName("text");for(i=0;i<g.length;i++)if((h=g.item(i).parentNode.getAttributeNS(null,"id"))&&h.match(/label/)&&(h=g.item(i),b=h.getAttributeNS(null,"transform"))){szTransformA=b.split(" ");for(b=0;b<szTransformA.length;b++)szTransformA[b].match(/translate/)&&(szTrans=szTransformA[b].substr(10,szTransformA[b].length-11),szTransA=szTrans.split(","),x=Number(szTransA[0])*
e,y=Number(szTransA[1])*e,szTransformA[b]="translate("+x+","+y+")");d="";for(b=0;b<szTransformA.length;b++)d=d+szTransformA[b]+" ";h.setAttributeNS(null,"transform",d)}};
Map.Layer.prototype.scaleLineDecorations=function(b,d){var e=b.getElementsByTagName("text");for(i=0;i<e.length;i++)if(e.item(i)&&e.item(i).getAttributeNS(null,"id")&&e.item(i).getAttributeNS(null,"id").match(/linedecoration/)){var f=e.item(i).style.getPropertyValue("dominant-baseline"),g=parseFloat(e.item(i).style.getPropertyValue("baseline-shift")),h=parseFloat(e.item(i).style.getPropertyValue("font-size")),k=0;"mathematical"==f&&(k+=h/3);"hanging"==f&&(k-=h);k-=g*d;e.item(i).setAttributeNS(null,
"dy",k)}};
Map.Layer.prototype.doLabelScaling=function(b){var d=null,e=SVGDocument.getElementById("mapstyles");if(e)d=e.firstChild.nextSibling.nodeValue,szNewStylesValue=__scaleTextStyleString(d,b),e.firstChild.nextSibling.nodeValue=szNewStylesValue,map.Scale.fCSSStyleNodeChanged=!0,map.Scale.refreshCSSStyles();else for(d=null,e=0,d=map.Scale.canvasNode.getElementsByTagName("g"),e=0;e<d.length;e++)if(!antiZoomAndPanList.isContained(d.item(e))){var f=d.item(e).getAttributeNS(null,"id");if(f&&0!=f.length&&f.match(/label/)){var g=
d.item(e).getAttributeNS(null,"style");if(g&&g.length)if(0==b)map.Layer.switchLayer(null,f,null,"none"==d.item(e).style.getPropertyValue("display")?!0:!1);else for(szNewStylesValue=__scaleStyleString(g,b),d.item(e).setAttributeNS(null,"style",szNewStylesValue),childA=d.item(e).childNodes,c=0;c<childA.length;c++)"text"==childA.item(c).nodeName&&(g=childA.item(c).getAttributeNS(null,"style"))&&g.length&&(szNewStylesValue=__scaleStyleString(g,b),childA.item(c).setAttributeNS(null,"style",szNewStylesValue))}}for(l in map.Layer.generatedLabelA)if(map.Layer.generatedLabelA[l])for(d=
map.Layer.generatedLabelA[l].getElementsByTagName("text"),e=0;e<d.length;e++)(g=d.item(e).getAttributeNS(null,"style"))&&g.length&&(szNewStylesValue=__scaleStyleString(g,b),d.item(e).setAttributeNS(null,"style",szNewStylesValue));this.adaptLabel(null)};
Map.Layer.prototype.changeObjectScaling=function(b,d,e){var f=null;b=0;0==d&&(d=1/map.Scale.nObjectScaling);if(e)for(e=e.childNodes,b=0;b<e.length;b++){if(matrixA=getMatrix(e.item(b)))matrixA[0]*=d,matrixA[3]*=d,setMatrix(e.item(b),matrixA);(f=e.item(b).childNodes[0])&&(matrixA=getMatrix(f))&&(matrixA[4]/=Math.pow(d,.5),matrixA[5]/=Math.pow(d,.5),setMatrix(f,matrixA))}else if(!(8<map.Scale.nObjectScaling*d||.1>map.Scale.nObjectScaling*d))for(map.Scale.nObjectScaling*=d,f=map.Layer.objectGroup.childNodes,
b=0;b<f.length;b++)if(!antiZoomAndPanList.isContained(f.item(b)))for(e=f.item(b).childNodes,ii=0;ii<e.length;ii++)if(matrixA=getMatrix(e.item(ii)))matrixA[0]*=d,matrixA[3]*=d,setMatrix(e.item(ii),matrixA)};
Map.Layer.prototype.setObjectRotate=function(b,d,e){b=null;var f=0;if(e)for(e=e.childNodes,f=0;f<e.length;f++)setRotate(e.item(f),(360+Number(d))%360);else for(b=map.Layer.objectGroup.childNodes,f=0;f<b.length;f++)if(!antiZoomAndPanList.isContained(b.item(f)))for(e=b.item(f).childNodes,ii=0;ii<e.length;ii++)setRotate(e.item(ii),(360+Number(d))%360)};
Map.Layer.prototype.setPatternRotate=function(b,d,e){b=null;var f=0;e||(e=SVGRootElement);b=e.getElementsByTagName("pattern");for(f=0;f<b.length;f++)b.item(f).getAttributeNS(null,"id").match(/antizoomandpan/)||setRotate(b.item(f),(360+Number(d))%360,"patternTransform")};
Map.Layer.prototype.setSymbolRotate=function(b,d,e){b=null;e=0;if(b=SVGDocument.getElementById("marker_symbols"))for(b=b.childNodes,e=0;e<b.length;e++)if(1==b.item(e).nodeType){var f=b.item(e).getAttributeNS(null,"id");f&&f.length&&!f.match(/antizoomandpan/)&&(setRotate(b.item(e),(360+Number(d))%360),map.Scale.rotatedSymbolsA["#"+f]=!0)}if(b=SVGDocument.getElementById("symbolstore"))for(b=b.getElementsByTagName("g"),e=0;e<b.length;e++)(f=b.item(e).getAttributeNS(null,"id"))&&f.length&&f.match(/symbol/)&&
!f.match(/antizoomandpan/)&&(setRotate(b.item(e),(360+Number(d))%360),map.Scale.rotatedSymbolsA["#"+f]=!0);b=SVGDocument.getElementById("widgets:antizoomandpan").getElementsByTagName("use");for(e=0;e<b.length;e++)f=b.item(e).getAttributeNS(szXlink,"href"),map.Scale.rotatedSymbolsA[f]&&setRotate(b.item(e),(360+Number(-d))%360);b=SVGHiddenGroup.getElementsByTagName("use");for(e=0;e<b.length;e++)f=b.item(e).getAttributeNS(szXlink,"href"),map.Scale.rotatedSymbolsA[f]&&setRotate(b.item(e),(360+Number(-d))%
360)};Map.Layer.prototype.changeObjectRotate=function(b,d,e){b=null;var f=0;if(e)for(e=e.childNodes,f=0;f<e.length;f++){var g=getRotateAttributeValue(e.item(f));setRotate(e.item(f),(360+Number(g)+Number(d))%360)}else for(b=map.Layer.objectGroup.childNodes,f=0;f<b.length;f++)if(!antiZoomAndPanList.isContained(b.item(f)))for(e=b.item(f).childNodes,f=0;f<e.length;f++)g=getRotateAttributeValue(e.item(f)),setRotate(e.item(f),(360+Number(g)+Number(d))%360)};
Map.Layer.prototype.setLabelRotate=function(b,d){for(var e=null,f=0,e=map.Layer.layerNode.getElementsByTagName("text"),f=0;f<e.length;f++)antiZoomAndPanList.isContained(e.item(f))||e.item(f).firstChild&&"textPath"==e.item(f).firstChild.nodeName||setRotate(e.item(f),(360+Number(d))%360);this.adaptLabel()};
Map.Layer.prototype.changeLabelRotate=function(b,d){for(var e=null,f=0,e=map.Scale.canvasNode.getElementsByTagName("text"),f=0;f<e.length;f++)if(!(antiZoomAndPanList.isContained(e.item(f))||e.item(f).firstChild&&"textPath"==e.item(f).firstChild.nodeName)){var g=getRotateAttributeValue(e.item(f));setRotate(e.item(f),(360+Number(g)+Number(d))%360)}this.adaptLabel()};
Map.Layer.prototype.adaptLabel=function(b,d){fAdaptLabelToScaling&&this.adaptLabelToScaling(b,d);if(fCheckLabelOverlap||fCheckLabelSpace||fCheckLabelSqueeze)d&&this.prepareCheckOverlap(b,d),this.checkLabelOverlapping(b,d)};
Map.Layer.prototype.adaptLabelToScaling=function(b,d){d||(d=SVGRootElement);if(fAdaptLabelToScaling||fCheckLabelOnlyOne){var e=!1;for(a in map.Layer.listA){var f=map.Layer.listA[a];f.nRenderer&12&&"line"==f.szType&&"inline"==f.szDisplayLabel&&(e=!0)}if(e){e=d.getElementsByTagName("textPath");if(map.Scale.oldZoomScale!=map.Scale)for(f=0;f<e.length;f++)e.item(f).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||e.item(f).parentNode.style.setProperty("display","none","");map.Label.fAdaptLabelToScalingPending||
(map.Label.fAdaptLabelToScalingPending=!0,"delayed"==fAdaptLabelToScaling?map.pushAction('setTimeout("map.Label.adaptLabelToScaling(null)",1500)'):map.pushAction("map.Label.adaptLabelToScaling(null,null)"))}}};Map.Layer.prototype.checkLabelOverlapping=function(b,d){if(fCheckLabelOverlap||fCheckLabelSpace||fCheckLabelSqueeze)d||(d=map.Layer.layerNode),d||(d=map.Scale.canvasNode),map.Label.initCheckOverlap(d)};
Map.Layer.prototype.prepareCheckOverlap=function(b,d){if(fCheckLabelOverlap||fCheckLabelSpace)d||(d=map.Layer.layerNode),d||(d=map.Scale.canvasNode),map.Label.prepareCheckOverlap(d)};Map.Layer.prototype.addChangedFeatureNode=function(b){var d;if(this.changedFeatureNodesA){for(d=0;d<this.changedFeatureNodesA.length;d++)if(this.changedFeatureNodesA[d]==b)return;this.changedFeatureNodesA[this.changedFeatureNodesA.length]=b}};
Map.Layer.prototype.isChangedFeature=function(b){var d;if(this.changedFeatureNodesA)for(d=0;d<this.changedFeatureNodesA.length;d++)if(map.Tiles.getMasterId(this.changedFeatureNodesA[d].getAttributeNS(null,"id"))==b)return!0;return!1};
Map.Layer.prototype.removeChangedFeatures=function(b){var d,e;if(this.changedFeatureNodesA)for(d=0;d<this.changedFeatureNodesA.length;d++)if(map.Tiles.getMasterId(this.changedFeatureNodesA[d].getAttributeNS(null,"id"))==b){this.changedFeatureNodesA[d].setAttributeNS(null,"style","");for(e=d;e<this.changedFeatureNodesA.length-1;e++)this.changedFeatureNodesA[e]=this.changedFeatureNodesA[e+1];this.changedFeatureNodesA.length--;d--}};
Map.Layer.prototype.setPointerEvents=function(b){for(a in map.Layer.listA){var d=map.Layer.listA[a].szName;if(d){var e=SVGDocument.getElementById(d),d=null==b||b==d?null:"none";e&&(d?e.style.setProperty("pointer-events",d,""):e.style.removeProperty("pointer-events"))}}};Map.Layer.prototype.getLayerObj=function(b){if(!b)return null;var d=b.split("#")[0].split(":")[0];"legend"==d&&(d=b.split(":")[2]);return this.listA[d]};
Map.Layer.prototype.getLayerName=function(b){return(b=this.getLayerObj(b))?b.szName:null};Map.Layer.prototype.getLayerObjOfNode=function(b){if(b)for(;b.parentNode&&"SVG"!=b.parentNode.nodeName;){var d=this.getLayerObj(b.getAttributeNS(null,"id"));if(d)return d;b=b.parentNode}return null};Map.Layer.prototype.getLayerItemNodeOfNode=function(b){for(;b.parentNode&&"SVG"!=b.parentNode.nodeName;){if(this.getLayerObj(b.getAttributeNS(null,"id")))return b;b=b.parentNode}return null};
Map.Layer.prototype.getLayerItemNodes=function(b){if(b=this.getLayerItemNodeOfNode(b)){var d=b.getAttributeNS(null,"id");return"point"==this.getLayerObj(d).szType&&fTileTextNoClip||map.Tiles.getMasterId(d)==d?Array(b):map.Tiles.getTileNodes(map.Tiles.getMasterId(d))}return[]};Map.Layer.prototype.getStyleOrClass=function(b){var d={};d.szClass=map.Dom.getAttributeByNodeOrParents(b,null,"class");d.szStyle=map.Dom.getAttributeByNodeOrParents(b,null,"style");return d};
Map.Layer.prototype.isMapObject=function(b){for(;b;){if(b==map.Scale.canvasNode)return!0;b=b.parentNode}return!1};Map.Layer.prototype.isLoaded=function(b){return(b=this.getLayerObj(b))?b.szFlag.match(/tiled/)?map.Tiles.isAnyLayerTileLoaded():!0:!1};
Map.Label=function(b){this.document=b?b.target.ownerDocument:SVGDocument;this.checkItemA=[];this.checkOvlA=[];this.nodeA=[];this.boxA=[];this.rootNode=null;this.zoomScale=0;this.fCheckLabelOverlappingPending=!1;this.ALTS_rootNode=this.ALTS_nodeA=this.ALTS_textA=null;this.killProcess=this.fAdaptLabelToScalingPending=!1};Map.Label.prototype=new Map;
Map.Label.Item=function(b){if(b)this.textNode=b,this.szId=b.getAttributeNS(null,"id")||"noId",this.bgNode=SVGDocument.getElementById(this.szId+":bg"),this.bbNode=SVGDocument.getElementById(this.szId+":textbg"),this.poNode=SVGDocument.getElementById(this.szId.slice(0,this.szId.length-1)),this.poNode||(b=map.Tiles.getMasterId(this.szId),b=b.slice(0,b.length-1),this.poNode=SVGDocument.getElementById(b)),this.bBox=null;else return this.szId="mapLabelNullItem",null};
Map.Label.Item.prototype.setDisplay=function(b){this.textNode.style.setProperty("display",b,"");this.bgNode&&this.bgNode.style.setProperty("display",b,"");this.bbNode&&this.bbNode.style.setProperty("display",b,"");this.poNode&&"use"==this.poNode.nodeName&&this.poNode.style.setProperty("display",b,"")};Map.Label.Item.prototype.setScale=function(b,d){setScale(this.textNode,b,d);this.bgNode&&setScale(this.bgNode,b,d);this.bbNode&&setScale(this.bbNode,b,d)};
Map.Label.Item.prototype.scaleBackground=function(){if(this.bbNode&&this.textNode){var b=map.Scale.normalX(2)*map.Scale.nZoomScale,d=map.Dom.getBox(this.textNode),e=getTranslateAttributeValue(this.textNode);0<d.width&&0<d.height&&(this.bbNode.setAttributeNS(null,"x",d.x+(e.x?e.x-b:0)),this.bbNode.setAttributeNS(null,"y",d.y-b+e.y),this.bbNode.setAttributeNS(null,"width",d.width+2*b),this.bbNode.setAttributeNS(null,"height",d.height+2*b))}};
Map.Label.prototype.stopProcessing=function(){this.killProcess=!0};Map.Label.prototype.prepareCheckOverlap=function(b){b=b.getElementsByTagName("text");for(var d=0;d<b.length;d++)b.item(d).firstChild&&"textPath"!=b.item(d).firstChild.nodeName&&!b.item(d).getAttributeNS(null,"id").match(/:bg/)&&(new Map.Label.Item(b.item(d))).setDisplay("none")};
Map.Label.prototype.initCheckOverlap=function(b){this.killProcess=!1;this.fCheckLabelOverlappingPending||(this.fCheckLabelOverlappingPending=!0,this.checkItemA.length=0,this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0,this.rootNode=b,fPDFEmbed||!map.Tiles.dataNode?setTimeout("map.Label.collectCheckOverlap()",0):map.pushAction("map.Label.collectCheckOverlap()"))};Map.Label.prototype.getCheckItem=function(b){return this.checkItemA[b]};Map.Label.prototype.getCheckItemCount=function(){return this.checkItemA.length};
Map.Label.prototype.addCheckItem=function(b,d){if(b){var e=map.Layer.getLayerObjOfNode(b);if((!e||b.parentNode.getAttributeNS(null,"id").match(/value/)||"inline"==e.szDisplayLabel)&&(fCheckLabelOverlap||"polygon"==e.szType)&&b.firstChild&&"textPath"!=b.firstChild.nodeName&&!b.getAttributeNS(null,"id").match(/:bg/)){var f=getMatrix(b),f=new point(Number(f[4]),Number(f[5])),g=map.Scale.getMapOffset(b);f.x+=g.x;f.y+=g.y;f.x<this.zoomBox.x||f.x>this.zoomBox.x+this.zoomBox.width||f.y<this.zoomBox.y||f.y>
this.zoomBox.y+this.zoomBox.height||(f=new Map.Label.Item(b),f.fRef=e&&"polygon"==e.szType?!0:!1,f.fScale=d,this.checkItemA[this.checkItemA.length]=f)}}else f=new Map.Label.Item(null),this.checkItemA[this.checkItemA.length]=f};
Map.Label.prototype.collectCheckOverlap=function(){var b=null,d=!1,e=[];for(a in map.Layer.listA)"polygon"==map.Layer.listA[a].szType&&e.push(a);fCheckOverlapAllLayer||e.push("resetoverlap");for(a in map.Layer.listA)"polygon"!=map.Layer.listA[a].szType&&e.push(a);this.zoomBox=map.Zoom.getBox();for(var f=e.length-1;0<=f;f--)if("resetoverlap"==e[f])this.addCheckItem(null);else{var g=map.Layer.listA[e[f]];if(g.szFlag.match(/tiled/)){if(!d&&(d=!0,g=map.Tiles.getTileInfo())){this.addCheckItem(null);for(var h=
0;h<g.length;h++)if("inline"==g[h].tileGroup.style.getPropertyValue("display")){for(var b=g[h].tileGroup.getElementsByTagName("text"),k=b.length-1;0<=k;k--)"none"!=b.item(k).parentNode.style.getPropertyValue("display")&&this.addCheckItem(b.item(k));fCheckOverlapClipOnTiles&&this.addCheckItem(null)}}}else if(g.szName){if(h=SVGDocument.getElementById(g.szName+":label"))if((k=h.getElementsByTagName("g"))&&0<k.length)for(var m=0;m<k.length;m++){if(b=k.item(m).getElementsByTagName("text"),b.length)for(h=
b.length-1;0<=h;h--)this.addCheckItem(b.item(h))}else if(b=h.getElementsByTagName("text"),b.length)for(h=b.length-1;0<=h;h--)this.addCheckItem(b.item(h));if(h=SVGDocument.getElementById(g.szName+":values"))if(b=h.getElementsByTagName("text"),b.length)for(h=b.length-1;0<=h;h--)this.addCheckItem(b.item(h))}}d=map.Themes.getTextObjects();for(h=0;h<d.length;h++)this.addCheckItem(d[h],!0);this.zoomScale=map.Scale.nZoomScale;this.checkItemA.length?setTimeout("map.Label.getBoxCheckOverlap(0)",100):this.fCheckLabelOverlappingPending=
!1};
Map.Label.prototype.getBoxCheckOverlap=function(b){var d=new Map.Sleep("map.Label.getBoxCheckOverlap",this.nflushLabelDraw,"");for(_STATUS("Map.Label: getBoxCheckOverlap ==== "+b+" ====== >>>");0<=b;b++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;break}if(d.checkSleep(b,10))break;if(cItem=this.getCheckItem(b))if("mapLabelNullItem"==cItem.szId&&fCheckOverlapImplicit)this.nodeA.length=0;else try{cItem.szOldDisplay=cItem.textNode.style.getPropertyValue("display");cItem.textNode.style.setProperty("display",
"inline","");cItem.setScale(1,1);cItem.textNode.setAttributeNS(null,"x",0);cItem.textNode.setAttributeNS(null,"y",0);cItem.bgNode&&(cItem.bgNode.style.setProperty("display","inline",""),cItem.bgNode.setAttributeNS(null,"x",0),cItem.bgNode.setAttributeNS(null,"y",0));var e=map.Dom.getBox(cItem.textNode);cItem.fScale&&(e.x*=map.Layer.nFeatureScale,e.y*=map.Layer.nFeatureScale,e.width*=map.Layer.nFeatureScale,e.height*=map.Layer.nFeatureScale);var f=map.Scale.getMapOffset(cItem.textNode);e.x+=f.x;e.y+=
f.y;f=getTranslate(cItem.textNode);e.x+=f.x;e.y+=f.y;if(map.Zoom.isVisibleBox(e)&&this.checkLabelSpace(cItem,e)){15<getRotateAttributeValue(cItem.textNode)&&345>getRotateAttributeValue(cItem.textNode)&&cItem.setScale(1,1);cItem.bBox=e;var g=this.nodeA.length;this.checkOvlA[g]=cItem;this.nodeA[g]=cItem.textNode;this.boxA[g]=e;fCheckLabelOverlap||(cItem.setDisplay("inline"),cItem.scaleBackground());fCheckOverlapImplicit&&this.execCheckLabelOverlappingOne(g)}else cItem.setDisplay("none")}catch(h){}else{fCheckOverlapImplicit?
this.fCheckLabelOverlappingPending=!1:setTimeout("map.Label.doCheckOverlap()",100);break}}};
Map.Label.prototype.checkLabelSpace=function(b,d){var e=null;if(!b.fRef)return!0;b.szId.match(/#/)?(e=b.szId.split("#"),e=e[0].substr(0,e[0].length-1)+"#"+e[1]):e=b.szId.substr(0,b.szId.length-1);if(e=SVGDocument.getElementById(e))if(b.refBox=map.Dom.getBox(e),e=b.refBox,e.width*=nCheckLabelSpace,d.width>e.width&&fAdaptLabelToScaling){var f=1,g=1;fCheckLabelSqueeze&&(d.width<=2*e.width||!fCheckLabelSpace)&&(f=Math.max(.7,e.width/d.width),d.width*=f,b.setScale(f,1));fCheckLabelSize&&(d.width<=1.5*
e.width||!fCheckLabelSpace)&&(g=Math.max(.7,e.width/d.width),d.width*=g,d.height*=g,b.setScale(f*g,g));if(!fCheckLabelSpace||d.width<=e.width)b.setDisplay("inline");else return b.setDisplay("none"),!1}else b.setDisplay("inline");else b.setDisplay(b.szOldDisplay);return!0};
Map.Label.prototype.doCheckOverlap=function(){fCheckLabelOverlap?2E4<nodeA.length?(this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0):(this.zoomScale=map.Scale.nZoomScale,"delayed"==fCheckLabelOverlap?setTimeout("map.Label.execCheckLabelOverlappingOnly(0)",2E3):map.pushAction("map.Label.execCheckLabelOverlappingOnly(0)")):this.fCheckLabelOverlappingPending=!1};
Map.Label.prototype.execCheckLabelOverlappingOnly=function(b){for(var d=new Map.Sleep("map.Label.execCheckLabelOverlappingOnly",25,"");b<this.checkOvlA.length;b++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;return}if(d.checkSleep(b,10))return;this.execCheckLabelOverlappingOne(b)}this.fCheckLabelOverlappingPending=!1};
Map.Label.prototype.execCheckLabelOverlappingOne=function(b){var d=this.checkOvlA[b];if(map.Zoom.isVisibleBox(d.bBox)){d.refBox||d.setDisplay("inline");if(fCheckLabelOverlap)for(var e=d.textNode.firstChild.nodeValue,f=d.bBox,g=Number(d.textNode.getAttributeNS(szMapNs,"pos")),h=!1,k=0;k<b;k++){var m=this.checkOvlA[k].textNode.firstChild.nodeValue,p=this.checkOvlA[k].bBox;if(fCheckLabelOnlyOne&&e==m){var m=Number(d.textNode.getAttributeNS(szMapNs,"partlen")),q=Number(this.checkOvlA[k].textNode.getAttributeNS(szMapNs,
"partlen"));if(m>q){this.checkOvlA[k].bBox=null;this.checkOvlA[k].setDisplay("none");continue}d.setDisplay("none");d.bBox=null}if(f&&p&&d.textNode!=this.checkOvlA[k].textNode&&map.Tiles.getMasterId(d.szId)!=map.Tiles.getMasterId(this.checkOvlA[k].szId)&&__checkOverlapBox(f,p)){if(fKillOverlappingLabel||h){p.height<f.height&&(d.refBox||!this.checkOvlA[k].refBox)?(this.checkOvlA[k].bBox=null,this.checkOvlA[k].setDisplay("none")):(d.setDisplay("none"),d.bBox=null);break}if(d.refBox)f.y>p.y?(d.textNode.setAttributeNS(null,
"y",f.height),d.bgNode&&d.bgNode.setAttributeNS(null,"y",f.height),f.y+=f.height):(d.textNode.setAttributeNS(null,"y",-f.height),d.bgNode&&d.bgNode.setAttributeNS(null,"y",-f.height),f.y-=f.height);else if(m=parseInt(d.textNode.style.getPropertyValue("font-size"))||14,f.y>=p.y&&(11==g||12==g||1==g||9==g||3==g||0==g))d.textNode.setAttributeNS(null,"y",m),d.bgNode&&d.bgNode.setAttributeNS(null,"y",m),f.y+=parseInt(m);else if(f.y<=p.y&&(7==g||6==g||5==g||9==g||3==g||0==g))d.textNode.setAttributeNS(null,
"y",-f.height),d.bgNode&&d.bgNode.setAttributeNS(null,"y",-f.height),f.y-=f.height;else if(f.x<=p.x&&(1==g||3==g||5==g))d.textNode.setAttributeNS(null,"x",-(f.width+50*map.Scale.nZoomScale)),d.bgNode&&d.bgNode.setAttributeNS(null,"x",-(f.width+50*map.Scale.nZoomScale)),f.x-=f.width+50*map.Scale.nZoomScale;else if(f.x>=p.x&&(11==g||9==g||7==g))d.textNode.setAttributeNS(null,"x",+(f.width+50*map.Scale.nZoomScale)),d.bgNode&&d.bgNode.setAttributeNS(null,"x",+(f.width+50*map.Scale.nZoomScale)),f.x+=f.width+
50*map.Scale.nZoomScale;else if(p.height<f.height&&(d.refBox||!this.checkOvlA[k].refBox)){this.checkOvlA[k].bBox=null;this.checkOvlA[k].setDisplay("none");continue}h=!0;k=0}}d.bbNode&&d.scaleBackground()}};__checkOverlapBox=function(b,d){return!b||!d||b.x+b.width<d.x||b.x>d.x+d.width||b.y+b.height<d.y||b.y>d.y+d.height?!1:!0};
Map.Label.prototype.adaptLabelToScaling=function(b,d){this.killProcess=!1;d||(d=SVGRootElement);this.fAdaptLabelToScalingPending=!1;this.ALTS_nodeA=[];this.ALTS_textA=[];this.ALTS_rootNode=d;var e=this.ALTS_nodeA,f=null,g=map.Tiles.getTileInfo();if(g)for(var h=0;h<g.length;h++)if("inline"==g[h].tileGroup.style.getPropertyValue("display"))for(var f=g[h].tileGroup.getElementsByTagName("textPath"),k=0;k<f.length;k++)f.item(k).parentNode.getAttributeNS(null,"id").match(/:bg/)||f.item(k).parentNode.getAttributeNS(null,
"id").match(/:linedecoration/)||(e[e.length]=f.item(k));if(null==e||0==e.length)for(f=SVGRootElement.getElementsByTagName("textPath"),h=0;h<f.length;h++)f.item(h).parentNode.getAttributeNS(null,"id").match(/:bg/)||f.item(h).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||(e[e.length]=f.item(h));map.pushAction("map.Label.execAdaptLabelToScaling(0)")};
Map.Label.prototype.execAdaptLabelToScaling=function(b){for(var d=new Map.Sleep("map.Label.execAdaptLabelToScaling",25,""),e=this.ALTS_nodeA,f=this.ALTS_rootNode,g=null;b<e.length;b++){if(d.checkSleep(b,10))return;var h=e[b].getAttributeNS(szXlink,"href"),h=h.substr(1,h.length-1),k=f.getElementById(h);if(k){var m=k.parentNode.getAttributeNS(null,"id"),g=map.Tiles.getMasterId(m),m=map.Tiles.getTileId(m);if(0==map.Layer.isScaleDependentLayerOn(g))e[b].parentNode.style.setProperty("display","none","");
else if(g=e[b].firstChild.nodeValue,!(this.ALTS_textA[g+m]&&1>=map.Tiles.getTileNodes(map.Tiles.getMasterId(h)).length)){pBox=map.Dom.getBox(k);e[b].setAttributeNS(szXlink,"href","");e[b].parentNode.style.setProperty("display","inline","");e[b].parentNode.style.setProperty("font-stretch","normal","");tBox=map.Dom.getBox(e[b].parentNode);e[b].setAttributeNS(szXlink,"href","#"+h);var p=Math.sqrt(tBox.width*tBox.width+tBox.height*tBox.height),q=Math.sqrt(pBox.width*pBox.width+pBox.height*pBox.height),
A=e[b].parentNode,w=SVGDocument.getElementById(A.getAttributeNS(null,"id")+":bg");w&&w.style.setProperty("display","inline","");if(.9*p<q){if(1.3*p<q?(A.style.setProperty("font-stretch","normal",""),w&&w.style.setProperty("font-stretch","normal","")):(A.style.setProperty("font-stretch","narrower",""),w&&w.style.setProperty("font-stretch","narrower","")),fCheckLabelOnlyOne){var v=map.Scale.getMapOffset(k);pBox.x+=v.x;pBox.y+=v.y;v=getTranslate(k);pBox.x+=v.x;pBox.y+=v.y;k=new box(pBox.x,pBox.y,pBox.width,
pBox.height);k.scale(p/q,p/q);map.Zoom.isCompletelyVisibleBox(k)?fTileTextNoClip?this.ALTS_textA[g]=h:this.ALTS_textA[g+m]=h:(A.style.setProperty("display","none",""),w&&w.style.setProperty("display","none",""))}}else A.style.setProperty("display","none",""),w&&w.style.setProperty("display","none","")}}}__adaptLabelToSymbols(null,f)};__adaptLabelToSymbols=function(b,d){};
Map.Label.prototype.getLabel=function(b){if(!SVGDocument.getElementById(b)){var d=map.Tiles.getTileNodes(map.Tiles.getMasterId(b));if(1>d.length)return null;for(var e=0;e<d.length;e++){var f=this.getLabel(d[e].getAttributeNS(null,"id"));if(f)return f}}b=SVGDocument.getElementById(b);if(!b)return null;if("g"==b.tagName)for(nodeA=b.childNodes,d=0;d<nodeA.length;d++)if(1==nodeA.item(d).nodeType){b=nodeA.item(d);break}d=null;if(d=b.getAttributeNS(null,"id"))if(d.match(/#/)?(d=d.split("#"),d=SVGDocument.getElementById(d[0]+
"T#"+d[1])):d=SVGDocument.getElementById(d+"T"),d)return d.firstChild.nodeValue;return b.getAttributeNS(szMapNs,"tooltip")};Map.Label.prototype.xgetLabel=function(b){map.Layer.getLayerObj(szTheme);return null};Map.Sleep=function(b,d,e){this.szFunction=b;this.initCheckSleep(d,e);this.fShowProgressBar=this.fEnableProgressBar=!1;this.nCount=0;this.szCancel="__cancelSleep()"};
Map.Sleep.prototype.initCheckSleep=function(b,d){this.checkSleepMaxCount=b;this.checkSleepCount=0;this.checkSleepMessage=d;this.runningTime=0;this.fShowProgressBar=this.fMessageDisplay=!1;"string"==typeof this.checkSleepMessage&&this.checkSleepMessage.length&&(fExecuteSilent||displayMessage(this.checkSleepMessage,1E3));__timer_reset()};
Map.Sleep.prototype.checkSleep=function(b,d){if(this.checkSleepMaxCount&&this.checkSleepCount++>=this.checkSleepMaxCount){this.checkSleepCount=0;var e=this.szFunction+"('"+String(b)+"')";this.fShowProgressBar?(this.runningTime=__timer_getSEC(),executeWithProgressBar(e,this.nDoneCount,this.nCount,this.checkSleepMessage,this.szCancel,this.runningTime)):(this.fMessageDisplay||(fExecuteSilent||displayMessage(this.checkSleepMessage,1E3),this.fMessageDisplay=!0),setTimeout(e,d?d:1));return!0}return!1};
Map.Sleep.prototype.checkSleepMS=function(b,d){return this.checkSleepMaxCount&&__timer_getMS()>this.checkSleepMaxCount?(__timer_reset(),setTimeout(this.szFunction+"('"+String(b)+"')",d?d:1),!0):!1};function __cancelSleep(){alert("cancel sleep")}
Map.Tiles=function(){var b=SVGDocument.getElementsByTagNameNS(szMapNs,"tiles");b.length&&(this.tilesNode=SVGDocument.getElementsByTagNameNS(szMapNs,"maptiles"),this.dataNode=b.item(0),this.nCount=this.dataNode.getAttributeNS(null,"count"),this.tileWidth=this.dataNode.getAttributeNS(null,"width"),this.tileHeight=this.dataNode.getAttributeNS(null,"height"),this.tilesRoot=this.dataNode.getAttributeNS(null,"root").split(".")[0],this.tilesSuffix=this.dataNode.getAttributeNS(null,"root").split(".")[1],
this.depUpper=this.dataNode.getAttributeNS(null,"upper"),this.depLower=this.dataNode.getAttributeNS(null,"lower"),fMarkTiles&&this.markTiles(),this.xLoader=null,this.fDiscardPending=!1)};Map.Tiles.prototype=new Map;Map.Tiles.prototype.getTileNodes=function(b){var d=[];b=this.getTileNodeIds(b);for(var e=0;e<b.length;e++){var f=SVGDocument.getElementById(b[e]);f&&(d[d.length]=f)}return d};
Map.Tiles.prototype.getTileNodeIds=function(b){var d=b.split(":");b=d[0];for(var e="",f=1;f<d.length;f++)e+=":"+d[f];d=[];for(f=0;f<this.nCount;f++)for(var g=0;g<this.nCount;g++)d[d.length]=b+"#"+this.buildTileExtension(g,f)+e;return d};
Map.Tiles.prototype.getTilePositions=function(){for(var b=map.Scale.origMinX,d=map.Scale.origMinY,e=[],f=0;f<this.nCount;f++)for(var g=0;g<this.nCount;g++)if(g<this.nCount&&f<this.nCount){var h=new box(b+g*this.tileWidth,d+f*this.tileHeight,this.tileWidth,this.tileHeight);e[e.length]=h}return e};
Map.Tiles.prototype.getTileBox=function(b){var d=b.split("#")[1];if(null==d||0>=d.length)return null;b=Number(d.substr(0,3));d=Number(d.substr(3,3));return new box(d*this.tileWidth-map.Scale.mapOffset.x,b*this.tileHeight-map.Scale.mapOffset.x,this.tileWidth,this.tileHeight)};
Map.Tiles.prototype.getTileInfo=function(){for(var b=map.Scale.origMinX,d=map.Scale.origMinY,e=[],f=1,g=Math.floor(this.nCount/2);g<=this.nCount&&0<=g;){for(var h=1,k=Math.floor(this.nCount/2);k<=this.nCount&&0<=k;){if(k<this.nCount&&g<this.nCount){var m=this.tilesRoot+"_"+this.buildTileExtension(k,g)+"."+this.tilesSuffix,p="tile"+this.buildTileExtension(k,g),q=SVGDocument.getElementById(p),A=new box(b+k*this.tileWidth,d+g*this.tileHeight,this.tileWidth,this.tileHeight);e[e.length]={szUrl:m,szGroup:p,
tileGroup:q,x:k,y:g,bBox:A};m=this.tilesRoot+"_"+this.buildTileExtension(k,g)+"_ncl."+this.tilesSuffix;p="tile"+this.buildTileExtension(k,g)+":noclip";(q=SVGDocument.getElementById(p))&&(e[e.length]={szUrl:m,szGroup:p,tileGroup:q,x:k,y:g,bBox:A})}k+=h;h=Math.abs(h)+1;0==(h&1)&&(h=-h)}g+=f;f=Math.abs(f)+1;0==(f&1)&&(f=-f)}b=e.length;f=d=0;for(a in e)e[a].tileGroup&&(e[a].tileGroup.hasChildNodes()&&d++,"inline"==e[a].tileGroup.style.getPropertyValue("display")&&f++);_STATUS("Tiling: "+b+"/"+d+"/"+f);
return e};Map.Tiles.prototype.getMasterId=function(b){if(null==b)return null;b=b.split(":");for(var d=b[0].split("#")[0],e=1;e<b.length;e++)d+=":"+b[e];b.length=0;return d};Map.Tiles.prototype.getTileId=function(b){if(null==b)return null;b=b.split(":");var d=b[0];b.length=0;return d};Map.Tiles.prototype.buildTileExtension=function(b,d){return __maptheme_formatpart(d,"0")+__maptheme_formatpart(b,"0")};
Map.Tiles.prototype.setShapeStyle=function(b,d){if(b&&this.nCount){var e=new MapObject(b);if(null!=e)for(var e=this.getMasterId(e.szId),f=e.split(":")[0],e=e.substr(f.length,e.length-f.length),f=this.getTileNodeIds(f),g=0;g<f.length;g++)(shapeNode=SVGDocument.getElementById(f[g]+e))&&shapeNode.setAttributeNS(null,"style",d)}};
Map.Tiles.prototype.markTiles=function(){var b=SVGDocument.getElementById("maptilesbg");if(b)for(var d=0;d<this.nCount;d++)for(var e=0;e<this.nCount;e++)map.Dom.newShape("rect",b,-this.tileWidth*this.nCount/2+e*this.tileWidth,-this.tileHeight*this.nCount/2+d*this.tileHeight,this.tileWidth,this.tileHeight,"fill:none;stroke:gray;stroke-width:0.01")};
Map.Tiles.prototype.switchScaleDependentTiles=function(b){if(fDynamicTiles&&!this.clearTiles(b)){var d=!1;if(0<this.nCount){getMatrix(map.Zoom.canvasNode);var e=map.Scale.origMinX,f=map.Scale.origMinY,g=map.Zoom.getBox(),h=this.getTileInfo();if(h)for(var k=0;k<h.length;k++){var m=h[k].szUrl,p=h[k].szGroup,q=h[k].x,A=h[k].y,w=h[k].bBox,v=h[k].tileGroup;v&&((q=new box(e+q*this.tileWidth,f+A*this.tileHeight,this.tileWidth,this.tileHeight),q.x==w.x&&q.y==w.y&&q.width==w.width&&q.height==w.height||alert("switchScaleDependentTiles box error !!"),
q.x+q.width<g.x||q.y+q.height<g.y||q.x>g.x+g.width||q.y>g.y+g.height)?v.hasChildNodes()&&("external"==v.getAttributeNS(szMapNs,"type")?(v.style.setProperty("display","none",""),fDiscardTiles&&"delayed"!=fDiscardTiles&&(map.Themes.removeFromThemeNodesCache(v),map.Dom.clearGroup(v))):v.style.setProperty("display","none","")):v.hasChildNodes()||"external"!=v.getAttributeNS(szMapNs,"type")?"inline"!=v.style.getPropertyValue("display")&&(v.style.setProperty("display","inline",""),d=!0,fAdaptLabelToScaling&&
map.Layer.adaptLabelToScaling(b,v)):(v.style.setProperty("display","inline",""),setTimeout("map.Tiles.loadScaleDependentTiles('"+p+"','"+m+"')",10)))}}"delayed"==fDiscardTiles&&this.discardTiles();d&&(map.Layer.adaptLabel(b,map.Layer.layerNode),map.Layer.doStoredFeatureScaling())}};
Map.Tiles.prototype.loadScaleDependentTiles=function(b,d){_STATUS("Loading Tile:"+d+","+b);var e=SVGDocument.getElementById(b);this.xLoader||(this.xLoader=new SVGLoaderTiles);this.xLoader.importSVGFile(d,SVGDocument,e,null)&&(fTilesLoaded=!0)};Map.Tiles.prototype.isLoading=function(){return this.xLoader?this.xLoader.isLoading():!1};
Map.Tiles.prototype.clearTiles=function(b){if(!fDynamicTiles)return!1;try{for(a in map.Layer.listA){var d=map.Layer.listA[a];if(d.szFlag.match(/tiled/)&&map.Themes.isThemeLayerUsed(d.szName)&&map.Layer.isScaleDependentLayerOn(d.szName))return!1}}catch(e){}if(0<this.nCount){b=1E11;var d=0,f=this.depUpper,g=this.depLower;f&&f.length&&(b=Number(f.split(":")[1]));g&&g.length&&(d=Number(g.split(":")[1]));if(map.Scale.nTrueMapScale*map.Scale.nZoomScale>=d&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=
b)return!1;if(b=this.getTileInfo())for(d=0;d<b.length;d++)(f=b[d].tileGroup)&&f.hasChildNodes()&&(f.style.setProperty("display","none",""),fDiscardTiles&&"delayed"!=fDiscardTiles&&(map.Themes.removeFromThemeNodesCache(f),map.Dom.clearGroup(f)))}"delayed"==fDiscardTiles&&this.discardTiles();return!0};Map.Tiles.prototype.discardTiles=function(b){fTilesLoaded&&fDiscardTiles&&!this.fDiscardPending&&(setTimeout("map.Tiles.doDiscardTiles()",5E3),this.fDiscardPending=!0)};
Map.Tiles.prototype.doDiscardTiles=function(b){if(fDynamicTiles&&fTilesLoaded)if(mouseObject)setTimeout("map.Tiles.doDiscardTiles()",6E3);else{if(map.Tiles&&0<map.Tiles.nCount&&(b=map.Tiles.getTileInfo()))for(var d=0;d<b.length;d++){var e=b[d].tileGroup;if(e&&"none"==e.style.getPropertyValue("display")&&e.hasChildNodes()){map.Themes.removeFromThemeNodesCache(e);map.Dom.clearGroup(e);setTimeout("map.Tiles.doDiscardTiles()",2E3);return}}this.fDiscardPending=!1}else this.fDiscardPending=!1};
Map.Tiles.prototype.isAnyTiledLayerVisible=function(){for(a in map.Layer.listA){var b=map.Layer.listA[a];if(b.szFlag.match(/tiled/)&&(1==b.nState||"none"!=b.szDisplay||"none"!=b.szDisplayLabel))return!0}return!1};Map.Tiles.prototype.allTilesLoaded=function(){var b=this.getTileInfo();if(b){var d=b.length,e=0;for(a in b)b[a].tileGroup&&b[a].tileGroup.hasChildNodes()&&e++;return d==e}return!1};
Map.Tiles.prototype.isAnyLayerTileLoaded=function(b){if(b=this.getTileInfo())for(a in b)if(b[a].tileGroup&&b[a].tileGroup.hasChildNodes())return!0;return!1};Map.Event=function(){this.fPanDone=!1;this.onoverShape=null;this.fMouseDown=!1;this.contextMenuObj=null;this.onoverPopup=!1;this.tooltipDone=this.popupContextObj=null};Map.Event.prototype=new Map;
Map.Event.prototype.initUseNodes=function(b){if(b&&(b=b.getElementsByTagName("use"))&&b.length)for(i=0;i<b.length;i++)b.item(i).style.setProperty("pointer-events","none","")};Map.Event.prototype.resolveInstance=function(b){if(!b)return null;if("undefined"!=typeof b.nodeType)return b;for(;b.parentNode&&"undefined"==b.correspondingUseElement;)b=b.parentNode;return b.correspondingUseElement};Map.Event.prototype.stopMouseEvent=function(b){b&&(b.stopPropagation(),b.preventDefault())};
Map.Event.prototype.defaultMouseOver=function(b){if(b&&b.target){var d=this.resolveInstance(b.target);if(1==d.nodeType){var e=new MapObject(d);if(e&&e.szId&&e.szId.match(/widget/))widgetList.onMouseOver(b);if(!this.fMouseDown||!this.fMouseDownMoved){if("idle"==szMapToolType)try{if(!e){HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();return}var f=e.szId;if(!(f.match(/legend/)||f.match(/tool/)||f.match(/button/)||f.match(/widget/)||f.match(/movable/)||f.match(/checked/)||f.match(/unchecked/))){HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();
return}}catch(g){}if(""!=szMapToolType){SVGPopupGroup.fu.isContained(d)||SVGFixedGroup.fu.isContained(d)?(this.popupContextObj&&__normalHighlight(b,this.popupContextObj),this.onoverPopup=!0):this.onoverPopup=!1;try{if(HTMLWindow.ixmaps.htmlgui_onItemClick(e.szId))return __circleHighlight(b,e),killTooltip(),HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle(),null}catch(h){}if(this.onoverPopup||!__normalHighlight(b,d)||"info"!==szMapToolType&&""!==szMapToolType)__simpleHighlight(b,d),this.tooltipDone=displayTooltip(b,
d);else{displayInfo(b,d,"delayed|pointer");this.onoverShape=d;try{highlightTheme(new MapObject(d))}catch(k){}}try{"mapbackground:eventrect"==d.getAttributeNS(null,"id")&&HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(m){}}}}}};__simpleHighlight=function(b,d){if(d)try{var e=d.getAttributeNS(szMapNs,"origstyle");if(!e||"null"==e){var f=d.getAttributeNS(szMapNs,"onoverstyle");f&&(d.setAttributeNS(szMapNs,"origstyle",d.getAttributeNS(null,"style")),d.setAttributeNS(null,"style",f))}}catch(g){}};
__simpleHighlightRemove=function(b,d){if(d)try{var e=d.getAttributeNS(szMapNs,"origstyle");e&&2<e.length&&(d.removeAttributeNS(szMapNs,"origstyle"),d.setAttributeNS(null,"style",e))}catch(f){}};
var __normalHighlight=function(b,d){if(__isChart(b,d))return(new MapObject(d)).fu.scale(1.05,1.05),!0;var e=new MapObject(d);if(null==e)return!1;var f=!0,g=null,e=e.szId;if(0===e.length||e.match(/legend/)||e.match(/background/)||e.match(/button/)||e.match(/widget/)||e.match(/textgrid/)||"info"!=szMapToolType&&""!=szMapToolType)return highLightList&&highLightList.removeAll(),!1;if(highLightList&&!highLightList.checkItem(d)){e=d;"g"!=e.nodeName&&(e=e.parentNode);if((e=e.getAttributeNS(null,"id"))&&
!e.match(/chartgroup/)&&_activeTheme!=map.Tiles.getMasterId(e.split(":")[0]))if(f=map.Layer.getLayerObj(e),!f||!f.szSelection||map.Event.tooltipDone||"info"!=szMapToolType&&""!=szMapToolType||displayTooltipText(b,map.Dictionary.getLocalText("click to activate")),fHighlightHint)g="hint",f=!1;else return!1;highLightList.removeAll();for(var e=map.Layer.getLayerItemNodes(d),h=0;h<e.length;h++)highLightList.addItem(e[h],g)}return f},__circleHighlight=function(b,d){d.objNode||(d=new MapObject(d));if(!d.objNode)return!1;
highLightList&&!highLightList.checkItem(d.objNode)&&(highLightList.unlock(),highLightList.removeAll(),highLightList.addItem(d.objNode,"circle"),highLightList.lock())},__isChart=function(b,d){mapObj=new MapObject(d);if(mapObj.szId.match(/chartgroup/)||mapObj.szId.match(/chart:box/)){var e=map.Themes.getTheme(mapObj.szId.split(":")[0]);return e&&e.szFlag&&e.szFlag.match(/BUFFER/)?!1:!0}return!1};
Map.Event.prototype.defaultMouseOut=function(b){if(b&&b.target){var d=this.resolveInstance(b.target),e=new MapObject(d);if(e&&e.szId&&e.szId.match(/widget/))widgetList.onMouseOut(b);__simpleHighlightRemove(b,d);this.onoverShape&&(removeInfo(b,this.onoverShape),__isChart(b,this.onoverShape)&&(new MapObject(this.onoverShape)).fu.scale(1,1));this.onoverShape&&!_activeItem&&(highLightList.removeItem(this.onoverShape),this.onoverShape=null,highlightThemeRemove());killTooltip();killInfo()}};
Map.Event.prototype.defaultMouseClick=function(b){if(b&&b.target){var d=this.resolveInstance(b.target);if(d&&1==d.nodeType){var e=new MapObject(d);if(d==this.ondownShape)if(5<this.fMouseDownMoved)this.fMouseDownMoved=0;else{e=d.parentNode;if("a"==e.nodeName){e=e.getAttributeNS(szXlink,"href");try{HTMLWindow.ixmaps.htmlgui_popupWindow(e),this.stopMouseEvent(b)}catch(f){}}e=new MapObject(d);if(null!=e){var g=e.objNode,h=e.szId;try{if(map.User.onClick(b,h))return null}catch(k){}try{if(HTMLWindow.ixmaps.htmlgui_onItemClick(h))return __circleHighlight(b,
e),killTooltip(),null}catch(m){}if(h){if(widgetList.onClick(b))return;try{"mapbackground:eventrect"==h&&HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(p){}}map.Legend&&map.Legend.legendMouseClick(b,g)?this.stopMouseEvent(b):!g||1!=g.nodeType||!g.parentNode||1!=g.parentNode.nodeType||map.Legend&&map.Legend.legendMouseClick(b,g.parentNode)||!(h=g.parentNode.getAttributeNS(null,"id"))||"PopupGroup"==h||h.match(/widget/)||!fActivateInfoOnClick&&"info"!=szMapToolType&&""!=szMapToolType&&"zoomrect"!=
szMapToolType||(isActiveTheme(map.Layer.getLayerName(h))?(SVGPopupGroup.fu.clear(),displayInfo(b,d,"add|fix|pointer")):(activateTheme(h.split(":")[0]),szMapToolType.match(/select/),map.Zoom.cancel(),this.defaultMouseOver(b),killTooltip()))}}}}};
Map.Event.prototype.defaultMouseDown=function(b){if(b&&b.target&&!map.fInitializing){var d=this.resolveInstance(b.target);if(2==b.button)this.contextMenuObj=d,this.contextMenuCurrentObj=b.currentTarget,__setContextMenu(b);else if(!b.button||0==b.button)if(this.fMouseDown=!0,this.ondownShape=d,this.fMouseDownMoved=0,d=new MapObject(d),null!=d){clickNode=d.objNode;d=String(d.szId);try{if(map.User.onMouseDown(b,d))return null}catch(e){}this.stopMouseEvent(b);widgetList.onMouseDown(b);if(d.match(/movabley/))mouseObject=
new MouseObject(b,clickNode,"yonly");else if(d.match(/movablex/))mouseObject=new MouseObject(b,clickNode,"xonly");else if(d.match(/movable/))mouseObject=new MouseObject(b,clickNode);else if(d.match(/maptoolnode/))mapToolList.onMouseDown(b);else if(d.match(/widget/))widgetList.onMouseDown(b);else d.match(/legend/)?(b=d.split(":"),2<b.length&&clickNode.ownerDocument.getElementById(b[2])&&("minus"==b[1]&&setTimeout("__opacityMinus('"+b[2]+"')",200),"plus"==b[1]&&setTimeout("__opacityPlus('"+b[2]+"')",
200))):(b.shiftKey||b.altKey||b.crtlKey||!map.Layer.isMapObject(clickNode)||szMapToolType&&""!=szMapToolType&&(mapTool=new MapTool(b,szMapToolType)),b.shiftKey&&!b.altKey&&!b.crtlKey&&map.Layer.isMapObject(clickNode)&&(mapTool=""==szMapToolType?new MapTool(b,"pan"):new MapTool(b,szMapToolType)),!fTriggerMouseMoveForPan||d.match(/legend/)||d.match(/tool/)||d.match(/button/)||d.match(/widget/)||d.match(/movable/)||d.match(/checked/)||d.match(/unchecked/)||"info"!=szMapToolType&&""!=szMapToolType||(this.triggerMoveForPan=
!0))}}};Map.Event.prototype.defaultMouseUp=function(b){if(b&&b.target&&!map.fInitializing){this.stopMouseEvent(b);try{if(map.User.onMouseUp(b))return null}catch(d){}this.fMouseDown=!1;if(mouseObject){try{mouseObject.onMouseUp(b)}catch(e){}mouseObject=null}widgetList.onMouseUp(b);this.triggerMoveForPan=!1}};
Map.Event.prototype.defaultMouseMove=function(b){if(b&&b.target&&!map.fInitializing){var d=this.resolveInstance(b.target);this.triggerMoveForPan&&this.fMouseDownMoved&&(mapTool=new MapTool(b,"pan"),this.triggerMoveForPan=!1);if(!mouseObject)try{var e=(new MapObject(d)).objNode.getAttributeNS(null,"id");if(!(e.match(/legend/)||e.match(/tool/)||e.match(/button/)||e.match(/widget/)||e.match(/movable/)||e.match(/checked/)||e.match(/unchecked/)||"idle"!=szMapToolType&&"mapbackground:eventrect"!=e)){HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();
return}}catch(f){}this.stopMouseEvent(b);if(mouseObject)try{mouseObject.onMouseMove(b)}catch(g){}this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null));this.fMouseDownMoved+=this.fMouseDown?1:0;widgetList.onMouseMove(b)}};var __fShiftDone=!1,__szOldMapToolType=null;
Map.Event.prototype.defaultKeyDown=function(b){!b||__fShiftDone||!b.shiftKey||b.altKey||b.crtlKey||(__szOldMapToolType=szMapToolType,"pan"==szMapToolType?setMapTool("zoomrect"):"zoomrect"==szMapToolType?setMapTool("pan"):"info"==szMapToolType&&setMapTool("pan"),__fShiftDone=!0)};Map.Event.prototype.defaultKeyUp=function(b){!b||!__fShiftDone||b.shiftKey||b.altKey||b.crtlKey||(setMapTool(__szOldMapToolType),__fShiftDone=!1)};
Map.Event.prototype.doDefaultZoom=function(b){if(!fFroozeDynamicContent){SVGNotifyGroup.fu.clear();var d=SVGRootElement.getAttribute("viewBox").split(" "),e=SVGOrigViewBoxString.split(" "),e=1/(Number(e[2])/Number(d[2]));if(d=map.Scale.zoomNode)var f=getMatrix(d),e=e/f[0];map.Scale.oldZoomScale=map.Scale.nZoomScale;map.Scale.oldMapCenter=map.Scale.mapCenter;map.Scale.nZoomScale!=e&&(map.Dom.clearGroup(SVGToolsGroup),map.Dom.clearGroup(SVGFixedGroup),map.removeAllHighlights());map.Scale.nZoomScale=
e;map.Scale.mapCenter=new point(f[4],f[5]);if(0==fPanByViewer){if(0!=SVGRootElement.currentTranslate.x||0!=SVGRootElement.currentTranslate.y){var d=map.Scale.zoomNode,f=getMatrix(d),e=f[0],g=f[3],h=map.Scale.rotatePoint(SVGRootElement.currentTranslate);SVGRootElement.currentTranslate.x=h.x;SVGRootElement.currentTranslate.y=h.y;h=f[4]+map.Scale.scaleX(SVGRootElement.currentTranslate.x);f=f[5]+map.Scale.scaleY(SVGRootElement.currentTranslate.y);d.setAttributeNS(null,"transform","matrix("+e+" 0 0 "+
g+" "+h+" "+f+")");map.Scale.mapCenter=new point(h,f);SVGRootElement.currentTranslate.x=0;SVGRootElement.currentTranslate.y=0}}else{if(f=SVGDocument.getElementById("mapcliprect"))f.setAttributeNS(null,"x",map.Scale.scaleX(-SVGRootElement.currentTranslate.x)),f.setAttributeNS(null,"y",map.Scale.scaleY(-SVGRootElement.currentTranslate.y)),f.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),f.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()));if(f=SVGDocument.getElementById("mapbackground:eventrect"))f.setAttributeNS(null,
"x",map.Scale.scaleX(-SVGRootElement.currentTranslate.x)),f.setAttributeNS(null,"y",map.Scale.scaleY(-SVGRootElement.currentTranslate.y)),f.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),f.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()))}b&&antiZoomAndPanList.adjustGroups(b);Math.abs(map.Scale.oldZoomScale-map.Scale.nZoomScale)>map.Scale.oldZoomScale/100?("delayed"==fFeatureScaling?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+
"')",1E3):map.Layer.changeFeatureScaling(b,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&"delayed"==fDynamicLayer?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(b),displayScale(b)):"delayed"==fDynamicTiles?setTimeout("map.Layer.doStoredFeatureScaling()",500):map.Layer.doStoredFeatureScaling(b);"delayed"==fDynamicTiles?setTimeout("map.Tiles.switchScaleDependentTiles(null)",500):map.Tiles.switchScaleDependentTiles(b);if(map.Scale.oldZoomScale!=
map.Scale.nZoomScale||10<Math.abs(map.Scale.oldMapCenter.x-map.Scale.mapCenter.x)||10<Math.abs(map.Scale.oldMapCenter.y-map.Scale.mapCenter.y)){try{HTMLWindow.ixmaps.htmlgui_onZoomAndPan(map.Scale.nZoomScale)}catch(k){}"delayed"==fDynamicTiles||"delayed"==fDynamicLayer?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",10);try{map.Scale.oldZoomScale!=map.Scale.nZoomScale?map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/map.Scale.nZoomScale):setTimeout("map.Themes.actualizeActiveTheme("+
map.Scale.oldZoomScale/map.Scale.nZoomScale+")",10)}catch(m){}try{HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale)),0,"BLANK"))}catch(p){}}zoomAndPanHistory.newItem();map.Scale.refreshCSSStyles();setTimeout("map.showMap()",1)}};
Map.Event.prototype.doPrintZoom=function(b){map.Scale.nZoomScale/=5;map.Scale.oldZoomScale!=map.Scale.nZoomScale?("delayed"==fFeatureScaling?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+"')",1E3):map.Layer.changeFeatureScaling(b,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&"delayed"==fDynamicLayer?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(b),displayScale(b)):"delayed"==fDynamicTiles?setTimeout("map.Layer.doStoredFeatureScaling()",
500):map.Layer.doStoredFeatureScaling(b);"delayed"==fDynamicTiles?setTimeout("map.Tiles.switchScaleDependentTiles(null)",500):map.Tiles.switchScaleDependentTiles(b);if(map.Scale.oldZoomScale!=map.Scale.nZoomScale||map.Scale.oldMapCenter.x!=map.Scale.mapCenter.x||map.Scale.oldMapCenter.y!=map.Scale.mapCenter.y){"delayed"==fDynamicTiles||"delayed"==fDynamicLayer?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",10);try{map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/
map.Scale.nZoomScale)}catch(d){}}try{HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale)),0,"BLANK")),HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(map.Zoom.getEnvelopeString(),map.Scale.oldZoomScale!=map.Scale.nZoomScale)}catch(e){}map.Scale.refreshCSSStyles()};Map.Event.prototype.doDefaultResize=function(b){map&&map.Layer&&(map.Layer.switchScaleDependentLayer(b),displayScale(b))};
Map.Event.prototype.doDefaultPan=function(b){b&&!mouseObject&&(antiZoomAndPanList.adjustGroups(b),map.Event.fPanDone=!0)};Map.Event.prototype.doDefaultAdjustPan=function(b){this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null))};Map.Event.prototype.moveToFrontOfGroup=function(b){b&&b.currentTarget&&b.currentTarget.parentNode&&b.currentTarget!=b.currentTarget.parentNode.lastChild&&b.currentTarget.parentNode.appendChild(b.currentTarget)};
function History(){this.itemA=[];this.historyPointer=0;this.fSuspend=!1;this.newItem()}History.prototype.add=function(b){this.historyPointer=this.itemA.length;this.itemA[this.itemA.length]=b};History.prototype.newItem=function(){this.fSuspend?this.fSuspend=!1:this.add(new HistoryItem)};History.prototype.backwards=function(){0<this.historyPointer&&(this.fSuspend=!0,this.itemA.length=this.historyPointer,this.historyPointer--,this.itemA[this.historyPointer].exec())};
History.prototype.forwards=function(){this.historyPointer<this.itemA.length-1&&(this.fSuspend=!0,this.historyPointer++,this.itemA[this.historyPointer].exec())};History.prototype.clear=function(){this.itemA.length=0};function HistoryItem(){try{this.szEnvelope=map.Zoom.getEnvelopeString()}catch(b){}}HistoryItem.prototype.exec=function(){try{var b=this.szEnvelope.split("="),d=b[1].split("'")[1],e=b[2].split("'")[1],f=b[3].split("'")[1],g=b[4].split("'")[1];map.Zoom.doZoomMapToEnvelope(d,e,f,g)}catch(h){alert("History Item not valid")}};
InfoContainer=function(b,d,e,f,g,h,k){d&&e&&2<e.length&&(this.szId=e+":movable",this.objectNode=map.Dom.newGroup(d,this.szId),this.ptPosition=f,this.ptOffsetOrig=new point(g.x,g.y),this.ptOffset=g,this.szMode=h,this.szTitle=k,this.nFontheight=14,this.onRemove="",this.fClipped=!0,this.create())};
InfoContainer.prototype.create=function(){this.ptPosition||(this.ptPosition=new point(1E3,1E3));this.ptOffset||(this.ptOffset=new point(100,100));this.szMode||(this.szMode="");this.szMode.match(/left/)&&(this.ptOffset.x=-(2*this.ptOffset.x),this.ptOffset.y*=3);this.frameNode=map.Dom.newShape("rect",this.objectNode,0,0,map.Scale.normalX(10),map.Scale.normalY(10),"fill:#ffffff;stroke:black;stroke-width:"+map.Scale.normalX(0)+"");this.frameNode.setAttributeNS(null,"rx",map.Scale.normalX(2*nInfoRoundRect));
this.frameNode.setAttributeNS(null,"ry",map.Scale.normalX(2*nInfoRoundRect));SVGDocument.getElementById(szShadowFilterToolsId)&&this.frameNode.style.setProperty("filter","url(#"+szShadowFilterToolsId+")","");this.canvasNode=map.Dom.newGroup(this.objectNode,this.szId+":canvas");this.canvasNode.fu.setPosition(map.Scale.normalX(1),map.Scale.normalY(1));this.titleNode=map.Dom.newGroup(this.objectNode,this.szId+":title");this.titleTextNode=map.Dom.newGroup(this.titleNode,this.szId+":titletext");this.szTitle&&
map.Dom.newText(this.titleTextNode,map.Scale.normalX(10),map.Scale.normalY(this.nFontheight+10),"font-family:arial;font-size:"+map.Scale.normalY(this.nFontheight/4*3)+"px;fill:black;pointer-events:none",this.szTitle);if(this.scrollObj=new ScrollArea(null,this.canvasNode,null,10,10,10))this.scrollObj.reformat(),this.workspaceNode=this.scrollObj.workspaceNode;this.workspaceNode||(this.scrollObj=null,this.workspaceNode=map.Dom.newGroup(this.canvasNode,this.szId+":workspace"),this.workspaceClipRect=map.Dom.setClipRect(this.workspaceNode,
new box(0,0,10,10)));this.objectNode.setAttributeNS(null,"onclick","map.Event.moveToFrontOfGroup(evt)");this.objectNode.setAttributeNS(null,"ontouchend","map.Event.moveToFrontOfGroup(evt)");this.szMode.match(/fix/)?(this.deleteButton=new Button(this.titleNode,this.szId,"BUTTON","#delete_button","map.Dom.removeElementById('"+this.szId+"');","remove"),this.deleteButton.scale(1,1),this.deleteButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10))):this.szMode.match(/pin/)&&SVGDocument.getElementById("pin_button")&&
(this.pinButton=new Button(this.titleNode,this.szId,"BUTTON","#pin_button","doDisplayInfo("+this.ptPosition.x+","+this.ptPosition.y+",'pointer|fix');","","fix it"),this.pinButton.scale(1,1),this.pinButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10)));this.widgetObj=new Widget(this.objectNode,this)};
InfoContainer.prototype.setTitle=function(b,d){d||(d=map.Scale.tStyle.ContainerTitle);map.Dom.clearGroup(this.titleTextNode);(this.szTitle=b)&&map.Dom.newText(this.titleTextNode,map.Scale.normalX(10),1.3*d.nFontHeight,d.szStyle,this.szTitle);this.reformat()};
InfoContainer.prototype.reformat=function(){this.bBox=map.Dom.getBox(this.workspaceNode);this.tBox=map.Dom.getBox(this.titleTextNode);0>this.bBox.height&&(this.bBox.height=0);0>this.bBox.width&&(this.bBox.width=0);0>this.tBox.height&&(this.tBox.height=0);if(0!=this.bBox.width&&0!=this.bBox.height||this.szTitle&&this.szTitle.length){1==this.bBox.height&&(this.bBox.height=-200);var b=map.Scale.normalX(15+map.Scale.nButtonSize);if(this.fClipped)var b=Math.min(Math.max(this.bBox.width+b,this.tBox.width+
b),map.Scale.bBox.width/2),d=Math.min(this.bBox.height+this.tBox.height,map.Scale.bBox.height/2.4);else b=Math.max(this.bBox.width+b,this.tBox.width+b),d=this.bBox.y+this.bBox.height+this.tBox.height+map.Scale.normalY(10);d>map.Scale.bBox.height/4*5&&(b=Math.min(this.bBox.width+map.Scale.normalX(10)+map.Scale.normalY(10),map.Scale.bBox.width/2.4));b>map.Scale.bBox.width/4*5&&(d=Math.min(this.bBox.height+this.tBox.height+map.Scale.normalY(10),map.Scale.bBox.height/2.4));this.scrollObj?(this.scrollObj.setWidth(b/
map.Scale.normalX(1)-1),this.scrollObj.setHeight(d/map.Scale.normalY(1)),this.scrollObj.reformat(),this.scrollObj.hasScrollBars()?(d<this.bBox.height+map.Scale.normalX(this.scrollObj.nScrollBarWidth)&&(this.scrollObj.setHeight(d/map.Scale.normalY(1)+this.scrollObj.nScrollBarWidth+6),this.scrollObj.reformat(),d+=map.Scale.normalY(this.scrollObj.nScrollBarWidth+1)),this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(8)+this.tBox.height),b+=map.Scale.normalX(10)+map.Scale.normalX(7),
d+=map.Scale.normalY(2)+map.Scale.normalY(10)+map.Scale.normalY(5)+2*this.tBox.height):(this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(10)+1.3*this.tBox.height),d+=map.Scale.normalY(10)+this.tBox.height-map.Scale.normalY(7))):(this.workspaceClipRect.setAttributeNS(null,"width",b),this.workspaceClipRect.setAttributeNS(null,"height",d));var e=map.Scale.tStyle.ContainerTitle,e=map.Scale.normalY(map.Scale.nButtonSize/3)+e.nFontHeight/2,f=map.Scale.normalY(map.Scale.nButtonSize/
3);this.pinButton?this.pinButton.setPosition(b-f,e):this.deleteButton?this.deleteButton.setPosition(b-f,e):b-=map.Scale.normalX(map.Scale.nButtonSize);this.bBox.width=b;this.bBox.height=d;this.frameNode&&(this.frameNode.setAttributeNS(null,"width",this.bBox.width+2*map.Scale.normalX(5)),this.frameNode.setAttributeNS(null,"height",this.bBox.height+map.Scale.normalX(5)));this.shadowNode&&(this.shadowNode.setAttributeNS(null,"width",this.bBox.width+2*map.Scale.normalX(5)+map.Scale.normalX(.5)),this.shadowNode.setAttributeNS(null,
"height",this.bBox.height+map.Scale.normalX(5)+map.Scale.normalY(1)));b=map.Scale.getGroupOffset(this.objectNode);this.newPosition=map.Scale.clipWidgetObjectToSVG(this.objectNode,new point(this.ptPosition.x+b.x,this.ptPosition.y+b.y),this.ptOffsetOrig,this.bBox);this.newPosition.x-=b.x;this.newPosition.y-=b.y;this.objectNode.fu.setPosition(this.newPosition.x,this.newPosition.y);this.ptOffset.x=this.newPosition.x-this.ptPosition.x;this.ptOffset.y=this.newPosition.y-this.ptPosition.y;this.szMode.match(/pointer/)&&
this.makePointer()}else this.remove()};
InfoContainer.prototype.makePointer=function(){var b=this.ptOffset.y,d=map.Scale.normalX(15),e=map.Scale.normalX(10);map.Scale.normalX(5);this.pointerObj?(map.Dom.clearGroup(this.pointerObj),map.Dom.clearGroup(this.pointShObj)):(this.pointerObj=map.Dom.newGroup(this.objectNode),this.pointShObj=map.Dom.newGroup(this.objectNode),this.pointShObj.parentNode.insertBefore(this.pointShObj,this.pointShObj.parentNode.firstChild));0>this.ptOffset.y&&this.ptOffset.y>-this.bBox.height&&0>this.ptOffset.x&&this.ptOffset.x>
-this.bBox.width||(b=this.ptOffset.y+this.bBox.height/2,d=this.ptOffset.x+this.bBox.width/2,Math.abs(b)+this.bBox.width/2-this.bBox.height/2>Math.abs(d)?(d=0,this.ptOffset.x>2*-e&&(d=this.ptOffset.x+2*e),this.ptOffset.x<-this.bBox.width+2*e&&(d=this.ptOffset.x+this.bBox.width-2*e),0<b?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(d-map.Scale.normalX(8.5))+","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(20)+",0 z","fill:black;fill-opacity:0.5"),
map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(d-map.Scale.normalX(7.5))+","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(d-map.Scale.normalX(8.5))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(20)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+
","+-this.ptOffset.y+" l "+(d-map.Scale.normalX(7.5))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white"))):(b=0,this.ptOffset.y>2*-e&&(b=this.ptOffset.y+2*e),this.ptOffset.y<-this.bBox.height+2*e&&(b=this.ptOffset.y+this.bBox.height-2*e),0<d?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+map.Scale.normalX(1))+","+(b-map.Scale.normalX(8.5))+" 0,"+map.Scale.normalX(20)+" z","fill:black;fill-opacity:0.5"),
map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+map.Scale.normalX(1))+","+(b-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(b-map.Scale.normalX(8.5))+" 0,"+map.Scale.normalX(20)+" z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+
","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(b-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white"))))};InfoContainer.prototype.onMouseMove=function(){if(this.fMouseDown){var b=this.objectNode.fu.getPosition();this.ptOffset.x+=b.x-this.beforeMovePosition.x;this.ptOffset.y+=b.y-this.beforeMovePosition.y;this.beforeMovePosition=this.objectNode.fu.getPosition();this.szMode.match(/pointer/)&&this.makePointer()}};
InfoContainer.prototype.onMouseUp=function(){var b=this.objectNode.fu.getPosition();this.ptOffset.x+=b.x-this.beforeMovePosition.x;this.ptOffset.y+=b.y-this.beforeMovePosition.y;this.fMouseDown=!1;this.szMode.match(/pointer/)&&this.makePointer()};InfoContainer.prototype.onMouseDown=function(){this.beforeMovePosition=this.objectNode.fu.getPosition();this.fMouseDown=!0};
InfoContainer.prototype.setOnRemove=function(b){this.deleteButton&&this.deleteButton.buttonNode&&this.deleteButton.setActionOn("map.Dom.removeElementById('"+this.szId+"');"+b)};InfoContainer.prototype.remove=function(){this.objectNode.parentNode.removeChild(this.objectNode);this.objectNode=null};InfoContainer.prototype.clear=function(){map.Dom.clearGroup(this.workspaceNode)};
MouseObject=function(b,d,e,f){d&&(this.objNode=d,this.objNode.fu=new Methods(this.objNode),this.objStartPosition=this.objNode.fu.getPosition(),this.szFlag=e?e:"",this.parent=f);this.mouseStartPosition=b?map.Scale.getClientMousePosition(b,this.objNode):new point(0,0)};
MouseObject.prototype.onMouseMove=function(b){var d=map.Scale.getClientMousePosition(b,this.objNode);try{if(map.User.onMouseMove(b,this.objNode.getAttributeNS(null,"id"),d))return null}catch(e){}switch(this.szFlag){case "yonly":d.x=this.mouseStartPosition.x;break;case "xonly":d.y=this.mouseStartPosition.y}if(this.objNode&&!this.szFlag.match(/parentonly/)){var f=this.objNode.fu.getScale();this.objNode.fu.setPosition(this.objStartPosition.x+(d.x-this.mouseStartPosition.x)/f.x,this.objStartPosition.y+
(d.y-this.mouseStartPosition.y)/f.y)}if(this.parent)this.parent.onMouseMove(b)};MouseObject.prototype.onMouseUp=function(b){if(this.parent)this.parent.onMouseUp(b)};Button=function(b,d,e,f,g,h,k){this.targetGroup=b;this.szId=d?d:"button:"+String(Math.random());this.szType=e?e:"SIMPLE";this.szStyle=f?f:"";this.szActionOn=g;this.szActionOff=h;this.szTooltip=k?k:"";this.draw()};
Button.prototype.draw=function(b){!this.szType.match(/SELECTED/)||this.szType.match(/CHECKBOX/)?(this.nodeObj=map.Dom.newGroup(this.targetGroup),this.nodeObj.setAttributeNS(null,"cursor","pointer"),b=map.Dom.constructNode("a",this.nodeObj,{}),this.shapeObj=map.Dom.newGroup(b)):this.shapeObj=this.nodeObj=map.Dom.newGroup(this.targetGroup);this.nodeObj.setAttributeNS(null,"id",this.szId+":button");if(this.szType.match(/CHECKBOX/)){b=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#unchecked_button"});
var d=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#checked_button"});b.setAttributeNS(null,"id",this.szId+":unchecked");d.setAttributeNS(null,"id",this.szId+":checked");this.szType.match(/SELECTED/)&&(this.checked=!0);this.szType.match(/SELECTED/)||(this.checked=!1,d.style.setProperty("display","none",""));b=map.Dom.newShape("rect",this.shapeObj,map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(map.Scale.nButtonSize),map.Scale.normalX(map.Scale.nButtonSize),
"fill:red;fill-opacity:0");b.setAttributeNS(null,"id",this.szId+":widget:eventrect");b.setAttributeNS(szMapNs,"tooltip",this.szTooltip);b.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)");new Widget(b,this)}else if(this.szType.match(/TEXTBUTTON/)){var e=this.szStyle;b=map.Scale.normalY(.6*map.Scale.nButtonSize);var f="font-family:arial;font-size:"+b+"px;fill:#444444;baseline-shift:-30%;pointer-events:none",g=b/2*e.length,d=null;this.szType.match(/SELECTED/)?d=map.Dom.newShape("rect",
this.shapeObj,-b/5,-b/3*2,g,b/5*6,"fill:#eeeeff;stroke:black;stroke-width:"+map.Scale.normalX(1)+";stroke-opacity:0.3"):(d=map.Dom.newShape("rect",this.shapeObj,-b/5,-b/3*2,g,b/5*6,"fill:white;stroke:none;opacity:0"),d.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),d.setAttributeNS(null,"onmouseout","map.Event.stopMouseEvent(evt)"),d.setAttributeNS(null,"onclick",this.szActionOn),d.setAttributeNS(null,"ontouchend",this.szActionOn),d.setAttributeNS(szMapNs,"tooltip",this.szTooltip));
e=map.Dom.newText(this.shapeObj,0,0,f,e);this.bBox=new box(-b/5,-b/3*2,e.getComputedTextLength()+b/5*2,b/5*6);d.setAttributeNS(null,"width",String(this.bBox.width));this.buttonNode=d}else this.szType.match(/BUTTON/)&&(b=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":this.szStyle}),b.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),b.setAttributeNS(null,"onmousedown","map.Event.stopMouseEvent(evt)"),b.setAttributeNS(null,"onclick",this.szActionOn),b.setAttributeNS(null,"ontouchend",
this.szActionOn),b.setAttributeNS(szMapNs,"tooltip",this.szTooltip),this.buttonNode=b)};Button.prototype.scale=function(b,d){this.nodeObj&&this.nodeObj.fu.scale(b,d)};Button.prototype.setPosition=function(b,d){this.nodeObj&&this.nodeObj.fu.setPosition(b,d)};Button.prototype.getPosition=function(b,d){if(this.nodeObj)return this.nodeObj.fu.getPosition()};Button.prototype.remove=function(){this.nodeObj&&this.nodeObj.parentNode.removeChild(this.nodeObj)};
Button.prototype.setActionOn=function(b){this.szActionOn=b;this.buttonNode&&(this.buttonNode.setAttributeNS(null,"onclick",this.szActionOn),this.buttonNode.setAttributeNS(null,"ontouchend",this.szActionOn))};Button.prototype.onClick=function(b){this.toggleCheckBox(b);map.Event.stopMouseEvent(b)};
Button.prototype.toggleCheckBox=function(b){b=SVGDocument.getElementById(this.szId+":checked");this.checked?(b.style.setProperty("display","none",""),eval(this.szActionOff)):(b.style.setProperty("display","inline",""),eval(this.szActionOn));this.checked=!this.checked};
ScrollBar=function(b,d,e,f,g,h){b&&(this.hBar=this.vBar=0,this.vScale=this.hScale=1,this.maxBox=e,this.bWidth=f,this.bHeight=g,this.hThumb=e.width,this.vThumb=e.height,this.vValue=this.hValue=this.vThumbOffset=this.hThumbOffset=0,this.contObj=b,this.contBox=contBox=map.Dom.getBox(b),this.contObj.fu=new Methods(this.contObj),contBox.width+contBox.x<=e.width-e.x+1&&contBox.height+contBox.y<=e.height-e.y+1||(contBox.width+contBox.x>e.width-e.x&&(this.hBar=g),contBox.height+contBox.y>e.height-e.y-this.hBar&&
(this.vBar=f),contBox.width+contBox.x>e.width-e.x-this.vBar&&(this.hBar=g),this.vBar&&(this.maxBox.width-=this.vBar+h),this.hBar&&(this.maxBox.height-=this.hBar+h),this.hMax=this.maxBox.width-2*this.hBar,this.vMax=this.maxBox.height-2*this.vBar,this.hScale=(contBox.width+contBox.x)/this.maxBox.width,this.vScale=(contBox.height+contBox.y)/this.maxBox.height,1<this.hScale&&(this.hThumb=Math.floor(this.hMax/this.hScale),this.hThumbOffset=Math.min(this.hMax-this.hThumb,-(d.x/this.hScale)),this.hValue=
-d.x/(contBox.width+contBox.x-this.maxBox.width)),1<this.vScale&&(this.vThumb=Math.floor(this.vMax/this.vScale),this.vThumbOffset=Math.min(this.vMax-this.vThumb,-(d.y/this.vScale)),this.vValue=-d.y/(contBox.height+contBox.y-this.maxBox.height)),this.hThumbStyle="fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.3)+";opacity:0.3",this.vThumbStyle="fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalY(.3)+";opacity:0.3"))};
ScrollBar.prototype.draw=function(b){if(this.contObj){var d="fill:white;stroke:black;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0",e="fill:#e8e8f8;stroke:white;stroke-width:"+map.Scale.normalX(.5)+";opacity:1.0";map.Scale.normalX(2);var f="fill:white;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0";this.remove(b);if(1!=this.hScale||1!=this.vScale){b=map.Dom.newGroup(this.contObj.parentNode);b.setAttributeNS(null,"id","scrollwidget");this.scrollWidget=b;var g=null;1<this.vScale&&
1<this.hScale&&map.Dom.newShape("rect",b,this.maxBox.width,this.maxBox.height,this.bWidth+map.Scale.normalX(1),this.bHeight+map.Scale.normalX(1),d);if(1<this.hScale){map.Dom.newShape("rect",b,this.bWidth,this.maxBox.height,this.hMax,this.bHeight+map.Scale.normalX(.8),f);if(g=map.Dom.newShape("rect",b,this.bWidth,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))g.setAttributeNS(null,"id","widget:scrollbar:bigstepleft"),new Widget(g,this);if(g=map.Dom.newShape("rect",
b,this.bWidth+this.hMax/2,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))g.setAttributeNS(null,"id","widget:scrollbar:bigstepright"),new Widget(g,this);g=map.Dom.newShape("rect",b,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.hThumb-map.Scale.normalX(2)),Math.max(2,this.bHeight-map.Scale.normalY(2)),this.hThumbStyle?this.hThumbStyle:e);g.fu.setPosition(this.bWidth,this.maxBox.height);this.hThumbObj=new Slider(g,new box(0,0,this.hMax-this.hThumb,0));
this.hThumbObj.parent=this;this.hThumbObj.setValue(new point(this.hValue,0))}if(1<this.vScale){map.Dom.newShape("rect",b,this.maxBox.width+map.Scale.normalX(2),this.bHeight,this.bWidth-map.Scale.normalX(2),this.vMax,f);if(g=map.Dom.newShape("rect",b,this.maxBox.width,this.bHeight,this.bWidth,this.vMax/2,"fill:black;stroke:black;opacity:0"))g.setAttributeNS(null,"id","widget:scrollbar:bigstepup"),new Widget(g,this);if(g=map.Dom.newShape("rect",b,this.maxBox.width,this.bHeight+this.vMax/2,this.bWidth,
this.vMax/2,"fill:black;stroke:black;opacity:0"))g.setAttributeNS(null,"id","widget:scrollbar:bigstepdown"),new Widget(g,this);g=map.Dom.newShape("rect",b,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.bWidth-map.Scale.normalX(2)),Math.max(2,this.vThumb-map.Scale.normalY(2)),this.vThumbStyle?this.vThumbStyle:e);g.fu.setPosition(this.maxBox.width,this.bHeight);this.vThumbObj=new Slider(g,new box(0,0,0,this.vMax-this.vThumb));this.vThumbObj.parent=this;this.vThumbObj.setValue(new point(0,
this.vValue))}}else this.contObj.fu.setPosition(0,0)}};ScrollBar.prototype.hasScrollBars=function(b){return 1<this.vScale||1<this.hScale};ScrollBar.prototype.onMouseDown=function(b){};ScrollBar.prototype.onMouseMove=function(b){var d=b=0;1<this.hScale&&(b=this.hThumbObj.fraction.x);1<this.vScale&&(d=this.vThumbObj.fraction.y);this.contObj.fu.setPosition(-b*(this.contBox.x+this.contBox.width-this.maxBox.width),-d*(this.contBox.y+this.contBox.height-this.maxBox.height))};
ScrollBar.prototype.onMouseUp=function(b){};ScrollBar.prototype.onClick=function(b){if(b=new MapObject(b.target))szId=b.szId,nStep=szId.match(/big/)?map.Scale.normalX(100):map.Scale.normalX(5),szId.match(/stepdown/)?this.vThumbObj.moveThumb(0,nStep):szId.match(/stepup/)?this.vThumbObj.moveThumb(0,-nStep):szId.match(/stepleft/)?this.hThumbObj.moveThumb(-nStep,0):szId.match(/stepright/)&&this.hThumbObj.moveThumb(nStep,0)};ScrollBar.prototype.remove=function(b){this.scrollWidget&&this.scrollWidget.parentNode.removeChild(this.scrollWidget)};
Slider=function(b,d,e,f,g){this.szId=null;this.moveArea=d;this.scaleArea=e;this.value=new point(0,0);this.fraction=new point(0,0);this.onUp=this.onMove=null;g&&(this.valuesA=g.split(","));this.objNode=b;this.objNode.setAttributeNS(null,"id","widget:slider:"+String(Math.random()));b.fu=new Methods(b);this.ptNull=b.fu.getPosition();widgetList.add(this)};Slider.prototype.setMoveArea=function(b){this.moveArea=b};Slider.prototype.setId=function(b){this.szId=b};
Slider.prototype.onMouseOver=function(b){if(this.parent)try{this.parent.onMouseOver(b,this.szId,this)}catch(d){}};Slider.prototype.onMouseOut=function(b){if(this.parent)try{this.parent.onMouseOut(b,this.szId,this)}catch(d){}};
Slider.prototype.onMouseDown=function(b){mouseObject=0==this.moveArea.width?new MouseObject(b,this.objNode,"yonly"):0==this.moveArea.height?new MouseObject(b,this.objNode,"xonly"):new MouseObject(b,this.objNode,null);mouseObject.parent=this;if(this.parent)try{this.parent.onMouseDown(b,this.szId,this)}catch(d){}};
Slider.prototype.onMouseMove=function(b){var d=this.objNode.fu.getPosition();d.x=Math.min(d.x,this.ptNull.x+this.moveArea.x+this.moveArea.width);d.x=Math.max(d.x,this.ptNull.x+this.moveArea.x);d.y=Math.min(d.y,this.ptNull.y+this.moveArea.y+this.moveArea.height);d.y=Math.max(d.y,this.ptNull.y+this.moveArea.y);this.objNode.fu.setPosition(d.x,d.y);this.value=new point(0,0);0<this.moveArea.width&&(this.value.x=d.x-this.ptNull.x,this.fraction.x=this.value.x/this.moveArea.width);0<this.moveArea.height&&
(this.value.y=d.y-this.ptNull.y,this.fraction.y=this.value.y/this.moveArea.height);if(this.parent)try{this.parent.onMouseMove(b,this.szId,this)}catch(e){}};Slider.prototype.onMouseUp=function(b){if(this.parent)try{this.parent.onMouseUp(b,this.szId,this)}catch(d){}};Slider.prototype.moveThumb=function(b,d){var e=this.objNode.fu.getPosition();e.x+=b;e.y+=d;this.objNode.fu.setPosition(e.x,e.y);this.onMouseMove()};
Slider.prototype.setValue=function(b){this.objNode.fu.setPosition(b.x*this.moveArea.width+this.ptNull.x,b.y*this.moveArea.height+this.ptNull.y);this.onMouseMove()};Slider.prototype.remove=function(){widgetList.removeWidget(this)};
RotationSlider=function(b,d,e,f,g,h){this.circlethumb=map.Dom.newGroup(b.parentNode,"widget:rotationslider:thumb");this.circlethumb.setAttributeNS(null,"area","-1000,-1000,1000,1000");this.circlethumb.setAttributeNS(null,"range",e);this.circlethumb.setAttributeNS(null,"scale",f);this.nStep=g;this.nSnap=h;this.pBase=b.fu.getPosition();this.circlethumb.fu.setPosition(this.pBase.x,this.pBase.y);this.circlethumbNode=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(5),"fill:#ff0000;opacity:0.0;pointer-events:none");
this.circleOverNode2=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(6),"fill:none;stroke:#ffffff;stroke-width:"+map.Scale.normalX(11)+";opacity:0.6;pointer-events:none;display:none");this.circleOverNode=map.Dom.newShape("path",this.circlethumb,"M-"+map.Scale.normalX(5.5)+",0 a"+map.Scale.normalX(6)+","+map.Scale.normalX(6)+" 0 1,0 "+map.Scale.normalX(5)+","+-map.Scale.normalX(5),"fill:none;stroke:#888888;stroke-width:"+map.Scale.normalX(1)+";opacity:0.8;pointer-events:none;display:none");
setRotate(this.circleOverNode,45);setRotate(this.circleOverNode2,45);d=map.Dom.newNode("defs",this.circlethumb);d=map.Dom.newNode("marker",d);d.setAttributeNS(null,"id","Triangle");d.setAttributeNS(null,"refX","0");d.setAttributeNS(null,"refY","0");d.setAttributeNS(null,"orient","auto");d.setAttributeNS(null,"style","overflow:visible");d.setAttributeNS(null,"path","M 0 0 L "+map.Scale.normalX(10)+" "+map.Scale.normalX(5)+" L 0 "+map.Scale.normalX(10)+" z");this.circleOverNode.style.setProperty("marker-start",
"url(#Triangle)","");this.circleOverNode.style.setProperty("marker-end","url(#Triangle)","");this.objNode=b;this.objNode.setAttributeNS(null,"id","widget:slider:"+String(Math.random()));widgetList.add(this);this.isActive=!1};RotationSlider.prototype.setValue=function(b){this.objNode.fu.setPosition(ptValue.x*this.moveArea.width+this.ptNull.x,ptValue.y*this.moveArea.height+this.ptNull.y);this.onMouseMove()};
RotationSlider.prototype.onMouseOver=function(b){this.circleOverNode.style.setProperty("display","inline","");this.circleOverNode2.style.setProperty("display","inline","");if(this.parent)try{this.parent.onMouseOver(b)}catch(d){}};RotationSlider.prototype.onMouseOut=function(b){this.isActive||(this.circleOverNode.style.setProperty("display","none",""),this.circleOverNode2.style.setProperty("display","none",""));if(this.parent)try{this.parent.onMouseOut(b)}catch(d){}};
RotationSlider.prototype.onMouseDown=function(b){var d=map.Scale.getClientMousePosition(b,SVGToolsGroup);this.startPosition=new point(d.x-this.pBase.x,d.y-this.pBase.y);this.circlethumbNode.fu.setPosition(this.startPosition.x,this.startPosition.y);mouseObject=new MouseObject(b,this.circlethumbNode);mouseObject.parent=this;this.isActive=!0;if(this.parent)try{this.parent.onMouseDown(b)}catch(e){}};
RotationSlider.prototype.onMouseMove=function(b){if(this.isActive&&(setRotate(this.objNode,this.getAngle()),this.parent))try{this.parent.onMouseMove(b)}catch(d){}};RotationSlider.prototype.onMouseUp=function(b){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display","none","");if(this.parent){try{this.parent.onMouseUp(b)}catch(d){}this.objNode.style.setProperty("opacity","1.0","")}};
RotationSlider.prototype.onClick=function(b){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display","none","");setRotate(this.objNode,0);if(this.parent){try{this.parent.onClick(b)}catch(d){}this.objNode.style.setProperty("opacity","1.0","")}};
RotationSlider.prototype.getAngle=function(b){var d=this.circlethumbNode.fu.getPosition();b=d.x;var d=d.y,e=Math.sqrt(b*b+d*d),e=Math.asin(b/e)/Math.PI*180,e=isNaN(e)?180:e;0<=b&&0<=d&&(e=180-e);0>b&&0<=d&&(e=180-e);0>b&&0>d&&(e=360+e);this.nStep&&this.nSnap&&(e%this.nStep<this.nSnap?(e=Math.floor(e/this.nStep)*this.nStep,this.objNode.style.setProperty("opacity","1.0","")):this.objNode.style.setProperty("opacity","0.5",""));return e};
function SORsliderMove(b){b=getMatrix(this.symbolNode);b[4]=Math.min(Math.max(Number(b[4]),sliderObject.moveArea.x),sliderObject.moveArea.width);b[5]=Math.min(Math.max(Number(b[5]),sliderObject.moveArea.y),sliderObject.moveArea.height);setMatrix(this.symbolNode,b);var d=SORsliderGetAngle(this.symbolNode),e=this.symbolNode.getAttribute("range");if(e&&""!=e){var f=Number(e.split(",")[0]),e=Number(e.split(",")[1]),g=0;f<e?(d=Math.min(Math.max(d,f),e),g=d/(e-f)*(sliderObject.scaleVal.ymin-sliderObject.scaleVal.xmin)):
(d>=e&&(d<=(f-e)/2?d=e:d<=f&&(d=f)),g=((d<=e?d+360:d)-f)/(360-f+e)*(sliderObject.scaleVal.ymin-sliderObject.scaleVal.xmin))}this.symbolNode.parentNode.firstChild.setAttributeNS(null,"transform","rotate("+d+")");b[4]=SX(20*Math.sin(d/180*Math.PI));b[5]=SY(-20*Math.cos(d/180*Math.PI));setMatrix(this.symbolNode,b);sliderObject.onMove&&""!=sliderObject.onMove&&eval(sliderObject.onMove+"(evt,"+String(g)+")")}
function SORsliderUp(b){b=SORsliderGetAngle(this.symbolNode);sliderObject.onUp&&""!=sliderObject.onUp&&eval(sliderObject.onUp+"(evt,"+String(b)+")");sliderObject.pointNode&&removeObject(sliderObject.pointNode);sliderObject=null}function SORsliderGetAngle(b){var d=getMatrix(b);b=Number(d[4]);var d=Number(d[5]),e=Math.sqrt(b*b+d*d),e=Math.asin(b/e)/Math.PI*180;0<=b&&0<=d&&(e=180-e);0>b&&0<=d&&(e=180-e);0>b&&0>d&&(e=360+e);return e}WidgetList=function(){this.widgetA=[]};
WidgetList.prototype.add=function(b){this.widgetA[this.widgetA.length]=b};WidgetList.prototype.getWidget=function(b){for(i in this.widgetA)if(this.widgetA[i].objNode==b)return this.widgetA[i];return null};WidgetList.prototype.onMouseOver=function(b){var d=new MapObject(b.target);if(d){d=this.getWidget(d.objNode);try{d.onMouseOver(b)}catch(e){}try{d.owner.onMouseOver(b)}catch(f){}}};WidgetList.prototype.onMouseOut=function(b){var d=new MapObject(b.target);if(d){d=this.getWidget(d.objNode);try{d.onMouseOut(b)}catch(e){}try{d.owner.onMouseOut(b)}catch(f){}}};
WidgetList.prototype.onMouseDown=function(b){var d=new MapObject(b.target);if(d){d=this.getWidget(d.objNode);try{d.onMouseDown(b)}catch(e){}try{d.owner.onMouseDown(b)}catch(f){}}};WidgetList.prototype.onMouseUp=function(b){var d=new MapObject(b.target);if(d){d=this.getWidget(d.objNode);try{d.onMouseUp(b)}catch(e){}try{d.owner.onMouseUp(b)}catch(f){}}};WidgetList.prototype.onMouseMove=function(b){var d=new MapObject(b.target);if(d){d=this.getWidget(d.objNode);try{d.onMouseMove(b)}catch(e){}try{d.owner.onMouseMove(b)}catch(f){}}};
WidgetList.prototype.onClick=function(b){var d=new MapObject(b.target);if(d&&(d=this.getWidget(d.objNode))){try{d.onClick(b)}catch(e){}try{d.owner.onClick(b)}catch(f){}return!0}return!1};WidgetList.prototype.removeWidget=function(b){for(var d=0;d<this.widgetA.length;d++)if(this.widgetA[d].objNode==b){for(;d<this.widgetA.length-1;d++)this.widgetA[d]=this.widgetA[d+1];this.widgetA.length--}};WidgetList.prototype.clear=function(){this.widgetA.length=0};
Widget=function(b,d){this.objNode=b;this.owner=d;widgetList.add(this)};Widget.prototype.remove=function(){widgetList.removeWidget(this)};widgetList=new WidgetList;MapToolList=function(){this.toolsA=[]};MapToolList.prototype.add=function(b,d){d&&d<this.toolsA.length-1?this.toolsA.splice(d,0,b):this.toolsA[this.toolsA.length]=b};MapToolList.prototype.getMapTool=function(b){for(i in this.toolsA)if(this.toolsA[i].objNode==b.parentNode)return this.toolsA[i];return null};
MapToolList.prototype.removeMapTool=function(b){for(var d=0;d<this.toolsA.length;d++)if(this.toolsA[d].objNode==b.parentNode){for(this.toolsA[d].remove();d<this.toolsA.length-1;d++)this.toolsA[d]=this.toolsA[d+1];this.toolsA.length--;this.toolsA.length&&this.toolsA[0].redraw()}};MapToolList.prototype.clear=function(){this.toolsA.length=0};
MapToolList.prototype.onMouseDown=function(b){var d=new MapObject(b.target);d&&(mapTool=mapToolList.getMapTool(d.objNode))&&(mouseObject=new MouseObject(b,d.objNode,"parentonly",mapTool),mouseObject.parent=mapTool)};mapToolList=new MapToolList;
MapTool=function(b,d,e){this.nFontSize=14;this.szLineStyle="fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";opacity:1.0;";this.szLineStyleLite="fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(.75)+";opacity:1.0;";this.szLineBgStyle="fill:none;stroke:white;stroke-width:"+map.Scale.normalX(5)+";opacity:0.5;";this.szFillBgStyle="fill:white;stroke:none;opacity:0.6";this.szTextStyle="font-family:arial;font-size:"+map.Scale.normalY(this.nFontSize)+"px;fill:darkblue;pointer-events:none;";
this.szPolylineStyle="fill:none;stroke:blue;stroke-width:"+map.Scale.normalX(2.5)+";stroke-opacity:0.5;";this.szPolygonStyle="fill:blue;stroke:black;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szBufferStyle="fill:blue;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szType=d;this.objNode=map.Dom.newGroup(SVGToolsGroup,d+String(Math.random()));var f=null,f=f=null,f=this.szPolygonStyle;switch(d){case "coord":mouseObject=new MouseObject(b,null,"parentonly");
mouseObject.parent=this;f=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",f,0,0,1,1,this.szFillBgStyle);map.Dom.newText(f,0,0,this.szTextStyle,"");map.Dom.newText(f,0,0,this.szTextStyle,"");f=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");f.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",f,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",f,-map.Scale.normalX(10),0,map.Scale.normalX(10),
0,this.szLineStyleLite);map.Dom.newShape("line",f,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",f,0,0,map.Scale.normalX(3.7),this.szLineStyle);f.fu.setPosition(mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y);this.redraw();break;case "polyline":f=this.szPolylineStyle;case "polygon":mouseObject=new MouseObject(b,null,"parentonly");mouseObject.parent=this;b=SVGDocument.getElementById("maptools_polypath");null==b&&(b=map.Dom.newNode("path",
SVGToolsGroup),b.setAttributeNS(null,"id","maptools_polypath"),b.setAttributeNS(szMapNs,"menu","polygonmenu"),b.setAttributeNS(null,"style",f),b.parentNode.insertBefore(b,this.objNode),mapToolList.toolShape=b);f=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");f.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",f,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",f,-map.Scale.normalX(10),0,map.Scale.normalX(10),0,this.szLineStyleLite);
map.Dom.newShape("line",f,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",f,0,0,map.Scale.normalX(3.7),this.szLineStyle);f.fu.setPosition(mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y);break;case "measurement":case "measurebuffer":case "selectbuffer":mouseObject=new MouseObject(b,null);mouseObject.parent=this;map.Dom.newShape("circle",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(1),
this.szLineBgStyle);map.Dom.newShape("circle",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(1),"measurebuffer"==this.szType||"selectbuffer"==this.szType?this.szBufferStyle:this.szLineStyle);map.Dom.newShape("line",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,this.szLineBgStyle);map.Dom.newShape("line",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,
mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,this.szLineStyle);f=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",f,mouseObject.mouseStartPosition.x+map.Scale.normalX(5),mouseObject.mouseStartPosition.y-map.Scale.normalY(5)-map.Scale.normalY(6*this.nFontSize/7),0,map.Scale.normalY(this.nFontSize),this.szFillBgStyle);map.Dom.newText(f,mouseObject.mouseStartPosition.x+map.Scale.normalX(5),mouseObject.mouseStartPosition.y-map.Scale.normalY(5),
this.szTextStyle,"test");f=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random()));map.Dom.newShape("circle",f,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",f,mouseObject.mouseStartPosition.x-map.Scale.normalX(10),mouseObject.mouseStartPosition.y,mouseObject.mouseStartPosition.x+map.Scale.normalX(10),mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",f,mouseObject.mouseStartPosition.x,
mouseObject.mouseStartPosition.y-map.Scale.normalX(10),mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",f,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);f=map.Dom.newGroup(this.objNode,"startpoint"+String(Math.random()));map.Dom.newShape("circle",f,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);
map.Dom.newShape("line",f,mouseObject.mouseStartPosition.x-map.Scale.normalX(10),mouseObject.mouseStartPosition.y,mouseObject.mouseStartPosition.x+map.Scale.normalX(10),mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",f,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y-map.Scale.normalX(10),mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",f,mouseObject.mouseStartPosition.x,
mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);break;case "zoomrect":case "selectrect":mouseObject=new MouseObject(b,null);mouseObject.parent=this;map.Dom.newShape("rect",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,10,10,this.szLineBgStyle);map.Dom.newShape("rect",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,10,10,this.szLineStyle);break;case "pan":mouseObject=new MouseObject(b,null),mouseObject.parent=
this,this.beginPan(b)}this.mapToolList=mapToolList;mapToolList.add(this,e)};MapTool.prototype.onMouseDown=function(b){var d=new MapObject(b.target);d&&(mouseObject=new MouseObject(b,d.objNode),mouseObject.parent=this)};
MapTool.prototype.onMouseMove=function(b){var d=null,e,f=map.Scale.getClientMousePosition(b,SVGToolsGroup),g=f.x-mouseObject.mouseStartPosition.x,h=f.y-mouseObject.mouseStartPosition.y;switch(this.szType){case "coord":d=this.objNode.childNodes;e=0;d.item(e++);g=d.item(e++);f=map.Scale.clipWidgetPositionToMap(f);g.fu.setPosition(f.x,f.y);this.redraw();break;case "measurement":case "measurebuffer":case "selectbuffer":d=this.objNode.childNodes;e=0;var k=d.item(e++),m=d.item(e++),p=d.item(e++),q=d.item(e++);
b=d.item(e++);d=d.item(e++);k.setAttributeNS(null,"r",String(Math.sqrt(g*g+h*h)));m.setAttributeNS(null,"r",String(Math.sqrt(g*g+h*h)));p.setAttributeNS(null,"x2",String(f.x));p.setAttributeNS(null,"y2",String(f.y));q.setAttributeNS(null,"x2",String(f.x));q.setAttributeNS(null,"y2",String(f.y));d.fu.setPosition(g,h);b.fu.setPosition(g/2,h/2);h=g=b.firstChild;f=map.Scale.getDistanceInMeter(mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,f.x,f.y);h.firstChild.nodeValue=map.Scale.formatDistanceString(f);
f=map.Dom.getBox(h);g.setAttributeNS(null,"width",f.width);break;case "zoomrect":case "selectrect":d=this.objNode.childNodes;e=0;f=d.item(e++);d=d.item(e++);f.setAttributeNS(null,"width",String(Math.max(1,g)));f.setAttributeNS(null,"height",String(Math.max(1,h)));d.setAttributeNS(null,"width",String(Math.max(1,g)));d.setAttributeNS(null,"height",String(Math.max(1,h)));break;case "pan":fPDFEmbed||!fPanToolByViewer?(map.Zoom.doPanMap(g/map.Scale.normalX(1),h/map.Scale.normalY(1)),mouseObject.mouseStartPosition.x=
f.x,mouseObject.mouseStartPosition.y=f.y):(f=map.Scale.getClientMousePosition(b,null),g=f.x-mouseObject.mouseStartPosition.x,h=f.y-mouseObject.mouseStartPosition.y,map.Zoom.doPanMapByViewer(g/map.Scale.normalX(1),h/map.Scale.normalY(1)));break;case "polyline":case "polygon":this.objNode.firstChild.fu.setPosition(f.x,f.y),this.redraw()}};
MapTool.prototype.onMouseUp=function(b){var d=0;switch(this.szType){case "coord":this.redraw();break;case "polyline":case "polygon":this.redraw();break;case "pan":displayMessage("please wait ...",500);setTimeout("map.Event.doDefaultZoom(null)",fPanToolByViewer?5:200);this.endPan(b);break;case "measurement":case "measurebuffer":toolNodes=this.objNode.childNodes;d=0;"measurement"==this.szType&&(b=toolNodes.item(d++),d=toolNodes.item(d++),b.parentNode.removeChild(b),d.parentNode.removeChild(d));break;
case "selectbuffer":toolNodes=this.objNode.childNodes;d=0;toolNodes.item(d++);d=toolNodes.item(d++);b=d.parentNode.getAttributeNS(null,"id")+":shape";d.setAttributeNS(null,"id",b);(d=map.Selections.newSelection("activeLayer",b,"type:circle"))?d.mapTool=this:this.remove();break;case "selectrect":toolNodes=this.objNode.childNodes;d=0;b=toolNodes.item(d++);d=toolNodes.item(d++);b=d.parentNode.getAttributeNS(null,"id")+":shape";d.setAttributeNS(null,"id",b);(d=map.Selections.newSelection("activeLayer",
b,"type:square"))?d.mapTool=this:this.remove();break;case "zoomrect":toolNodes=this.objNode.childNodes,d=0,b=toolNodes.item(d++),d=map.Dom.getBox(b),this.objNode.parentNode.removeChild(this.objNode),map.Zoom.doZoomMapToWidgetRect(d),setMapTool("")}};MapTool.prototype.beginPan=function(b){fPanToolByViewer&&fPanHideTools&&!fPDFEmbed&&(this.endPanTimeout=!1,map.Zoom.activateClipping(b),this.hideTools(b));try{HTMLWindow.ixmaps.htmlgui_isHTMLMapVisible()?map.hideAll():this.hideLayer(b)}catch(d){this.hideLayer(b)}map.Label.stopProcessing()};
MapTool.prototype.endPan=function(b){"delayed"!=fEndPan?(fPanToolByViewer&&fPanHideTools&&!fPDFEmbed&&(map.Zoom.removeClipping(b),setTimeout("mapTool.showTools(null)",5)),setTimeout("mapTool.showLayer(null)",50),setTimeout("map.showAll()",250)):(this.endPanTimeout=!0,setTimeout("mapTool.doEndPan(null)",500))};
MapTool.prototype.doEndPan=function(b){if(1==this.endPanTimeout){fPanToolByViewer&&fPanHideTools&&!fPDFEmbed&&(map.Zoom.removeClipping(b),this.showTools(b));this.showLayer(b);this.endPanTimeout=!1;try{map.Themes.actualizeActiveTheme()}catch(d){}}};MapTool.prototype.hideTools=function(b){this.toolsHidden&&0!=this.toolsHidden||(antiZoomAndPanList.setDisplay(b,"none"),this.toolsHidden=!0)};
MapTool.prototype.showTools=function(b){1==this.toolsHidden&&(antiZoomAndPanList.setDisplay(b,"inline"),this.toolsHidden=!1)};
MapTool.prototype.hideLayer=function(b){for(a in map.Layer.listA)if(b=map.Layer.listA[a],b.szFlag.match(/invisiblepan/)){if(map.Tiles&&0<map.Tiles.nCount)for(var d=map.Tiles.getTileNodeIds(a),e=0;e<d.length;e++){var f=d[e];if(featureNode=SVGDocument.getElementById(f))b.szBeforeHideStyle=featureNode.style.getPropertyValue("display"),featureNode.style.setProperty("display","none","");if(featureNode=SVGDocument.getElementById(f+":label"))b.szBeforeHideLabelStyle=featureNode.style.getPropertyValue("display"),
featureNode.style.setProperty("display","none","");if(featureNode=SVGDocument.getElementById(f+":label:bg"))b.szBeforeHideLabelStyle=featureNode.style.getPropertyValue("display"),featureNode.style.setProperty("display","none","")}if(featureNode=SVGDocument.getElementById(a))b.szBeforeHideStyle=featureNode.style.getPropertyValue("display"),featureNode.style.setProperty("display","none","");if(featureNode=SVGDocument.getElementById(a+":label"))b.szBeforeHideLabelStyle=featureNode.style.getPropertyValue("display"),
featureNode.style.setProperty("display","none","");if(featureNode=SVGDocument.getElementById(a+":label:bg"))b.szBeforeHideLabelStyle=featureNode.style.getPropertyValue("display"),featureNode.style.setProperty("display","none","")}};
MapTool.prototype.showLayer=function(b){for(a in map.Layer.listA)if(b=map.Layer.listA[a],b.szFlag.match(/invisiblepan/)){if(map.Tiles&&0<map.Tiles.nCount)for(var d=map.Tiles.getTileNodeIds(a),e=0;e<d.length;e++){var f=d[e];(featureNode=SVGDocument.getElementById(f))&&(b.szBeforeHideStyle.length?featureNode.style.setProperty("display",b.szBeforeHideStyle,""):featureNode.style.removeProperty("display"));(featureNode=SVGDocument.getElementById(f+":label"))&&(b.szBeforeHideLabelStyle.length?featureNode.style.setProperty("display",
b.szBeforeHideLabelStyle,""):featureNode.style.removeProperty("display"));(featureNode=SVGDocument.getElementById(f+":label:bg"))&&(b.szBeforeHideLabelStyle.length?featureNode.style.setProperty("display",b.szBeforeHideLabelStyle,""):featureNode.style.removeProperty("display"))}(featureNode=SVGDocument.getElementById(a))&&(b.szBeforeHideStyle.length?featureNode.style.setProperty("display",b.szBeforeHideStyle,""):featureNode.style.removeProperty("display"));(featureNode=SVGDocument.getElementById(a+
":label"))&&(b.szBeforeHideLabelStyle.length?featureNode.style.setProperty("display",b.szBeforeHideLabelStyle,""):featureNode.style.removeProperty("display"));(featureNode=SVGDocument.getElementById(a+":label:bg"))&&(b.szBeforeHideLabelStyle.length?featureNode.style.setProperty("display",b.szBeforeHideLabelStyle,""):featureNode.style.removeProperty("display"))}};
MapTool.prototype.redraw=function(b){switch(this.szType){case "polygon":var d=SVGDocument.getElementById("maptools_polypath");if(null==d)break;var e=[],f=this.mapToolList.toolsA;szD="";var g=f[0].objNode.firstChild;g.fu=new Methods(g);g=g.fu.getPosition();e[e.length]=g;szD+="M"+g.x+","+g.y;for(i=1;i<f.length;i++)g=f[i].objNode.firstChild,g.fu=new Methods(g),g=g.fu.getPosition(),e[e.length]=g,szD+=" "+g.x+","+g.y;szD+="z";d.setAttributeNS(null,"d",szD);(f=SVGDocument.getElementById("maptools_phantomPointGroup"))?
map.Dom.clearGroup(f):f=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");for(i=0;i<e.length;i++)x=e[i].x+(e[i<e.length-1?i+1:0].x-e[i].x)/2,y=e[i].y+(e[i<e.length-1?i+1:0].y-e[i].y)/2,g=map.Dom.newShape("circle",f,x,y,map.Scale.normalX(10),"fill:white;stroke:none;opacity:0.1;"),map.Dom.newShape("circle",f,x,y,map.Scale.normalX(2),this.szPolygonStyle+"pointer-events:none;"),g.setAttributeNS(szMapNs,"tooltip","click to add point"),g.setAttributeNS(null,"onmousedown","new MapTool(evt,'polygon',"+
(i+1)+")");(f=map.Dom.getObjectById("maptools_polygon_text"))?map.Dom.clearGroup(f):f=map.Dom.newGroup(SVGToolsGroup,"maptools_polygon_text");d=__doGetPolygonCenter(e);g=Math.abs(__doGetPolygonSurface(e,!0));e=new TextField(b,f,"maptooltext_template",18);e.setText(map.Scale.formatSurfaceString(g));b=e.textGroup.fu.getBox();e.setPosition(d.x-b.width/2,d.y-b.height/2);break;case "polyline":f=SVGDocument.getElementById("maptools_polypath");if(null==f)break;e=[];d=this.mapToolList.toolsA;szD="";g=d[0].objNode.firstChild;
g.fu=new Methods(g);g=g.fu.getPosition();e[e.length]=g;szD+="M"+g.x+","+g.y;for(i=1;i<d.length;i++)g=d[i].objNode.firstChild,g.fu=new Methods(g),g=g.fu.getPosition(),szD+=" "+g.x+","+g.y,e[e.length]=g;f.setAttributeNS(null,"d",szD);(f=SVGDocument.getElementById("maptools_phantomPointGroup"))?map.Dom.clearGroup(f):f=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");for(i=0;i<e.length-1;i++)x=e[i].x+(e[i+1].x-e[i].x)/2,y=e[i].y+(e[i+1].y-e[i].y)/2,g=map.Dom.newShape("circle",f,x,y,map.Scale.normalX(2),
this.szPolygonStyle),g.setAttributeNS(szMapNs,"tooltip","click to add point"),g.setAttributeNS(null,"onmousedown","new MapTool(evt,'polyline',"+(i+1)+")");(f=SVGDocument.getElementById("maptools_polyline_textgroup"))?map.Dom.clearGroup(f):f=map.Dom.newGroup(this.objNode,"maptools_polyline_textgroup");g=0;for(i=1;i<d.length;i++){var h=0,e=d[i].objNode.firstChild,k=d[i-1].objNode.firstChild.fu.getPosition(),m=e.fu.getPosition(),g=g+(h=map.Scale.getDistanceInMeter(k.x,k.y,m.x,m.y)),e=new TextField(b,
f,"maptooltext_template",12);e.setText(map.Scale.formatDistanceString(h));e.setPosition(k.x+(m.x-k.x)/2,k.y+(m.y-k.y)/2)}m=d[d.length-1].objNode.firstChild.fu.getPosition();e=new TextField(b,f,"maptooltext_template",18);e.setText(map.Scale.formatDistanceString(g));e.setPosition(m.x+map.Scale.normalX(5),m.y);e.textGroup.setAttributeNS(szMapNs,"menu","polylinemenu");break;case "coord":d=this.objNode.childNodes,i=0,b=d.item(i++),d=d.item(i++).fu.getPosition(),e=b.firstChild,f=e.nextSibling,g=f.nextSibling,
k=map.Scale.getMapPosition(d.x,d.y),k=map.Scale.getMapCoordinate(k.x,k.y),k=map.Scale.getGeoCoordinateOfPoint(k.x,k.y),h="Y="+String(k.y),f.firstChild.nodeValue="X="+String(k.x),g.firstChild.nodeValue=h,k=map.Dom.getBox(f),h=map.Dom.getBox(g),f.setAttributeNS(null,"y",Number(k.height)),g.setAttributeNS(null,"y",Number(k.y)+Number(k.height)+Number(h.height)+map.Scale.normalY(3)),e.setAttributeNS(null,"width",k.width),e.setAttributeNS(null,"height",Number(k.height)+Number(h.height)+map.Scale.normalY(3)),
d=new point(d.x,d.y),e=new point(map.Scale.normalX(5),map.Scale.normalY(5)),d=map.Scale.clipWidgetObjectToMap(b,d,e),b.fu.setPosition(d.x,d.y)}};MapTool.prototype.remove=function(b){this.objNode.parentNode.removeChild(this.objNode)};MapTool.prototype.printPolygon=function(b){(b=SVGDocument.getElementById("maptools_polygon"))&&alert(printNode(b))};
setMapTool=function(b){map.Layer.setPointerEvents(null);"info"==b&&"info"==szMapToolType&&deactivateTheme(_activeTheme);"pan"==b&&deactivateTheme(_activeTheme);killTooltip();killInfo();map.Dom.clearGroup(SVGMenuGroup);map.Dom.clearGroup(SVGToolsGroup);mapToolList.clear();szMapToolType=b;fPDFEmbed&&fSetToolCursor&&setTimeout("setMapToolCursor('"+b+"')",100);try{HTMLWindow.ixmaps.htmlgui_setMapTool(b)}catch(d){}};
setMapToolCursor=function(b){var d=null;(d=SVGDocument.getElementById("mapbackground"))&&d.setAttributeNS(null,"cursor","url(#"+b+"_cursor)");(d=SVGDocument.getElementById("mapcanvas"))&&d.setAttributeNS(null,"cursor","url(#"+b+"_cursor)");SVGToolsGroup&&SVGToolsGroup.setAttributeNS(null,"cursor","url(#"+b+"_cursor)")};var _lastActiveToolBgNode=null;
setMapToolActive=function(b){_lastActiveToolBgNode&&_lastActiveToolBgNode.style.setProperty("opacity","0","");var d=null;if(d=SVGDocument.getElementById("legend:activatetool:"+b))if(b=d.getElementsByTagName("rect").item(0))b.style.setProperty("opacity","1",""),b.style.setProperty("fill","#eeeeff",""),b.style.setProperty("stroke","#0000ff",""),b.style.setProperty("stroke-width","0.5",""),_lastActiveToolBgNode=b};
TextField=function(b,d,e,f){(b=SVGDocument.getElementById(e))?(this.textGroup=d.appendChild(b.cloneNode(1E3)),this.textGroup.fu=new Methods(this.textGroup),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.textGroup.setAttributeNS(null,"id",e+String(Math.random())),d=this.textGroup.getElementsByTagName("rect"),e=this.textGroup.getElementsByTagName("text"),1<d.length?(this.sdNode=d.item(0),this.bgNode=d.item(1)):this.bgNode=d.item(0),this.textNode=e.item(0),f&&this.textNode.style.setProperty("font-size",
String(f)+"px",""),this.textNode.parentNode==this.textGroup?(this.workspaceNode=map.Dom.newGroup(this.textGroup,"workspace:"+String(Math.random())),this.textGroup.insertBefore(this.workspaceNode,this.textNode),this.workspaceNode.appendChild(this.textNode)):this.workspaceNode=this.textNode.parentNode):"flat"==e?(this.textGroup=map.Dom.newGroup(d,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),fMapBorder3D&&SVGDocument.getElementById(szShadowFilterId)&&
(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",nInfoRoundRect*f/6),this.sdNode.setAttributeNS(null,"ry",nInfoRoundRect*f/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:#888888;stroke-width:2;"),this.bgNode.setAttributeNS(null,"rx",nInfoRoundRect*f/6),this.bgNode.setAttributeNS(null,"ry",nInfoRoundRect*f/6),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+
f+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.7")):"light"==e?(this.textGroup=map.Dom.newGroup(d,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),fMapBorder3D&&SVGDocument.getElementById(szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",nInfoRoundRect*f/6),this.sdNode.setAttributeNS(null,
"ry",nInfoRoundRect*f/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#fdfdfd;stroke:#888888;stroke-width:0.1;opacity:1;"),this.bgNode.setAttributeNS(null,"rx",nInfoRoundRect*f/6),this.bgNode.setAttributeNS(null,"ry",nInfoRoundRect*f/6),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+f+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.95")):"alert"==e?(this.textGroup=map.Dom.newGroup(d,
"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),SVGDocument.getElementById(szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#666666;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.Scale.normalY(.1)),this.sdNode.setAttributeNS(null,"ry",map.Scale.normalY(.1))),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#F9EDB8;stroke:#EDC967;stroke-width:1;opacity:1"),this.textNode=map.Dom.newText(this.textGroup,
0,0,"font-family:arial;font-size:"+f+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode):(this.textGroup=map.Dom.newGroup(d,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.5;stroke:none"),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:blue;stroke-width:0.1"),this.sdNode.setAttributeNS(null,"rx",nInfoRoundRect),this.sdNode.setAttributeNS(null,
"ry",nInfoRoundRect),this.bgNode.setAttributeNS(null,"rx",nInfoRoundRect),this.bgNode.setAttributeNS(null,"ry",nInfoRoundRect),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+f+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode,"transparent"==e&&(this.textGroup.setAttributeNS(null,"opacity","0.4"),this.sdNode.setAttributeNS(null,"rx",5*nInfoRoundRect),this.sdNode.setAttributeNS(null,"ry",5*nInfoRoundRect),this.bgNode.setAttributeNS(null,"rx",5*nInfoRoundRect),
this.bgNode.setAttributeNS(null,"ry",5*nInfoRoundRect)))};TextField.prototype.setText=function(b){try{return this.textNode.firstChild.nodeValue=b,this.resizeField(),!0}catch(d){return!1}};
TextField.prototype.resizeField=function(){try{var b=map.Dom.getBox(this.workspaceNode);this.bgNode&&(this.bgNode.setAttributeNS(null,"x",b.x-12),this.bgNode.setAttributeNS(null,"y",b.y-3),this.bgNode.setAttributeNS(null,"width",b.width+24),this.bgNode.setAttributeNS(null,"height",b.height+10));this.sdNode&&(this.sdNode.setAttributeNS(null,"x",b.x-6+1),this.sdNode.setAttributeNS(null,"y",b.y-3+2),this.sdNode.setAttributeNS(null,"width",b.width+12+1),this.sdNode.setAttributeNS(null,"height",b.height+
6+1))}catch(d){}};TextField.prototype.setPosition=function(b,d){this.textGroup.fu.setPosition(b,d)};
ScrollArea=function(b,d,e,f,g,h){this.nMaxWidth=f?f:100;this.nMaxHeight=g?g:100;this.nScrollBarWidth=h?h:10;null!=d&&(b=":"+String(Math.random()),(f=SVGDocument.getElementById(e))?(this.areaGroup=d.appendChild(f.cloneNode(1E3)),this.areaGroup.fu=new Methods(this.areaGroup),this.areaGroup.fu.extendAllIds(this.areaGroup,b),this.workspaceNode=SVGDocument.getElementById(e+":workspace"+b),this.cliprectNode=SVGDocument.getElementById(e+":cliprect"+b)):(e="scrollarea",this.areaGroup=map.Dom.newGroup(d,e+
b),d=map.Dom.newNode("clipPath",this.areaGroup),d.setAttribute("id",e+":clippath"+b),d.setAttribute("style","pointer-events:all"),this.cliprectNode=map.Dom.newShape("rect",d,0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight),"fill:none;stroke:none"),this.cliprectNode.setAttribute("id",e+":cliprect"+b),this.areaGroup.setAttributeNS(null,"clip-path","url(#"+e+":clippath"+b+")"),this.workspaceNode=map.Dom.newGroup(this.areaGroup,e+":workspace"+b)),this.szId=e)};
ScrollArea.prototype.setWidth=function(b){this.cliprectNode&&(this.nMaxWidth=Number(b),this.cliprectNode.setAttributeNS(null,"width",map.Scale.normalX(Math.max(this.nMaxWidth,0))))};ScrollArea.prototype.setHeight=function(b){this.cliprectNode&&(this.nMaxHeight=Number(b),this.cliprectNode.setAttributeNS(null,"height",map.Scale.normalX(Math.max(this.nMaxHeight,0))))};ScrollArea.prototype.setPosition=function(b,d){this.areaGroup&&this.areaGroup.fu.setPosition(b,d)};
ScrollArea.prototype.reformat=function(b){this.scrollObj&&(this.scrollObj.remove(b),this.scrollObj=null);var d=new box(0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight)),e=getTranslate(this.workspaceNode);if(0>this.nMaxWidth||0>this.nMaxHeight){var f=map.Dom.getBox(this.workspaceNode);d.width=0<=this.nMaxWidth?d.width:f.width+map.Scale.normalX(this.nScrollBarWidth+5);d.height=0<=this.nMaxHeight?d.height:f.height+map.Scale.normalY(this.nScrollBarWidth+5);this.cliprectNode.setAttributeNS(null,
"width",d.width);this.cliprectNode.setAttributeNS(null,"height",d.height)}(this.scrollObj=new ScrollBar(this.workspaceNode,new point(e.x,e.y),d,map.Scale.normalX(this.nScrollBarWidth),map.Scale.normalY(this.nScrollBarWidth),map.Scale.normalX(1)))&&this.scrollObj.draw(b)};ScrollArea.prototype.remove=function(b){this.scrollObj&&(this.scrollObj.remove(b),this.scrollObj=null);this.areaGroup&&(this.areaGroup.parentNode.removeChild(this.areaGroup),this.areaGroup=null)};
ScrollArea.prototype.hasScrollBars=function(b){return this.scrollObj?this.scrollObj.hasScrollBars():!1};ScrollArea.prototype.getWidth=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"width"))/map.Scale.normalX(1):0};ScrollArea.prototype.getHeight=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"height"))/map.Scale.normalY(1):0};
ScrollArea.prototype.setScrollPosition=function(b){this.scrollObj&&this.scrollObj.vThumbObj&&this.scrollObj.vThumbObj.setValue(b);this.scrollObj&&this.scrollObj.hThumbObj&&this.scrollObj.hThumbObj.setValue(b)};var allHighLights=[];map.removeAllHighlights=function(){for(var b=0;b<allHighLights.length;b++)allHighLights[b]&&(allHighLights[b].unlock(),allHighLights[b].removeAll());allHighLights.length=0};HighLight=function(){this.itemA=[];allHighLights[allHighLights.length]=this};
HighLight.prototype.addItem=function(b,d){for(var e=0;e<this.itemA.length;e++)if(this.itemA[e].node==b)return null;return(e=new HighLightItem(b,d))?(this.itemA[this.itemA.length]=e,e.node):null};HighLight.prototype.checkItem=function(b){for(var d=0;d<this.itemA.length;d++)if(this.itemA[d].node==b)return!0;return!1};
HighLight.prototype.removeItem=function(b){b=map.Layer.getLayerItemNodeOfNode(b);for(var d=0;d<this.itemA.length;d++)if(this.itemA[d].node==b){for(this.itemA[d].removeHighLight();d<this.itemA.length-1;d++)this.itemA[d]=this.itemA[d+1];--this.itemA.length}};HighLight.prototype.offAll=function(){for(var b=0;b<this.itemA.length;b++)this.itemA[b].removeHighLight()};HighLight.prototype.onAll=function(){for(var b=0;b<this.itemA.length;b++)this.itemA[b].doHighLight()};var __highlightObject=null;
HighLight.prototype.startToggle=function(){0<nHighlightToggle&&(this.toggleCount=2*nHighlightToggle,__highlightObject=this,setTimeout("__highlightObject.toggleAll()",1E3))};HighLight.prototype.toggleAll=function(){for(var b=0;b<this.itemA.length;b++)this.itemA[b].highlighted?this.itemA[b].removeHighLight():this.itemA[b].doHighLight();0<--this.toggleCount&&setTimeout("__highlightObject.toggleAll()",500)};
HighLight.prototype.removeAll=function(){if(!this.fLock){for(var b=0;b<this.itemA.length;b++)this.itemA[b].removeHighLight();this.itemA.length=0}};HighLight.prototype.lock=function(){this.fLock=!0};HighLight.prototype.unlock=function(){this.fLock=!1};function HighLightItem(b,d){if("circle"!=d&&(b=map.Layer.getLayerItemNodeOfNode(b),!b))return null;this.node=b;this.szMode=d;this.doHighLight()}
HighLightItem.prototype.doHighLight=function(){var b=this.node;if(b){if(this.szMode&&"circle"==this.szMode){this.highlightGroup=map.Dom.newGroup(map.Layer.objectGroup,":highlightgroup");this.itemNode=map.Dom.newGroup(this.highlightGroup);var d=map.Scale.normalX(50)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,b=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,e=map.Scale.normalX(5)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale;map.Dom.newShape("circle",this.itemNode,
0,0,d,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+e+" "+e+";stroke-width:"+1.1*b+"px;pointer-events:none");map.Dom.newShape("circle",this.itemNode,0,0,d,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+e+" "+e+";stroke-width:"+b+"px;pointer-events:none");this.itemNode.fu.setPosition(this.node.parentNode.fu.getPosition().x,this.node.parentNode.fu.getPosition().y);return!0}d=new MapObject(b);e=map.Layer.getLayerObj(d.szId);d=e.szHighlight;if(!d)switch(e.szType){case "point":d=
"filter:url(#Glow);scale:1.5";break;case "line":d="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";break;case "polygon":d="fill:yellow"}if(this.szMode&&"hint"==this.szMode)switch(e.szType){case "point":d="filter:url(#Glow);scale:1.5";break;case "line":d="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";break;case "polygon":d="fill:#eeeeff;fill-opacity:0.2;stroke-opacity:0.5;stroke:#eeeeff;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;"}if(d=__scaleStyleString(d,map.Scale.normalX(1/
map.Zoom.nZoom))){var f=b.parentNode,g=f.nextSibling;g&&1==g.nodeType&&g.getAttributeNS(null,"id").match(/highlightgroup/)?this.highlightGroup=g:(this.highlightGroup=map.Dom.newGroup(f.parentNode,e.szName+":highlightgroup"),this.highlightGroup=f.parentNode.insertBefore(this.highlightGroup,g),this.highlightGroup.setAttributeNS(null,"class",f.getAttributeNS(null,"class")));this.highlightGroup.setAttributeNS(null,"style",d+";display:inline;pointer-events:none");b=b.cloneNode(1E3);this.itemNode=this.highlightGroup.appendChild(b);
this.itemNode.setAttributeNS(null,"id","");if(d.match(/fill:/)&&(this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),this.itemNode.hasChildNodes))for(b=this.itemNode.childNodes,e=0;e<b.length;e++)1==b.item(e).nodeType&&b.item(e).style.setProperty("fill","inherit","");if(d.match(/stroke:/)&&(this.itemNode.style.removeProperty("stroke"),this.itemNode.hasChildNodes))for(b=this.itemNode.childNodes,e=0;e<b.length;e++)1==b.item(e).nodeType&&(b.item(e).style.setProperty("stroke",
"none",""),b.item(e).style.removeProperty("stroke"));if(d.match(/scale:/)){this.itemNode.fu=new Methods(this.itemNode);d=parseFloat(d.split("scale:")[1]);if(isNaN(d)||0==d)d=1.5;this.itemNode.fu.scaleBy(d,d)}return this.highlighted=!0}return!1}};HighLightItem.prototype.removeHighLight=function(){this.highlightGroup&&this.highlightGroup.removeChild(this.itemNode);this.highlighted=!1};var __info_infoShape=null;
function displayInfo(b,d,e){var f=null;if(b&&!b.touches)f=map.Scale.getClientMousePosition(b,SVGPopupGroup);else{f=map.Scale.getScreenPosition(d);if(!map.Scale.isWidgetPositionInMap(f))return null;e+="|pointer"}if(e.match(/delayed/))killInfo(),__info_infoShape=d,idInfoTimeout=setTimeout("doDisplayInfo("+f.x+","+f.y+",'"+e+"')",nInfoTimeout);else return __info_infoShape=d,doDisplayInfo(f.x,f.y,e)}Map.prototype.displayInfo=function(b,d,e){displayInfo(b,d,e)};
function killInfo(){idInfoTimeout&&clearTimeout(idInfoTimeout);__info_infoShape=null}
doDisplayInfo=function(b,d,e){var f,g,h=null;e&&e.match(/add/)||SVGPopupGroup.fu.clear();var k=null,k=__info_infoShape?map.Event.popupContextObj=__info_infoShape:map.Event.popupContextObj;if(null==k)return null;var m=k.getAttributeNS(szMapNs,"info");null!=m&&0!==m.length||!k.parentNode||(k=k.parentNode,m=k.getAttributeNS(szMapNs,"info"));var p=map.Dom.getAttributeByNodeOrParents(k.parentNode,szMapNs,"info"),q=map.Dom.getAttributeByNodeOrParents(k.parentNode,szMapNs,"show"),A=map.Dom.getAttributeByNodeOrParents(k.parentNode,
szMapNs,"label");f=map.Dom.getAttributeByNodeOrParents(k.parentNode,szMapNs,"units");var w=map.Dom.getAttributeByNodeOrParents(k,null,"id"),v=w+":info";map.Themes&&map.Themes.activeTheme&&(v+=":"+map.Themes.activeTheme.szId);if(SVGDocument.getElementById(v))return null;if(w&&w.length){var w=map.Tiles.getMasterId(w),z=w.split(":::")[0];imageNode=SVGDocument.getElementById(z+":image")}try{if(map.User.onInfoDisplay(null,w))return null}catch(H){}b=new point(b,d);z=new point(map.Scale.normalX(nInfoOffsetX),
map.Scale.normalY(nInfoOffsetY));d="info:"+String(Math.random());var z=new InfoContainer(SVGDocument,SVGPopupGroup,d+(e.match(/pointer/)?"":":movable"),b,z,e),B=z.workspaceNode,B=map.Dom.newGroup(B,v),u=new box(0,0,0,0),v=(new MapObject(k)).szId;if(v.match(/chartgroup/)){g=v.split(":")[1];var t=v.split(":")[3],v=g+"::"+t}else(layerItem=map.Layer.getLayerItemNodeOfNode(k))&&(v=layerItem.getAttributeNS(null,"id"));t=map.Label.getLabel(v);map.Themes.activeTheme&&(t=map.Themes.getTitle(v,map.Themes.activeTheme));
try{var r=map.Themes.getDataRow(v,map.Themes.activeTheme),t=HTMLWindow.ixmaps.htmlgui_onInfoTitle(t,r)}catch(J){}if(t){if(!isNaN(t))var C=map.Layer.getLayerObj(g),t=(C?C.szLabel+" ":"")+t;z.setTitle(t,map.Scale.tStyle.InfoContainerTitle)}if(e.match(/short/))return z.reformat(),z?z.objectNode:null;if(map.Themes&&map.Themes.activeTheme){var F=null;g=map.Themes.activeTheme;if((C=map.Layer.getLayerItemNodes(k))&&0<C.length)for(r=0;r<map.Themes.themesA.length;r++){g=map.Themes.themesA[r];var D=map.Dom.newGroup(B,
"info:chart"),F=map.Tiles.getMasterId(C[0].getAttributeNS(null,"id"));map.Themes.getChart(F,D,"VALUES|ZOOM|AXIS",g);D.hasChildNodes()||(F=map.Tiles.getMasterId(C[0].parentNode.getAttributeNS(null,"id")))&&map.Themes.getChart(F,D,"VALUES|ZOOM|AXIS",g);if(!D.hasChildNodes()){var E=k.getAttributeNS(null,"id")||"";(F=E.split(":")[1])&&map.Themes.getChart(F,D,"VALUES|ZOOM|AXIS",g)}if(D.hasChildNodes()){killTooltip();z.fClipped=!1;E=map.Dom.getBox(D);if(0<E.width&&0<E.height){var t=.9*map.Scale.tStyle.Description.nFontHeight,
G=__scaleStyleString(map.Scale.tStyle.Description.szStyle,1),E=g.szTitle;map.Dom.newText(B,map.Scale.normalX(6),u.height+t,G,E);t=g.szFlag.match(/CHART/)?t+map.Scale.normalY(6/1.3):t+map.Scale.normalY(6*1.3);D.fu.scale(2,2);E=map.Dom.getBox(D);D.fu.setPosition(map.Scale.normalX(6)-2*E.x,u.height+t-2*E.y);E=map.Dom.getBox(D);t=E.y+E.height+map.Scale.normalY(6);if(u=map.Themes.getLabel(F,g))u=25>u.length?u:u.substr(0,25)+"...",t+=map.Scale.normalY(6*1.3),G=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,
1),map.Dom.newText(D,E.x,t,G,u),t+=map.Scale.tStyle.Description.nFontHeight;if(u=map.Themes.getSummary(F,g))G=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.5),map.Dom.newText(D,E.x,t,G,u);u=map.Dom.getBox(B);u.height+=map.Scale.normalY(12)}g.fShowData&&(h=g.getDataGrid(F,B))&&(h.setPosition(map.Scale.normalX(5),u.height),h.hasScrollBars&&h.hasScrollBars()&&h.workspaceNode.style.setProperty("display","none",""))}}else{D=map.Dom.newGroup(B,"info:chart");E=(new MapObject(k)).szId;F=E.split(":")[1];
G=E.split(":")[3];t=(C=map.Layer.getLayerObj(F))?C.szSelection+" ":"";(C=map.Themes.getTheme(E.split(":")[0]))&&C.szInfoTitle&&(t=C.szInfoTitle);t=(E=map.Label.getLabel(F+"::"+G))?E:t+G;F=F+"::"+G;C.szFlag.match(/POINTER/)&&1<C.nOrigSumA.length&&1<C.partsA.length?map.Themes.getChart(F,D,"VALUES|ZOOM|AXIS|HORZ",C):(map.Themes.getChart(F,D,"VALUES|ZOOM|AXIS",C),C.szFlag.match(/COUNTS/)&&1<C.partsA.length&&(G=map.Dom.newGroup(D,"info:chart:x"),E=C.nNormalSizeValue,C.nNormalSizeValue=10*map.Themes.getMaxValue(F,
C),map.Themes.getChart(F,G,"CHART|BAR|HORZ|ZOOM|VALUES|AXIS|NOZERO|SORT",C),C.nNormalSizeValue=E,G.fu.setPosition(0,G.fu.getBox().height+D.fu.getBox().height/2+map.Scale.normalX(5))));C&&C.itemA[F]&&C.itemA[F].szSelectionId&&(t=C.itemA[F].szSelectionId.split(":").pop());C&&C.itemA[F]&&C.itemA[F].szTitle&&(t=C.itemA[F].szTitle);try{r=map.Themes.getDataRow(v,map.Themes.activeTheme),t=HTMLWindow.ixmaps.htmlgui_onInfoTitle(t,r)}catch(K){}if(D.hasChildNodes()){killTooltip();z.fClipped=!1;z.setTitle(t,
map.Scale.tStyle.InfoContainerTitle);E=map.Dom.getBox(D);if(0<E.width&&0<E.height){D.fu.scale(2,2);D.fu.setPosition(map.Scale.normalX(6)-2*E.x,u.height+map.Scale.normalY(6)-2*E.y);t=E.y+E.height+map.Scale.normalY(6);G=__scaleStyleString(map.Scale.tStyle.Description.szStyle,.5);t+=.25*map.Scale.tStyle.Description.nFontHeight+map.Scale.normalY(1);map.Dom.newText(D,E.x,t,G,C.szTitle);t+=.5*map.Scale.tStyle.Description.nFontHeight+map.Scale.normalY(1);if(u=map.Themes.getValueComment(F,map.Themes.activeTheme))G=
__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.5),map.Dom.newText(D,E.x,t,G,u),t+=.5*map.Scale.tStyle.Summary.nFontHeight+map.Scale.normalY(.5);if(u=map.Themes.getSummary(F,map.Themes.activeTheme))G=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.5),map.Dom.newText(D,E.x,t,G,u);u=map.Dom.getBox(B);u.height+=map.Scale.normalY(12)}g.fShowData&&(h=g.getDataGrid(F,B))&&(h.setPosition(map.Scale.normalX(5),u.height),h.hasScrollBars&&h.hasScrollBars()&&h.workspaceNode.style.setProperty("display",
"none",""))}}u=map.Dom.getBox(B)}imageNode&&(r=imageNode.cloneNode(1E3),r=B.appendChild(r),r.fu=new Methods(r),r.fu.setPosition(map.Scale.normalX(5),u.height+map.Scale.normalY(5)),r.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),u=map.Dom.getBox(B),u.height+=map.Scale.normalX(7));if(m&&m.length&&p.length&&!h){if(q&&q.length){if(r=[],p=p.split("|"),m=m.split("|"),q=q.split("|"),D=A.split("|"),A=f.split("|"),q&&q.length){for(f=0;f<q.length;f++)for(g=0;g<p.length;g++)q[f]==p[g]&&(r[r.length]=D&&
D[f]?map.Dictionary.getLocalText(D[f]):map.Dictionary.getLocalText(p[g]));for(f=0;f<q.length;f++)for(g=0;g<p.length;g++)q[f]==p[g]&&(D=map.Dictionary.getLocalText(m[g]),r[r.length]=__formatInfoValue(D),r[r.length-1]+=A[f]?" "+A[f]:"")}}else{r=[];p=p.split("|");A=f.split("|");for(f=0;f<p.length;f++)r[r.length]=map.Dictionary.getLocalText(p[f]);m=m.split("|");for(f=0;f<m.length;f++)isNaN(m[f])?(D=map.Dictionary.getLocalText(p[f]+":"+m[f]),r[r.length]=D!=p[f]+":"+m[f]?D:map.Dictionary.getLocalText(m[f])):
(D=map.Dictionary.getLocalText(p[f]+":"+m[f]),r[r.length]=__formatInfoValue(D!=p[f]+":"+m[f]?D:m[f])),r[r.length-1]+=A[f]?" "+A[f]:""}if(r.length){var I=createTextGrid(SVGDocument,B,d+":textgrid",r,2,14);I.fu.setPosition(map.Scale.normalX(5),u.height)}try{if(userGroup=map.User.onInfoDisplayExtend(null,w,I.parentNode,b))userGroup=I.appendChild(userGroup),userGroup.fu.setPosition(map.Scale.normalX(5),u.height)}catch(L){}}try{if(userGroup=HTMLWindow.ixmaps.htmlgui_onInfoDisplayExtend(SVGDocument,v))userGroup=
B.appendChild(userGroup),userGroup.fu=new Methods(userGroup),userGroup.fu.setPosition(map.Scale.normalX(10),u.height+map.Scale.normalX(10))}catch(M){}B.hasChildNodes()||map.Dom.newShape("rect",B,0,0,1,1,"fill:none;stroke:none;");z.reformat();h&&h.workspaceNode.style.setProperty("display","inline","");e.match(/fix/)&&(z.objectNode.fu.scale(nFixedInfoScale,nFixedInfoScale),SVGFixedGroup.appendChild(z.objectNode),z.highLightList=new HighLight,z.highLightList.addItem(k),z.highLightList.lock(),z.setOnRemove("_doRemoveFixedInfo(map.Dom.popObj('"+
map.Dom.pushObj(z)+"'))"));return z?z.objectNode:null};_doRemoveFixedInfo=function(b){b.highLightList.unlock();b.highLightList.removeAll()};function removeInfo(b,d){setTimeout("_removeInfo()",1E3)}_removeInfo=function(b){null!=map.Event.onoverShape||map.Event.onoverPopup?setTimeout("_removeInfo()",250):SVGPopupGroup.fu.clear()};Map.prototype.removeInfo=function(){SVGFixedGroup.fu.clear()};var __infoShape=null,__stackedInfoShapeA=[];
function displayInfoDelayed(b,d,e){__stackedInfoShapeA[__stackedInfoShapeA.length]=d;1>=__stackedInfoShapeA.length&&setTimeout("doDisplayInfoDelayed()",e)}function doDisplayInfoDelayed(){if(SVGPopupGroup.hasChildNodes)setTimeout("doDisplayInfoDelayed()",1E3);else{for(var b=0;b<__stackedInfoShapeA.length;b++)displayInfo(null,__stackedInfoShapeA[b],0==b?"":"add");__stackedInfoShapeA.length=0}}
__formatInfoValue=function(b){if(b.match(/E+/)){var d=b.split("E+"),e=parseFloat(d[0]),d=parseInt(d[1]);if(!isNaN(e)&&!isNaN(d))return e*=Math.pow(10,d),String(Math.round(100*e)/100)}e=Number(b);return isNaN(e)?b:String(e)};
createTextGrid=function(b,d,e,f,g,h,k,m){b=Math.ceil(f.length/g);h=h?h:12;for(var p=0,q=0;q<f.length&&f[q];q++)p=Math.max(p,f[q].length);d=map.Dom.newGroup(d,e);var A=SVGDocument.getElementById("TextLinesBgPattern");szStyle=m?m:"fill:#ffffff;stroke:"+(szTextGridStyle.match(/background/)?"1":"none");e=[];for(var w=[],p=Array(b),q=0;q<b;q++)p[q]=Array(g);var v=map.Dom.newNode("g",d),z=map.Scale.normalX(5);m=map.Scale.normalX(3);for(var H=Math.min(map.Scale.normalX(250),map.Scale.bBox.width/5),B=0;B<
g;B++){for(var u=map.Scale.normalY(h),q=0;q<b;q++){1<g&&0==B&&!A&&szTextGridStyle.match(/background/)&&szTextGridStyle.match(/alternate/);var t=map.Dom.newText(v,0,u,"font-family:arial;font-size:"+map.Scale.normalY(h)+"px;fill:"+szInfoBodyColor+"",f[q+B*b]);map.Dom.wrapText(t,H);p[q][B]=t;w[q]=t;1<g&&0==B&&!A&&(szTextGridStyle.match(/firstsmall/)&&t.style.setProperty("font-size",String(map.Scale.normalY(.9*h))+"px",""),szTextGridStyle.match(/firstitalic/)&&t.style.setProperty("font-style","italic",
""),szTextGridStyle.match(/firstgray/)&&t.style.setProperty("fill","#888888",""));if(k&&k[q+B*b])try{var r=__getStyleArray(k[q+B*b]);for(a in r)t.style.setProperty(a,r[a],"")}catch(J){}t.setAttribute("transform","matrix(1 0 0 1 "+z+" "+m+")");"a"!=t.nodeName&&t.style.setProperty("pointer-events","none","")}u=map.Dom.getBox(v).width;if(szTextGridStyle.match(/firstright/)&&0==B)for(q=0;q<b;q++)w[q].setAttribute("transform","matrix(1 0 0 1 "+(z+u)+" "+m+")"),w[q].style.setProperty("text-anchor","end",
"");z=u+map.Scale.normalX(h)+map.Scale.normalX(5);if(0==B)var C=z}f=map.Scale.normalY(h);for(q=0;q<b;q++){k=map.Scale.normalY(h);for(var B=0;B<g;B++)k=Math.max(k,map.Dom.getBox(p[q][B]).height);for(B=0;B<g;B++)r=getMatrix(p[q][B]),r[5]+=f,setMatrix(p[q][B],r);f+=k+map.Scale.normalY(2)}bBox=map.Dom.getBox(v);for(q=0;q<b;q++)e[q]&&(szTextGridStyle.match(/full/)?e[q].setAttributeNS(null,"width",bBox.width+map.Scale.normalX(h/2)):e[q].setAttributeNS(null,"width",C-map.Scale.normalX(5)));(g=SVGDocument.getElementById("TextLinesBgPattern:antizoomandpan"))&&
g.setAttributeNS(null,"patternTransform","matrix(1 0 0 1 0 "+String(m-map.Scale.normalY(h-1))+")");return d};var __textField_group=null,__textField_frame=null,__textField_shadow=null,__textField_fontheight=12;
function createTextField(b,d,e,f,g){g||(g=12);if(b&&d)return b=map.Dom.newGroup(d,e),d=map.Dom.newShape("rect",b,1,1,1,1,"fill:#444444;opacity:0.5;stroke:none"),e=map.Dom.newShape("rect",b,1,1,1,1,"fill:#fefeff;stroke:#444444;stroke-width:"+map.Scale.normalX(.2)+""),map.Dom.newText(b,0,map.Scale.normalY(1.25*g),"font-family:arial;font-size:"+map.Scale.normalY(g)+"px;fill:"+szInfoBodyColor+"",f),__textField_group=b,__textField_frame=e,__textField_shadow=d,__textField_fontheight=g,sizeTextField(),b}
function sizeTextField(){var b=__textField_fontheight,d=map.Dom.getBox(__textField_group);__textField_frame.setAttributeNS(null,"rx",map.Scale.normalX(2));__textField_frame.setAttributeNS(null,"ry",map.Scale.normalX(2));__textField_frame.setAttributeNS(null,"x",-map.Scale.normalX(.75*b));__textField_frame.setAttributeNS(null,"y",-map.Scale.normalY(1));__textField_frame.setAttributeNS(null,"width",d.width+map.Scale.normalX(1.5*b));__textField_frame.setAttributeNS(null,"height",d.height+map.Scale.normalY(b)/
2);__textField_shadow.setAttributeNS(null,"rx",map.Scale.normalX(4));__textField_shadow.setAttributeNS(null,"ry",map.Scale.normalX(4));__textField_shadow.setAttributeNS(null,"x",-map.Scale.normalX(.75*b)+map.Scale.normalX(2));__textField_shadow.setAttributeNS(null,"y",map.Scale.normalY(2));__textField_shadow.setAttributeNS(null,"width",d.width+map.Scale.normalX(1.5*b)+map.Scale.normalX(1.5));__textField_shadow.setAttributeNS(null,"height",d.height+map.Scale.normalX(b)/2-map.Scale.normalX(0))}
function displayScale(b,d){if(fScaleBar){for(var e=map.Scale.nTrueMapScale*map.Scale.nZoomScale,f=0,f=0;10<e;f++)e/=10;for(e=5<e?10:2.5<e?5:1.1<=e?2.5:1;0<f;f--)e*=10;var g=e/(map.Scale.nMapScale*map.Scale.nZoomScale)*(map.Scale.nMapPPI/nInch);(f=map.Dom.getObjectById("legend:scalegroup"))||(f=map.Dom.newGroup(SVGMenuGroup,"legend:scalegroup"));f.hasChildNodes();f.fu.clear();var h=f.getAttributeNS(szMapNs,"scaleunits"),k=f.getAttributeNS(szMapNs,"barcolor"),m=f.getAttributeNS(szMapNs,"bgcolor"),p=
f.getAttributeNS(szMapNs,"bgstyle"),q=f.getAttributeNS(szMapNs,"bgopacity"),A=f.getAttributeNS(szMapNs,"maxwidth");if(null==p||1>p.length)p=null==m||1>m.length?"fill:white;":"fill:"+m+";",q&&(p+="opacity:"+q+";");0==A&&(A=map.Scale.bBox.width/3/map.Scale.normalX(1));if(null==k||1>k.length)k="red";k="fill:"+k+("#ffffff"==k?";stroke:black;stroke-width:0.1;":"")+";pointer-events:none";p=map.Dom.newShape("rect",f,map.Scale.normalX(0),map.Scale.normalY(0),map.Scale.normalX(0),map.Scale.normalY(0),p);m=
map.Scale.nTrueMapScale*map.Scale.nZoomScale;m=1<=m?"1:"+String(__formatValue(m,0,"BLANK")):String(__formatValue(1/m,0,"BLANK"))+":1";map.Dom.newText(f,0,map.Scale.normalY(12),"font-family:arial;font-size:"+map.Scale.normalY(9)+"px;fill:"+szInfoBodyColor+"",m).fu.setPosition(0,-map.Scale.normalY(10));if(0<A){m=0;h=h.length?h:"meters";q=100;"feet"==h?(q=33.3,3E4<e&&(h="miles",q=5280*33.3)):1E4<e&&(h="km",q=1E5);for(var w=0;20>w;w++){var v=1==w%2?k:"fill:black;pointer-events:none";map.Dom.newShape("rect",
f,map.Scale.normalX(m),map.Scale.normalY(5),map.Scale.normalX(g),map.Scale.normalY(5),v);var v=Math.floor(e/q*w*100)/100,z=h;0<w&&(z=Math.floor(v)!=v?String(v):String(Math.floor(v)));map.Dom.newText(f,0===w?map.Scale.normalX(m):map.Scale.normalX(m-4),map.Scale.normalY(18),"font-family:arial;font-size:"+map.Scale.normalY(8)+"px;fill:"+szInfoBodyColor+";pointer-events:none;",z);m+=g;if(1<A&&m>A||map.Scale.mapPosition.x&&map.Scale.normalX(m)>9*map.Scale.bBox.width/10||!map.Scale.mapPosition.x&&map.Scale.normalX(m)>
map.Scale.bBox.width/2)break}e=map.Scale.nTrueMapScale*map.Scale.nZoomScale/q;100<e?Math.round(e):Math.round(100*e)}else map.Dom.newShape("rect",f,map.Scale.normalX(50),map.Scale.normalY(20),map.Scale.normalX(1),map.Scale.normalY(1),"fill:white;opacity:0;");e=map.Dom.getBox(f);p&&(p.setAttributeNS(null,"x",e.x-map.Scale.normalX(7)),p.setAttributeNS(null,"y",e.y-map.Scale.normalY(2)),p.setAttributeNS(null,"width",e.width+map.Scale.normalX(14)),p.setAttributeNS(null,"height",e.height+map.Scale.normalY(4)),
p.setAttributeNS(null,"rx",map.Scale.normalY(2)),p.setAttributeNS(null,"ry",map.Scale.normalY(2)));d&&(A=map.Scale.normalX(8),g=map.Scale.normalX(nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.bBox.height<map.Scale.viewBox.height&&(A=map.Scale.normalX(2),g=0),A=map.Scale.mapPosition.x+A,"bottom"==d?f.fu.setPosition(A+g,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-g-e.height):f.fu.setPosition(A+g,-e.y+map.Scale.normalY(2)+map.Scale.normalY(1)+g));f.fu.setPosition(50,
map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-90);p&&(e=f.fu.getPosition().y>map.Scale.normalY(100)?"top":"bottom",p.setAttributeNS(null,"onclick","displayScale(evt,'"+e+"')"));SVGPopupGroup&&(SVGPopupGroup.fu.clear(),f.setAttributeNS(szMapNs,"tooltip","click to move it"))}}Map.Toolbar=function(b){this.init(b)};Map.Toolbar.prototype=new Map;
Map.Toolbar.prototype.init=function(b){b=SVGDocument.getElementById("legend:toolbar");var d=SVGDocument.getElementById("toolbar");b&&d&&(d.setAttributeNS(null,"id","toolbar:movable"),map.Dom.clearGroup(b),b.appendChild(d),b.setAttributeNS(null,"cursor","pointer"),this.refresh())};
Map.Toolbar.prototype.refresh=function(b){if((b=SVGDocument.getElementById("legend:toolbar"))&&!(map.Legend&&map.Legend.objNode&&map.Legend.objNode.fu.isContained(b))){var d=map.Scale.normalX(nMapBorderWidth);b.fu=new Methods(b);var e=b.fu.getPosition(),f=b.getAttributeNS(szMapNs,"position");f.match(/NONE/)&&b.style.setProperty("display","none","");f.match(/INMAP/)&&(f.match(/RIGHT/)?(f=b.fu.getBox(),b.fu.setPosition(map.Scale.mapPosition.x+map.Scale.bBox.width-d-map.Scale.normalX(10)-f.width,e.y+
d)):b.fu.setPosition(map.Scale.mapPosition.x+map.Scale.normalX(6)+d,e.y+d))}};
Map.Legend=function(b){b=b?b.target.ownerDocument:SVGDocument;var d=b.getElementById("legend:group");if(!d||"undefined"==typeof d)return null;this.fInitializing=!0;this.lastItemObjectA=[];this.objNode=d;this.objNode.fu=new Methods(this.objNode);b=b.getElementById("legend_body");try{map.Dictionary.applyToNode(b)}catch(e){}this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity","0","");fAllIncluded||fPDFEmbed?this.init():setTimeout("map.Legend.init()",500)};
Map.Legend.prototype=new Map;
Map.Legend.prototype.init=function(b){if(1!=this.blockRecursion){var d=map.Scale.mapPosition.x?map.Scale.normalY(10):map.Scale.normalY(60),e=b?b.target.ownerDocument:SVGDocument,f=e.getElementById("legend:group");if(!f)return this.fInitializing=!1;this.objNode=f;this.objNode.fu=new Methods(this.objNode);var g=e.getElementById("legend_title");e.getElementById("legend_onoff_bg:sizeable");var h=e.getElementById("legend_body"),k=e.getElementById("legend:toolbar"),m=e.getElementById("legend_bg"),p=e.getElementById("legend_body_bg"),
q=e.getElementById("legend_body_header"),A=e.getElementById("legend_body_footer"),w=e.getElementById("legend_body:frame"),v=e.getElementById("legend:off:legend_body"),z=e.getElementById("legend_body:workspace:movabley");try{var H=map.Dom.getBox(z?z:h)}catch(B){this.fHidden||(this.show(),setTimeout("map.Legend.init()",10));this.fInitializing=!1;return}var u=1E5,t=1E5,r=SVGDocument.getElementById("legend:param");r&&(u=Number(r.getAttributeNS(szMapNs,"maxwidth")),t=Number(r.getAttributeNS(szMapNs,"maxheight")),
u=u?map.Scale.normalX(u):1E6,t=t?map.Scale.normalY(t):1E6);(r=SVGDocument.getElementById("test:markerrect"))&&r.parentNode.removeChild(r);this.fInitializing&&(this.blockRecursion=!0,this.checkGroupCollapse(null),this.blockRecursion=!1);try{H=map.Dom.getBox(z?z:h)}catch(J){H=new box(0,0,map.Scale.normalX(150),map.Scale.normalX(300))}var C=__getLegendPartBox(b,g),r=__getLegendPartBox(b,q),z=__getLegendPartBox(b,A);k&&k.parentNode==h&&(k.fu=new Methods(k),k=k.fu.getBox(),0>=k.y&&0<k.width&&1E5>k.width&&
(r.y+=k.y+k.height,r.width=Math.max(r.width,k.width),q&&(q.fu=new Methods(q),q.fu.setPosition(r.x,r.y))));if(r.y||r.height)w.fu=new Methods(w),w.fu.setPosition(w.fu.getPosition().x,r.y+r.height);H.height+=map.Scale.normalY(0);(k=SVGDocument.getElementById("legend:show:button"))&&k.style.setProperty("display","none","");h&&p&&(map.Scale.legendWidth=Math.max(C.x+C.width+map.Scale.normalX(10),Math.max(H.x+H.width,Math.max(r.x+r.width,z.x+z.width)))+map.Scale.normalX(20),map.Scale.legendWidth=Math.min(map.Scale.legendWidth,
u),u=this.objNode.fu.getPosition(),u.x<map.Scale.mapPosition.x&&0<map.Scale.viewBox.width-map.Scale.bBox.width?(map.Scale.legendWidth=map.Scale.mapPosition.x-map.Scale.normalX(2),t=1E5,this.fInMap=!1,fLegendToggleButtons&&(u=Number(p.getAttributeNS(null,"y")),p.setAttributeNS(null,"y",u+map.Scale.normalX(-100)),SVGDocument.getElementById("legend:hide:button")||(u=new Button(f,"legend:hide","BUTTON","#expand_left_button","map.Api.extendMap()","","expand map"),u.nodeObj.style.setProperty("opacity",
"0.9",""),u.scale(1.8,1.8),u.setPosition(map.Scale.legendWidth-map.Scale.normalX(6),map.Scale.mapPosition.y+map.Scale.normalY(8))),SVGDocument.getElementById("legend:show:button")||(u=new Button(f.parentNode,"legend:show","BUTTON","#expand_right_button","map.Api.normalMap()","","show legend"),f.parentNode.insertBefore(u.nodeObj,f.parentNode.firstChild),u.scale(1.8,1.8),u.nodeObj.style.setProperty("opacity","0.8",""),u.nodeObj.style.setProperty("display","none",""),fMapBorder3D&&SVGDocument.getElementById(szShadowFilterId)&&
u.nodeObj.style.setProperty("filter","url(#"+szShadowFilterId+")",""),u.setPosition(map.Scale.normalX(9),map.Scale.mapOffset.y+map.Scale.normalY(14))))):u.x>=map.Scale.mapPosition.x+map.Scale.bBox.width?(map.Scale.legendWidth=map.Scale.viewBox.width-map.Scale.mapPosition.x-map.Scale.bBox.width-map.Scale.normalX(8),t=1E5,this.fInMap=!1):(this.objNode.fu.setPosition(map.Scale.normalX(8+nMapBorderWidth),map.Scale.normalY(nMapBorderWidth)),t+=z.height,q&&q.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),
v&&v.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),this.fInMap=!0),map.Scale.legendHeight=Math.min(H.y+H.height+r.y+r.height+z.height+map.Scale.normalY(6),Math.min(t,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-d)),p.setAttributeNS(null,"width",map.Scale.legendWidth),p.setAttributeNS(null,"height",map.Scale.legendHeight-Number(p.getAttributeNS(null,"y"))+map.Scale.normalY(5)),p.setAttributeNS(null,"rx",map.Scale.normalX(2)),p.setAttributeNS(null,"ry",map.Scale.normalX(2)),
this.fInMap&&(fObjectPseudoShadow&&!this.shadowNode&&(f=(d=p.style.getPropertyValue("opacity"))&&d.length?Number(d):1,d=p.style.getPropertyValue("fill-opacity"),d=f*(d&&d.length?Number(d):1),d=1==d?.5*d:.2*d,this.shadowNode=map.Dom.newShape("rect",h,map.Scale.normalX(3),map.Scale.normalY(-19),map.Scale.normalX(10),map.Scale.normalY(10),"fill:#444444;stroke:#888888;opacity:"+d+";"),this.shadowNode=h.insertBefore(this.shadowNode,p)),this.shadowNode.setAttributeNS(null,"width",map.Scale.legendWidth),
this.shadowNode.setAttributeNS(null,"height",map.Scale.legendHeight-Number(p.getAttributeNS(null,"y"))+map.Scale.normalY(5)),this.shadowNode.setAttributeNS(null,"rx",map.Scale.normalX(5)),this.shadowNode.setAttributeNS(null,"ry",map.Scale.normalX(5))),p.setAttributeNS(szMapNs,"menu","legendmenu"));h&&m&&m.setAttributeNS(null,"width",H.x+H.width-map.Scale.normalY(15));h&&v&&fInitLegendOff&&(h.style.setProperty("display","none",""),v.style.setProperty("display","none",""));h=null;if(w)if(h=map.Dom.setClipRect(w,
new box(0,0,1,1)),w=map.Scale.legendHeight-r.height-z.height,H.height<=w?(h.setAttributeNS(null,"width",map.Scale.legendWidth),h.setAttributeNS(null,"height",H.y+H.height+map.Scale.normalY(10))):(h.setAttributeNS(null,"width",map.Scale.legendWidth),h.setAttributeNS(null,"height",w)),A&&(A.fu=new Methods(A),A.fu.setPosition(0,map.Scale.legendHeight-z.height-map.Scale.normalY(2)),map.Dom.setClipRect(A,new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),map.Scale.viewBox.height))),q&&map.Dom.setClipRect(q,
new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),w)),g&&map.Dom.setClipRect(g,new box(map.Scale.normalX(-20),map.Scale.normalY(-20),map.Scale.legendWidth-map.Scale.normalX(0),w)),this.scrollObj)g=new box(h.getAttributeNS(null,"x"),h.getAttributeNS(null,"y"),h.getAttributeNS(null,"width"),h.getAttributeNS(null,"height")),this.scrollObj.setWidth(g.width/map.Scale.normalX(1)),this.scrollObj.setHeight(g.height/map.Scale.normalY(1)),this.scrollObj.reformat(b);else if(q=e.getElementById("legend_body:workspace:movabley"))g=
new box(h.getAttributeNS(null,"x"),h.getAttributeNS(null,"y"),h.getAttributeNS(null,"width"),h.getAttributeNS(null,"height")),this.scrollObj=new ScrollArea(b,null,null,g.width/map.Scale.normalX(1),g.height/map.Scale.normalY(1),10),this.scrollObj.workspaceNode=q,this.scrollObj.cliprectNode=h,this.scrollObj&&this.scrollObj.reformat(b);fClipMapToLegend&&(b=e.getElementById("mapcliprect"))&&(e=map.Dom.getBox(b),e=e.x+e.width,g=map.Scale.normalX(5),b.setAttributeNS(null,"x",map.Scale.legendWidth+g),b.setAttributeNS(null,
"width",e-map.Scale.legendWidth-g));this.fInitializing=!1;this.objNode.parentNode.appendChild(this.objNode);this.fHidden||this.show();return!0}};Map.Legend.prototype.move=function(b){mouseObject=new MouseObject(b,this.objNode)};Map.Legend.prototype.reformat=function(b){this.scrollObj&&this.scrollObj.reformat(b)};
Map.Legend.prototype.hide=function(b){this.objNode.style.setProperty("display","none","");this.fHidden=!0;(b=SVGDocument.getElementById("legend:show:button"))&&b.style.setProperty("display","inline","")};Map.Legend.prototype.show=function(b){this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity","1","");this.fHidden=!1;(b=SVGDocument.getElementById("legend:show:button"))&&b.style.setProperty("display","none","")};
Map.Legend.prototype.getPosition=function(b){return(b=(b?b.target.ownerDocument:SVGDocument).getElementById("legend:group"))?(b=getMatrix(b),new point(b[4],b[5])):new point(0,0)};
function __getLegendPartBox(b,d){var e=new box(0,0,0,0);if(d)try{if("text"==d.nodeName)return map.Dom.getBox(d);for(var f=d.childNodes,g=0;g<f.length;g++)if(1==f.item(g).nodeType){var h=getScale(f.item(g)),k=getTranslate(f.item(g)),m=map.Dom.getBox(f.item(g));m.x=k.x+m.x*h.x;m.y=k.y+m.y*h.y;m.width*=h.x;m.height*=h.y;if(f.item(g).getAttributeNS(null,"id").match(/overviewmap/)){var p=SVGDocument.getElementById("overviewmap:clippath");p&&(m=map.Dom.getBox(p),m.height=p.firstChild.getAttribute("height"),
m.width=p.firstChild.getAttribute("width"),m.height=e.height+m.height*map.Scale.getGroupScale(p).y,m.width*=map.Scale.getGroupScale(p).x)}isNaN(m.width)||isNaN(m.height)||0>m.width||0>m.height||(e.x=Math.min(e.x,m.x),e.y=Math.min(e.y,m.y),e.width=Math.max(e.width,m.x+m.width),e.height=Math.max(e.height,m.y+m.height))}if(isNaN(e.width)||isNaN(e.height)||0>e.width||0>e.height)e=new box(0,0,0,0)}catch(q){e=new box(0,0,0,0)}return e}
Map.Legend.prototype.checkGroupCollapse=function(b,d){var e=b?b.target.ownerDocument:SVGDocument;null==d&&(d=e.getElementById("legend_body:workspace:movabley"));if(d&&1==d.nodeType)for(var f=d.childNodes,g=0;g<f.length;g++)if(1==f.item(g).nodeType){var h=f.item(g).getAttributeNS(szMapNs,"mode");h&&h.match(/HIDDEN/)&&(h=f.item(g).getAttributeNS(null,"id").split(":"),"legend"==h[0]&&"item"==h[1]&&(h=e.getElementById("legend:collapse:"+h[2]),this.legendMouseClick(b,h)));this.checkGroupCollapse(b,f.item(g))}};
Map.Legend.prototype.legendMouseClick=function(b,d){if(null==d||1!=d.nodeType)return!1;var e=d.getAttributeNS(null,"id");if(e&&!e.match(/legend/))return!1;if(e&&e.match(/this:item/))return this.execLegendMouseClickOnItem(b,d,e),!0;for(var e=e.split(":"),f=3;f<e.length;f++)e[2]+=":"+e[f];this.execLegendMouseClick(b,d,e[2],e[1])||this.execLegendMouseClickOnTiles(b,d,e[2],e[1])||(clearThemes(),setMapTool(""));e[2]&&!e[2].match(/:label/)&&map.Layer.isScaleDependentLayerOn(e[2]+":label")&&this.execLegendMouseClick(b,
d,e[2]+":label",e[1]);return!0};
Map.Legend.prototype.execLegendMouseClick=function(b,d,e,f,g){if(null==e||null==f)return!1;if("mapzoom"==f&&!e.match(/label/))return map.Zoom.doZoomMap(e,"byfactor"),!0;if("textscale"==f&&!e.match(/label/))return map.Layer.changeLabelScaling(null,e,"byfactor"),!0;if("backwards"==f&&!e.match(/label/))return zoomAndPanHistory.backwards(),!0;if("activatetool"==f&&!e.match(/label/))return setMapTool(e),!0;var h=map.Dom.getAttributeByNodeOrParents(d,szMapNs,"classname");h.match(/legendgroup/)&&(h=null);
switch(f){case "suboff":f="off";case "off":g&&g.length?map.Layer.switchLayerByCSS(b,e,h,"none"):e.match(/\'/)?map.Layer.switchLayer(b,e,h,!1):executeWithMessage("map.Layer.switchLayer(null,'"+e+"','"+h+"',false)","...");d.style.setProperty("display","none","");!e.match(/label/)&&fCheckSublayerCollapse&&__checkCollapsable(d,"collapse");break;case "on":g&&g.length?map.Layer.switchLayerByCSS(b,e,h,"inline"):e.match(/\'/)?map.Layer.switchLayer(b,e,h,!0):executeWithMessage("map.Layer.switchLayer(null,'"+
e+"','"+h+"',true)","...");(g=SVGDocument.getElementById("legend:off:"+e))&&g.style.setProperty("display","inline","");!e.match(/label/)&&fCheckSublayerCollapse&&__checkCollapsable(d,"expand");map.Event.doDefaultZoom(b);break;case "collapse":d.style.setProperty("display","none","");__checkCollapsable(d,"collapse");break;case "expand":(g=SVGDocument.getElementById("legend:collapse:"+e))&&g.style.setProperty("display","inline","");__checkCollapsable(d,"expand");break;case "minus":opacity=featureNode.style.getPropertyValue("opacity");
opacity=""!==opacity?Number(opacity):1;0<opacity&&(opacity-=.1,featureNode.style.setProperty("opacity",String(opacity),""));break;case "plus":opacity=featureNode.style.getPropertyValue("opacity");opacity=""!==opacity?Number(opacity):1;1>opacity&&(opacity+=.1,featureNode.style.setProperty("opacity",String(opacity),""));break;case "setactive":activateTheme(e);szMapToolType.match(/select/)||setMapTool("info");break;case "item":try{this.lastItemObjectA[e].redraw()}catch(k){}}__setThemeState(e,f);return!0};
Map.Legend.prototype.execLegendMouseClickOnItem=function(b,d,e){if((b=map.Dom.getAttributeByNodeOrParents(d,szMapNs,"onactivate"))&&b.length)switch(szIdA=e.split(":"),szAction=szIdA[1],szItem=szIdA[szIdA.length-1],szAction){case "off":d.style.setProperty("display","none","");try{this.lastItemObjectA[szItem]&&this.lastItemObjectA[szItem].remove()}catch(f){}lastItemObject=this.lastItemObjectA[szItem]=null;break;case "on":if(this.lastItemObjectA[szItem])break;e="legend:off:"+e.substr(10,e.length-10);
(d=SVGDocument.getElementById(e))&&d.style.setProperty("display","inline","");try{this.lastItemObjectA[szItem]=eval(b),this.lastItemObjectA[szItem]&&(this.lastItemObjectA[szItem].onremove="map.Legend.setLegendCheckBox(null,'"+e+"','unchecked');map.Legend.lastItemObjectA['"+szItem+"']=null;deactivateTheme('"+szItem+"')",this.lastItemObjectA[szItem].szItem=szItem)}catch(g){alert("ERROR: "+g.description+" \nIN: "+b)}}return!0};
function __opacityPlus(b){if(map.Event.fMouseDown){var d=SVGDocument.getElementById(b),e=d.style.getPropertyValue("opacity"),e=""!==e?Number(e):1;1>e&&(d.style.setProperty("opacity",String(e+.1),""),setTimeout("__opacityPlus('"+b+"')",200))}}function __opacityMinus(b){if(map.Event.fMouseDown){var d=SVGDocument.getElementById(b),e=d.style.getPropertyValue("opacity"),e=""!==e?Number(e):1;0<e&&(d.style.setProperty("opacity",String(e-.1),""),setTimeout("__opacityMinus('"+b+"')",200))}}
Map.Legend.prototype.execLegendMouseClickOnTiles=function(b,d,e,f){var g=!1;if(e&&map.Tiles&&0<map.Tiles.nCount)for(var h=map.Tiles.getTileNodeIds(e),k=0;k<h.length;k++)this.execLegendMouseClick(b,d,h[k],f)&&(g=!0);g||(h=map.Dom.getAttributeByNodeOrParents(d,szMapNs,"classname"))&&h.length&&(g=this.execLegendMouseClick(b,d,e,f,h));return g};
Map.Legend.prototype.setLegendCheckBox=function(b,d,e){if(d.match(/legend/))for(szIdA=d.split(":"),d="legend:off",b=2;b<szIdA.length;b++)d+=":"+szIdA[b];(d=SVGDocument.getElementById(d))&&d.style.setProperty("display","checked"==e?"inline":"none","")};
Map.Legend.prototype.switchLegendCheckBox=function(b,d,e){b="legend:off:"+d;var f=SVGDocument.getElementById(b);f||(f=SVGDocument.getElementById(b+":byclassname"));f&&f.style.setProperty("display",e,"");(f=SVGDocument.getElementById("legend:setactive:"+d))&&f.style.setProperty("opacity","none"==e?"0.4":"1","")};
function __setThemeState(b,d){var e=SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(e)for(var f=0;f<e.length;f++)e.item(f).getAttributeNS(null,"name")==map.Tiles.getMasterId(b)&&e.item(f).setAttributeNS(null,"state",d)}function __getThemeState(b){var d=SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(d)for(var e=0;e<d.length;e++)if(d.item(e).getAttributeNS(null,"name")==map.Tiles.getMasterId(b))return d.item(e).getAttributeNS(null,"state");return"none"}
function __checkCollapsable(b,d){if(null!=b){var e=b.getAttributeNS(null,"id");if(!e.match(/label/)){var f,g=e.split(":"),e=g[0]+":item:"+g[2];for(f=3;f<g.length;f++)e=e+":"+g[f];if(e=b.ownerDocument.getElementById(e)){var h,g=null,k=e.childNodes;for(f=0;f<k.length;f++)if(1==k.item(f).nodeType&&k.item(f).getAttributeNS(null,"id")&&k.item(f).getAttributeNS(null,"id").match(/collapsable/)){h=0;switch(d){case "collapse":if("collapsed"==k.item(f).getAttributeNS(szMapNs,"state")||k.item(f).getAttributeNS(null,
"id").match(/placeholder/))break;(g=b.ownerDocument.getElementById(k.item(f).getAttributeNS(null,"id")+":end"))?h=-g.getAttributeNS(null,"y")+map.Scale.normalY(20):(g=map.Dom.getBox(k.item(f)),h=-g.height);g=map.Dom.newGroup(k.item(f).parentNode,k.item(f).getAttributeNS(null,"id")+":placeholder");g.setAttributeNS(szMapNs,"state","collapsed");g.parentNode.insertBefore(g,k.item(f));SVGHiddenGroup.appendChild(k.item(f+1));break;case "expand":if("collapsed"!=k.item(f).getAttributeNS(szMapNs,"state")&&
!k.item(f).getAttributeNS(null,"id").match(/placeholder/))break;h=null;if(k.item(f).getAttributeNS(null,"id").match(/placeholder/)){g=k.item(f);h=g.getAttributeNS(null,"id").split(":");k="";for(f=0;f<h.length-1;f++)k+=0<f?":":"",k+=h[f];h=SVGDocument.getElementById(k);g.parentNode.replaceChild(h,g);h=SVGDocument.getElementById(k)}else h=k.item(f);h.setAttributeNS(szMapNs,"state","expanded");(g=b.ownerDocument.getElementById(h.getAttributeNS(null,"id")+":end"))?h=g.getAttributeNS(null,"y")-map.Scale.normalY(20):
(g=map.Dom.getBox(h),h=g.height)}for(f=e.nextSibling;f&&h;)if(1==f.nodeType&&(g=getMatrix(f),g[5]+=h,setMatrix(f,g)),f=f.nextSibling,null==f)for(;e.parentNode&&e.parentNode.getAttributeNS(null,"id").match(/legend/);)if(e=e.parentNode,e.getAttributeNS(null,"id").match(/item/)){f=e.nextSibling;break}try{map.Legend.init(null)}catch(m){}break}}}}}zoomAndPanHistory=new History;highLightList=new HighLight;
