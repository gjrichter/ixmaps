Map.Viewport=function(a){map.Scale.metadataNode&&(this.szPopupAlignment=(this.alignmentNode=map.Scale.metadataNode.getElementsByTagNameNS(szMapNs,"alignments").item(0))?this.alignmentNode.getAttributeNS(null,"popupwindow"):"",this.szPopupAlignment=szLocalPopupAlignment?szLocalPopupAlignment:this.szPopupAlignment);if(this.eventRect=SVGDocument.getElementById("mapbackground:eventrect"))szMapBackgroundStyle&&this.eventRect.setAttributeNS(null,"style",szMapBackgroundStyle+";pointer-events:all"),szMapBackgroundColor&&
this.eventRect.setAttributeNS(null,"style","fill:"+szMapBackgroundColor+";opacity:1;pointer-events:all");this.clipToolsGroup();this.createPanBorder();this.createNorthArrow();return!0};Map.Viewport.prototype=new Map;Map.Viewport.prototype.reformat=function(){this.clipToolsGroup();this.createPanBorder();this.createNorthArrow()};
Map.Viewport.prototype.clipToolsGroup=function(){map.Dom.setClipRect(SVGToolsGroup,new box(map.Scale.mapPosition.x+map.Scale.normalX(nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.normalY(nMapBorderWidth),map.Scale.bBox.width-2*map.Scale.normalX(nMapBorderWidth),map.Scale.bBox.height-2*map.Scale.normalY(nMapBorderWidth)));this.widgetBox=new box(map.Scale.mapPosition.x+map.Scale.normalX(nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.normalY(nMapBorderWidth+nToolMarginTop),map.Scale.bBox.width-
2*map.Scale.normalX(nMapBorderWidth),map.Scale.bBox.height-2*map.Scale.normalY(nMapBorderWidth))};
Map.Viewport.prototype.createPanBorder=function(){var a=SVGDocument;if(fMapBorder){var b=a.getElementById("widgets:antizoomandpan");if(b){var c=szMapBorderColor,d=map.Scale.normalX(nMapBorderWidth),e=a.getElementById("mapBorderClipCover");e&&e.parentNode.removeChild(e);e=map.Dom.newGroup(b,"mapBorderClipCover");e.setAttributeNS(null,"style","fill:white;opacity:1.0");b.insertBefore(e,b.firstChild);map.Dom.newShape("rect",e,0,0,map.Scale.mapPosition.x,map.Scale.viewBox.height,"");map.Dom.newShape("rect",
e,0,0,map.Scale.viewBox.width+1E4,map.Scale.mapPosition.y,"");map.Dom.newShape("rect",e,0,map.Scale.mapPosition.y+map.Scale.bBox.height,map.Scale.viewBox.width+1E4,map.Scale.viewBox.height-(map.Scale.mapPosition.y+map.Scale.bBox.height)+1E4,"");map.Dom.newShape("rect",e,map.Scale.mapPosition.x+map.Scale.bBox.width,0,map.Scale.viewBox.width-(map.Scale.mapPosition.x+map.Scale.bBox.width)+1E4,map.Scale.bBox.height,"");(e=a.getElementById("mapBorder"))&&e.parentNode.removeChild(e);e=map.Dom.newGroup(b,
"mapBorder");if(fMapBorder3D&&map.Scale.mapPosition.x)c="#ffffff",b.insertBefore(e,b.firstChild),e.fu.setPosition(0,0),d=map.Scale.normalX(250),a=map.Scale.normalX(-3),b=null,b=map.Dom.newShape("rect",e,map.Scale.mapPosition.x,map.Scale.mapPosition.y-d+a,map.Scale.bBox.width,d,"fill:"+c+";opacity:0.5"),b.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),b=map.Dom.newShape("rect",e,0,map.Scale.mapPosition.y+map.Scale.bBox.height-a,map.Scale.mapPosition.x+map.Scale.bBox.width,
d,"fill:"+c+";opacity:0.5"),b.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),b=map.Dom.newShape("rect",e,0,0,map.Scale.mapPosition.x,map.Scale.mapPosition.y+map.Scale.bBox.height,"fill:"+c+";opacity:0.5"),b.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),b=map.Dom.newShape("rect",e,map.Scale.mapPosition.x+map.Scale.bBox.width-a,0,d,map.Scale.mapPosition.y+map.Scale.bBox.height,"fill:"+c+";opacity:0.5"),b.setAttributeNS(null,"style",
"filter:url(#DropShadowFilterTools:antizoomandpan)");else if(e.setAttributeNS(null,"transform","matrix(1 0 0 1 "+map.Scale.mapPosition.x+" "+map.Scale.mapPosition.y+")"),map.Dom.newShape("rect",e,0,0,map.Scale.bBox.width,d,"fill:"+c+";opacity:1.0"),map.Dom.newShape("rect",e,0,map.Scale.bBox.height-d,map.Scale.bBox.width,d,"fill:"+c+";opacity:1.0"),map.Dom.newShape("rect",e,0,0,d,map.Scale.bBox.height,"fill:"+c+";opacity:1.0"),map.Dom.newShape("rect",e,map.Scale.bBox.width-d,0,d,map.Scale.bBox.height,
"fill:"+c+";opacity:1.0"),2<nMapBorderWidth){var c=szMapPanBorderStyle+";stroke-width:"+map.Scale.normalX(1)+";opacity:1.0",a=szMapPanBorderOnoverStyle+";stroke-width:"+map.Scale.normalX(1)+";opacity:1.0",b=null,f=map.Scale.bBox,g=f.width/10,h=f.width/3/+map.Scale.normalX(1),b=map.Dom.newShape("rect",e,g,0,f.width-2*g,d,c);b.setAttributeNS(null,"onclick","map.Viewport.doPanMap(0,"+h+")");b.setAttributeNS(szMapNs,"tooltip","pan");b.setAttributeNS(szMapNs,"onoverstyle",a);b=map.Dom.newShape("rect",
e,g,f.height-d-1,f.width-2*g,d,c);b.setAttributeNS(null,"onclick","map.Viewport.doPanMap(0,"+-h+")");b.setAttributeNS(szMapNs,"tooltip","pan");b.setAttributeNS(szMapNs,"onoverstyle",a);b=map.Dom.newShape("rect",e,0,g,d,f.height-2*g,c);b.setAttributeNS(szMapNs,"onoverstyle",a);b.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+h+",0)");b.setAttributeNS(szMapNs,"tooltip","pan");b.setAttributeNS(szMapNs,"onoverstyle",a);b=map.Dom.newShape("rect",e,f.width-d-1,g,d,f.height-2*g,c);b.setAttributeNS(null,
"onclick","map.Viewport.doPanMap("+-h+",0)");b.setAttributeNS(szMapNs,"onoverstyle",a);b.setAttributeNS(szMapNs,"tooltip","pan");b=map.Dom.newShape("path",e,"M0,0 l "+g+",0 0,"+d+" "+-(g-d)+",0 0,"+(g-d)+" "+-d+",0 z",c);b.setAttributeNS(szMapNs,"onoverstyle",a);b.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+h+","+h+")");b.setAttributeNS(szMapNs,"tooltip","pan");b.setAttributeNS(szMapNs,"onoverstyle",a);b=map.Dom.newShape("path",e,"M"+f.width+","+f.height+" l "+-g+",0 0,"+-d+" "+(g-d)+",0 0,"+
-(g-d)+" "+d+",0 z",c);b.setAttributeNS(szMapNs,"tooltip","pan");b.setAttributeNS(szMapNs,"onoverstyle",a);b.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-h+","+-h+")");b.setAttributeNS(szMapNs,"tooltip","pan");b.setAttributeNS(szMapNs,"onoverstyle",a);b=map.Dom.newShape("path",e,"M"+f.width+",0 l "+-g+",0 0,"+d+" "+(g-d)+",0 0,"+(g-d)+" "+d+",0 z",c);b.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-h+","+h+")");b.setAttributeNS(szMapNs,"onoverstyle",a);b.setAttributeNS(szMapNs,
"tooltip","pan");b=map.Dom.newShape("path",e,"M0,"+f.height+" l "+g+",0 0,"+-d+" "+-(g-d)+",0 0,"+-(g-d)+" "+-d+",0 z",c);b.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+h+","+-h+")");b.setAttributeNS(szMapNs,"tooltip","pan");b.setAttributeNS(szMapNs,"onoverstyle",a)}}}};Map.Viewport.prototype.doPanMap=function(a,b){executeWithMessage("map.Viewport.panMap("+a+","+b+")","please wait ...",100)};Map.Viewport.prototype.panMap=function(a,b){map.Zoom.setNewPan(a,b);map.Event.doDefaultZoom(null)};
Map.Viewport.prototype.setBackgroundColor=function(a){this.eventRect&&this.eventRect.setAttributeNS(null,"style","fill:"+a+";opacity:1;pointer-events:all")};Map.Viewport.prototype.togglePanBorder=function(){var a=SVGDocument.getElementById("mapBorder");a?a.parentNode.removeChild(a):map.Viewport.createPanBorder()};
Map.Viewport.prototype.createNorthArrow=function(){if(fNorthArrow){var a=SVGDocument.getElementById("widgets:antizoomandpan");if(a){var b="none";this.northGroup&&(b=this.northGroup.style.getPropertyValue("display"),this.northGroup.parentNode.removeChild(this.northGroup));this.northGroup=map.Dom.newGroup(a,"mapNorthArrow");b&&this.northGroup.style.setProperty("display",b);"TOP"==szNorthArrowPosition?this.northGroup.fu.setPosition(this.widgetBox.x+this.widgetBox.width-map.Scale.normalX(75),map.Scale.normalX(45+
nToolMarginTop)):this.northGroup.fu.setPosition(this.widgetBox.x+this.widgetBox.width-map.Scale.normalX(75),this.widgetBox.y+map.Scale.normalX((this.widgetBox.y?50:60)+nToolMarginTop));a=map.Scale.normalY(30);b=map.Scale.normalY(12);map.Dom.newShape("circle",this.northGroup,0,0,a,"fill:white;opacity:0.2");map.Dom.newShape("path",this.northGroup,"M0,"+-a/2+" l "+b/2+","+1.2*a+" "+-b/2+","+-a/5+" "+-b/2+","+a/5+" z","fill:#444444;stroke:#ffffff;stroke-width:"+map.Scale.normalX(.4)+";");map.Dom.newText(this.northGroup,
map.Scale.normalX(-5),map.Scale.normalY(-19),"font-family:arial;font-size:"+map.Scale.normalX(12)+"px;font-weight:bold;fill:#444444;stroke:white;stroke-width:0.2;pointer-events:none","N");map.Dom.newShape("rect",this.northGroup,-b/2,-a,b,a,"fill:green;opacity:0.0");"rotatable"==fNorthArrow&&(this.northGroup.setAttributeNS(null,"cursor","pointer"),this.northGroup.setAttributeNS(szMapNs,"tooltip",map.Dictionary.getLocalText("click to move it")),this.northArrowObj=new RotationSlider(this.northGroup,
100,"0,360","1",90,9))&&(this.northArrowObj.parent=this);a=new Button(this.northGroup,"mapNorthArrow:zoomin","BUTTON","#plus_button1","map.Zoom.doZoomMap(2)","","zoom in");a.setPosition(map.Scale.normalY(0),map.Scale.normalY(40));a.scale(1.3,1.3);a.nodeObj.style.setProperty("fill-opacity","0.5","");a=new Button(this.northGroup,"mapNorthArrow:zoomout","BUTTON","#minus_button1","map.Zoom.doZoomMap(0.5)","","zoom out");a.setPosition(map.Scale.normalY(0),map.Scale.normalY(40+2*nNormalButtonSize));a.scale(1.3,
1.3);a.nodeObj.style.setProperty("fill-opacity","0.5","")}}};Map.Viewport.prototype.onClick=function(a){this.northArrowObj&&executeWithMessage("map.Scale.setRotation(null,0)","...")};Map.Viewport.prototype.onMouseUp=function(a){this.northArrowObj&&!fRotateOnMouseMove&&executeWithMessage("map.Scale.setRotation(null,"+this.northArrowObj.getAngle()+")","...")};
Map.Viewport.prototype.onMouseMove=function(a){this.northArrowObj&&fRotateOnMouseMove&&(a=this.northArrowObj.getAngle(),a!=this.nAngle&&(map.Scale.setRotation(null,a),this.nAngle=a))};Map.Viewport.prototype.showNorthArrow=function(){this.northGroup&&this.northGroup.style.setProperty("display","inline","")};
Map.Viewport.prototype.hideNorthArrow=function(){this.northGroup&&"none"!=this.northGroup.style.getPropertyValue("display")&&(this.northGroup.style.setProperty("display","none",""),this.northArrowObj&&executeWithMessage("map.Scale.setRotation(null,0)","..."))};Map.Viewport.prototype.clipMap=function(a){var b=SVGDocument.getElementById("mapcliprect");b&&b.setAttributeNS(null,"width",map.Scale.normalX(a))};
Map.Viewport.prototype.clipLayer=function(a,b){a||(a=_activeTheme);var c=SVGDocument.getElementById(a),d=SVGDocument.getElementById(a+":values");"undefined"!=typeof this.lastClippedLayer&&this.lastClippedLayer!=c&&(map.Dom.setClipRect(this.lastClippedLayer,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.bBox.width,map.Scale.bBox.height)),this.lastClippedLayer=null);"undefined"!=typeof this.lastClippedLayerV&&this.lastClippedLayerV!=d&&(map.Dom.setClipRect(this.lastClippedLayerV,new box(-map.Scale.mapOffset.x,
-map.Scale.mapOffset.y,map.Scale.bBox.width,map.Scale.bBox.height)),this.lastClippedLayerV=null);c&&(map.Dom.setClipRect(c,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.normalX(b),map.Scale.bBox.height)),this.lastClippedLayer=c);d&&(map.Dom.setClipRect(d,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.normalX(b),map.Scale.bBox.height)),this.lastClippedLayerV=d)};
Map.Zoom=function(a){this.canvasNode=SVGDocument.getElementById("mapcanvas");this.zoomNode=SVGDocument.getElementById("mapzoomandpan");this.nZoomY=this.nZoomX=this.nZoom=1;this.doCenter=this.doArea=this.doZoom=null;this.fAreaSet=!1;a&&1<a&&this.doExecuteZoomMap(a,1)};Map.Zoom.prototype=new Map;
Map.Zoom.prototype.init=function(){if(map.Scale.initZoomNode){var a=Number(map.Scale.initZoomNode.getAttribute("MinBoundX")),b=Number(map.Scale.initZoomNode.getAttribute("MaxBoundX")),c=Number(map.Scale.initZoomNode.getAttribute("MinBoundY")),d=Number(map.Scale.initZoomNode.getAttribute("MaxBoundY"));"degree"==map.Scale.initZoomNode.getAttribute("units")?this.doZoomMapToGeoBounds(c,a,d,b):this.Zoom.doZoomMapToEnvelope(a,b,c,d)}};
Map.Zoom.prototype.toFullExtend=function(){setTimeout("map.Zoom.reset()",100)};Map.Zoom.prototype.setNewZoom=function(a){this.doZoom=a;map.Zoom.execute()};Map.Zoom.prototype.setNewPan=function(a,b){this.doPanMap(a,b)};Map.Zoom.prototype.setNewArea=function(a){this.fAreaSet=!0;this.doSetAreaByParentMap(a)||(this.doArea=new box(a.x,a.y,a.width,a.height),map.Zoom.execute())};Map.Zoom.prototype.setNewCenter=function(a){this.doCenterByParentMap(a)||(this.doCenter=new box(a.x,a.y,a.width,a.height),map.Zoom.execute())};
Map.Zoom.prototype.execute=function(){this.doZoom&&(this.doExecuteZoomMap(this.doZoom,this.nZoom),this.nZoom=this.doZoom,this.doZoom=null);this.doArea&&(this.doZoomMapToArea(this.doArea),this.doArea=null);this.doCenter&&(this.doCenterMapToArea(this.doCenter),this.doCenter=null);SVGPopupGroup&&SVGPopupGroup.fu.clear()};Map.Zoom.prototype.cancel=function(){this.doCenter=this.doArea=this.doZoom=null};
Map.Zoom.prototype.reset=function(){this.zoomNode.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)");SVGRootElement.currentTranslate.x=0;SVGRootElement.currentTranslate.y=0;this.nZoom=1;map.Event.doDefaultZoom(null);clearMessage(100)};
Map.Zoom.prototype.getBox=function(){var a=getMatrix(this.canvasNode),b=getMatrix(this.zoomNode),c=-a[4]/this.nZoomX,a=-a[5]/this.nZoomY,c=c-(map.Scale.normalX(SVGRootElement.currentTranslate.x)+b[4])/this.nZoomX,a=a-(map.Scale.normalY(SVGRootElement.currentTranslate.y)+b[5])/this.nZoomY;return new box(c,a,map.Scale.bBox.width/this.nZoomX,map.Scale.bBox.height/this.nZoomY)};
Map.Zoom.prototype.getEnvelope=function(){var a=this.getBox(),b=map.Scale.getMapCoordinate(a.x,a.y),a=map.Scale.getMapCoordinate(a.x+a.width,a.y+a.height);return[b,a]};Map.Zoom.prototype.getEnvelopeString=function(){var a=this.getEnvelope();return String("MinBoundX='"+a[0].x+"' MaxBoundX='"+a[1].x+"' MinBoundY='"+a[1].y+"' MaxBoundY='"+a[0].y+"'")};
Map.Zoom.prototype.getFractionBox=function(){var a=getMatrix(this.zoomNode),b=map.Scale.rotatePoint(new point(a[4],a[5]),-1);a[4]=b.x;a[5]=b.y;var b=(map.Scale.normalX(SVGRootElement.currentTranslate.x)+a[4])/this.nZoomX,a=(map.Scale.normalY(SVGRootElement.currentTranslate.y)+a[5])/this.nZoomY,c=map.Scale.bBox.width-map.Scale.bBox.width/this.nZoomX,d=map.Scale.bBox.height-map.Scale.bBox.height/this.nZoomY;return 0<c&&0<d?new box(.5-b/c,.5-a/d,1/this.nZoomX,1/this.nZoomY):new box(0,0,1/this.nZoomX,
1/this.nZoomY)};Map.Zoom.prototype.setFractionBox=function(a){var b=map.Scale.bBox.width*a.width,c=map.Scale.bBox.height*a.height;a=new box((map.Scale.bBox.width-b)*a.x+map.Scale.bBox.x,(map.Scale.bBox.height-c)*a.y+map.Scale.bBox.y,b,c);map.Zoom.setNewCenter(a)};
Map.Zoom.prototype.clipArea=function(a){a.width/a.height!=map.Scale.bBox.width/map.Scale.bBox.height&&(a.width>a.height?a.height=a.width/map.Scale.bBox.width*map.Scale.bBox.height:a.width=a.height/map.Scale.bBox.height*map.Scale.bBox.width);var b=a.x-map.Scale.bBox.x,c=map.Scale.bBox.x+map.Scale.bBox.width-(a.x+a.width),d=a.y-map.Scale.bBox.y,e=map.Scale.bBox.y+map.Scale.bBox.height-(a.y+a.height);if(0>b||0>c||0>d||0>e){if(0>b&&0>c)a.x=map.Scale.bBox.x,a.width=map.Scale.bBox.width;else if(0>b)a.x+=
-b,a.width-=c>-b?0:-b-c;else if(0>c)return a.x-=-c,this.clipArea(a);if(0>d&&0>e)a.y=map.Scale.bBox.y,a.height=map.Scale.bBox.heigt;else if(0>d)a.y+=-d,a.height-=e>-d?0:-d-e;else if(0>e)return a.y-=-e,this.clipArea(a)}return a};Map.Zoom.prototype.isVisibleBox=function(a){try{var b=this.getBox();return a.x+a.width<b.x||a.x>b.x+b.width||a.y+a.height<b.y||a.y>b.y+b.height?!1:!0}catch(c){return!1}};
Map.Zoom.prototype.isCompletelyVisibleBox=function(a){var b=this.getBox();return a.x<b.x||a.x+a.width>b.x+b.width||a.y<b.y||a.y+a.height>b.y+b.height?!1:!0};
Map.Zoom.prototype.doExecuteZoomMap=function(a,b){a=this.checkZoomLimit(a);if(a!=this.nZoom){var c=getMatrix(this.zoomNode),d=(SVGRootElement.currentTranslate.x+map.Scale.embedX(c[4]))/b*a,c=(SVGRootElement.currentTranslate.y+map.Scale.embedX(c[5]))/b*a;this.nOldZoomX=this.nZoomX;this.nOldZoomY=this.nZoomY;this.nZoomX=this.nZoomX/b*a;this.nZoomY=this.nZoomY/b*a;fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix("+this.nZoomX+" 0 0 "+this.nZoomY+" 0 0)"),SVGRootElement.currentTranslate.x=
d,SVGRootElement.currentTranslate.y=c):this.zoomNode.setAttributeNS(null,"transform","matrix("+this.nZoomX+" 0 0 "+this.nZoomY+" "+map.Scale.normalX(d)+" "+map.Scale.normalY(c)+")");this.nZoom=a;map.Event.doDefaultZoom(null)}};
Map.Zoom.prototype.doZoomMapToArea=function(a){this.fAreaSet=!0;var b=getMatrix(this.canvasNode);new point(b[4],b[5]);var b=Math.min(map.Scale.bBox.width/a.width,map.Scale.bBox.height/a.height),c=map.Scale.bBox.width/a.width,d=map.Scale.bBox.height/a.height,b=Math.round(1E6*b)/1E6,c=Math.round(1E6*c)/1E6,d=Math.round(1E6*d)/1E6,e=this.checkZoomLimit(b);e!=b&&a.scale(b/e);b=e;b!=this.nZoom&&(fPreserveMapRatio&&(c=d=b),fZoomByViewer&&fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),
SVGRootElement.currentScale=b):fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix("+c+" 0 0 "+d+" 0 0)"),SVGRootElement.currentScale=1):this.zoomNode.setAttributeNS(null,"transform","matrix("+c+" 0 0 "+d+" 0 0)"),this.nZoom=b,this.nOldZoomX=this.nZoomX,this.nOldZoomY=this.nZoomY,this.nZoomX=c,this.nZoomY=d);this.doCenterMapToArea(a)};
Map.Zoom.prototype.doCenterMapToArea=function(a){this.fAreaSet=!0;this.fExternalZoom=!1;var b=getMatrix(this.canvasNode),c=new point(b[4],b[5]),d=getMatrix(this.zoomNode),b=d[0],d=d[3];a.x+=a.width/2;a.y+=a.height/2;a.x=a.x*b+c.x;a.y=a.y*d+c.y;var c=-a.x+map.Scale.bBox.width/2,e=-a.y+map.Scale.bBox.height/2,e=map.Scale.rotatePoint(new point(c,e)),c=e.x,e=e.y;fZoomByViewer&&fPanByViewer?(SVGRootElement.currentScale=this.nZoom,SVGRootElement.currentTranslate.x=map.Scale.embedX(c-a.width/2)*this.nZoomX,
SVGRootElement.currentTranslate.y=map.Scale.embedY(e-a.height/2)*this.nZoomY):fPanByViewer?(SVGRootElement.currentTranslate.x=map.Scale.embedX(c),SVGRootElement.currentTranslate.y=map.Scale.embedY(e)):(a=getTranslate(this.zoomNode),this.zoomNode.setAttributeNS(null,"transform","matrix("+b+" 0 0 "+d+" "+c+" "+e+")"),this.doPanFixed(c-a.x,e-a.y));fFroozeDynamicContent||(map.isIdle()?map.Event.doDefaultZoom(null):map.pushAction("map.Event.doDefaultZoom(null)"))};
Map.Zoom.prototype.doPanFixed=function(a,b){for(var c=SVGFixedGroup.childNodes,d=0;d<c.length;d++){var e=c.item(d).fu.getPosition();c.item(d).fu.setPosition(e.x+a,e.y+b)}c=SVGToolsGroup.childNodes;for(d=0;d<c.length;d++)e=c.item(d).fu.getPosition(),c.item(d).fu.setPosition(e.x+a,e.y+b)};
Map.Zoom.prototype.doZoomMapToWidgetRect=function(a){var b=Math.min(a.width,a.height)<map.Scale.normalX(25)?!0:!1;new point(a.x,a.y);new point(a.x-a.width,a.y-a.height);var c=getMatrix(map.Scale.zoomNode),d=c[0],e=c[3],f=antiZoomAndPanList.getActualMatrix(),g=map.Scale.rotatePoint(new point(c[4],c[5]),-1);c[4]=g.x;c[5]=g.y;a.x=a.x*f[0]+f[4];a.y=a.y*f[3]+f[5];a.width*=f[0];a.height*=f[3];a.x=a.x-map.Scale.mapPosition.x-map.Scale.mapOffset.x;a.y=a.y-map.Scale.mapPosition.y-map.Scale.mapOffset.y;a.x=
(a.x-c[4])/d;a.y=(a.y-c[5])/e;a.width/=d;a.height/=e;b?map.Zoom.setNewCenter(a):map.Zoom.setNewArea(a)};
Map.Zoom.prototype.doZoomMapToEnvelope=function(a,b,c,d){this.doCheckEnvelope(a,b,c,d)?(a=(a-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x,d=map.Scale.maxY-map.Scale.minY-(d-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y,map.Zoom.setNewArea(new box(a,d,(b-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x-a,map.Scale.maxY-map.Scale.minY-(c-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y-d),300)):map.Zoom.doZoomMapToLayer("maplayer")};
Map.Zoom.prototype.doCenterMapToEnvelope=function(a,b,c,d){this.doCheckEnvelope(a,b,c,d)&&(a=(a-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x,d=map.Scale.maxY-map.Scale.minY-(d-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y,map.Zoom.doCenterMapToArea(new box(a,d,(b-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x-a,map.Scale.maxY-map.Scale.minY-(c-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y-d)))};
Map.Zoom.prototype.doCenterMapToGeoPosition=function(a,b){var c=map.Scale.getMapCoordinateOfLatLon(a,b);c?this.doSetCenterByParentMap(c.x,c.y)||this.doCenterMapToEnvelope(c.x,c.x,c.y,c.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};
Map.Zoom.prototype.doCenterMapToGeoBounds=function(a,b,c,d){this.fExternalZoom=!1;a=map.Scale.getMapCoordinateOfLatLon(a,b);c=map.Scale.getMapCoordinateOfLatLon(c,d);a&&c?this.doCenterMapToEnvelope(a.x,c.x,a.y,c.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};
Map.Zoom.prototype.doZoomMapToGeoBounds=function(a,b,c,d){a=map.Scale.getMapCoordinateOfLatLon(a,b);c=map.Scale.getMapCoordinateOfLatLon(c,d);a&&c?this.doSetEnvelopeByParentMap(a.x,c.x,a.y,c.y)||this.doZoomMapToEnvelope(a.x,c.x,a.y,c.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};Map.Zoom.prototype.doZoomMapToView=function(a,b){try{HTMLWindow.ixmaps.htmlgui_setCenterAndZoom({lat:a[0],lng:a[1]},b)}catch(c){return!1}};
Map.Zoom.prototype.doZoomMapToLayer=function(a){if(fPendingNewGeoBounds)fPendingNewGeoBounds=!1;else{var b=SVGDocument.getElementById(a),c=map.Dom.getBox(b),b=map.Scale.getMapOffset(b);c.x+=b.x;c.y+=b.y;c=new box(c.x,c.y,c.width,c.height);c.scale(.8);if("maplayer"==a){var b=a=3E4,d=-3E4,e=-3E4,f=!1,g;for(g in map.Layer.listA)if(!g.match(/legend/)){var h=SVGDocument.getElementById(g+"::bbox");h&&(a=Math.min(a,Number(h.getAttributeNS(null,"minboundx"))),b=Math.min(b,Number(h.getAttributeNS(null,"minboundy"))),
d=Math.max(d,Number(h.getAttributeNS(null,"maxboundx"))),e=Math.max(e,Number(h.getAttributeNS(null,"maxboundy"))),f=!0)}f&&(c=new box(a,b,Math.abs(d-a),Math.abs(e-b)))}c.width&&c.height&&c.width<map.Scale.bBox.width&&c.height<map.Scale.bBox.height&&(map.Zoom.doSetAreaByParentMap(c)||map.Zoom.setNewArea(c))}};
Map.Zoom.prototype.doSetMapToGeoBounds=function(a,b,c,d){this.fExternalZoom=!1;a=map.Scale.getMapCoordinateOfLatLon(a,b);c=map.Scale.getMapCoordinateOfLatLon(c,d);a&&c?this.doZoomMapToEnvelope(a.x,c.x,a.y,c.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};Map.Zoom.prototype.getCenterOfMapInGeoPosition=function(){var a=this.getBox(),a=map.Scale.getMapCoordinate(a.x+a.width/2,a.y+a.height/2);return a=map.Scale.getGeoCoordinateOfPoint(a.x,a.y)};
Map.Zoom.prototype.getBoundsOfMapInGeoBounds=function(){var a=this.getBox(),b=map.Scale.getMapCoordinate(a.x,a.y+a.height),a=map.Scale.getMapCoordinate(a.x+a.width,a.y),b=map.Scale.getGeoCoordinateOfPoint(b.x,b.y),a=map.Scale.getGeoCoordinateOfPoint(a.x,a.y);return[b,a]};
Map.Zoom.prototype.doCheckEnvelope=function(a,b,c,d){return fLimitMapToExtent?a<map.Scale.minBoundX&&b>map.Scale.maxBoundX&&c<map.Scale.minBoundY&&d>map.Scale.maxBoundY&&b-a>2*(map.Scale.maxBoundX-map.Scale.minBoundX)||a>map.Scale.maxBoundX||b<map.Scale.minBoundX||c>map.Scale.maxBoundY||d<map.Scale.minBoundY?(displayMessage("position outside",500),!1):!0:!0};
Map.Zoom.prototype.doSetAreaByParentMap=function(a){var b=map.Scale.getMapCoordinate(a.x,a.y);a=map.Scale.getMapCoordinate(a.x+a.width,a.y+a.height);return this.doSetEnvelopeByParentMap(b.x,a.x,b.y,a.y)};Map.Zoom.prototype.doSetEnvelopeByParentMap=function(a,b,c,d){try{var e=map.Scale.getGeoCoordinateOfPoint(a,c),f=map.Scale.getGeoCoordinateOfPoint(b,d);this.fExternalZoom=!0;return HTMLWindow.ixmaps.htmlgui_setCurrentEnvelopeByGeoBounds(e,f)}catch(g){return!1}};
Map.Zoom.prototype.doCenterByParentMap=function(a){a=map.Scale.getMapCoordinate(a.x+a.width/2,a.y+a.height/2);return this.doSetCenterByParentMap(a.x,a.y)};Map.Zoom.prototype.doSetCenterByParentMap=function(a,b){try{var c=map.Scale.getGeoCoordinateOfPoint(a,b);return HTMLWindow.ixmaps.htmlgui_setCurrentCenterByGeoBounds(c)}catch(d){return!1}};
Map.Zoom.prototype.doZoomMap=function(a,b){if(this.zoomNode){displayMessage("please wait ...",500);var c=getMatrix(map.Zoom.zoomNode)[0];if(0===a)return this.toFullExtend(),Math.round(map.Scale.nMapScale);switch(b){case "absolute":c=a;break;case "byscale":c=map.Scale.nTrueMapScale/a;break;default:c*=a}this.setNewZoom(c);return Math.round(map.Scale.nMapScale/c)}};
Map.Zoom.prototype.doPanMap=function(a,b){var c=getMatrix(this.zoomNode),d=c[0],e=c[3],f=SVGRootElement.currentTranslate.x+a,g=SVGRootElement.currentTranslate.y+b,g=map.Scale.rotatePoint(new point(f,g)),f=g.x,g=g.y,f=f+map.Scale.embedX(c[4]),g=g+map.Scale.embedY(c[5]);fPanByViewer?(SVGRootElement.currentTranslate.x=f,SVGRootElement.currentTranslate.y=g):(f=map.Scale.normalX(f),g=map.Scale.normalY(g),c=getTranslate(this.zoomNode),this.zoomNode.setAttributeNS(null,"transform","matrix("+d+" 0 0 "+e+
" "+f+" "+g+")"),this.doPanFixed(f-c.x,g-c.y));try{var h=this.getBox(),l=map.Scale.getMapCoordinate(h.x+h.width/2,h.y+h.height/2);this.doSetCenterByParentMap(l.x,l.y)}catch(k){try{HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(this.getEnvelopeString(),!1)}catch(w){}}};Map.Zoom.prototype.doPanMapByViewer=function(a,b){var c=SVGRootElement.currentTranslate.y+b;SVGRootElement.currentTranslate.x+=a;SVGRootElement.currentTranslate.y=c};
Map.Zoom.prototype.checkZoomLimit=function(a){var b=1E6;fPDFEmbed&&(b=20,map.Tiles&&1<map.Tiles.nCount&&(b=20));return a>=b?(displayMessage("zoom limit !",1E3),b):a=Math.round(1E6*a)/1E6};Map.Zoom.prototype.removeClipping=function(a){fClipMapDynamic&&SVGDocument.getElementById("mapclip").setAttributeNS(null,"clip-path","")};Map.Zoom.prototype.activateClipping=function(a){fClipMapDynamic&&SVGDocument.getElementById("mapclip").setAttributeNS(null,"clip-path","url(#mapclippath)")};
Map.Zoom.prototype.onMouseMove=function(a){};Map.Zoom.prototype.onMouseDown=function(a){};Map.Zoom.prototype.onMouseUp=function(a){this.setFractionBox(new box(this.overviewThumbObj.fraction.x,this.overviewThumbObj.fraction.y,1/this.nZoomX,1/this.nZoomY))};
Map.Layer=function(a){this.document=a?a.target.ownerDocument:SVGDocument;this.layerNode=SVGDocument.getElementById("maplayer");this.listA=[];this.depListA=[];this.generatedLabelA=[];this.changedFeatureNodesA=[];this.objectGroup=SVGDocument.getElementById(szObjectGroupId);this.fSwitchSublayer=!0;this.nDynamicObjectScale=this.nObjectScale=this.nFeatureScale=1;a=0;var b=SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(b.length)for(this.listA.legend_body=new Map.Layer.Item(null),a=0;a<b.length;a++)this.listA[b.item(a).getAttributeNS(null,
"name")]=new Map.Layer.Item(b.item(a));b=SVGDocument.getElementsByTagNameNS(szMapNs,"scaledependency");if(!(0>=b.length))for(a=0;a<b.length;a++){var c=b.item(a).getAttributeNS(null,"feature");this.depListA[c]=new Map.Layer.Dependency(b.item(a))}};Map.Layer.prototype=new Map;
Map.Layer.Item=function(a){if(a){if(this.szName=a.getAttributeNS(null,"name"),this.szLegendName=a.getAttributeNS(null,"legendname"),this.szFlag=a.getAttributeNS(null,"flag"),this.szType=a.getAttributeNS(null,"type"),this.nItems=Number(a.getAttributeNS(null,"items")),this.nRenderer=a.getAttributeNS(null,"renderer"),this.szRenderer=a.getAttributeNS(null,"rendererfield"),this.szLabel=a.getAttributeNS(null,"label"),this.szSelection=a.getAttributeNS(null,"selection"),this.szFilter=a.getAttributeNS(null,
"filter"),this.szFilterValue=a.getAttributeNS(null,"filtervalue"),this.szHighlight=a.getAttributeNS(null,"highlightstyle"),this.szDisplay=a.getAttributeNS(null,"display"),this.szDisplayLabel=a.getAttributeNS(null,"displaylabel"),this.categoryA=this.labelBoxA=null,a=a.getElementsByTagNameNS(szMapNs,"category"),a.length){this.categoryA=[];for(var b=0;b<a.length;b++){var c=this.categoryA[a.item(b).getAttributeNS(null,"name")]={};c.legendname=a.item(b).getAttributeNS(null,"legendname");c.fill=a.item(b).getAttributeNS(null,
"fill");c.stroke=a.item(b).getAttributeNS(null,"stroke");c.style=a.item(b).getAttributeNS(null,"style");c.display="inline"}}}else this.szFlag="",this.szType="dummy",this.szDisplayLabel=this.szDisplay="inline"};
Map.Layer.Dependency=function(a){a&&(this.shapeId=a.getAttributeNS(null,"shape"),this.szFeature=a.getAttributeNS(null,"feature"),this.depClass=a.getAttributeNS(null,"classname"),this.nUpper=1E11,this.nLower=0,this.depLower=a.getAttributeNS(null,"lower"),(this.depUpper=a.getAttributeNS(null,"upper"))&&this.depUpper.length&&(this.nUpper=Number(this.depUpper.split(":")[1])),this.depLower&&this.depLower.length&&(this.nLower=Number(this.depLower.split(":")[1])),this.szDisplayAttribute="inline")};
function __doSwitchGroupTheme(a,b){var c=SVGDocument.getElementById("legend:"+b+":"+a);c&&map.Legend&&(map.Legend.execLegendMouseClick(null,c,a,b),map.Legend.execLegendMouseClick(null,c,a+":label",b))}
function __doSwitchGroupThemes(a,b){var c="legend:collapsable:"+a.split(":")[0];if(c=SVGDocument.getElementById(c))for(var c=c.childNodes,d=0;d<c.length;d++)if(1==c.item(d).nodeType){var e=c.item(d).getAttributeNS(null,"id").split("legend:setactive:")[1];e||(e=c.item(d).getAttributeNS(null,"id").split("legend:item:")[1]);var f=b?"on":"off";e&&e!=a&&!e.match(/"/)&&SVGDocument.getElementById("legend:"+f+":"+e)&&(!1===b||map.Layer.isScaleDependentLayerOn(e))&&setTimeout('__doSwitchGroupTheme("'+e+'","'+
f+'")',10*d)}}
Map.Layer.prototype.switchLayer=function(a,b,c,d){var e=d?"inline":"none",f=this.listA[b.split(":")[0]];if(!f)return!1;if(c&&c.match(/legendgroup/))return!0;if(b&&!b.match(/label/)&&!b.match(/::/)&&(b.match(/group/)||this.fSwitchSublayer)){var g="legend:collapsable:"+b.split(":")[0];SVGDocument.getElementById(g)&&setTimeout('__doSwitchGroupThemes("'+b+'",'+d+")",250)}b&&!b.match(/label/)&&b.match(/::/)&&!0===d&&(g=this.fSwitchSublayer,this.fSwitchSublayer=!1,this.switchLayer(a,b.split("::")[0],c,
!0),this.fSwitchSublayer=g,(g=SVGDocument.getElementById("legend:off:"+b.split("::")[0]))&&"inline"!=g.style.getPropertyValue("display")&&(g=SVGDocument.getElementById("legend:suboff:"+b.split("::")[0]))&&g.style.setProperty("display","inline",""));b.match(/label/)&&!b.match(/:bg/)&&this.switchLayer(a,b+":bg",c,d);b.match(/::/)&&b.split("::")[1]&&f.categoryA[b.split("::")[1]]?f.categoryA[b.split("::")[1]].display=e:(f.categoryA&&f.categoryA[null]&&(f.categoryA[null].display=e),f.display=e,f.nState=
"none"==e?!1:!0);return f&&(this.switchLayerByFeature(b,d)||this.switchLayerOnTiles(b,d))?(b.match(/:label/)?f.szDisplayLabel=e:(f.nState=d,f.szDisplay=e),f.szLabel&&this.adaptLabel(a),setTimeout("map.Layer.adaptLabel()",100),!0):c&&!b.match(/:label/)?(this.switchLayerByCSS(null,b,c,d?"inline":"none"),f&&(f.szDisplay=e),setTimeout("map.Layer.adaptLabel()",100),!0):!1};
Map.Layer.prototype.switchLayerOnTiles=function(a,b){var c=!1;if(map.Tiles&&0<map.Tiles.nCount)for(var d=map.Tiles.getTileNodeIds(a),e=0;e<d.length;e++)c=this.switchLayerByFeature(d[e],b)?!0:c;return c};
Map.Layer.prototype.switchLayerByFeature=function(a,b){var c,d=!1,e=this.document.getElementById(a);if(e)if(this.addChangedFeatureNode(e),"linetemplate"==e.getAttributeNS(null,"class")||"linetemplate"==e.getAttributeNS(szMapNs,"class"))if(a.match(/#/)){var f=a.split("#");for(c=0;10>c;c++)if(e=this.document.getElementById(f[0]+"_"+c+"#"+f[1]))e.style.setProperty("display",b?"inline":"none",""),d=!0}else for(c=0;10>c;c++){if(e=this.document.getElementById(a+"_"+c))e.style.setProperty("display",b?"inline":
"none",""),d=!0}else e.style.setProperty("display",b?"inline":"none",""),d=!0;return d};
Map.Layer.prototype.switchLayerByCSS=function(a,b,c,d){if("(null)"!=c){if(b&&(b=b.split(":")[0],this.listA[b+"_1"])){var e=c.substr(b.length,c.length-b.length),f=parseInt(e),g=parseInt(e.substr(e.length-1,1)),e=c.substr(0,b.length);for(c=1;this.listA[b+"_"+c];)f++,this.switchLayerByCSS(a,null,e+"-"+c+f+"s"+g,d),c++;return}map.Scale.CSSStyleNodes&&(a=map.Scale.CSSStyleNodes,map.CSS=new Map.CSS(map.Scale.CSSStyleNodes),map.CSS.setStyle(c,"display",d),map.Scale.fCSSStyleNodeChanged=!0,a.firstChild.nextSibling.nodeValue=
map.CSS.getStyleString(),displayMessage("please wait ...",500),setTimeout("map.Scale.refreshCSSStyles()",200))}};
Map.Layer.prototype.switchScaleDependentLayer=function(a,b){if(fDynamicLayer){var c="";if(null!=this.depListA){var d=0;for(d in this.depListA){map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.depListA[d].nLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.depListA[d].nUpper?c="inline":(c="none",!this.depListA[d].shapeId.match(/:label/)&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.depListA[d].nUpper&&(map.Themes&&0!==map.Themes.getThemeCount()||displayMessage("'"+this.depListA[d].shapeId+
"' not visible at actual zoom level!",3E3,"notify")));if(this.depListA[d].szDisplayAttribute!=c){this.depListA[d].szDisplayAttribute=c;if(this.isChangedFeature(this.depListA[d].shapeId)){if(this.depListA[d].szOldDisplayAttribute==c)continue;this.depListA[d].szOldDisplayAttribute=this.depListA[d].szDisplayAttribute}var e=this.depListA[d].szFeature;map.Legend&&map.Legend.switchLegendCheckBox(a,e,c)}try{var f=this.depListA[d].shapeId;f.match(/label/)?(f.split(":"),this.listA[f.split(":")[0]].szDisplayLabel=
c):this.listA[f].szDisplay=c}catch(g){alert("Syntax error: "+f)}}if(map.Scale.CSSStyleNodes&&fSwitchByCSS){c=map.Scale.CSSStyleNodes;map.CSS=new Map.CSS(map.Scale.CSSStyleNodes);e=f=null;for(d in this.depListA)e=this.depListA[d],e.szDisplayAttribute!=e.szOldDisplayAttribute&&(f=e.depClass,3<f.length?(map.CSS.setStyle(f,"display",e.szDisplayAttribute),map.Scale.fCSSStyleNodeChanged=!0):(f=SVGDocument.getElementById(e.shapeId))&&f.style.setProperty("display",e.szDisplayAttribute,""));map.Scale.fCSSStyleNodeChanged&&
(c.firstChild.nextSibling.nodeValue=map.CSS.getStyleString())}else for(b=b?b:SVGRootElement,d=b.getElementsByTagName("g"),c=0;c<d.length;c++)e=d.item(c).getAttributeNS(null,"id"),e=map.Tiles.getMasterId(e),this.depListA[e]&&d.item(c).style.setProperty("display",this.depListA[e].szDisplayAttribute,"")}}};Map.Layer.prototype.isScaleDependentLayer=function(a){return this.depListA&&this.depListA[a]?!0:!1};
Map.Layer.prototype.isScaleDependentLayerOn=function(a){return this.depListA&&this.depListA[a]?this.depListA[a].szDisplayAttribute.match(/none/)?!1:!0:!0};
Map.Layer.prototype.zoomToScaleDependentLayerOn=function(a){if("undefined"!=typeof this.listA[a]){map.Event.doDefaultZoom(null);var b=map.Scale.nTrueMapScale*map.Scale.nZoomScale,c=0,c=this.depListA&&this.depListA[a]&&this.depListA[a].nUpper?this.depListA[a].nUpper:map.Tiles.depUpper?map.Tiles.depUpper.split(":")[1]:0,c=Math.ceil(b/c);a=map.Zoom.getBox();b=a.width/c;c=a.height/c;a.x+=(a.width-b)/2;a.y+=(a.height-c)/2;a.width=b;a.height=c;map.Zoom.setNewArea(a);setTimeout("map.Tiles.switchScaleDependentTiles()",
5E3)}};Map.Layer.prototype.isLayerOn=function(a){return this.listA[a]?this.listA[a].szDisplay.match(/none/)?!1:!0:!1};Map.Layer.prototype.changeLayerOpacity=function(a,b){var c=!1;(c=this.changeOpacity(a,b))||(c=this.changeOpacityOnTiles(a,b));return c};Map.Layer.prototype.changeOpacityOnTiles=function(a,b){var c=!1;if(map.Tiles&&0<map.Tiles.nCount)for(var d=map.Tiles.getTileNodeIds(a),e=0;e<d.length;e++)c=this.changeOpacity(d[e],b)?!0:c;else c=this.changeOpacity(a,b)?!0:c;return c};
Map.Layer.prototype.changeOpacity=function(a,b){var c,d=!1,e=this.document.getElementById(a);if(e)if("linetemplate"==e.getAttributeNS(null,"class")||"linetemplate"==e.getAttributeNS(szMapNs,"class"))if(a.match(/#/)){var f=a.split("#");for(c=0;10>c;c++)if(e=this.document.getElementById(f[0]+"_"+c+"#"+f[1]))this.changeNodeOpacity(e,b),d=!0}else for(c=0;10>c;c++){if(e=this.document.getElementById(a+"_"+c))this.changeNodeOpacity(e,b),d=!0}else this.changeNodeOpacity(e,b),d=!0;return d};
Map.Layer.prototype.changeNodeOpacity=function(a,b,c){var d=a.style.getPropertyValue(c?c:"opacity");d&&0!==d.length||(d="1");d=Number(d);d=Math.min(1,d*b);d=Math.max(0,d);a.style.setProperty(c?c:"opacity",String(d),"")};
Map.Layer.prototype.initPatternScaling=function(a,b){b||(b=SVGRootElement);for(var c=1/map.Scale.getEmbedScale()*map.Scale.nFeatureScaling,d=b.getElementsByTagName("pattern"),e=0;e<d.length;e++)d.item(e).getAttributeNS(null,"id").match(/antizoomandpan/)||(getPatternMatrix(d.item(e)),d.item(e).setAttributeNS(null,"patternTransform","matrix("+c+" 0 0 "+c+" 0 0)"))};Map.Layer.prototype.changeLineScaling=function(a,b){this.doFeatureScaling(b);map.Scale.nLineScaling*=b};
Map.Layer.prototype.changeLabelScaling=function(a,b){this.doLabelScaling(b);map.Scale.nLabelScaling*=b};
Map.Layer.prototype.changeFeatureScaling=function(a,b,c){if(!(1<=b&&1<=map.Scale.featureScaling_lastScale)||c){var d=b/map.Scale.getEmbedScale();c=b;if(fFeatureScalingDynamic){var e=Math.log(1/b);1<e&&(b*=e)}map.Layer.nFeatureScale=b;map.Layer.nDynamicScale=map.Layer.nFeatureScale/map.Scale.nZoomScale;e=b/map.Scale.featureScaling_lastScale;map.Scale.featureScaling_lastScale=b;if(0!==e&&1!==e)if(fFeatureScaling){for(var f=null,g=0,f=SVGRootElement.getElementsByTagName("pattern"),g=getMatrix(map.Scale.zoomNode),
h=g[4]+map.Scale.scaleX(SVGRootElement.currentTranslate.x),l=g[5]+map.Scale.scaleY(SVGRootElement.currentTranslate.y),h=-h*d,l=-l*d,g=0;g<f.length;g++)f.item(g).getAttributeNS(null,"id").match(/antizoomandpan/)||(getPatternMatrix(f.item(g)),f.item(g).setAttributeNS(null,"patternTransform","matrix("+d+" 0 0 "+d+" "+String(h)+" "+String(l)+")"));a=a?a.target.ownerDocument:SVGDocument;f=!0;1>map.Scale.nFeatureScaling&&(f=!1,1>e&&1<=map.Scale.nFeatureScaling*map.Zoom.nZoom&&(1>map.Scale.nFeatureScaling*
map.Zoom.nZoom*e&&(e=1/map.Scale.nFeatureScaling/map.Zoom.nZoom),f=!0),1<e&&1<=map.Scale.nFeatureScaling*map.Zoom.nZoom*e&&(1>map.Scale.nFeatureScaling*map.Zoom.nZoom&&(e=map.Zoom.nZoom*e/(1/map.Scale.nFeatureScaling)),f=!0));if(f){f=SVGRootElement.getElementsByTagName("filter");for(g=0;g<f.length;g++)if(!f.item(g).getAttributeNS(null,"id").match(/antizoomandpan/))for(d=f.item(g).childNodes,h=0;h<d.length;h++)"feMorphology"==d.item(h).nodeName&&d.item(h).setAttributeNS(null,"radius",Number(d.item(h).getAttributeNS(null,
"radius"))*e),"feOffset"==d.item(h).nodeName&&(d.item(h).setAttributeNS(null,"dx",Number(d.item(h).getAttributeNS(null,"dx"))*e),d.item(h).setAttributeNS(null,"dy",Number(d.item(h).getAttributeNS(null,"dy"))*e)),"feGaussianBlur"==d.item(h).nodeName&&d.item(h).setAttributeNS(null,"stdDeviation",Number(d.item(h).getAttributeNS(null,"stdDeviation"))*e);this.doFeatureScaling(e);this.doLabelScaling(e);d=e;if(f=SVGDocument.getElementById("marker_symbols"))for(f=f.childNodes,g=0;g<f.length;g++)if(1==f.item(g).nodeType&&
(h=f.item(g).getAttributeNS(null,"id"))&&h.length&&!h.match(/antizoomandpan/)){var k=getMatrix(f.item(g));k&&(k[0]*=e,k[3]*=e,setMatrix(f.item(g),k),map.Scale.scaledSymbolsA["#"+h]=!0)}if(f=SVGDocument.getElementById("symbolstore"))for(f=f.getElementsByTagName("g"),g=0;g<f.length;g++)(h=f.item(g).getAttributeNS(null,"id"))&&h.length&&h.match(/symbol/)&&!h.match(/antizoomandpan/)&&(k=getMatrix(f.item(g)))&&(k[0]*=e,k[3]*=e,k[4]*=e,k[5]*=e,setMatrix(f.item(g),k),map.Scale.scaledSymbolsA["#"+h]=!0);
f=SVGDocument.getElementById("widgets:antizoomandpan").getElementsByTagName("use");for(g=0;g<f.length;g++)h=f.item(g).getAttributeNS(szXlink,"href"),map.Scale.scaledSymbolsA[h]&&(k=getMatrix(f.item(g)))&&(k[0]/=e,k[3]/=e,setMatrix(f.item(g),k));f=SVGHiddenGroup.getElementsByTagName("use");for(g=0;g<f.length;g++)h=f.item(g).getAttributeNS(szXlink,"href"),map.Scale.scaledSymbolsA[h]&&(k=getMatrix(f.item(g)))&&(k[0]/=e,k[3]/=e,setMatrix(f.item(g),k));this.scaleTextOffsets(SVGRootElement,b,d,a.getElementById("mapstyles"));
this.scaleLineDecorations(SVGRootElement,b);this.doObjectScaling(c)}}else this.doObjectScaling(c)}};
Map.Layer.prototype.doFeatureScaling=function(a){var b=null,c=null,d=SVGDocument.getElementById("mapstyles");if(d)b=d.firstChild.nextSibling.nodeValue,c=__scaleLineStyleString(b,a),d.firstChild.nextSibling.nodeValue=c,map.Scale.fCSSStyleNodeChanged=!0;else if(fFeatureScalingByLayer){var e=null,d=[],b=[],c=!1,f;for(f in map.Layer.listA)if(e=map.Layer.listA[f],e.szFlag.match(/tiled/)){if(!c){var c=!0,g=map.Tiles.getTileInfo();if(g)for(var h=0;h<g.length;h++){var l=Number(g[h].tileGroup.getAttributeNS(szMapNs,
"deltaTBD"));if("inline"==g[h].tileGroup.style.getPropertyValue("display")){for(var e=g[h].tileGroup.getElementsByTagName("g"),k=0;k<e.length;k++)e.item(k).getAttributeNS(null,"id").match(/:label/)||(d[d.length]=e.item(k),b[d.length-1]=l?l:1);g[h].tileGroup.setAttributeNS(szMapNs,"deltaTBD","1")}else g[h].tileGroup.hasChildNodes()&&g[h].tileGroup.setAttributeNS(szMapNs,"deltaTBD",String(a*(l?l:1)))}}}else if(e.szName&&(e=SVGDocument.getElementById(e.szName)))for(d[d.length]=e,b[d.length-1]=1,e=e.getElementsByTagName("g"),
k=0;k<e.length;k++)e.item(k).getAttributeNS(null,"id").match(/:label/)||(d[d.length]=e.item(k),b[d.length-1]=1);e=SVGDocument.getElementById("mapobjects");e=e.getElementsByTagName("g");for(k=0;k<e.length;k++)d[d.length]=e.item(k),b[d.length-1]=1;for(f=0;f<d.length;f++)(c=d[f].getAttributeNS(null,"style"))&&c.length&&(c=__scaleLineStyleString(c,a*b[f]),d[f].setAttributeNS(null,"style",c))}};
Map.Layer.prototype.doObjectScaling=function(a){if(fObjectScaling){map.Layer.nObjectScale=a;"dynamic"==fObjectScaling&&(map.Layer.nObjectScale*=Math.pow(1/(map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale),1/map.Scale.nDynamicScalePow));map.Layer.nDynamicObjectScale=map.Layer.nObjectScale/a;var b=map.Layer.nObjectScale/map.Scale.objectScaling_lastScale;map.Scale.objectScaling_lastScale=map.Layer.nObjectScale;if(0!==b&&1!==b&&(a=!0,1>map.Scale.nObjectScaling&&(a=!1,1>b&&1<=map.Scale.nObjectScaling*
map.Zoom.nZoom&&(1>map.Scale.nObjectScaling*map.Zoom.nZoom*b&&(b=1/map.Scale.nObjectScaling/map.Zoom.nZoom),a=!0),1<b&&1<=map.Scale.nObjectScaling*map.Zoom.nZoom*b&&(1>map.Scale.nObjectScaling*map.Zoom.nZoom&&(b=map.Zoom.nZoom*b/(1/map.Scale.nObjectScaling)),a=!0)),a)){a=b;for(var b=b/map.Zoom.nOldZoomX*map.Zoom.nOldZoomY/map.Zoom.nZoomY*map.Zoom.nZoomX,c=map.Layer.objectGroup.childNodes,d=0;d<c.length;d++)if(!c.item(d).getAttributeNS(null,"id").match(/featuregroup/))if(antiZoomAndPanList.isContained(c.item(d)))for(var e=
c.item(d).childNodes,f=0;f<e.length;f++)e.item(f).firstChild&&e.item(f).firstChild.style.setProperty("stroke-width",e.item(f).firstChild.style.getPropertyValue("stroke-width")*a);else for(e=c.item(d).childNodes,f=0;f<e.length;f++){var g=getMatrix(e.item(f));g&&(g[0]*=a,g[3]*=b,setMatrix(e.item(f),g))}}}};
Map.Layer.prototype.doStoredFeatureScaling=function(a){if(fFeatureScaling){var b=null;if(!(a?a.target.ownerDocument:SVGDocument).getElementById("mapstyles")){b=null;a=[];var c=[],d=map.Tiles.getTileInfo();if(d)for(var e=0;e<d.length;e++)if("inline"==d[e].tileGroup.style.getPropertyValue("display")){var f=Number(d[e].tileGroup.getAttributeNS(szMapNs,"deltaTBD"));if(f&&1!=f)for(var b=d[e].tileGroup.getElementsByTagName("g"),g=0;g<b.length;g++)a[a.length]=b.item(g),c[a.length-1]=f?f:1,d[e].tileGroup.setAttributeNS(szMapNs,
"deltaTBD","1")}for(d=0;d<a.length;d++)a[d].getAttributeNS(null,"id").match(/:label/)||(b=a[d].getAttributeNS(null,"style"))&&b.length&&(b=__scaleLineStyleString(b,c[d]),a[d].setAttributeNS(null,"style",b))}}};
Map.Layer.prototype.scaleTextOffsets=function(a,b,c,d){for(var e=a.getElementsByTagName("rect"),f=0;f<e.length;f++){var g=e.item(f).getAttributeNS(null,"id");if(g&&g.match(/textbg/)&&(g=e.item(f).nextSibling.nextSibling)&&"text"==g.nodeName)if(g=map.Dom.getBox(g),0>g.width||0>g.height)e.item(f).setAttributeNS(null,"width",0),e.item(f).setAttributeNS(null,"height",0);else{d&&(g.x*=c,g.y*=c,g.width*=c,g.height*=c);var h=map.Scale.normalX(1)*b;e.item(f).setAttributeNS(null,"x",g.x-h);e.item(f).setAttributeNS(null,
"y",g.y-h);e.item(f).setAttributeNS(null,"width",g.width+2*h);e.item(f).setAttributeNS(null,"height",g.height+2*h)}}e=a.getElementsByTagName("text");for(f=0;f<e.length;f++)if((g=e.item(f).parentNode.getAttributeNS(null,"id"))&&g.match(/label/)&&(g=e.item(f),a=g.getAttributeNS(null,"transform"))){a=a.split(" ");for(b=0;b<a.length;b++)a[b].match(/translate/)&&(d=a[b].substr(10,a[b].length-11).split(","),a[b]="translate("+Number(d[0])*c+","+Number(d[1])*c+")");d="";for(b=0;b<a.length;b++)d=d+a[b]+" ";
g.setAttributeNS(null,"transform",d)}};
Map.Layer.prototype.scaleLineDecorations=function(a,b){for(var c=a.getElementsByTagName("text"),d=0;d<c.length;d++)if(c.item(d)&&c.item(d).getAttributeNS(null,"id")&&c.item(d).getAttributeNS(null,"id").match(/linedecoration/)){var e=c.item(d).style.getPropertyValue("dominant-baseline"),f=parseFloat(c.item(d).style.getPropertyValue("baseline-shift")),g=parseFloat(c.item(d).style.getPropertyValue("font-size")),h=0;"mathematical"==e&&(h+=g/3);"hanging"==e&&(h-=g);h-=f*b;c.item(d).setAttributeNS(null,
"dy",h)}};
Map.Layer.prototype.doLabelScaling=function(a){var b=null,c=SVGDocument.getElementById("mapstyles");if(c){var b=c.firstChild.nextSibling.nodeValue,d=__scaleTextStyleString(b,a);c.firstChild.nextSibling.nodeValue=d;map.Scale.fCSSStyleNodeChanged=!0;map.Scale.refreshCSSStyles()}else for(c=null,b=0,c=map.Scale.canvasNode.getElementsByTagName("g"),b=0;b<c.length;b++)if(!antiZoomAndPanList.isContained(c.item(b))){var e=c.item(b).getAttributeNS(null,"id");if(e&&0!==e.length&&e.match(/label/)&&(d=c.item(b).getAttributeNS(null,
"style"))&&d.length)if(0===a)map.Layer.switchLayer(null,e,null,"none"==c.item(b).style.getPropertyValue("display")?!0:!1);else{d=__scaleStyleString(d,a);c.item(b).setAttributeNS(null,"style",d);for(var e=c.item(b).childNodes,f=0;f<e.length;f++)"text"==e.item(f).nodeName&&(d=e.item(f).getAttributeNS(null,"style"))&&d.length&&(d=__scaleStyleString(d,a),e.item(f).setAttributeNS(null,"style",d))}}for(var g in map.Layer.generatedLabelA)if(map.Layer.generatedLabelA[g])for(c=map.Layer.generatedLabelA[g].getElementsByTagName("text"),
b=0;b<c.length;b++)(d=c.item(b).getAttributeNS(null,"style"))&&d.length&&(d=__scaleStyleString(d,a),c.item(b).setAttributeNS(null,"style",d));this.adaptLabel(null)};
Map.Layer.prototype.changeObjectScaling=function(a,b,c){var d=null;a=null;var e=0;0===b&&(b=1/map.Scale.nObjectScaling);if(c){var f=c.childNodes;for(c=0;c<f.length;c++){if(a=getMatrix(f.item(c)))a[0]*=b,a[3]*=b,setMatrix(f.item(c),a);(d=f.item(c).childNodes[0])&&(a=getMatrix(d))&&(a[4]/=Math.pow(b,.5),a[5]/=Math.pow(b,.5),setMatrix(d,a))}}else if(!(8<map.Scale.nObjectScaling*b||.1>map.Scale.nObjectScaling*b))for(map.Scale.nObjectScaling*=b,d=map.Layer.objectGroup.childNodes,c=0;c<d.length;c++)if(!antiZoomAndPanList.isContained(d.item(c)))for(f=
d.item(c).childNodes,e=0;e<f.length;e++)if(a=getMatrix(f.item(e)))a[0]*=b,a[3]*=b,setMatrix(f.item(e),a)};Map.Layer.prototype.setObjectRotate=function(a,b,c){a=null;var d=0;if(c){var e=c.childNodes;for(c=0;c<e.length;c++)setRotate(e.item(c),(360+Number(b))%360)}else for(a=map.Layer.objectGroup.childNodes,c=0;c<a.length;c++)if(!antiZoomAndPanList.isContained(a.item(c)))for(e=a.item(c).childNodes,d=0;d<e.length;d++)setRotate(e.item(d),(360+Number(b))%360)};
Map.Layer.prototype.setPatternRotate=function(a,b,c){a=null;var d=0;c||(c=SVGRootElement);a=c.getElementsByTagName("pattern");for(d=0;d<a.length;d++)a.item(d).getAttributeNS(null,"id").match(/antizoomandpan/)||setRotate(a.item(d),(360+Number(b))%360,"patternTransform")};
Map.Layer.prototype.setSymbolRotate=function(a,b,c){a=null;c=0;if(a=SVGDocument.getElementById("marker_symbols"))for(a=a.childNodes,c=0;c<a.length;c++)if(1==a.item(c).nodeType){var d=a.item(c).getAttributeNS(null,"id");d&&d.length&&!d.match(/antizoomandpan/)&&(setRotate(a.item(c),(360+Number(b))%360),map.Scale.rotatedSymbolsA["#"+d]=!0)}if(a=SVGDocument.getElementById("symbolstore"))for(a=a.getElementsByTagName("g"),c=0;c<a.length;c++)(d=a.item(c).getAttributeNS(null,"id"))&&d.length&&d.match(/symbol/)&&
!d.match(/antizoomandpan/)&&(setRotate(a.item(c),(360+Number(b))%360),map.Scale.rotatedSymbolsA["#"+d]=!0);a=SVGDocument.getElementById("widgets:antizoomandpan").getElementsByTagName("use");for(c=0;c<a.length;c++)d=a.item(c).getAttributeNS(szXlink,"href"),map.Scale.rotatedSymbolsA[d]&&setRotate(a.item(c),(360+Number(-b))%360);a=SVGHiddenGroup.getElementsByTagName("use");for(c=0;c<a.length;c++)d=a.item(c).getAttributeNS(szXlink,"href"),map.Scale.rotatedSymbolsA[d]&&setRotate(a.item(c),(360+Number(-b))%
360)};Map.Layer.prototype.changeObjectRotate=function(a,b,c){a=null;var d=0;if(c)for(c=c.childNodes,d=0;d<c.length;d++){var e=getRotateAttributeValue(c.item(d));setRotate(c.item(d),(360+Number(e)+Number(b))%360)}else for(a=map.Layer.objectGroup.childNodes,d=0;d<a.length;d++)if(!antiZoomAndPanList.isContained(a.item(d)))for(c=a.item(d).childNodes,d=0;d<c.length;d++)e=getRotateAttributeValue(c.item(d)),setRotate(c.item(d),(360+Number(e)+Number(b))%360)};
Map.Layer.prototype.setLabelRotate=function(a,b){for(var c=null,d=0,c=map.Layer.layerNode.getElementsByTagName("text"),d=0;d<c.length;d++)antiZoomAndPanList.isContained(c.item(d))||c.item(d).firstChild&&"textPath"==c.item(d).firstChild.nodeName||setRotate(c.item(d),(360+Number(b))%360);this.adaptLabel()};
Map.Layer.prototype.changeLabelRotate=function(a,b){for(var c=null,d=0,c=map.Scale.canvasNode.getElementsByTagName("text"),d=0;d<c.length;d++)if(!(antiZoomAndPanList.isContained(c.item(d))||c.item(d).firstChild&&"textPath"==c.item(d).firstChild.nodeName)){var e=getRotateAttributeValue(c.item(d));setRotate(c.item(d),(360+Number(e)+Number(b))%360)}this.adaptLabel()};
Map.Layer.prototype.adaptLabel=function(a,b){fAdaptLabelToScaling&&this.adaptLabelToScaling(a,b);if(fCheckLabelOverlap||fCheckLabelSpace||fCheckLabelSqueeze)b&&this.prepareCheckOverlap(a,b),this.checkLabelOverlapping(a,b)};
Map.Layer.prototype.adaptLabelToScaling=function(a,b){b||(b=SVGRootElement);if(fAdaptLabelToScaling||fCheckLabelOnlyOne){var c=!1,d;for(d in map.Layer.listA){var e=map.Layer.listA[d];e.nRenderer&12&&"line"==e.szType&&"inline"==e.szDisplayLabel&&(c=!0)}if(c){c=b.getElementsByTagName("textPath");if(map.Scale.oldZoomScale!=map.Scale)for(d=0;d<c.length;d++)c.item(d).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||c.item(d).parentNode.style.setProperty("display","none","");map.Label.fAdaptLabelToScalingPending||
(map.Label.fAdaptLabelToScalingPending=!0,"delayed"==fAdaptLabelToScaling?map.pushAction('setTimeout("map.Label.adaptLabelToScaling(null)",1500)'):map.pushAction("map.Label.adaptLabelToScaling(null,null)"))}}};Map.Layer.prototype.checkLabelOverlapping=function(a,b){if(fCheckLabelOverlap||fCheckLabelSpace||fCheckLabelSqueeze)b||(b=map.Layer.layerNode),b||(b=map.Scale.canvasNode),map.Label.initCheckOverlap(b)};
Map.Layer.prototype.prepareCheckOverlap=function(a,b){if(fCheckLabelOverlap||fCheckLabelSpace)b||(b=map.Layer.layerNode),b||(b=map.Scale.canvasNode),map.Label.prepareCheckOverlap(b)};Map.Layer.prototype.addChangedFeatureNode=function(a){var b;if(this.changedFeatureNodesA){for(b=0;b<this.changedFeatureNodesA.length;b++)if(this.changedFeatureNodesA[b]==a)return;this.changedFeatureNodesA[this.changedFeatureNodesA.length]=a}};
Map.Layer.prototype.isChangedFeature=function(a){var b;if(this.changedFeatureNodesA)for(b=0;b<this.changedFeatureNodesA.length;b++)if(map.Tiles.getMasterId(this.changedFeatureNodesA[b].getAttributeNS(null,"id"))==a)return!0;return!1};
Map.Layer.prototype.removeChangedFeatures=function(a){var b,c;if(this.changedFeatureNodesA)for(b=0;b<this.changedFeatureNodesA.length;b++)if(map.Tiles.getMasterId(this.changedFeatureNodesA[b].getAttributeNS(null,"id"))==a){this.changedFeatureNodesA[b].setAttributeNS(null,"style","");for(c=b;c<this.changedFeatureNodesA.length-1;c++)this.changedFeatureNodesA[c]=this.changedFeatureNodesA[c+1];this.changedFeatureNodesA.length--;b--}};
Map.Layer.prototype.setPointerEvents=function(a){for(var b in map.Layer.listA){var c=map.Layer.listA[b].szName;if(c){var d=SVGDocument.getElementById(c),c=null==a||a==c?null:"none";d&&(c?d.style.setProperty("pointer-events",c,""):d.style.removeProperty("pointer-events"))}}};Map.Layer.prototype.getLayerObj=function(a){if(!a)return null;var b=a.split("#")[0].split(":")[0];"legend"==b&&(b=a.split(":")[2]);return this.listA[b]};
Map.Layer.prototype.getLayerName=function(a){return(a=this.getLayerObj(a))?a.szName:null};Map.Layer.prototype.getLayerObjOfNode=function(a){if(a)for(;a.parentNode&&"SVG"!=a.parentNode.nodeName;){var b=this.getLayerObj(a.getAttributeNS(null,"id"));if(b)return b;a=a.parentNode}return null};Map.Layer.prototype.getLayerItemNodeOfNode=function(a){for(;a.parentNode&&"SVG"!=a.parentNode.nodeName;){if(this.getLayerObj(a.getAttributeNS(null,"id")))return a;a=a.parentNode}return null};
Map.Layer.prototype.getLayerItemNodes=function(a){if(a=this.getLayerItemNodeOfNode(a)){var b=a.getAttributeNS(null,"id");return"point"==this.getLayerObj(b).szType&&fTileTextNoClip||map.Tiles.getMasterId(b)==b?Array(a):map.Tiles.getTileNodes(map.Tiles.getMasterId(b))}return[]};Map.Layer.prototype.getStyleOrClass=function(a){var b={};b.szClass=map.Dom.getAttributeByNodeOrParents(a,null,"class");b.szStyle=map.Dom.getAttributeByNodeOrParents(a,null,"style");return b};
Map.Layer.prototype.isMapObject=function(a){for(;a;){if(a==map.Scale.canvasNode)return!0;a=a.parentNode}return!1};Map.Layer.prototype.isLoaded=function(a){return(a=this.getLayerObj(a))?a.szFlag.match(/tiled/)?map.Tiles.isAnyLayerTileLoaded():!0:!1};
Map.Label=function(a){this.document=a?a.target.ownerDocument:SVGDocument;this.checkItemA=[];this.checkOvlA=[];this.nodeA=[];this.boxA=[];this.rootNode=null;this.zoomScale=0;this.fCheckLabelOverlappingPending=!1;this.ALTS_rootNode=this.ALTS_nodeA=this.ALTS_textA=null;this.killProcess=this.fAdaptLabelToScalingPending=!1};Map.Label.prototype=new Map;
Map.Label.Item=function(a){if(a)this.textNode=a,this.szId=a.getAttributeNS(null,"id")||"noId",this.bgNode=SVGDocument.getElementById(this.szId+":bg"),this.bbNode=SVGDocument.getElementById(this.szId+":textbg"),this.poNode=SVGDocument.getElementById(this.szId.slice(0,this.szId.length-1)),this.poNode||(a=map.Tiles.getMasterId(this.szId),a=a.slice(0,a.length-1),this.poNode=SVGDocument.getElementById(a)),this.bBox=null;else return this.szId="mapLabelNullItem",null};
Map.Label.Item.prototype.setDisplay=function(a){this.textNode.style.setProperty("display",a,"");this.bgNode&&this.bgNode.style.setProperty("display",a,"");this.bbNode&&this.bbNode.style.setProperty("display",a,"");this.poNode&&"use"==this.poNode.nodeName&&this.poNode.style.setProperty("display",a,"")};Map.Label.Item.prototype.setScale=function(a,b){setScale(this.textNode,a,b);this.bgNode&&setScale(this.bgNode,a,b);this.bbNode&&setScale(this.bbNode,a,b)};
Map.Label.Item.prototype.scaleBackground=function(){if(this.bbNode&&this.textNode){var a=map.Scale.normalX(2)*map.Scale.nZoomScale,b=map.Dom.getBox(this.textNode),c=getTranslateAttributeValue(this.textNode);0<b.width&&0<b.height&&(this.bbNode.setAttributeNS(null,"x",b.x+(c.x?c.x-a:0)),this.bbNode.setAttributeNS(null,"y",b.y-a+c.y),this.bbNode.setAttributeNS(null,"width",b.width+2*a),this.bbNode.setAttributeNS(null,"height",b.height+2*a))}};
Map.Label.prototype.stopProcessing=function(){this.killProcess=!0};Map.Label.prototype.prepareCheckOverlap=function(a){a=a.getElementsByTagName("text");for(var b=0;b<a.length;b++)a.item(b).firstChild&&"textPath"!=a.item(b).firstChild.nodeName&&!a.item(b).getAttributeNS(null,"id").match(/:bg/)&&(new Map.Label.Item(a.item(b))).setDisplay("none")};
Map.Label.prototype.initCheckOverlap=function(a){this.killProcess=!1;this.fCheckLabelOverlappingPending||(this.fCheckLabelOverlappingPending=!0,this.checkItemA.length=0,this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0,this.rootNode=a,fPDFEmbed||!map.Tiles.dataNode?setTimeout("map.Label.collectCheckOverlap()",0):map.pushAction("map.Label.collectCheckOverlap()"))};Map.Label.prototype.getCheckItem=function(a){return this.checkItemA[a]};Map.Label.prototype.getCheckItemCount=function(){return this.checkItemA.length};
Map.Label.prototype.addCheckItem=function(a,b){if(a){var c=map.Layer.getLayerObjOfNode(a);if(c&&(!c||a.parentNode.getAttributeNS(null,"id").match(/value/)||"inline"==c.szDisplayLabel)&&(fCheckLabelOverlap||"polygon"==c.szType)&&a.firstChild&&"textPath"!=a.firstChild.nodeName&&!a.getAttributeNS(null,"id").match(/:bg/)){var d=getMatrix(a),d=new point(Number(d[4]),Number(d[5])),e=map.Scale.getMapOffset(a);d.x+=e.x;d.y+=e.y;d.x<this.zoomBox.x||d.x>this.zoomBox.x+this.zoomBox.width||d.y<this.zoomBox.y||
d.y>this.zoomBox.y+this.zoomBox.height||(d=new Map.Label.Item(a),d.fRef=c&&"polygon"==c.szType?!0:!1,d.fScale=b,this.checkItemA[this.checkItemA.length]=d)}}else d=new Map.Label.Item(null),this.checkItemA[this.checkItemA.length]=d};
Map.Label.prototype.collectCheckOverlap=function(){var a=null,b=!1,c=[],d;for(d in map.Layer.listA)"polygon"==map.Layer.listA[d].szType&&c.push(d);fCheckOverlapAllLayer||c.push("resetoverlap");for(d in map.Layer.listA)"polygon"!=map.Layer.listA[d].szType&&c.push(d);this.zoomBox=map.Zoom.getBox();for(d=c.length-1;0<=d;d--)if("resetoverlap"==c[d])this.addCheckItem(null);else{var e=map.Layer.listA[c[d]];if(e.szFlag.match(/tiled/)){if(!b&&(b=!0,e=map.Tiles.getTileInfo())){this.addCheckItem(null);for(var f=
0;f<e.length;f++)if("inline"==e[f].tileGroup.style.getPropertyValue("display")){for(var a=e[f].tileGroup.getElementsByTagName("text"),g=a.length-1;0<=g;g--)"none"!=a.item(g).parentNode.style.getPropertyValue("display")&&this.addCheckItem(a.item(g));fCheckOverlapClipOnTiles&&this.addCheckItem(null)}}}else if(e.szName){if(a=SVGDocument.getElementById(e.szName+":label"))if((g=a.getElementsByTagName("g"))&&0<g.length)for(var h=0;h<g.length;h++){if(a=g.item(h).getElementsByTagName("text"),a.length)for(f=
a.length-1;0<=f;f--)this.addCheckItem(a.item(f))}else if(a=a.getElementsByTagName("text"),a.length)for(f=a.length-1;0<=f;f--)this.addCheckItem(a.item(f));if(a=SVGDocument.getElementById(e.szName+":values"))if(a=a.getElementsByTagName("text"),a.length)for(f=a.length-1;0<=f;f--)this.addCheckItem(a.item(f))}}b=map.Themes.getTextObjects();for(f=0;f<b.length;f++)this.addCheckItem(b[f],!0);this.zoomScale=map.Scale.nZoomScale;this.checkItemA.length?setTimeout("map.Label.getBoxCheckOverlap(0)",100):this.fCheckLabelOverlappingPending=
!1};
Map.Label.prototype.getBoxCheckOverlap=function(a){var b=new Map.Sleep("map.Label.getBoxCheckOverlap",this.nflushLabelDraw,"");for(_STATUS("Map.Label: getBoxCheckOverlap ==== "+a+" ====== >>>");0<=a;a++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;break}if(b.checkSleep(a,10))break;var c=this.getCheckItem(a);if(c)if("mapLabelNullItem"==c.szId&&fCheckOverlapImplicit)this.nodeA.length=0;else try{c.szOldDisplay=c.textNode.style.getPropertyValue("display");c.textNode.style.setProperty("display","inline",
"");c.setScale(1,1);c.textNode.setAttributeNS(null,"x",0);c.textNode.setAttributeNS(null,"y",0);c.bgNode&&(c.bgNode.style.setProperty("display","inline",""),c.bgNode.setAttributeNS(null,"x",0),c.bgNode.setAttributeNS(null,"y",0));var d=map.Dom.getBox(c.textNode);c.fScale&&(d.x*=map.Layer.nFeatureScale,d.y*=map.Layer.nFeatureScale,d.width*=map.Layer.nFeatureScale,d.height*=map.Layer.nFeatureScale);var e=map.Scale.getMapOffset(c.textNode);d.x+=e.x;d.y+=e.y;e=getTranslate(c.textNode);d.x+=e.x;d.y+=e.y;
if(map.Zoom.isVisibleBox(d)&&this.checkLabelSpace(c,d)){15<getRotateAttributeValue(c.textNode)&&345>getRotateAttributeValue(c.textNode)&&c.setScale(1,1);c.bBox=d;var f=this.nodeA.length;this.checkOvlA[f]=c;this.nodeA[f]=c.textNode;this.boxA[f]=d;fCheckLabelOverlap||(c.setDisplay("inline"),c.scaleBackground());fCheckOverlapImplicit&&this.execCheckLabelOverlappingOne(f)}else c.setDisplay("none")}catch(g){}else{fCheckOverlapImplicit?this.fCheckLabelOverlappingPending=!1:setTimeout("map.Label.doCheckOverlap()",
100);break}}};
Map.Label.prototype.checkLabelSpace=function(a,b){var c=null;if(!a.fRef)return!0;a.szId.match(/#/)?(c=a.szId.split("#"),c=c[0].substr(0,c[0].length-1)+"#"+c[1]):c=a.szId.substr(0,a.szId.length-1);if(c=SVGDocument.getElementById(c))if(a.refBox=map.Dom.getBox(c),c=a.refBox,c.width*=nCheckLabelSpace,b.width>c.width&&fAdaptLabelToScaling){var d=1,e=1;fCheckLabelSqueeze&&(b.width<=2*c.width||!fCheckLabelSpace)&&(d=Math.max(.7,c.width/b.width),b.width*=d,a.setScale(d,1));fCheckLabelSize&&(b.width<=1.5*
c.width||!fCheckLabelSpace)&&(e=Math.max(.7,c.width/b.width),b.width*=e,b.height*=e,a.setScale(d*e,e));if(!fCheckLabelSpace||b.width<=c.width)a.setDisplay("inline");else return a.setDisplay("none"),!1}else a.setDisplay("inline");else a.setDisplay(a.szOldDisplay);return!0};
Map.Label.prototype.doCheckOverlap=function(){fCheckLabelOverlap?2E4<this.nodeA.length?(this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0):(this.zoomScale=map.Scale.nZoomScale,"delayed"==fCheckLabelOverlap?setTimeout("map.Label.execCheckLabelOverlappingOnly(0)",2E3):map.pushAction("map.Label.execCheckLabelOverlappingOnly(0)")):this.fCheckLabelOverlappingPending=!1};
Map.Label.prototype.execCheckLabelOverlappingOnly=function(a){for(var b=new Map.Sleep("map.Label.execCheckLabelOverlappingOnly",25,"");a<this.checkOvlA.length;a++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;return}if(b.checkSleep(a,10))return;this.execCheckLabelOverlappingOne(a)}this.fCheckLabelOverlappingPending=!1};
Map.Label.prototype.execCheckLabelOverlappingOne=function(a){var b=this.checkOvlA[a];if(map.Zoom.isVisibleBox(b.bBox)){b.refBox||b.setDisplay("inline");if(fCheckLabelOverlap)for(var c=b.textNode.firstChild.nodeValue,d=b.bBox,e=Number(b.textNode.getAttributeNS(szMapNs,"pos")),f=!1,g=0;g<a;g++){var h=this.checkOvlA[g].textNode.firstChild.nodeValue,l=this.checkOvlA[g].bBox;if(fCheckLabelOnlyOne&&c==h){var h=Number(b.textNode.getAttributeNS(szMapNs,"partlen")),k=Number(this.checkOvlA[g].textNode.getAttributeNS(szMapNs,
"partlen"));if(h>k){this.checkOvlA[g].bBox=null;this.checkOvlA[g].setDisplay("none");continue}b.setDisplay("none");b.bBox=null}if(d&&l&&b.textNode!=this.checkOvlA[g].textNode&&map.Tiles.getMasterId(b.szId)!=map.Tiles.getMasterId(this.checkOvlA[g].szId)&&__checkOverlapBox(d,l)){if(fKillOverlappingLabel||f){l.height<d.height&&(b.refBox||!this.checkOvlA[g].refBox)?(this.checkOvlA[g].bBox=null,this.checkOvlA[g].setDisplay("none")):(b.setDisplay("none"),b.bBox=null);break}if(b.refBox)d.y>l.y?(b.textNode.setAttributeNS(null,
"y",d.height),b.bgNode&&b.bgNode.setAttributeNS(null,"y",d.height),d.y+=d.height):(b.textNode.setAttributeNS(null,"y",-d.height),b.bgNode&&b.bgNode.setAttributeNS(null,"y",-d.height),d.y-=d.height);else if(h=parseInt(b.textNode.style.getPropertyValue("font-size"))||14,d.y>=l.y&&(11===e||12===e||1===e||9===e||3===e||0===e))b.textNode.setAttributeNS(null,"y",h),b.bgNode&&b.bgNode.setAttributeNS(null,"y",h),d.y+=parseInt(h);else if(d.y<=l.y&&(7===e||6===e||5===e||9===e||3===e||0===e))b.textNode.setAttributeNS(null,
"y",-d.height),b.bgNode&&b.bgNode.setAttributeNS(null,"y",-d.height),d.y-=d.height;else if(d.x<=l.x&&(1==e||3==e||5==e))b.textNode.setAttributeNS(null,"x",-(d.width+50*map.Scale.nZoomScale)),b.bgNode&&b.bgNode.setAttributeNS(null,"x",-(d.width+50*map.Scale.nZoomScale)),d.x-=d.width+50*map.Scale.nZoomScale;else if(d.x>=l.x&&(11==e||9==e||7==e))b.textNode.setAttributeNS(null,"x",+(d.width+50*map.Scale.nZoomScale)),b.bgNode&&b.bgNode.setAttributeNS(null,"x",+(d.width+50*map.Scale.nZoomScale)),d.x+=d.width+
50*map.Scale.nZoomScale;else if(l.height<d.height&&(b.refBox||!this.checkOvlA[g].refBox)){this.checkOvlA[g].bBox=null;this.checkOvlA[g].setDisplay("none");continue}f=!0;g=0}}b.bbNode&&b.scaleBackground()}};var __checkOverlapBox=function(a,b){return!a||!b||a.x+a.width<b.x||a.x>b.x+b.width||a.y+a.height<b.y||a.y>b.y+b.height?!1:!0};
Map.Label.prototype.adaptLabelToScaling=function(a,b){this.killProcess=!1;b||(b=SVGRootElement);this.fAdaptLabelToScalingPending=!1;this.ALTS_nodeA=[];this.ALTS_textA=[];this.ALTS_rootNode=b;var c=this.ALTS_nodeA,d=null,e=map.Tiles.getTileInfo();if(e)for(var f=0;f<e.length;f++)if("inline"==e[f].tileGroup.style.getPropertyValue("display"))for(var d=e[f].tileGroup.getElementsByTagName("textPath"),g=0;g<d.length;g++)d.item(g).parentNode.getAttributeNS(null,"id").match(/:bg/)||d.item(g).parentNode.getAttributeNS(null,
"id").match(/:linedecoration/)||(c[c.length]=d.item(g));if(null==c||0===c.length)for(d=SVGRootElement.getElementsByTagName("textPath"),f=0;f<d.length;f++)d.item(f).parentNode.getAttributeNS(null,"id").match(/:bg/)||d.item(f).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||(c[c.length]=d.item(f));map.pushAction("map.Label.execAdaptLabelToScaling(0)")};
Map.Label.prototype.execAdaptLabelToScaling=function(a){for(var b=new Map.Sleep("map.Label.execAdaptLabelToScaling",25,""),c=this.ALTS_nodeA,d=this.ALTS_rootNode,e=null;a<c.length;a++){if(b.checkSleep(a,10))return;var f=c[a].getAttributeNS(szXlink,"href"),f=f.substr(1,f.length-1),g=d.getElementById(f);if(g){var h=g.parentNode.getAttributeNS(null,"id"),e=map.Tiles.getMasterId(h),h=map.Tiles.getTileId(h);if(!1===map.Layer.isScaleDependentLayerOn(e))c[a].parentNode.style.setProperty("display","none",
"");else if(e=c[a].firstChild.nodeValue,!(this.ALTS_textA[e+h]&&1>=map.Tiles.getTileNodes(map.Tiles.getMasterId(f)).length)){var l=map.Dom.getBox(g);c[a].setAttributeNS(szXlink,"href","");c[a].parentNode.style.setProperty("display","inline","");c[a].parentNode.style.setProperty("font-stretch","normal","");var k=map.Dom.getBox(c[a].parentNode);c[a].setAttributeNS(szXlink,"href","#"+f);var k=Math.sqrt(k.width*k.width+k.height*k.height),w=Math.sqrt(l.width*l.width+l.height*l.height),v=c[a].parentNode,
n=SVGDocument.getElementById(v.getAttributeNS(null,"id")+":bg");n&&n.style.setProperty("display","inline","");if(.9*k<w){if(1.3*k<w?(v.style.setProperty("font-stretch","normal",""),n&&n.style.setProperty("font-stretch","normal","")):(v.style.setProperty("font-stretch","narrower",""),n&&n.style.setProperty("font-stretch","narrower","")),fCheckLabelOnlyOne){var u=map.Scale.getMapOffset(g);l.x+=u.x;l.y+=u.y;u=getTranslate(g);l.x+=u.x;l.y+=u.y;g=new box(l.x,l.y,l.width,l.height);g.scale(k/w,k/w);map.Zoom.isCompletelyVisibleBox(g)?
fTileTextNoClip?this.ALTS_textA[e]=f:this.ALTS_textA[e+h]=f:(v.style.setProperty("display","none",""),n&&n.style.setProperty("display","none",""))}}else v.style.setProperty("display","none",""),n&&n.style.setProperty("display","none","")}}}__adaptLabelToSymbols(null,d)};var __adaptLabelToSymbols=function(a,b){};
Map.Label.prototype.getLabel=function(a){if(!SVGDocument.getElementById(a)){var b=map.Tiles.getTileNodes(map.Tiles.getMasterId(a));if(1>b.length)return null;for(var c=0;c<b.length;c++){var d=this.getLabel(b[c].getAttributeNS(null,"id"));if(d)return d}}a=SVGDocument.getElementById(a);if(!a)return null;if("g"==a.tagName)for(b=a.childNodes,c=0;c<b.length;c++)if(1==b.item(c).nodeType){a=b.item(c);break}b=null;if(b=a.getAttributeNS(null,"id"))if(b.match(/#/)?(b=b.split("#"),b=SVGDocument.getElementById(b[0]+
"T#"+b[1])):b=SVGDocument.getElementById(b+"T"),b)return b.firstChild.nodeValue;return a.getAttributeNS(szMapNs,"tooltip")};Map.Sleep=function(a,b,c){this.szFunction=a;this.initCheckSleep(b,c);this.fShowProgressBar=this.fEnableProgressBar=!1;this.nCount=0;this.szCancel="__cancelSleep()"};
Map.Sleep.prototype.initCheckSleep=function(a,b){this.checkSleepMaxCount=a;this.checkSleepCount=0;this.checkSleepMessage=b;this.runningTime=0;this.fShowProgressBar=this.fMessageDisplay=!1;"string"==typeof this.checkSleepMessage&&this.checkSleepMessage.length&&(fExecuteSilent||displayMessage(this.checkSleepMessage,1E3));__timer_reset()};
Map.Sleep.prototype.checkSleep=function(a,b){if(this.checkSleepMaxCount&&this.checkSleepCount++>=this.checkSleepMaxCount){this.checkSleepCount=0;var c=this.szFunction+"('"+String(a)+"')";this.fShowProgressBar?(this.runningTime=__timer_getSEC(),executeWithProgressBar(c,this.nDoneCount,this.nCount,this.checkSleepMessage,this.szCancel,this.runningTime)):(this.fMessageDisplay||(fExecuteSilent||displayMessage(this.checkSleepMessage,1E3),this.fMessageDisplay=!0),setTimeout(c,b?b:1));return!0}return!1};
Map.Sleep.prototype.checkSleepMS=function(a,b){return this.checkSleepMaxCount&&__timer_getMS()>this.checkSleepMaxCount?(__timer_reset(),setTimeout(this.szFunction+"('"+String(a)+"')",b?b:1),!0):!1};function __cancelSleep(){alert("cancel sleep")}
Map.Tiles=function(){var a=SVGDocument.getElementsByTagNameNS(szMapNs,"tiles");a.length&&(this.tilesNode=SVGDocument.getElementsByTagNameNS(szMapNs,"maptiles"),this.dataNode=a.item(0),this.nCount=this.dataNode.getAttributeNS(null,"count"),this.tileWidth=this.dataNode.getAttributeNS(null,"width"),this.tileHeight=this.dataNode.getAttributeNS(null,"height"),this.tilesRoot=this.dataNode.getAttributeNS(null,"root").split(".")[0],this.tilesSuffix=this.dataNode.getAttributeNS(null,"root").split(".")[1],
this.depUpper=this.dataNode.getAttributeNS(null,"upper"),this.depLower=this.dataNode.getAttributeNS(null,"lower"),fMarkTiles&&this.markTiles(),this.xLoader=null,this.fDiscardPending=!1)};Map.Tiles.prototype=new Map;Map.Tiles.prototype.getTileNodes=function(a){var b=[];a=this.getTileNodeIds(a);for(var c=0;c<a.length;c++){var d=SVGDocument.getElementById(a[c]);d&&(b[b.length]=d)}return b};
Map.Tiles.prototype.getTileNodeIds=function(a){var b=a.split(":");a=b[0];for(var c="",d=1;d<b.length;d++)c+=":"+b[d];b=[];for(d=0;d<this.nCount;d++)for(var e=0;e<this.nCount;e++)b[b.length]=a+"#"+this.buildTileExtension(e,d)+c;return b};
Map.Tiles.prototype.getTilePositions=function(){for(var a=map.Scale.origMinX,b=map.Scale.origMinY,c=[],d=0;d<this.nCount;d++)for(var e=0;e<this.nCount;e++)if(e<this.nCount&&d<this.nCount){var f=new box(a+e*this.tileWidth,b+d*this.tileHeight,this.tileWidth,this.tileHeight);c[c.length]=f}return c};
Map.Tiles.prototype.getTileBox=function(a){var b=a.split("#")[1];if(null==b||0>=b.length)return null;a=Number(b.substr(0,3));b=Number(b.substr(3,3));return new box(b*this.tileWidth-map.Scale.mapOffset.x,a*this.tileHeight-map.Scale.mapOffset.x,this.tileWidth,this.tileHeight)};
Map.Tiles.prototype.getTileInfo=function(){for(var a=map.Scale.origMinX,b=map.Scale.origMinY,c=[],d=1,e=Math.floor(this.nCount/2);e<=this.nCount&&0<=e;){for(var f=1,g=Math.floor(this.nCount/2);g<=this.nCount&&0<=g;){if(g<this.nCount&&e<this.nCount){var h=this.tilesRoot+"_"+this.buildTileExtension(g,e)+"."+this.tilesSuffix,l="tile"+this.buildTileExtension(g,e),k=SVGDocument.getElementById(l),w=new box(a+g*this.tileWidth,b+e*this.tileHeight,this.tileWidth,this.tileHeight);c[c.length]={szUrl:h,szGroup:l,
tileGroup:k,x:g,y:e,bBox:w};h=this.tilesRoot+"_"+this.buildTileExtension(g,e)+"_ncl."+this.tilesSuffix;l="tile"+this.buildTileExtension(g,e)+":noclip";(k=SVGDocument.getElementById(l))&&(c[c.length]={szUrl:h,szGroup:l,tileGroup:k,x:g,y:e,bBox:w})}g+=f;f=Math.abs(f)+1;0===(f&1)&&(f=-f)}e+=d;d=Math.abs(d)+1;0===(d&1)&&(d=-d)}var a=c.length,d=b=0,v;for(v in c)c[v].tileGroup&&(c[v].tileGroup.hasChildNodes()&&b++,"inline"==c[v].tileGroup.style.getPropertyValue("display")&&d++);_STATUS("Tiling: "+a+"/"+
b+"/"+d);return c};Map.Tiles.prototype.getMasterId=function(a){if(null==a)return null;a=a.split(":");for(var b=a[0].split("#")[0],c=1;c<a.length;c++)b+=":"+a[c];a.length=0;return b};Map.Tiles.prototype.getTileId=function(a){if(null==a)return null;a=a.split(":");var b=a[0];a.length=0;return b};Map.Tiles.prototype.buildTileExtension=function(a,b){return __maptheme_formatpart(b,"0")+__maptheme_formatpart(a,"0")};
Map.Tiles.prototype.setShapeStyle=function(a,b){if(a&&this.nCount){var c=new MapObject(a);if(null!=c)for(var c=this.getMasterId(c.szId),d=c.split(":")[0],c=c.substr(d.length,c.length-d.length),d=this.getTileNodeIds(d),e=0;e<d.length;e++){var f=SVGDocument.getElementById(d[e]+c);f&&f.setAttributeNS(null,"style",b)}}};
Map.Tiles.prototype.markTiles=function(){var a=SVGDocument.getElementById("maptilesbg");if(a)for(var b=0;b<this.nCount;b++)for(var c=0;c<this.nCount;c++)map.Dom.newShape("rect",a,-this.tileWidth*this.nCount/2+c*this.tileWidth,-this.tileHeight*this.nCount/2+b*this.tileHeight,this.tileWidth,this.tileHeight,"fill:none;stroke:gray;stroke-width:0.01")};
Map.Tiles.prototype.switchScaleDependentTiles=function(a){if(fDynamicTiles&&!this.clearTiles(a)){var b=!1;if(0<this.nCount){getMatrix(map.Zoom.canvasNode);var c=map.Scale.origMinX,d=map.Scale.origMinY,e=map.Zoom.getBox(),f=this.getTileInfo();if(f)for(var g=0;g<f.length;g++){var h=f[g].szUrl,l=f[g].szGroup,k=f[g].x,w=f[g].y,v=f[g].bBox,n=f[g].tileGroup;n&&((k=new box(c+k*this.tileWidth,d+w*this.tileHeight,this.tileWidth,this.tileHeight),k.x==v.x&&k.y==v.y&&k.width==v.width&&k.height==v.height||alert("switchScaleDependentTiles box error !!"),
k.x+k.width<e.x||k.y+k.height<e.y||k.x>e.x+e.width||k.y>e.y+e.height)?n.hasChildNodes()&&("external"==n.getAttributeNS(szMapNs,"type")?(n.style.setProperty("display","none",""),fDiscardTiles&&"delayed"!=fDiscardTiles&&(map.Themes.removeFromThemeNodesCache(n),map.Dom.clearGroup(n))):n.style.setProperty("display","none","")):n.hasChildNodes()||"external"!=n.getAttributeNS(szMapNs,"type")?"inline"!=n.style.getPropertyValue("display")&&(n.style.setProperty("display","inline",""),b=!0,fAdaptLabelToScaling&&
map.Layer.adaptLabelToScaling(a,n)):(n.style.setProperty("display","inline",""),setTimeout("map.Tiles.loadScaleDependentTiles('"+l+"','"+h+"')",10)))}}"delayed"==fDiscardTiles&&this.discardTiles();b&&(map.Layer.adaptLabel(a,map.Layer.layerNode),map.Layer.doStoredFeatureScaling())}};
Map.Tiles.prototype.loadScaleDependentTiles=function(a,b){_STATUS("Loading Tile:"+b+","+a);var c=SVGDocument.getElementById(a);this.xLoader||(this.xLoader=new SVGLoaderTiles);this.xLoader.importSVGFile(b,SVGDocument,c,null)&&(fTilesLoaded=!0)};Map.Tiles.prototype.isLoading=function(){return this.xLoader?this.xLoader.isLoading():!1};
Map.Tiles.prototype.clearTiles=function(a){if(!fDynamicTiles)return!1;try{for(var b in map.Layer.listA){var c=map.Layer.listA[b];if(c.szFlag.match(/tiled/)&&map.Themes.isThemeLayerUsed(c.szName)&&map.Layer.isScaleDependentLayerOn(c.szName))return!1}}catch(d){}if(0<this.nCount){a=1E11;b=0;var c=this.depUpper,e=this.depLower;c&&c.length&&(a=Number(c.split(":")[1]));e&&e.length&&(b=Number(e.split(":")[1]));if(map.Scale.nTrueMapScale*map.Scale.nZoomScale>=b&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=
a)return!1;if(a=this.getTileInfo())for(b=0;b<a.length;b++)(c=a[b].tileGroup)&&c.hasChildNodes()&&(c.style.setProperty("display","none",""),fDiscardTiles&&"delayed"!=fDiscardTiles&&(map.Themes.removeFromThemeNodesCache(c),map.Dom.clearGroup(c)))}"delayed"==fDiscardTiles&&this.discardTiles();return!0};Map.Tiles.prototype.discardTiles=function(a){fTilesLoaded&&fDiscardTiles&&!this.fDiscardPending&&(setTimeout("map.Tiles.doDiscardTiles()",5E3),this.fDiscardPending=!0)};
Map.Tiles.prototype.doDiscardTiles=function(a){if(fDynamicTiles&&fTilesLoaded)if(mouseObject)setTimeout("map.Tiles.doDiscardTiles()",6E3);else{if(map.Tiles&&0<map.Tiles.nCount&&(a=map.Tiles.getTileInfo()))for(var b=0;b<a.length;b++){var c=a[b].tileGroup;if(c&&"none"==c.style.getPropertyValue("display")&&c.hasChildNodes()){map.Themes.removeFromThemeNodesCache(c);map.Dom.clearGroup(c);setTimeout("map.Tiles.doDiscardTiles()",2E3);return}}this.fDiscardPending=!1}else this.fDiscardPending=!1};
Map.Tiles.prototype.isAnyTiledLayerVisible=function(){for(var a in map.Layer.listA){var b=map.Layer.listA[a];if(b.szFlag.match(/tiled/)&&(!0===b.nState||"none"!=b.szDisplay||"none"!=b.szDisplayLabel))return!0}return!1};Map.Tiles.prototype.allTilesLoaded=function(){var a=this.getTileInfo();if(a){var b=a.length,c=0,d;for(d in a)a[d].tileGroup&&a[d].tileGroup.hasChildNodes()&&c++;return b==c}return!1};
Map.Tiles.prototype.isAnyLayerTileLoaded=function(a){if(a=this.getTileInfo())for(var b in a)if(a[b].tileGroup&&a[b].tileGroup.hasChildNodes())return!0;return!1};Map.Event=function(){this.fPanDone=!1;this.onoverShape=null;this.fMouseDown=!1;this.contextMenuObj=null;this.onoverPopup=!1;this.tooltipDone=this.popupContextObj=null};Map.Event.prototype=new Map;
Map.Event.prototype.initUseNodes=function(a){if(a&&(a=a.getElementsByTagName("use"))&&a.length)for(var b=0;b<a.length;b++)a.item(b).style.setProperty("pointer-events","none","")};Map.Event.prototype.resolveInstance=function(a){if(!a)return null;if("undefined"!=typeof a.nodeType)return a;for(;a.parentNode&&"undefined"==a.correspondingUseElement;)a=a.parentNode;return a.correspondingUseElement};Map.Event.prototype.stopMouseEvent=function(a){a&&(a.stopPropagation(),a.preventDefault())};
Map.Event.prototype.defaultMouseOver=function(a){if(a&&a.target){var b=this.resolveInstance(a.target);if(1==b.nodeType){var c=new MapObject(b);if(c&&c.szId&&c.szId.match(/widget/))widgetList.onMouseOver(a);if(!this.fMouseDown||!this.fMouseDownMoved){if("idle"==szMapToolType)try{if(!c){HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();return}var d=c.szId;if(!(d.match(/legend/)||d.match(/tool/)||d.match(/button/)||d.match(/widget/)||d.match(/movable/)||d.match(/checked/)||d.match(/unchecked/))){HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();
return}}catch(e){}if(""!==szMapToolType){SVGPopupGroup.fu.isContained(b)||SVGFixedGroup.fu.isContained(b)?(this.popupContextObj&&__normalHighlight(a,this.popupContextObj),this.onoverPopup=!0):this.onoverPopup=!1;if("clickinfo"==szMapToolType)try{if(c.szId.match(/text/i)&&(c=new MapObject(b.parentNode)),c.szId.match(/:chart:box/i)&&(d=c.szId.split(":chart:box")[0]+":chartgroup",c=new MapObject(c.objNode.ownerDocument.getElementById(d))),szMapToolType="",HTMLWindow.ixmaps.htmlgui_onItemClick(c.szId))return __circleHighlight(a,
c),SVGPopupGroup.fu.clear(),killTooltip(),HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle(),null}catch(f){}if(this.onoverPopup||!__normalHighlight(a,b)||"info"!==szMapToolType&&"clickinfo"!==szMapToolType&&""!==szMapToolType)__simpleHighlight(a,b),this.tooltipDone=displayTooltip(a,b),this.onoverShape=b;else{displayInfo(a,b,"delayed|pointer");this.onoverShape=b;try{highlightTheme(new MapObject(b))}catch(g){}}try{"mapbackground:eventrect"==b.getAttributeNS(null,"id")&&HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(h){}}}}}};
var __simpleHighlight=function(a,b){if(b)try{var c=b.getAttributeNS(szMapNs,"origstyle");if(!c||"null"==c){var d=b.getAttributeNS(szMapNs,"onoverstyle");d&&(b.setAttributeNS(szMapNs,"origstyle",b.getAttributeNS(null,"style")),b.setAttributeNS(null,"style",d))}}catch(e){}},__simpleHighlightRemove=function(a,b){if(b)try{var c=b.getAttributeNS(szMapNs,"origstyle");c&&2<c.length&&(b.removeAttributeNS(szMapNs,"origstyle"),b.setAttributeNS(null,"style",c))}catch(d){}},__normalHighlight=function(a,b){var c=
new MapObject(b);if(null==c)return!1;var d=!0,e=null,c=c.szId;if(0===c.length||c.match(/legend/)||c.match(/background/)||c.match(/button/)||c.match(/widget/)||c.match(/textgrid/)||"clickinfo"!=szMapToolType&&"info"!=szMapToolType&&""!==szMapToolType)return highLightList&&highLightList.removeAll(),!1;if(highLightList&&!highLightList.checkItem(b)){c=b;"g"!=c.nodeName&&(c=c.parentNode);if((c=c.getAttributeNS(null,"id"))&&!c.match(/chartgroup/)&&_activeTheme!=map.Tiles.getMasterId(c.split(":")[0]))if(d=
map.Layer.getLayerObj(c),!d||!d.szSelection||map.Event.tooltipDone||"clickinfo"!=szMapToolType&&"info"!=szMapToolType&&""!==szMapToolType||displayTooltipText(a,map.Dictionary.getLocalText("click to activate")),fHighlightHint)e="hint",d=!1;else return!1;highLightList.removeAll();for(var c=map.Layer.getLayerItemNodes(b),f=0;f<c.length;f++)highLightList.addItem(c[f],e)}return d},__circleHighlight=function(a,b){b.objNode||(b=new MapObject(b));if(!b.objNode)return!1;highLightList&&!highLightList.checkItem(b.objNode)&&
(highLightList.unlock(),highLightList.removeAll(),highLightList.addItem(b.objNode,__isChart(null,b.objNode)?"isolate":""),highLightList.lock())},__isChart=function(a,b){var c=new MapObject(b);return c.szId.match(/chartgroup/)||c.szId.match(/chart:box/)?(c=map.Themes.getTheme(c.szId.split(":")[0]))&&c.szFlag&&c.szFlag.match(/BUFFER/)?!1:!0:!1};
Map.Event.prototype.defaultMouseOut=function(a){if(a&&a.target){var b=this.resolveInstance(a.target),c=new MapObject(b);if(c&&c.szId&&c.szId.match(/widget/))widgetList.onMouseOut(a);__simpleHighlightRemove(a,b);this.onoverShape&&removeInfo(a,this.onoverShape);this.onoverShape&&!_activeItem&&(highLightList.removeItem(this.onoverShape),this.onoverShape=null,highlightThemeRemove());killTooltip();killInfo()}};
Map.Event.prototype.defaultMouseClick=function(a){if(a&&a.target){var b=this.resolveInstance(a.target);if(b&&1==b.nodeType){var c=new MapObject(b);if(b==this.ondownShape)if(5<this.fMouseDownMoved)this.fMouseDownMoved=0;else{c=b.parentNode;if("a"==c.nodeName){c=c.getAttributeNS(szXlink,"href");try{HTMLWindow.ixmaps.htmlgui_popupWindow(c),this.stopMouseEvent(a)}catch(d){}}c=new MapObject(b);if(null!=c){var e=c.objNode,f=c.szId;try{if(map.User.onClick(a,f))return null}catch(g){}try{if(HTMLWindow.ixmaps.htmlgui_onItemClick(f))return __circleHighlight(a,
c),SVGPopupGroup.fu.clear(),killTooltip(),null}catch(h){}if(f){if(widgetList.onClick(a))return;try{"mapbackground:eventrect"==f&&HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(l){}}map.Legend&&map.Legend.legendMouseClick(a,e)?this.stopMouseEvent(a):!e||1!=e.nodeType||!e.parentNode||1!=e.parentNode.nodeType||map.Legend&&map.Legend.legendMouseClick(a,e.parentNode)||!(f=e.parentNode.getAttributeNS(null,"id"))||"PopupGroup"==f||f.match(/widget/)||!fActivateInfoOnClick&&"info"!=szMapToolType&&"clickinfo"!=
szMapToolType&&""!==szMapToolType&&"zoomrect"!=szMapToolType||(isActiveTheme(map.Layer.getLayerName(f))?(SVGPopupGroup.fu.clear(),displayInfo(a,b,"add|fix|pointer")):(activateTheme(f.split(":")[0]),szMapToolType.match(/select/),map.Zoom.cancel(),this.defaultMouseOver(a),killTooltip()))}}}}};
Map.Event.prototype.defaultMouseDown=function(a){if(a&&a.target&&!map.fInitializing){var b=this.resolveInstance(a.target);if(2==a.button)this.contextMenuObj=b,this.contextMenuCurrentObj=a.currentTarget,__setContextMenu(a);else if(!a.button||0===a.button){this.fMouseDown=!0;this.ondownShape=b;this.fMouseDownMoved=0;var c=new MapObject(b);if(null!=c){b=c.objNode;c=String(c.szId);try{if(map.User.onMouseDown(a,c))return null}catch(d){}this.stopMouseEvent(a);widgetList.onMouseDown(a);if(c.match(/movabley/))mouseObject=
new MouseObject(a,b,"yonly");else if(c.match(/movablex/))mouseObject=new MouseObject(a,b,"xonly");else if(c.match(/movable/))mouseObject=new MouseObject(a,b);else if(c.match(/maptoolnode/))mapToolList.onMouseDown(a);else if(c.match(/widget/))widgetList.onMouseDown(a);else c.match(/legend/)?(a=c.split(":"),2<a.length&&b.ownerDocument.getElementById(a[2])&&("minus"==a[1]&&setTimeout("__opacityMinus('"+a[2]+"')",200),"plus"==a[1]&&setTimeout("__opacityPlus('"+a[2]+"')",200))):(a.shiftKey||a.altKey||
a.crtlKey||!map.Layer.isMapObject(b)||szMapToolType&&""!==szMapToolType&&new MapTool(a,szMapToolType),a.shiftKey&&!a.altKey&&!a.crtlKey&&map.Layer.isMapObject(b)&&(""===szMapToolType?new MapTool(a,"pan"):new MapTool(a,szMapToolType)),!fTriggerMouseMoveForPan||c.match(/legend/)||c.match(/tool/)||c.match(/button/)||c.match(/widget/)||c.match(/movable/)||c.match(/checked/)||c.match(/unchecked/)||"info"!=szMapToolType&&""!==szMapToolType||(this.triggerMoveForPan=!0))}}}};
Map.Event.prototype.defaultMouseUp=function(a){if(a&&a.target&&!map.fInitializing){this.stopMouseEvent(a);try{if(map.User.onMouseUp(a))return null}catch(b){}this.fMouseDown=!1;if(mouseObject){try{mouseObject.onMouseUp(a)}catch(c){}mouseObject=null}widgetList.onMouseUp(a);this.triggerMoveForPan=!1}};
Map.Event.prototype.defaultMouseMove=function(a){if(a&&a.target&&!map.fInitializing){var b=this.resolveInstance(a.target);this.triggerMoveForPan&&this.fMouseDownMoved&&(new MapTool(a,"pan"),this.triggerMoveForPan=!1);if(!mouseObject)try{var c=(new MapObject(b)).objNode.getAttributeNS(null,"id");if(!(c.match(/legend/)||c.match(/tool/)||c.match(/button/)||c.match(/widget/)||c.match(/movable/)||c.match(/checked/)||c.match(/unchecked/)||"idle"!=szMapToolType&&"mapbackground:eventrect"!=c)){HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();
return}}catch(d){}this.stopMouseEvent(a);if(mouseObject)try{mouseObject.onMouseMove(a)}catch(e){}this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null));this.fMouseDownMoved+=this.fMouseDown?1:0;widgetList.onMouseMove(a)}};var __fShiftDone=!1,__szOldMapToolType=null;
Map.Event.prototype.defaultKeyDown=function(a){!a||__fShiftDone||!a.shiftKey||a.altKey||a.crtlKey||(__szOldMapToolType=szMapToolType,"pan"==szMapToolType?setMapTool("zoomrect"):"zoomrect"==szMapToolType?setMapTool("pan"):"info"==szMapToolType&&setMapTool("pan"),__fShiftDone=!0)};Map.Event.prototype.defaultKeyUp=function(a){!a||!__fShiftDone||a.shiftKey||a.altKey||a.crtlKey||(setMapTool(__szOldMapToolType),__fShiftDone=!1)};
Map.Event.prototype.doDefaultZoom=function(a){if(!fFroozeDynamicContent){SVGNotifyGroup.fu.clear();try{map.Themes.getTheme().unlabelMap()}catch(b){}map.showMap();var c=SVGRootElement.getAttribute("viewBox").split(" "),d=SVGOrigViewBoxString.split(" "),d=1/(Number(d[2])/Number(c[2]));if(c=map.Scale.zoomNode)var e=getMatrix(c),d=d/e[0];map.Scale.oldZoomScale=map.Scale.nZoomScale;map.Scale.oldMapCenter=map.Scale.mapCenter;map.Scale.nZoomScale!=d&&(map.Dom.clearGroup(SVGToolsGroup),map.Dom.clearGroup(SVGFixedGroup),
map.removeAllHighlights());map.Scale.nZoomScale=d;map.Scale.mapCenter=new point(e[4],e[5]);if(!1===fPanByViewer){if(0!==SVGRootElement.currentTranslate.x||0!==SVGRootElement.currentTranslate.y){var c=map.Scale.zoomNode,e=getMatrix(c),d=e[0],f=e[3],g=map.Scale.rotatePoint(SVGRootElement.currentTranslate);SVGRootElement.currentTranslate.x=g.x;SVGRootElement.currentTranslate.y=g.y;g=e[4]+map.Scale.scaleX(SVGRootElement.currentTranslate.x);e=e[5]+map.Scale.scaleY(SVGRootElement.currentTranslate.y);c.setAttributeNS(null,
"transform","matrix("+d+" 0 0 "+f+" "+g+" "+e+")");map.Scale.mapCenter=new point(g,e);SVGRootElement.currentTranslate.x=0;SVGRootElement.currentTranslate.y=0}}else{if(e=SVGDocument.getElementById("mapcliprect"))e.setAttributeNS(null,"x",map.Scale.scaleX(-SVGRootElement.currentTranslate.x)),e.setAttributeNS(null,"y",map.Scale.scaleY(-SVGRootElement.currentTranslate.y)),e.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),e.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()));
if(e=SVGDocument.getElementById("mapbackground:eventrect"))e.setAttributeNS(null,"x",map.Scale.scaleX(-SVGRootElement.currentTranslate.x)),e.setAttributeNS(null,"y",map.Scale.scaleY(-SVGRootElement.currentTranslate.y)),e.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),e.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()))}a&&antiZoomAndPanList.adjustGroups(a);Math.abs(map.Scale.oldZoomScale-map.Scale.nZoomScale)>map.Scale.oldZoomScale/100?("delayed"==
fFeatureScaling?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+"')",1E3):map.Layer.changeFeatureScaling(a,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&"delayed"==fDynamicLayer?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(a),displayScale(a)):"delayed"==fDynamicTiles?setTimeout("map.Layer.doStoredFeatureScaling()",500):map.Layer.doStoredFeatureScaling(a);"delayed"==fDynamicTiles?setTimeout("map.Tiles.switchScaleDependentTiles(null)",
500):map.Tiles.switchScaleDependentTiles(a);if(map.Scale.oldZoomScale!=map.Scale.nZoomScale||10<Math.abs(map.Scale.oldMapCenter.x-map.Scale.mapCenter.x)||10<Math.abs(map.Scale.oldMapCenter.y-map.Scale.mapCenter.y)){try{HTMLWindow.ixmaps.htmlgui_onZoomAndPan(map.Scale.nZoomScale)}catch(h){}"delayed"==fDynamicTiles||"delayed"==fDynamicLayer?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",10);try{map.Scale.oldZoomScale!=map.Scale.nZoomScale?map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/
map.Scale.nZoomScale):setTimeout("map.Themes.actualizeActiveTheme("+map.Scale.oldZoomScale/map.Scale.nZoomScale+")",10)}catch(l){}try{HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale)),0,"BLANK"))}catch(k){}}zoomAndPanHistory.newItem();map.Scale.refreshCSSStyles()}};
Map.Event.prototype.doPrintZoom=function(a){map.Scale.nZoomScale/=5;map.Scale.oldZoomScale!=map.Scale.nZoomScale?("delayed"==fFeatureScaling?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+"')",1E3):map.Layer.changeFeatureScaling(a,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&"delayed"==fDynamicLayer?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(a),displayScale(a)):"delayed"==fDynamicTiles?setTimeout("map.Layer.doStoredFeatureScaling()",
500):map.Layer.doStoredFeatureScaling(a);"delayed"==fDynamicTiles?setTimeout("map.Tiles.switchScaleDependentTiles(null)",500):map.Tiles.switchScaleDependentTiles(a);if(map.Scale.oldZoomScale!=map.Scale.nZoomScale||map.Scale.oldMapCenter.x!=map.Scale.mapCenter.x||map.Scale.oldMapCenter.y!=map.Scale.mapCenter.y){"delayed"==fDynamicTiles||"delayed"==fDynamicLayer?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",10);try{map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/
map.Scale.nZoomScale)}catch(b){}}try{HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale)),0,"BLANK")),HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(map.Zoom.getEnvelopeString(),map.Scale.oldZoomScale!=map.Scale.nZoomScale)}catch(c){}map.Scale.refreshCSSStyles()};Map.Event.prototype.doDefaultResize=function(a){map&&map.Layer&&(map.Layer.switchScaleDependentLayer(a),displayScale(a))};
Map.Event.prototype.doDefaultPan=function(a){a&&!mouseObject&&(antiZoomAndPanList.adjustGroups(a),map.Event.fPanDone=!0)};Map.Event.prototype.doDefaultAdjustPan=function(a){this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null))};Map.Event.prototype.moveToFrontOfGroup=function(a){a&&a.currentTarget&&a.currentTarget.parentNode&&a.currentTarget!=a.currentTarget.parentNode.lastChild&&a.currentTarget.parentNode.appendChild(a.currentTarget)};
function History(){this.itemA=[];this.historyPointer=0;this.fSuspend=!1;this.newItem()}History.prototype.add=function(a){this.historyPointer=this.itemA.length;this.itemA[this.itemA.length]=a};History.prototype.newItem=function(){this.fSuspend?this.fSuspend=!1:this.add(new HistoryItem)};History.prototype.backwards=function(){0<this.historyPointer&&(this.fSuspend=!0,this.itemA.length=this.historyPointer,this.historyPointer--,this.itemA[this.historyPointer].exec())};
History.prototype.forwards=function(){this.historyPointer<this.itemA.length-1&&(this.fSuspend=!0,this.historyPointer++,this.itemA[this.historyPointer].exec())};History.prototype.clear=function(){this.itemA.length=0};function HistoryItem(){try{this.szEnvelope=map.Zoom.getEnvelopeString()}catch(a){}}HistoryItem.prototype.exec=function(){try{var a=this.szEnvelope.split("="),b=a[1].split("'")[1],c=a[2].split("'")[1],d=a[3].split("'")[1],e=a[4].split("'")[1];map.Zoom.doZoomMapToEnvelope(b,c,d,e)}catch(f){alert("History Item not valid")}};
InfoContainer=function(a,b,c,d,e,f,g){b&&c&&2<c.length&&(this.szId=c+":movable",this.objectNode=map.Dom.newGroup(b,this.szId),this.ptPosition=d,this.ptOffsetOrig=new point(e.x,e.y),this.ptOffset=e,this.szMode=f,this.szTitle=g,this.nFontheight=14,this.onRemove="",this.fClipped=!0,this.create())};
InfoContainer.prototype.create=function(){this.ptPosition||(this.ptPosition=new point(1E3,1E3));this.ptOffset||(this.ptOffset=new point(100,100));this.szMode||(this.szMode="");this.szMode.match(/left/)&&(this.ptOffset.x=-(2*this.ptOffset.x),this.ptOffset.y*=3);this.frameNode=map.Dom.newShape("rect",this.objectNode,0,0,map.Scale.normalX(10),map.Scale.normalY(10),"fill:#ffffff;stroke:black;stroke-width:"+map.Scale.normalX(0)+"");this.frameNode.setAttributeNS(null,"rx",map.Scale.normalX(2*nInfoRoundRect));
this.frameNode.setAttributeNS(null,"ry",map.Scale.normalX(2*nInfoRoundRect));SVGDocument.getElementById(szShadowFilterToolsId)&&this.frameNode.style.setProperty("filter","url(#"+szShadowFilterToolsId+")","");this.canvasNode=map.Dom.newGroup(this.objectNode,this.szId+":canvas");this.canvasNode.fu.setPosition(map.Scale.normalX(1),map.Scale.normalY(1));this.titleNode=map.Dom.newGroup(this.objectNode,this.szId+":title");this.titleTextNode=map.Dom.newGroup(this.titleNode,this.szId+":titletext");this.szTitle&&
map.Dom.newText(this.titleTextNode,map.Scale.normalX(10),map.Scale.normalY(this.nFontheight+10),"font-family:arial;font-size:"+map.Scale.normalY(this.nFontheight/4*3)+"px;fill:black;pointer-events:none",this.szTitle);if(this.scrollObj=new ScrollArea(null,this.canvasNode,null,10,10,10))this.scrollObj.reformat(),this.workspaceNode=this.scrollObj.workspaceNode;this.workspaceNode||(this.scrollObj=null,this.workspaceNode=map.Dom.newGroup(this.canvasNode,this.szId+":workspace"),this.workspaceClipRect=map.Dom.setClipRect(this.workspaceNode,
new box(0,0,10,10)));this.objectNode.setAttributeNS(null,"onclick","map.Event.moveToFrontOfGroup(evt)");this.objectNode.setAttributeNS(null,"ontouchend","map.Event.moveToFrontOfGroup(evt)");this.szMode.match(/fix/)?(this.deleteButton=new Button(this.titleNode,this.szId,"BUTTON","#delete_button","map.Dom.removeElementById('"+this.szId+"');","remove"),this.deleteButton.scale(1,1),this.deleteButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10))):this.szMode.match(/pin/)&&SVGDocument.getElementById("pin_button")&&
(this.pinButton=new Button(this.titleNode,this.szId,"BUTTON","#pin_button","doDisplayInfo("+this.ptPosition.x+","+this.ptPosition.y+",'pointer|fix');","","fix it"),this.pinButton.scale(1,1),this.pinButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10)));this.widgetObj=new Widget(this.objectNode,this)};
InfoContainer.prototype.setTitle=function(a,b){b||(b=map.Scale.tStyle.ContainerTitle);map.Dom.clearGroup(this.titleTextNode);(this.szTitle=a)&&map.Dom.newText(this.titleTextNode,map.Scale.normalX(10),1.3*b.nFontHeight,b.szStyle,this.szTitle);this.reformat()};
InfoContainer.prototype.reformat=function(){this.bBox=map.Dom.getBox(this.workspaceNode);this.tBox=map.Dom.getBox(this.titleTextNode);0>this.bBox.height&&(this.bBox.height=0);0>this.bBox.width&&(this.bBox.width=0);0>this.tBox.height&&(this.tBox.height=0);if(0!==this.bBox.width&&0!==this.bBox.height||this.szTitle&&this.szTitle.length){1==this.bBox.height&&(this.bBox.height=-200);var a=map.Scale.normalX(15+map.Scale.nButtonSize);if(this.fClipped)var a=Math.min(Math.max(this.bBox.width+a,this.tBox.width+
a),map.Scale.bBox.width/2),b=Math.min(this.bBox.height+this.tBox.height,map.Scale.bBox.height/2.4);else a=Math.max(this.bBox.width+a,this.tBox.width+a),b=this.bBox.y+this.bBox.height+this.tBox.height+map.Scale.normalY(10);b>map.Scale.bBox.height/4*5&&(a=Math.min(this.bBox.width+map.Scale.normalX(10)+map.Scale.normalY(10),map.Scale.bBox.width/2.4));a>map.Scale.bBox.width/4*5&&(b=Math.min(this.bBox.height+this.tBox.height+map.Scale.normalY(10),map.Scale.bBox.height/2.4));this.scrollObj?(this.scrollObj.setWidth(a/
map.Scale.normalX(1)-1),this.scrollObj.setHeight(b/map.Scale.normalY(1)),this.scrollObj.reformat(),this.scrollObj.hasScrollBars()?(b<this.bBox.height+map.Scale.normalX(this.scrollObj.nScrollBarWidth)&&(this.scrollObj.setHeight(b/map.Scale.normalY(1)+this.scrollObj.nScrollBarWidth+6),this.scrollObj.reformat(),b+=map.Scale.normalY(this.scrollObj.nScrollBarWidth+1)),this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(8)+this.tBox.height),a+=map.Scale.normalX(10)+map.Scale.normalX(7),
b+=map.Scale.normalY(2)+map.Scale.normalY(10)+map.Scale.normalY(5)+2*this.tBox.height):(this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(10)+1.3*this.tBox.height),b+=map.Scale.normalY(10)+this.tBox.height-map.Scale.normalY(7))):(this.workspaceClipRect.setAttributeNS(null,"width",a),this.workspaceClipRect.setAttributeNS(null,"height",b));var c=map.Scale.tStyle.ContainerTitle,c=map.Scale.normalY(map.Scale.nButtonSize/3)+c.nFontHeight/2,d=map.Scale.normalY(map.Scale.nButtonSize/
3);this.pinButton?this.pinButton.setPosition(a-d,c):this.deleteButton?this.deleteButton.setPosition(a-d,c):a-=map.Scale.normalX(map.Scale.nButtonSize);this.bBox.width=a;this.bBox.height=b;this.frameNode&&(this.frameNode.setAttributeNS(null,"width",this.bBox.width+2*map.Scale.normalX(5)),this.frameNode.setAttributeNS(null,"height",this.bBox.height+map.Scale.normalX(5)));this.shadowNode&&(this.shadowNode.setAttributeNS(null,"width",this.bBox.width+2*map.Scale.normalX(5)+map.Scale.normalX(.5)),this.shadowNode.setAttributeNS(null,
"height",this.bBox.height+map.Scale.normalX(5)+map.Scale.normalY(1)));a=map.Scale.getGroupOffset(this.objectNode);this.newPosition=map.Scale.clipWidgetObjectToSVG(this.objectNode,new point(this.ptPosition.x+a.x,this.ptPosition.y+a.y),this.ptOffsetOrig,this.bBox);this.newPosition.x-=a.x;this.newPosition.y-=a.y;this.objectNode.fu.setPosition(this.newPosition.x,this.newPosition.y);this.ptOffset.x=this.newPosition.x-this.ptPosition.x;this.ptOffset.y=this.newPosition.y-this.ptPosition.y;this.szMode.match(/pointer/)&&
this.makePointer()}else this.remove()};
InfoContainer.prototype.makePointer=function(){var a=this.ptOffset.y,b=map.Scale.normalX(15),c=map.Scale.normalX(10);map.Scale.normalX(5);this.pointerObj?(map.Dom.clearGroup(this.pointerObj),map.Dom.clearGroup(this.pointShObj)):(this.pointerObj=map.Dom.newGroup(this.objectNode),this.pointShObj=map.Dom.newGroup(this.objectNode),this.pointShObj.parentNode.insertBefore(this.pointShObj,this.pointShObj.parentNode.firstChild));0>this.ptOffset.y&&this.ptOffset.y>-this.bBox.height&&0>this.ptOffset.x&&this.ptOffset.x>
-this.bBox.width||(a=this.ptOffset.y+this.bBox.height/2,b=this.ptOffset.x+this.bBox.width/2,Math.abs(a)+this.bBox.width/2-this.bBox.height/2>Math.abs(b)?(b=0,this.ptOffset.x>2*-c&&(b=this.ptOffset.x+2*c),this.ptOffset.x<-this.bBox.width+2*c&&(b=this.ptOffset.x+this.bBox.width-2*c),0<a?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(b-map.Scale.normalX(8))+","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(20)+",0 z","fill:black;fill-opacity:0.2"),
map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(b-map.Scale.normalX(7.5))+","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(b-map.Scale.normalX(8))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(20)+",0 z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+
","+-this.ptOffset.y+" l "+(b-map.Scale.normalX(7.5))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white"))):(a=0,this.ptOffset.y>2*-c&&(a=this.ptOffset.y+2*c),this.ptOffset.y<-this.bBox.height+2*c&&(a=this.ptOffset.y+this.bBox.height-2*c),0<b?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+map.Scale.normalX(1))+","+(a-map.Scale.normalX(8))+" 0,"+map.Scale.normalX(20)+" z","fill:black;fill-opacity:0.2"),
map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+map.Scale.normalX(1))+","+(a-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(a-map.Scale.normalX(8))+" 0,"+map.Scale.normalX(20)+" z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+
","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(a-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white"))))};InfoContainer.prototype.onMouseMove=function(){if(this.fMouseDown){var a=this.objectNode.fu.getPosition();this.ptOffset.x+=a.x-this.beforeMovePosition.x;this.ptOffset.y+=a.y-this.beforeMovePosition.y;this.beforeMovePosition=this.objectNode.fu.getPosition();this.szMode.match(/pointer/)&&this.makePointer()}};
InfoContainer.prototype.onMouseUp=function(){var a=this.objectNode.fu.getPosition();this.ptOffset.x+=a.x-this.beforeMovePosition.x;this.ptOffset.y+=a.y-this.beforeMovePosition.y;this.fMouseDown=!1;this.szMode.match(/pointer/)&&this.makePointer()};InfoContainer.prototype.onMouseDown=function(){this.beforeMovePosition=this.objectNode.fu.getPosition();this.fMouseDown=!0};
InfoContainer.prototype.setOnRemove=function(a){this.deleteButton&&this.deleteButton.buttonNode&&this.deleteButton.setActionOn("map.Dom.removeElementById('"+this.szId+"');"+a)};InfoContainer.prototype.remove=function(){this.objectNode.parentNode.removeChild(this.objectNode);this.objectNode=null};InfoContainer.prototype.clear=function(){map.Dom.clearGroup(this.workspaceNode)};
var MouseObject=function(a,b,c,d){b&&(this.objNode=b,this.objNode.fu=new Methods(this.objNode),this.objStartPosition=this.objNode.fu.getPosition(),this.szFlag=c?c:"",this.parent=d);this.mouseStartPosition=a?map.Scale.getClientMousePosition(a,this.objNode):new point(0,0)};
MouseObject.prototype.onMouseMove=function(a){var b=map.Scale.getClientMousePosition(a,this.objNode);try{if(map.User.onMouseMove(a,this.objNode.getAttributeNS(null,"id"),b))return null}catch(c){}switch(this.szFlag){case "yonly":b.x=this.mouseStartPosition.x;break;case "xonly":b.y=this.mouseStartPosition.y}if(this.objNode&&!this.szFlag.match(/parentonly/)){var d=this.objNode.fu.getScale();this.objNode.fu.setPosition(this.objStartPosition.x+(b.x-this.mouseStartPosition.x)/d.x,this.objStartPosition.y+
(b.y-this.mouseStartPosition.y)/d.y)}if(this.parent)this.parent.onMouseMove(a)};MouseObject.prototype.onMouseUp=function(a){if(this.parent)this.parent.onMouseUp(a)};var Button=function(a,b,c,d,e,f,g){this.targetGroup=a;this.szId=b?b:"button:"+String(Math.random());this.szType=c?c:"SIMPLE";this.szStyle=d?d:"";this.szActionOn=e;this.szActionOff=f;this.szTooltip=g?g:"";this.draw()};
Button.prototype.draw=function(a){!this.szType.match(/SELECTED/)||this.szType.match(/CHECKBOX/)?(this.nodeObj=map.Dom.newGroup(this.targetGroup),this.nodeObj.setAttributeNS(null,"cursor","pointer"),a=map.Dom.constructNode("a",this.nodeObj,{}),this.shapeObj=map.Dom.newGroup(a)):this.shapeObj=this.nodeObj=map.Dom.newGroup(this.targetGroup);this.nodeObj.setAttributeNS(null,"id",this.szId+":button");if(this.szType.match(/CHECKBOX/)){a=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#unchecked_button"});
var b=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#checked_button"});a.setAttributeNS(null,"id",this.szId+":unchecked");b.setAttributeNS(null,"id",this.szId+":checked");this.szType.match(/SELECTED/)&&(this.checked=!0);this.szType.match(/SELECTED/)||(this.checked=!1,b.style.setProperty("display","none",""));a=map.Dom.newShape("rect",this.shapeObj,map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(map.Scale.nButtonSize),map.Scale.normalX(map.Scale.nButtonSize),
"fill:red;fill-opacity:0");a.setAttributeNS(null,"id",this.szId+":widget:eventrect");a.setAttributeNS(szMapNs,"tooltip",this.szTooltip);a.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)");new Widget(a,this)}else if(this.szType.match(/TEXTBUTTON/)){var c=this.szStyle;a=map.Scale.normalY(.6*map.Scale.nButtonSize);var d="font-family:arial;font-size:"+a+"px;fill:#444444;baseline-shift:-30%;pointer-events:none",e=a/2*c.length,b=null;this.szType.match(/SELECTED/)?b=map.Dom.newShape("rect",
this.shapeObj,-a/5,-a/3*2,e,a/5*6,"fill:#eeeeff;stroke:black;stroke-width:"+map.Scale.normalX(1)+";stroke-opacity:0.3"):(b=map.Dom.newShape("rect",this.shapeObj,-a/5,-a/3*2,e,a/5*6,"fill:white;stroke:none;opacity:0"),b.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),b.setAttributeNS(null,"onmouseout","map.Event.stopMouseEvent(evt)"),b.setAttributeNS(null,"onclick",this.szActionOn),b.setAttributeNS(null,"ontouchend",this.szActionOn),b.setAttributeNS(szMapNs,"tooltip",this.szTooltip));
c=map.Dom.newText(this.shapeObj,0,0,d,c);this.bBox=new box(-a/5,-a/3*2,c.getComputedTextLength()+a/5*2,a/5*6);b.setAttributeNS(null,"width",String(this.bBox.width));this.buttonNode=b}else this.szType.match(/BUTTON/)&&(a=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":this.szStyle}),a.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),a.setAttributeNS(null,"onmousedown","map.Event.stopMouseEvent(evt)"),a.setAttributeNS(null,"onclick",this.szActionOn),a.setAttributeNS(null,"ontouchend",
this.szActionOn),a.setAttributeNS(szMapNs,"tooltip",this.szTooltip),this.buttonNode=a)};Button.prototype.scale=function(a,b){this.nodeObj&&this.nodeObj.fu.scale(a,b)};Button.prototype.setPosition=function(a,b){this.nodeObj&&this.nodeObj.fu.setPosition(a,b)};Button.prototype.getPosition=function(a,b){if(this.nodeObj)return this.nodeObj.fu.getPosition()};Button.prototype.remove=function(){this.nodeObj&&this.nodeObj.parentNode.removeChild(this.nodeObj)};
Button.prototype.setActionOn=function(a){this.szActionOn=a;this.buttonNode&&(this.buttonNode.setAttributeNS(null,"onclick",this.szActionOn),this.buttonNode.setAttributeNS(null,"ontouchend",this.szActionOn))};Button.prototype.onClick=function(a){this.toggleCheckBox(a);map.Event.stopMouseEvent(a)};
Button.prototype.toggleCheckBox=function(a){a=SVGDocument.getElementById(this.szId+":checked");this.checked?(a.style.setProperty("display","none",""),eval(this.szActionOff)):(a.style.setProperty("display","inline",""),eval(this.szActionOn));this.checked=!this.checked};
var ScrollBar=function(a,b,c,d,e,f){a&&(this.hBar=this.vBar=0,this.vScale=this.hScale=1,this.maxBox=c,this.bWidth=d,this.bHeight=e,this.hThumb=c.width,this.vThumb=c.height,this.vValue=this.hValue=this.vThumbOffset=this.hThumbOffset=0,this.contObj=a,this.contBox=a=map.Dom.getBox(a),this.contObj.fu=new Methods(this.contObj),a.width+a.x<=c.width-c.x+1&&a.height+a.y<=c.height-c.y+1||(a.width+a.x>c.width-c.x&&(this.hBar=e),a.height+a.y>c.height-c.y-this.hBar&&(this.vBar=d),a.width+a.x>c.width-c.x-this.vBar&&
(this.hBar=e),this.vBar&&(this.maxBox.width-=this.vBar+f),this.hBar&&(this.maxBox.height-=this.hBar+f),this.hMax=this.maxBox.width-2*this.hBar,this.vMax=this.maxBox.height-2*this.vBar,this.hScale=(a.width+a.x)/this.maxBox.width,this.vScale=(a.height+a.y)/this.maxBox.height,1<this.hScale&&(this.hThumb=Math.floor(this.hMax/this.hScale),this.hThumbOffset=Math.min(this.hMax-this.hThumb,-(b.x/this.hScale)),this.hValue=-b.x/(a.width+a.x-this.maxBox.width)),1<this.vScale&&(this.vThumb=Math.floor(this.vMax/
this.vScale),this.vThumbOffset=Math.min(this.vMax-this.vThumb,-(b.y/this.vScale)),this.vValue=-b.y/(a.height+a.y-this.maxBox.height)),this.hThumbStyle="fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.3)+";opacity:0.3",this.vThumbStyle="fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalY(.3)+";opacity:0.3"))};
ScrollBar.prototype.draw=function(a){if(this.contObj){var b="fill:white;stroke:black;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0",c="fill:#e8e8f8;stroke:white;stroke-width:"+map.Scale.normalX(.5)+";opacity:1.0";map.Scale.normalX(2);var d="fill:white;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0";this.remove(a);if(1!=this.hScale||1!=this.vScale){a=map.Dom.newGroup(this.contObj.parentNode);a.setAttributeNS(null,"id","scrollwidget");this.scrollWidget=a;var e=null;1<this.vScale&&
1<this.hScale&&map.Dom.newShape("rect",a,this.maxBox.width,this.maxBox.height,this.bWidth+map.Scale.normalX(1),this.bHeight+map.Scale.normalX(1),b);if(1<this.hScale){map.Dom.newShape("rect",a,this.bWidth,this.maxBox.height,this.hMax,this.bHeight+map.Scale.normalX(.8),d);if(e=map.Dom.newShape("rect",a,this.bWidth,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepleft"),new Widget(e,this);if(e=map.Dom.newShape("rect",
a,this.bWidth+this.hMax/2,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepright"),new Widget(e,this);e=map.Dom.newShape("rect",a,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.hThumb-map.Scale.normalX(2)),Math.max(2,this.bHeight-map.Scale.normalY(2)),this.hThumbStyle?this.hThumbStyle:c);e.fu.setPosition(this.bWidth,this.maxBox.height);this.hThumbObj=new Slider(e,new box(0,0,this.hMax-this.hThumb,0));
this.hThumbObj.parent=this;this.hThumbObj.setValue(new point(this.hValue,0))}if(1<this.vScale){map.Dom.newShape("rect",a,this.maxBox.width+map.Scale.normalX(2),this.bHeight,this.bWidth-map.Scale.normalX(2),this.vMax,d);if(e=map.Dom.newShape("rect",a,this.maxBox.width,this.bHeight,this.bWidth,this.vMax/2,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepup"),new Widget(e,this);if(e=map.Dom.newShape("rect",a,this.maxBox.width,this.bHeight+this.vMax/2,this.bWidth,
this.vMax/2,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepdown"),new Widget(e,this);e=map.Dom.newShape("rect",a,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.bWidth-map.Scale.normalX(2)),Math.max(2,this.vThumb-map.Scale.normalY(2)),this.vThumbStyle?this.vThumbStyle:c);e.fu.setPosition(this.maxBox.width,this.bHeight);this.vThumbObj=new Slider(e,new box(0,0,0,this.vMax-this.vThumb));this.vThumbObj.parent=this;this.vThumbObj.setValue(new point(0,
this.vValue))}}else this.contObj.fu.setPosition(0,0)}};ScrollBar.prototype.hasScrollBars=function(a){return 1<this.vScale||1<this.hScale};ScrollBar.prototype.onMouseDown=function(a){};ScrollBar.prototype.onMouseMove=function(a){var b=a=0;1<this.hScale&&(a=this.hThumbObj.fraction.x);1<this.vScale&&(b=this.vThumbObj.fraction.y);this.contObj.fu.setPosition(-a*(this.contBox.x+this.contBox.width-this.maxBox.width),-b*(this.contBox.y+this.contBox.height-this.maxBox.height))};
ScrollBar.prototype.onMouseUp=function(a){};ScrollBar.prototype.onClick=function(a){if(a=new MapObject(a.target)){a=a.szId;var b=a.match(/big/)?map.Scale.normalX(100):map.Scale.normalX(5);a.match(/stepdown/)?this.vThumbObj.moveThumb(0,b):a.match(/stepup/)?this.vThumbObj.moveThumb(0,-b):a.match(/stepleft/)?this.hThumbObj.moveThumb(-b,0):a.match(/stepright/)&&this.hThumbObj.moveThumb(b,0)}};ScrollBar.prototype.remove=function(a){this.scrollWidget&&this.scrollWidget.parentNode.removeChild(this.scrollWidget)};
var Slider=function(a,b,c,d,e){this.szId=null;this.moveArea=b;this.scaleArea=c;this.value=new point(0,0);this.fraction=new point(0,0);this.onUp=this.onMove=null;e&&(this.valuesA=e.split(","));this.objNode=a;this.objNode.setAttributeNS(null,"id","widget:slider:"+String(Math.random()));a.fu=new Methods(a);this.ptNull=a.fu.getPosition();widgetList.add(this)};Slider.prototype.setMoveArea=function(a){this.moveArea=a};Slider.prototype.setId=function(a){this.szId=a};
Slider.prototype.onMouseOver=function(a){if(this.parent)try{this.parent.onMouseOver(a,this.szId,this)}catch(b){}};Slider.prototype.onMouseOut=function(a){if(this.parent)try{this.parent.onMouseOut(a,this.szId,this)}catch(b){}};
Slider.prototype.onMouseDown=function(a){mouseObject=0===this.moveArea.width?new MouseObject(a,this.objNode,"yonly"):0===this.moveArea.height?new MouseObject(a,this.objNode,"xonly"):new MouseObject(a,this.objNode,null);mouseObject.parent=this;if(this.parent)try{this.parent.onMouseDown(a,this.szId,this)}catch(b){}};
Slider.prototype.onMouseMove=function(a){var b=this.objNode.fu.getPosition();b.x=Math.min(b.x,this.ptNull.x+this.moveArea.x+this.moveArea.width);b.x=Math.max(b.x,this.ptNull.x+this.moveArea.x);b.y=Math.min(b.y,this.ptNull.y+this.moveArea.y+this.moveArea.height);b.y=Math.max(b.y,this.ptNull.y+this.moveArea.y);this.objNode.fu.setPosition(b.x,b.y);this.value=new point(0,0);0<this.moveArea.width&&(this.value.x=b.x-this.ptNull.x,this.fraction.x=this.value.x/this.moveArea.width);0<this.moveArea.height&&
(this.value.y=b.y-this.ptNull.y,this.fraction.y=this.value.y/this.moveArea.height);if(this.parent)try{this.parent.onMouseMove(a,this.szId,this)}catch(c){}};Slider.prototype.onMouseUp=function(a){if(this.parent)try{this.parent.onMouseUp(a,this.szId,this)}catch(b){}};Slider.prototype.moveThumb=function(a,b){var c=this.objNode.fu.getPosition();c.x+=a;c.y+=b;this.objNode.fu.setPosition(c.x,c.y);this.onMouseMove()};
Slider.prototype.setValue=function(a){this.objNode.fu.setPosition(a.x*this.moveArea.width+this.ptNull.x,a.y*this.moveArea.height+this.ptNull.y);this.onMouseMove()};Slider.prototype.remove=function(){widgetList.removeWidget(this)};
var RotationSlider=function(a,b,c,d,e,f){this.circlethumb=map.Dom.newGroup(a.parentNode,"widget:rotationslider:thumb");this.circlethumb.setAttributeNS(null,"area","-1000,-1000,1000,1000");this.circlethumb.setAttributeNS(null,"range",c);this.circlethumb.setAttributeNS(null,"scale",d);this.nStep=e;this.nSnap=f;this.pBase=a.fu.getPosition();this.circlethumb.fu.setPosition(this.pBase.x,this.pBase.y);this.circlethumbNode=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(5),"fill:#ff0000;opacity:0.0;pointer-events:none");
this.circleOverNode2=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(6),"fill:none;stroke:#ffffff;stroke-width:"+map.Scale.normalX(11)+";opacity:0.6;pointer-events:none;display:none");this.circleOverNode=map.Dom.newShape("path",this.circlethumb,"M-"+map.Scale.normalX(5.5)+",0 a"+map.Scale.normalX(6)+","+map.Scale.normalX(6)+" 0 1,0 "+map.Scale.normalX(5)+","+-map.Scale.normalX(5),"fill:none;stroke:#888888;stroke-width:"+map.Scale.normalX(1)+";opacity:0.8;pointer-events:none;display:none");
setRotate(this.circleOverNode,45);setRotate(this.circleOverNode2,45);b=map.Dom.newNode("defs",this.circlethumb);b=map.Dom.newNode("marker",b);b.setAttributeNS(null,"id","Triangle");b.setAttributeNS(null,"refX","0");b.setAttributeNS(null,"refY","0");b.setAttributeNS(null,"orient","auto");b.setAttributeNS(null,"style","overflow:visible");b.setAttributeNS(null,"path","M 0 0 L "+map.Scale.normalX(10)+" "+map.Scale.normalX(5)+" L 0 "+map.Scale.normalX(10)+" z");this.circleOverNode.style.setProperty("marker-start",
"url(#Triangle)","");this.circleOverNode.style.setProperty("marker-end","url(#Triangle)","");this.objNode=a;this.objNode.setAttributeNS(null,"id","widget:slider:"+String(Math.random()));widgetList.add(this);this.isActive=!1};RotationSlider.prototype.setValue=function(a){setRotate(this.objNode,a)};RotationSlider.prototype.onMouseOver=function(a){this.circleOverNode.style.setProperty("display","inline","");this.circleOverNode2.style.setProperty("display","inline","");if(this.parent)try{this.parent.onMouseOver(a)}catch(b){}};
RotationSlider.prototype.onMouseOut=function(a){this.isActive||(this.circleOverNode.style.setProperty("display","none",""),this.circleOverNode2.style.setProperty("display","none",""));if(this.parent)try{this.parent.onMouseOut(a)}catch(b){}};
RotationSlider.prototype.onMouseDown=function(a){var b=map.Scale.getClientMousePosition(a,SVGToolsGroup);this.startPosition=new point(b.x-this.pBase.x,b.y-this.pBase.y);this.circlethumbNode.fu.setPosition(this.startPosition.x,this.startPosition.y);mouseObject=new MouseObject(a,this.circlethumbNode);mouseObject.parent=this;this.isActive=!0;if(this.parent)try{this.parent.onMouseDown(a)}catch(c){}};
RotationSlider.prototype.onMouseMove=function(a){if(this.isActive&&(setRotate(this.objNode,this.getAngle()),this.parent))try{this.parent.onMouseMove(a)}catch(b){}};RotationSlider.prototype.onMouseUp=function(a){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display","none","");if(this.parent){try{this.parent.onMouseUp(a)}catch(b){}this.objNode.style.setProperty("opacity","1.0","")}};
RotationSlider.prototype.onClick=function(a){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display","none","");setRotate(this.objNode,0);if(this.parent){try{this.parent.onClick(a)}catch(b){}this.objNode.style.setProperty("opacity","1.0","")}};
RotationSlider.prototype.getAngle=function(a){var b=this.circlethumbNode.fu.getPosition();a=b.x;var b=b.y,c=Math.sqrt(a*a+b*b),c=Math.asin(a/c)/Math.PI*180,c=isNaN(c)?180:c;0<=a&&0<=b&&(c=180-c);0>a&&0<=b&&(c=180-c);0>a&&0>b&&(c=360+c);this.nStep&&this.nSnap&&(c%this.nStep<this.nSnap?(c=Math.floor(c/this.nStep)*this.nStep,this.objNode.style.setProperty("opacity","1.0","")):this.objNode.style.setProperty("opacity","0.5",""));return c};var WidgetList=function(){this.widgetA=[]};
WidgetList.prototype.add=function(a){this.widgetA[this.widgetA.length]=a};WidgetList.prototype.getWidget=function(a){for(var b in this.widgetA)if(this.widgetA[b].objNode==a)return this.widgetA[b];return null};WidgetList.prototype.onMouseOver=function(a){var b=new MapObject(a.target);if(b){b=this.getWidget(b.objNode);try{b.onMouseOver(a)}catch(c){}try{b.owner.onMouseOver(a)}catch(d){}}};WidgetList.prototype.onMouseOut=function(a){var b=new MapObject(a.target);if(b){b=this.getWidget(b.objNode);try{b.onMouseOut(a)}catch(c){}try{b.owner.onMouseOut(a)}catch(d){}}};
WidgetList.prototype.onMouseDown=function(a){var b=new MapObject(a.target);if(b){b=this.getWidget(b.objNode);try{b.onMouseDown(a)}catch(c){}try{b.owner.onMouseDown(a)}catch(d){}}};WidgetList.prototype.onMouseUp=function(a){var b=new MapObject(a.target);if(b){b=this.getWidget(b.objNode);try{b.onMouseUp(a)}catch(c){}try{b.owner.onMouseUp(a)}catch(d){}}};WidgetList.prototype.onMouseMove=function(a){var b=new MapObject(a.target);if(b){b=this.getWidget(b.objNode);try{b.onMouseMove(a)}catch(c){}try{b.owner.onMouseMove(a)}catch(d){}}};
WidgetList.prototype.onClick=function(a){var b=new MapObject(a.target);if(b&&(b=this.getWidget(b.objNode))){try{b.onClick(a)}catch(c){}try{b.owner.onClick(a)}catch(d){}return!0}return!1};WidgetList.prototype.removeWidget=function(a){for(var b=0;b<this.widgetA.length;b++)if(this.widgetA[b].objNode==a){for(;b<this.widgetA.length-1;b++)this.widgetA[b]=this.widgetA[b+1];this.widgetA.length--}};WidgetList.prototype.clear=function(){this.widgetA.length=0};
var Widget=function(a,b){this.objNode=a;this.owner=b;widgetList.add(this)};Widget.prototype.remove=function(){widgetList.removeWidget(this)};var widgetList=new WidgetList,MapToolList=function(){this.toolsA=[]};MapToolList.prototype.add=function(a,b){b&&b<this.toolsA.length-1?this.toolsA.splice(b,0,a):this.toolsA[this.toolsA.length]=a};MapToolList.prototype.getMapTool=function(a){for(var b in this.toolsA)if(this.toolsA[b].objNode==a.parentNode)return this.toolsA[b];return null};
MapToolList.prototype.removeMapTool=function(a){for(var b=0;b<this.toolsA.length;b++)if(this.toolsA[b].objNode==a.parentNode){for(this.toolsA[b].remove();b<this.toolsA.length-1;b++)this.toolsA[b]=this.toolsA[b+1];this.toolsA.length--;this.toolsA.length&&this.toolsA[0].redraw()}};MapToolList.prototype.clear=function(){this.toolsA.length=0};
MapToolList.prototype.onMouseDown=function(a){var b=new MapObject(a.target);if(b){var c=mapToolList.getMapTool(b.objNode);c&&(mouseObject=new MouseObject(a,b.objNode,"parentonly",c),mouseObject.parent=c)}};
var mapToolList=new MapToolList,MapTool=function(a,b,c){this.nFontSize=14;this.szLineStyle="fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";opacity:1.0;";this.szLineStyleLite="fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(.75)+";opacity:1.0;";this.szLineBgStyle="fill:none;stroke:white;stroke-width:"+map.Scale.normalX(5)+";opacity:0.5;";this.szFillBgStyle="fill:white;stroke:none;opacity:0.6";this.szTextStyle="font-family:arial;font-size:"+map.Scale.normalY(this.nFontSize)+
"px;fill:darkblue;pointer-events:none;";this.szPolylineStyle="fill:none;stroke:blue;stroke-width:"+map.Scale.normalX(2.5)+";stroke-opacity:0.5;";this.szPolygonStyle="fill:blue;stroke:black;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szBufferStyle="fill:blue;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szType=b;this.objNode=map.Dom.newGroup(SVGToolsGroup,b+String(Math.random()));var d=null,d=d=null,d=this.szPolygonStyle;switch(b){case "coord":mouseObject=
new MouseObject(a,null,"parentonly");mouseObject.parent=this;d=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",d,0,0,1,1,this.szFillBgStyle);map.Dom.newText(d,0,0,this.szTextStyle,"");map.Dom.newText(d,0,0,this.szTextStyle,"");d=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");d.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",d,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",d,
-map.Scale.normalX(10),0,map.Scale.normalX(10),0,this.szLineStyleLite);map.Dom.newShape("line",d,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",d,0,0,map.Scale.normalX(3.7),this.szLineStyle);d.fu.setPosition(mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y);this.redraw();break;case "polyline":d=this.szPolylineStyle;case "polygon":mouseObject=new MouseObject(a,null,"parentonly");mouseObject.parent=this;a=SVGDocument.getElementById("maptools_polypath");
null==a&&(a=map.Dom.newNode("path",SVGToolsGroup),a.setAttributeNS(null,"id","maptools_polypath"),a.setAttributeNS(szMapNs,"menu","polygonmenu"),a.setAttributeNS(null,"style",d),a.parentNode.insertBefore(a,this.objNode),mapToolList.toolShape=a);d=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");d.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",d,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",d,-map.Scale.normalX(10),0,map.Scale.normalX(10),
0,this.szLineStyleLite);map.Dom.newShape("line",d,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",d,0,0,map.Scale.normalX(3.7),this.szLineStyle);d.fu.setPosition(mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y);break;case "measurement":case "measurebuffer":case "selectbuffer":mouseObject=new MouseObject(a,null);mouseObject.parent=this;map.Dom.newShape("circle",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,
map.Scale.normalX(1),this.szLineBgStyle);map.Dom.newShape("circle",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(1),"measurebuffer"==this.szType||"selectbuffer"==this.szType?this.szBufferStyle:this.szLineStyle);map.Dom.newShape("line",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,this.szLineBgStyle);map.Dom.newShape("line",this.objNode,mouseObject.mouseStartPosition.x,
mouseObject.mouseStartPosition.y,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,this.szLineStyle);d=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",d,mouseObject.mouseStartPosition.x+map.Scale.normalX(5),mouseObject.mouseStartPosition.y-map.Scale.normalY(5)-map.Scale.normalY(6*this.nFontSize/7),0,map.Scale.normalY(this.nFontSize),this.szFillBgStyle);map.Dom.newText(d,mouseObject.mouseStartPosition.x+map.Scale.normalX(5),mouseObject.mouseStartPosition.y-
map.Scale.normalY(5),this.szTextStyle,"test");d=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random()));map.Dom.newShape("circle",d,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",d,mouseObject.mouseStartPosition.x-map.Scale.normalX(10),mouseObject.mouseStartPosition.y,mouseObject.mouseStartPosition.x+map.Scale.normalX(10),mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",d,mouseObject.mouseStartPosition.x,
mouseObject.mouseStartPosition.y-map.Scale.normalX(10),mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",d,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);d=map.Dom.newGroup(this.objNode,"startpoint"+String(Math.random()));map.Dom.newShape("circle",d,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);
map.Dom.newShape("line",d,mouseObject.mouseStartPosition.x-map.Scale.normalX(10),mouseObject.mouseStartPosition.y,mouseObject.mouseStartPosition.x+map.Scale.normalX(10),mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",d,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y-map.Scale.normalX(10),mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",d,mouseObject.mouseStartPosition.x,
mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);break;case "zoomrect":case "selectrect":mouseObject=new MouseObject(a,null);mouseObject.parent=this;map.Dom.newShape("rect",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,10,10,this.szLineBgStyle);map.Dom.newShape("rect",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,10,10,this.szLineStyle);break;case "pan":mouseObject=new MouseObject(a,null),mouseObject.parent=
this,this.beginPan(a)}this.mapToolList=mapToolList;mapToolList.add(this,c)};MapTool.prototype.onMouseDown=function(a){var b=new MapObject(a.target);b&&(mouseObject=new MouseObject(a,b.objNode),mouseObject.parent=this)};
MapTool.prototype.onMouseMove=function(a){var b=null,c,d=map.Scale.getClientMousePosition(a,SVGToolsGroup),e=d.x-mouseObject.mouseStartPosition.x,f=d.y-mouseObject.mouseStartPosition.y;switch(this.szType){case "coord":b=this.objNode.childNodes;c=0;b.item(c++);e=b.item(c++);d=map.Scale.clipWidgetPositionToMap(d);e.fu.setPosition(d.x,d.y);this.redraw();break;case "measurement":case "measurebuffer":case "selectbuffer":b=this.objNode.childNodes;c=0;var g=b.item(c++),h=b.item(c++),l=b.item(c++),k=b.item(c++);
a=b.item(c++);b=b.item(c++);g.setAttributeNS(null,"r",String(Math.sqrt(e*e+f*f)));h.setAttributeNS(null,"r",String(Math.sqrt(e*e+f*f)));l.setAttributeNS(null,"x2",String(d.x));l.setAttributeNS(null,"y2",String(d.y));k.setAttributeNS(null,"x2",String(d.x));k.setAttributeNS(null,"y2",String(d.y));b.fu.setPosition(e,f);a.fu.setPosition(e/2,f/2);f=e=a.firstChild;d=map.Scale.getDistanceInMeter(mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,d.x,d.y);f.firstChild.nodeValue=map.Scale.formatDistanceString(d);
d=map.Dom.getBox(f);e.setAttributeNS(null,"width",d.width);break;case "zoomrect":case "selectrect":b=this.objNode.childNodes;c=0;d=b.item(c++);b=b.item(c++);d.setAttributeNS(null,"width",String(Math.max(1,e)));d.setAttributeNS(null,"height",String(Math.max(1,f)));b.setAttributeNS(null,"width",String(Math.max(1,e)));b.setAttributeNS(null,"height",String(Math.max(1,f)));break;case "pan":fPDFEmbed||!fPanToolByViewer?(map.Zoom.doPanMap(e/map.Scale.normalX(1),f/map.Scale.normalY(1)),mouseObject.mouseStartPosition.x=
d.x,mouseObject.mouseStartPosition.y=d.y):(d=map.Scale.getClientMousePosition(a,null),e=d.x-mouseObject.mouseStartPosition.x,f=d.y-mouseObject.mouseStartPosition.y,map.Zoom.doPanMapByViewer(e/map.Scale.normalX(1),f/map.Scale.normalY(1)));break;case "polyline":case "polygon":this.objNode.firstChild.fu.setPosition(d.x,d.y),this.redraw()}};
MapTool.prototype.onMouseUp=function(a){var b=0;switch(this.szType){case "coord":this.redraw();break;case "polyline":case "polygon":this.redraw();break;case "pan":displayMessage("please wait ...",500);setTimeout("map.Event.doDefaultZoom(null)",fPanToolByViewer?5:200);this.endPan(a);break;case "measurement":case "measurebuffer":a=this.objNode.childNodes;b=0;if("measurement"==this.szType){var c=a.item(b++),b=a.item(b++);c.parentNode.removeChild(c);b.parentNode.removeChild(b)}break;case "selectbuffer":a=
this.objNode.childNodes;b=0;a.item(b++);b=a.item(b++);a=b.parentNode.getAttributeNS(null,"id")+":shape";b.setAttributeNS(null,"id",a);(b=map.Selections.newSelection("activeLayer",a,"type:circle"))?b.mapTool=this:this.remove();break;case "selectrect":a=this.objNode.childNodes;b=0;c=a.item(b++);b=a.item(b++);a=b.parentNode.getAttributeNS(null,"id")+":shape";b.setAttributeNS(null,"id",a);(b=map.Selections.newSelection("activeLayer",a,"type:square"))?b.mapTool=this:this.remove();break;case "zoomrect":a=
this.objNode.childNodes,b=0,c=a.item(b++),b=map.Dom.getBox(c),this.objNode.parentNode.removeChild(this.objNode),map.Zoom.doZoomMapToWidgetRect(b),setMapTool("")}};MapTool.prototype.beginPan=function(a){fPanToolByViewer&&fPanHideTools&&!fPDFEmbed&&(this.endPanTimeout=!1,map.Zoom.activateClipping(a),this.hideTools(a));try{HTMLWindow.ixmaps.htmlgui_isHTMLMapVisible()?map.hideAll():this.hideLayer(a)}catch(b){this.hideLayer(a)}map.Label.stopProcessing()};
MapTool.prototype.endPan=function(a){"delayed"!=fEndPan?(fPanToolByViewer&&fPanHideTools&&!fPDFEmbed&&(map.Zoom.removeClipping(a),setTimeout("mapTool.showTools(null)",5)),setTimeout("mapTool.showLayer(null)",50),setTimeout("map.showAll()",250)):(this.endPanTimeout=!0,setTimeout("mapTool.doEndPan(null)",500))};
MapTool.prototype.doEndPan=function(a){if(!0===this.endPanTimeout){fPanToolByViewer&&fPanHideTools&&!fPDFEmbed&&(map.Zoom.removeClipping(a),this.showTools(a));this.showLayer(a);this.endPanTimeout=!1;try{map.Themes.actualizeActiveTheme()}catch(b){}}};MapTool.prototype.hideTools=function(a){this.toolsHidden&&!1!==this.toolsHidden||(antiZoomAndPanList.setDisplay(a,"none"),this.toolsHidden=!0)};
MapTool.prototype.showTools=function(a){!0===this.toolsHidden&&(antiZoomAndPanList.setDisplay(a,"inline"),this.toolsHidden=!1)};
MapTool.prototype.hideLayer=function(a){for(var b in map.Layer.listA)if(a=map.Layer.listA[b],a.szFlag.match(/invisiblepan/)){if(map.Tiles&&0<map.Tiles.nCount)for(var c=map.Tiles.getTileNodeIds(b),d=0;d<c.length;d++){var e=c[d],f=SVGDocument.getElementById(e);f&&(a.szBeforeHideStyle=f.style.getPropertyValue("display"),f.style.setProperty("display","none",""));if(f=SVGDocument.getElementById(e+":label"))a.szBeforeHideLabelStyle=f.style.getPropertyValue("display"),f.style.setProperty("display","none",
"");if(f=SVGDocument.getElementById(e+":label:bg"))a.szBeforeHideLabelStyle=f.style.getPropertyValue("display"),f.style.setProperty("display","none","")}if(f=SVGDocument.getElementById(b))a.szBeforeHideStyle=f.style.getPropertyValue("display"),f.style.setProperty("display","none","");if(f=SVGDocument.getElementById(b+":label"))a.szBeforeHideLabelStyle=f.style.getPropertyValue("display"),f.style.setProperty("display","none","");if(f=SVGDocument.getElementById(b+":label:bg"))a.szBeforeHideLabelStyle=
f.style.getPropertyValue("display"),f.style.setProperty("display","none","")}};
MapTool.prototype.showLayer=function(a){for(var b in map.Layer.listA)if(a=map.Layer.listA[b],a.szFlag.match(/invisiblepan/)){if(map.Tiles&&0<map.Tiles.nCount)for(var c=map.Tiles.getTileNodeIds(b),d=0;d<c.length;d++){var e=c[d],f=SVGDocument.getElementById(e);f&&(a.szBeforeHideStyle.length?f.style.setProperty("display",a.szBeforeHideStyle,""):f.style.removeProperty("display"));(f=SVGDocument.getElementById(e+":label"))&&(a.szBeforeHideLabelStyle.length?f.style.setProperty("display",a.szBeforeHideLabelStyle,
""):f.style.removeProperty("display"));(f=SVGDocument.getElementById(e+":label:bg"))&&(a.szBeforeHideLabelStyle.length?f.style.setProperty("display",a.szBeforeHideLabelStyle,""):f.style.removeProperty("display"))}(f=SVGDocument.getElementById(b))&&(a.szBeforeHideStyle.length?f.style.setProperty("display",a.szBeforeHideStyle,""):f.style.removeProperty("display"));(f=SVGDocument.getElementById(b+":label"))&&(a.szBeforeHideLabelStyle.length?f.style.setProperty("display",a.szBeforeHideLabelStyle,""):
f.style.removeProperty("display"));(f=SVGDocument.getElementById(b+":label:bg"))&&(a.szBeforeHideLabelStyle.length?f.style.setProperty("display",a.szBeforeHideLabelStyle,""):f.style.removeProperty("display"))}};
MapTool.prototype.redraw=function(a){switch(this.szType){case "polygon":var b=SVGDocument.getElementById("maptools_polypath");if(null==b)break;var c=[],d=this.mapToolList.toolsA,e="",f=d[0].objNode.firstChild;f.fu=new Methods(f);f=f.fu.getPosition();c[c.length]=f;for(var e=e+("M"+f.x+","+f.y),g=1;g<d.length;g++)f=d[g].objNode.firstChild,f.fu=new Methods(f),f=f.fu.getPosition(),c[c.length]=f,e+=" "+f.x+","+f.y;b.setAttributeNS(null,"d",e+"z");(e=SVGDocument.getElementById("maptools_phantomPointGroup"))?
map.Dom.clearGroup(e):e=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");for(g=0;g<c.length;g++){var d=c[g].x+(c[g<c.length-1?g+1:0].x-c[g].x)/2,f=c[g].y+(c[g<c.length-1?g+1:0].y-c[g].y)/2,h=map.Dom.newShape("circle",e,d,f,map.Scale.normalX(10),"fill:white;stroke:none;opacity:0.1;");map.Dom.newShape("circle",e,d,f,map.Scale.normalX(2),this.szPolygonStyle+"pointer-events:none;");h.setAttributeNS(szMapNs,"tooltip","click to add point");h.setAttributeNS(null,"onmousedown","new MapTool(evt,'polygon',"+
(g+1)+")")}(e=map.Dom.getObjectById("maptools_polygon_text"))?map.Dom.clearGroup(e):e=map.Dom.newGroup(SVGToolsGroup,"maptools_polygon_text");g=__doGetPolygonCenter(c);b=Math.abs(__doGetPolygonSurface(c,!0));c=new TextField(a,e,"maptooltext_template",18);c.setText(map.Scale.formatSurfaceString(b));a=c.textGroup.fu.getBox();c.setPosition(g.x-a.width/2,g.y-a.height/2);break;case "polyline":d=SVGDocument.getElementById("maptools_polypath");if(null==d)break;c=[];b=this.mapToolList.toolsA;e="";f=b[0].objNode.firstChild;
f.fu=new Methods(f);f=f.fu.getPosition();c[c.length]=f;e+="M"+f.x+","+f.y;for(g=1;g<b.length;g++)f=b[g].objNode.firstChild,f.fu=new Methods(f),f=f.fu.getPosition(),e+=" "+f.x+","+f.y,c[c.length]=f;d.setAttributeNS(null,"d",e);(e=SVGDocument.getElementById("maptools_phantomPointGroup"))?map.Dom.clearGroup(e):e=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");for(g=0;g<c.length-1;g++)d=c[g].x+(c[g+1].x-c[g].x)/2,f=c[g].y+(c[g+1].y-c[g].y)/2,h=map.Dom.newShape("circle",e,d,f,map.Scale.normalX(2),
this.szPolygonStyle),h.setAttributeNS(szMapNs,"tooltip","click to add point"),h.setAttributeNS(null,"onmousedown","new MapTool(evt,'polyline',"+(g+1)+")");(e=SVGDocument.getElementById("maptools_polyline_textgroup"))?map.Dom.clearGroup(e):e=map.Dom.newGroup(this.objNode,"maptools_polyline_textgroup");d=0;for(g=1;g<b.length;g++){var h=0,c=b[g].objNode.firstChild,f=b[g-1].objNode.firstChild.fu.getPosition(),l=c.fu.getPosition(),d=d+(h=map.Scale.getDistanceInMeter(f.x,f.y,l.x,l.y)),c=new TextField(a,
e,"maptooltext_template",12);c.setText(map.Scale.formatDistanceString(h));c.setPosition(f.x+(l.x-f.x)/2,f.y+(l.y-f.y)/2)}l=b[b.length-1].objNode.firstChild.fu.getPosition();c=new TextField(a,e,"maptooltext_template",18);c.setText(map.Scale.formatDistanceString(d));c.setPosition(l.x+map.Scale.normalX(5),l.y);c.textGroup.setAttributeNS(szMapNs,"menu","polylinemenu");break;case "coord":b=this.objNode.childNodes,g=0,a=b.item(g++),g=b.item(g++).fu.getPosition(),b=a.firstChild,c=b.nextSibling,e=c.nextSibling,
d=map.Scale.getMapPosition(g.x,g.y),d=map.Scale.getMapCoordinate(d.x,d.y),d=map.Scale.getGeoCoordinateOfPoint(d.x,d.y),f="Y="+String(d.y),c.firstChild.nodeValue="X="+String(d.x),e.firstChild.nodeValue=f,d=map.Dom.getBox(c),f=map.Dom.getBox(e),c.setAttributeNS(null,"y",Number(d.height)),e.setAttributeNS(null,"y",Number(d.y)+Number(d.height)+Number(f.height)+map.Scale.normalY(3)),b.setAttributeNS(null,"width",d.width),b.setAttributeNS(null,"height",Number(d.height)+Number(f.height)+map.Scale.normalY(3)),
g=new point(g.x,g.y),b=new point(map.Scale.normalX(5),map.Scale.normalY(5)),g=map.Scale.clipWidgetObjectToMap(a,g,b),a.fu.setPosition(g.x,g.y)}};MapTool.prototype.remove=function(a){this.objNode.parentNode.removeChild(this.objNode)};MapTool.prototype.printPolygon=function(a){(a=SVGDocument.getElementById("maptools_polygon"))&&alert(printNode(a))};
setMapTool=function(a){map.Layer.setPointerEvents(null);"info"==a&&"info"==szMapToolType&&deactivateTheme(_activeTheme);"pan"==a&&deactivateTheme(_activeTheme);killTooltip();killInfo();map.Dom.clearGroup(SVGMenuGroup);map.Dom.clearGroup(SVGToolsGroup);mapToolList.clear();szMapToolType=a;fPDFEmbed&&fSetToolCursor&&setTimeout("setMapToolCursor('"+a+"')",100);try{HTMLWindow.ixmaps.htmlgui_setMapTool(a)}catch(b){}};
var setMapToolCursor=function(a){var b=null;(b=SVGDocument.getElementById("mapbackground"))&&b.setAttributeNS(null,"cursor","url(#"+a+"_cursor)");(b=SVGDocument.getElementById("mapcanvas"))&&b.setAttributeNS(null,"cursor","url(#"+a+"_cursor)");SVGToolsGroup&&SVGToolsGroup.setAttributeNS(null,"cursor","url(#"+a+"_cursor)")},_lastActiveToolBgNode=null,setMapToolActive=function(a){_lastActiveToolBgNode&&_lastActiveToolBgNode.style.setProperty("opacity","0","");var b=null;if(b=SVGDocument.getElementById("legend:activatetool:"+
a))if(a=b.getElementsByTagName("rect").item(0))a.style.setProperty("opacity","1",""),a.style.setProperty("fill","#eeeeff",""),a.style.setProperty("stroke","#0000ff",""),a.style.setProperty("stroke-width","0.5",""),_lastActiveToolBgNode=a};
TextField=function(a,b,c,d){(a=SVGDocument.getElementById(c))?(this.textGroup=b.appendChild(a.cloneNode(1E3)),this.textGroup.fu=new Methods(this.textGroup),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.textGroup.setAttributeNS(null,"id",c+String(Math.random())),b=this.textGroup.getElementsByTagName("rect"),c=this.textGroup.getElementsByTagName("text"),1<b.length?(this.sdNode=b.item(0),this.bgNode=b.item(1)):this.bgNode=b.item(0),this.textNode=c.item(0),d&&this.textNode.style.setProperty("font-size",
String(d)+"px",""),this.textNode.parentNode==this.textGroup?(this.workspaceNode=map.Dom.newGroup(this.textGroup,"workspace:"+String(Math.random())),this.textGroup.insertBefore(this.workspaceNode,this.textNode),this.workspaceNode.appendChild(this.textNode)):this.workspaceNode=this.textNode.parentNode):"flat"==c?(this.textGroup=map.Dom.newGroup(b,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),fMapBorder3D&&SVGDocument.getElementById(szShadowFilterId)&&
(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",nInfoRoundRect*d/6),this.sdNode.setAttributeNS(null,"ry",nInfoRoundRect*d/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:#888888;stroke-width:2;"),this.bgNode.setAttributeNS(null,"rx",nInfoRoundRect*d/6),this.bgNode.setAttributeNS(null,"ry",nInfoRoundRect*d/6),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+
d+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.7")):"light"==c?(this.textGroup=map.Dom.newGroup(b,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),fMapBorder3D&&SVGDocument.getElementById(szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",nInfoRoundRect*d/6),this.sdNode.setAttributeNS(null,
"ry",nInfoRoundRect*d/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#fdfdfd;stroke:#888888;stroke-width:0.1;opacity:1;"),this.bgNode.setAttributeNS(null,"rx",nInfoRoundRect*d/6),this.bgNode.setAttributeNS(null,"ry",nInfoRoundRect*d/6),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+d+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.95")):"alert"==c?(this.textGroup=map.Dom.newGroup(b,
"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),SVGDocument.getElementById(szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#666666;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.Scale.normalY(.1)),this.sdNode.setAttributeNS(null,"ry",map.Scale.normalY(.1))),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#F9EDB8;stroke:#EDC967;stroke-width:1;opacity:1"),this.textNode=map.Dom.newText(this.textGroup,
0,0,"font-family:arial;font-size:"+d+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode):(this.textGroup=map.Dom.newGroup(b,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.5;stroke:none"),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:blue;stroke-width:0.1"),this.sdNode.setAttributeNS(null,"rx",nInfoRoundRect),this.sdNode.setAttributeNS(null,
"ry",nInfoRoundRect),this.bgNode.setAttributeNS(null,"rx",nInfoRoundRect),this.bgNode.setAttributeNS(null,"ry",nInfoRoundRect),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+d+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode,"transparent"==c&&(this.textGroup.setAttributeNS(null,"opacity","0.4"),this.sdNode.setAttributeNS(null,"rx",5*nInfoRoundRect),this.sdNode.setAttributeNS(null,"ry",5*nInfoRoundRect),this.bgNode.setAttributeNS(null,"rx",5*nInfoRoundRect),
this.bgNode.setAttributeNS(null,"ry",5*nInfoRoundRect)))};TextField.prototype.setText=function(a){try{return this.textNode.firstChild.nodeValue=a,this.resizeField(),!0}catch(b){return!1}};
TextField.prototype.resizeField=function(){try{var a=map.Dom.getBox(this.workspaceNode);this.bgNode&&(this.bgNode.setAttributeNS(null,"x",a.x-12),this.bgNode.setAttributeNS(null,"y",a.y-3),this.bgNode.setAttributeNS(null,"width",a.width+24),this.bgNode.setAttributeNS(null,"height",a.height+10));this.sdNode&&(this.sdNode.setAttributeNS(null,"x",a.x-6+1),this.sdNode.setAttributeNS(null,"y",a.y-3+2),this.sdNode.setAttributeNS(null,"width",a.width+12+1),this.sdNode.setAttributeNS(null,"height",a.height+
6+1))}catch(b){}};TextField.prototype.setPosition=function(a,b){this.textGroup.fu.setPosition(a,b)};
var ScrollArea=function(a,b,c,d,e,f){this.nMaxWidth=d?d:100;this.nMaxHeight=e?e:100;this.nScrollBarWidth=f?f:10;null!=b&&(a=":"+String(Math.random()),(d=SVGDocument.getElementById(c))?(this.areaGroup=b.appendChild(d.cloneNode(1E3)),this.areaGroup.fu=new Methods(this.areaGroup),this.areaGroup.fu.extendAllIds(this.areaGroup,a),this.workspaceNode=SVGDocument.getElementById(c+":workspace"+a),this.cliprectNode=SVGDocument.getElementById(c+":cliprect"+a)):(c="scrollarea",this.areaGroup=map.Dom.newGroup(b,
c+a),b=map.Dom.newNode("clipPath",this.areaGroup),b.setAttribute("id",c+":clippath"+a),b.setAttribute("style","pointer-events:all"),this.cliprectNode=map.Dom.newShape("rect",b,0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight),"fill:none;stroke:none"),this.cliprectNode.setAttribute("id",c+":cliprect"+a),this.areaGroup.setAttributeNS(null,"clip-path","url(#"+c+":clippath"+a+")"),this.workspaceNode=map.Dom.newGroup(this.areaGroup,c+":workspace"+a)),this.szId=c)};
ScrollArea.prototype.setWidth=function(a){this.cliprectNode&&(this.nMaxWidth=Number(a),this.cliprectNode.setAttributeNS(null,"width",map.Scale.normalX(Math.max(this.nMaxWidth,0))))};ScrollArea.prototype.setHeight=function(a){this.cliprectNode&&(this.nMaxHeight=Number(a),this.cliprectNode.setAttributeNS(null,"height",map.Scale.normalX(Math.max(this.nMaxHeight,0))))};ScrollArea.prototype.setPosition=function(a,b){this.areaGroup&&this.areaGroup.fu.setPosition(a,b)};
ScrollArea.prototype.reformat=function(a){this.scrollObj&&(this.scrollObj.remove(a),this.scrollObj=null);var b=new box(0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight)),c=getTranslate(this.workspaceNode);if(0>this.nMaxWidth||0>this.nMaxHeight){var d=map.Dom.getBox(this.workspaceNode);b.width=0<=this.nMaxWidth?b.width:d.width+map.Scale.normalX(this.nScrollBarWidth+5);b.height=0<=this.nMaxHeight?b.height:d.height+map.Scale.normalY(this.nScrollBarWidth+5);this.cliprectNode.setAttributeNS(null,
"width",b.width);this.cliprectNode.setAttributeNS(null,"height",b.height)}(this.scrollObj=new ScrollBar(this.workspaceNode,new point(c.x,c.y),b,map.Scale.normalX(this.nScrollBarWidth),map.Scale.normalY(this.nScrollBarWidth),map.Scale.normalX(1)))&&this.scrollObj.draw(a)};ScrollArea.prototype.remove=function(a){this.scrollObj&&(this.scrollObj.remove(a),this.scrollObj=null);this.areaGroup&&(this.areaGroup.parentNode.removeChild(this.areaGroup),this.areaGroup=null)};
ScrollArea.prototype.hasScrollBars=function(a){return this.scrollObj?this.scrollObj.hasScrollBars():!1};ScrollArea.prototype.getWidth=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"width"))/map.Scale.normalX(1):0};ScrollArea.prototype.getHeight=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"height"))/map.Scale.normalY(1):0};
ScrollArea.prototype.setScrollPosition=function(a){this.scrollObj&&this.scrollObj.vThumbObj&&this.scrollObj.vThumbObj.setValue(a);this.scrollObj&&this.scrollObj.hThumbObj&&this.scrollObj.hThumbObj.setValue(a)};var allHighLights=[];map.removeAllHighlights=function(){for(var a=0;a<allHighLights.length;a++)allHighLights[a]&&(allHighLights[a].unlock(),allHighLights[a].removeAll());allHighLights.length=0};var HighLight=function(){this.itemA=[];allHighLights[allHighLights.length]=this};
HighLight.prototype.addItem=function(a,b){for(var c=0;c<this.itemA.length;c++)if(this.itemA[c].node==a)return null;return(c=new HighLightItem(a,b))?(this.itemA[this.itemA.length]=c,c.node):null};HighLight.prototype.checkItem=function(a){for(var b=0;b<this.itemA.length;b++)if(this.itemA[b].node==a)return!0;return!1};
HighLight.prototype.removeItem=function(a){a=map.Layer.getLayerItemNodeOfNode(a);for(var b=0;b<this.itemA.length;b++)if(this.itemA[b].node==a){for(this.itemA[b].removeHighLight();b<this.itemA.length-1;b++)this.itemA[b]=this.itemA[b+1];--this.itemA.length}};HighLight.prototype.offAll=function(){for(var a=0;a<this.itemA.length;a++)this.itemA[a].removeHighLight()};HighLight.prototype.onAll=function(){for(var a=0;a<this.itemA.length;a++)this.itemA[a].doHighLight()};var __highlightObject=null;
HighLight.prototype.startToggle=function(){0<nHighlightToggle&&(this.toggleCount=2*nHighlightToggle,__highlightObject=this,setTimeout("__highlightObject.toggleAll()",1E3))};HighLight.prototype.toggleAll=function(){for(var a=0;a<this.itemA.length;a++)this.itemA[a].highlighted?this.itemA[a].removeHighLight():this.itemA[a].doHighLight();0<--this.toggleCount&&setTimeout("__highlightObject.toggleAll()",500)};
HighLight.prototype.removeAll=function(){if(!this.fLock){for(var a=0;a<this.itemA.length;a++)this.itemA[a].removeHighLight();this.itemA.length=0}};HighLight.prototype.lock=function(){this.fLock=!0};HighLight.prototype.unlock=function(){this.fLock=!1};function HighLightItem(a,b){if("circle"!=b&&"isolate"!=b&&(a=map.Layer.getLayerItemNodeOfNode(a),!a))return null;this.node=a;this.szMode=b;this.doHighLight()}
HighLightItem.prototype.doHighLight=function(){var a,b;if(a=this.node){if(this.szMode&&"circle"==this.szMode&&this.node.parentNode.fu&&this.node.parentNode.fu.getPosition){this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup,":highlightgroup");this.itemNode=map.Dom.newGroup(this.highlightGroup);a=map.Scale.normalX(50)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale;b=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale;var c=map.Scale.normalX(5)*
map.Layer.nObjectScale/map.Layer.nDynamicObjectScale;map.Dom.newShape("circle",this.itemNode,0,0,a,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+c+" "+c+";stroke-width:"+1.1*b+"px;pointer-events:none");map.Dom.newShape("circle",this.itemNode,0,0,a,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+c+" "+c+";stroke-width:"+b+"px;pointer-events:none");map.Dom.getBox(this.node);a=this.node.parentNode.fu.getScale();var d=this.node.fu.getPosition().x*a.x;a=this.node.fu.getPosition().y*
a.y;d=this.node.parentNode.fu.getPosition().x+d;a=this.node.parentNode.fu.getPosition().y+a;this.itemNode.fu.setPosition(d,a);this.itemNode.fu.scaleBy(1,1/map.Zoom.nZoomY*map.Zoom.nZoomX);return!0}if(this.szMode&&"isolate"==this.szMode&&this.node.parentNode.fu&&this.node.parentNode.fu.getPosition)return a=a.cloneNode(1E3),this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup.parentNode,":highlightgroup"),this.itemNode=this.highlightGroup.appendChild(a),this.itemNode.setAttributeNS(null,
"id",""),this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),map.Dom.getBox(this.node),a=this.node.parentNode.fu.getScale(),d=this.node.fu.getPosition().x*a.x,a=this.node.fu.getPosition().y*a.y,d=this.node.parentNode.fu.getPosition().x+d,a=this.node.parentNode.fu.getPosition().y+a,this.itemNode.fu=new Methods(this.itemNode),this.itemNode.fu.setPosition(d,a),d=this.node.fu.getScale(),a=this.node.parentNode.fu.getScale(),this.itemNode.fu.scale(d.x*a.x,d.y*a.y),
this.objectGroupOpacity=map.Layer.objectGroup.style.getPropertyValue("opacity")||1,map.Layer.objectGroup.style.setProperty("opacity","0.3"),d=map.Dom.newGroup(this.itemNode),a=map.Scale.normalX(50)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,b=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,c=map.Scale.normalX(5)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,map.Dom.newShape("circle",d,0,0,a,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+c+" "+
c+";stroke-width:"+1.1*b+"px;pointer-events:none"),map.Dom.newShape("circle",d,0,0,a,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+c+" "+c+";stroke-width:"+b+"px;pointer-events:none"),map.Dom.getBox(this.node),a=this.node.parentNode.fu.getScale(),this.node.fu.getPosition(),this.node.fu.getPosition(),this.node.parentNode.fu.getPosition(),this.node.parentNode.fu.getPosition(),d.fu.scale(1/a.x,1/a.y),d.fu.scaleBy(1,1/map.Zoom.nZoomY*map.Zoom.nZoomX),!0;d=new MapObject(a);b=map.Layer.getLayerObj(d.szId);
d=b.szHighlight;if(!d)switch(b.szType){case "point":d="filter:url(#Glow);scale:1.5";break;case "line":d="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";break;case "polygon":d="fill:yellow"}if(this.szMode&&"hint"==this.szMode)switch(b.szType){case "point":d="filter:url(#Glow);scale:1.5";break;case "line":d="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";break;case "polygon":d="fill:#eeeeff;fill-opacity:0.2;stroke-opacity:0.5;stroke:#eeeeff;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;"}if(d=
__scaleStyleString(d,map.Scale.normalX(1/map.Zoom.nZoom))){var c=a.parentNode,e=c.nextSibling;e&&1==e.nodeType&&e.getAttributeNS(null,"id").match(/highlightgroup/)?this.highlightGroup=e:(this.highlightGroup=map.Dom.newGroup(c.parentNode,b.szName+":highlightgroup"),this.highlightGroup=c.parentNode.insertBefore(this.highlightGroup,e),this.highlightGroup.setAttributeNS(null,"class",c.getAttributeNS(null,"class")));this.highlightGroup.setAttributeNS(null,"style",d+";display:inline;pointer-events:none");
a=a.cloneNode(1E3);this.itemNode=this.highlightGroup.appendChild(a);this.itemNode.setAttributeNS(null,"id","");if(d.match(/fill:/)&&(this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),this.itemNode.hasChildNodes))for(b=this.itemNode.childNodes,a=0;a<b.length;a++)1==b.item(a).nodeType&&b.item(a).style.setProperty("fill","inherit","");if(d.match(/stroke:/)&&(this.itemNode.style.removeProperty("stroke"),this.itemNode.hasChildNodes))for(b=this.itemNode.childNodes,
a=0;a<b.length;a++)1==b.item(a).nodeType&&(b.item(a).style.setProperty("stroke","none",""),b.item(a).style.removeProperty("stroke"));if(d.match(/scale:/)){this.itemNode.fu=new Methods(this.itemNode);d=parseFloat(d.split("scale:")[1]);if(isNaN(d)||0===d)d=1.5;this.itemNode.fu.scaleBy(d,d)}return this.highlighted=!0}return!1}};
HighLightItem.prototype.removeHighLight=function(){this.highlightGroup&&this.highlightGroup.parentNode&&this.highlightGroup.parentNode.removeChild(this.highlightGroup);this.highlighted=!1;this.objectGroupOpacity&&(map.Layer.objectGroup.style.setProperty("opacity",this.objectGroupOpacity),this.objectGroupOpacity=null)};var __info_infoShape=null,idInfoTimeout=null;
function displayInfo(a,b,c){var d=null;if(a&&!a.touches)d=map.Scale.getClientMousePosition(a,SVGPopupGroup);else{d=map.Scale.getScreenPosition(b);if(!map.Scale.isWidgetPositionInMap(d))return null;c+="|pointer"}if(c.match(/delayed/))killInfo(),__info_infoShape=b,idInfoTimeout=setTimeout("doDisplayInfo("+d.x+","+d.y+",'"+c+"')",nInfoTimeout);else return __info_infoShape=b,doDisplayInfo(d.x,d.y,c)}Map.prototype.displayInfo=function(a,b,c){displayInfo(a,b,c)};
function killInfo(){idInfoTimeout&&clearTimeout(idInfoTimeout);__info_infoShape=null}
doDisplayInfo=function(a,b,c){var d,e,f=null;c&&c.match(/add/)||SVGPopupGroup.fu.clear();var g=null,g=__info_infoShape?map.Event.popupContextObj=__info_infoShape:map.Event.popupContextObj;if(null==g)return null;var h=g.getAttributeNS(szMapNs,"info");null!=h&&0!==h.length||!g.parentNode||(g=g.parentNode,h=g.getAttributeNS(szMapNs,"info"));var l=map.Dom.getAttributeByNodeOrParents(g.parentNode,szMapNs,"info"),k=map.Dom.getAttributeByNodeOrParents(g.parentNode,szMapNs,"show"),w=map.Dom.getAttributeByNodeOrParents(g.parentNode,
szMapNs,"label");d=map.Dom.getAttributeByNodeOrParents(g.parentNode,szMapNs,"units");var v=map.Dom.getAttributeByNodeOrParents(g,null,"id"),n=v+":info";map.Themes&&map.Themes.activeTheme&&(n+=":"+map.Themes.activeTheme.szId);if(SVGDocument.getElementById(n))return null;e=null;if(v&&v.length){var v=map.Tiles.getMasterId(v),u=v.split(":::")[0];e=SVGDocument.getElementById(u+":image")}try{if(map.User.onInfoDisplay(null,v))return null}catch(C){}a=new point(a,b);u=new point(map.Scale.normalX(nInfoOffsetX),
map.Scale.normalY(nInfoOffsetY));b="info:"+String(Math.random());var u=new InfoContainer(SVGDocument,SVGPopupGroup,b+(c.match(/pointer/)?"":":movable"),a,u,c),y=u.workspaceNode,y=map.Dom.newGroup(y,n),r=new box(0,0,0,0),n=(new MapObject(g)).szId;if(n.match(/chartgroup/))var m=n.split(":")[1],p=n.split(":")[3],n=m+"::"+p;else{var t=map.Layer.getLayerItemNodeOfNode(g);t&&(n=t.getAttributeNS(null,"id"))}p=map.Label.getLabel(n);map.Themes.activeTheme&&(p=map.Themes.getTitle(n,map.Themes.activeTheme));
try{var x=map.Themes.getDataRow(n,map.Themes.activeTheme),p=HTMLWindow.ixmaps.htmlgui_onInfoTitle(p,x)}catch(F){}if(p){if(!isNaN(p))var q=map.Layer.getLayerObj(m),p=(q?q.szLabel+" ":"")+p;u.setTitle(p,map.Scale.tStyle.InfoContainerTitle)}if(c.match(/short/))return u.reformat(),u?u.objectNode:null;if(map.Themes&&map.Themes.activeTheme){t=null;q=map.Themes.activeTheme;if((p=map.Layer.getLayerItemNodes(g))&&0<p.length)for(x=0;x<map.Themes.themesA.length;x++){if(q=map.Themes.themesA[x],m=map.Dom.newGroup(y,
"info:chart"),t=map.Tiles.getMasterId(p[0].getAttributeNS(null,"id")),map.Themes.getChart(t,m,"VALUES|ZOOM|AXIS",q),m.hasChildNodes()||(t=map.Tiles.getMasterId(p[0].parentNode.getAttributeNS(null,"id")))&&map.Themes.getChart(t,m,"VALUES|ZOOM|AXIS",q),m.hasChildNodes()||(t=g.getAttributeNS(null,"id")||"",(t=t.split(":")[1])&&map.Themes.getChart(t,m,"VALUES|ZOOM|AXIS",q)),m.hasChildNodes()){killTooltip();u.fClipped=!1;var A=map.Dom.getBox(m);if(0<A.width&&0<A.height){var z=.9*map.Scale.tStyle.Description.nFontHeight,
B=__scaleStyleString(map.Scale.tStyle.Description.szStyle,1),A=q.szTitle;map.Dom.newText(y,map.Scale.normalX(6),r.height+z,B,A);z=q.szFlag.match(/CHART/)?z+map.Scale.normalY(6/1.3):z+map.Scale.normalY(6*1.3);m.fu.scale(2,2);A=map.Dom.getBox(m);m.fu.setPosition(map.Scale.normalX(6)-2*A.x,r.height+z-2*A.y);A=map.Dom.getBox(m);z=A.y+A.height+map.Scale.normalY(6);if(r=map.Themes.getLabel(t,q))r=25>r.length?r:r.substr(0,25)+"...",z+=map.Scale.normalY(6*1.3),B=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,
1),map.Dom.newText(m,A.x,z,B,r),z+=map.Scale.tStyle.Description.nFontHeight;var D=map.Themes.getSummary(t,q);D&&(B=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.5),map.Dom.newText(m,A.x,z,B,D));r=map.Dom.getBox(y);r.height+=map.Scale.normalY(12)}q.fShowData&&(f=q.getDataGrid(t,y))&&(f.setPosition(map.Scale.normalX(5),r.height),f.hasScrollBars&&f.hasScrollBars()&&f.workspaceNode.style.setProperty("display","none",""))}}else{m=map.Dom.newGroup(y,"info:chart");t=(new MapObject(g)).szId;z=t.split(":")[1];
B=t.split(":")[3];p=(q=map.Layer.getLayerObj(z))?q.szSelection+" ":"";(q=map.Themes.getTheme(t.split(":")[0]))&&q.szInfoTitle&&(p=q.szInfoTitle);p=(t=map.Label.getLabel(z+"::"+B))?t:p+B;t=z+"::"+B;q.szFlag.match(/PLOT/)?map.Themes.getChart(t,m,"VALUES|XAXIS|ZOOM|BOX|GRID",q):q.szFlag.match(/POINTER/)&&1<q.nOrigSumA.length&&1<q.partsA.length?map.Themes.getChart(t,m,"VALUES|ZOOM|AXIS|HORZ",q):(map.Themes.getChart(t,m,"VALUES|ZOOM|AXIS",q),q.szFlag.match(/COUNTS/)&&1<q.partsA.length&&(z=map.Dom.newGroup(m,
"info:chart:x"),B=q.nNormalSizeValue,q.nNormalSizeValue=10*map.Themes.getMaxValue(t,q),map.Themes.getChart(t,z,"CHART|BAR|HORZ|ZOOM|VALUES|AXIS|NOZERO|SORT",q),q.nNormalSizeValue=B,z.fu.setPosition(0,z.fu.getBox().height+m.fu.getBox().height/2+map.Scale.normalX(5))));q&&q.itemA[t]&&q.itemA[t].szSelectionId&&(p=q.itemA[t].szSelectionId.split(":").pop());q&&q.itemA[t]&&q.itemA[t].szTitle&&(p=q.itemA[t].szTitle);q&&q.itemA[t]&&q.itemA[t].dbIndexA&&q.itemA[t].dbIndexA.length&&(p=q.itemA[t].dbIndexA.length+
" "+map.Dictionary.getLocalText("items aggregated"));q&&q.itemA[t]&&q.itemA[t].szSelectionId2&&"undefined"!=q.itemA[t].szSelectionId2&&(p+=" ==> "+q.itemA[t].szSelectionId2);try{x=map.Themes.getDataRow(n,map.Themes.activeTheme),p=HTMLWindow.ixmaps.htmlgui_onInfoTitle(p,x)}catch(H){}if(m.hasChildNodes()){killTooltip();u.fClipped=!1;u.setTitle(p,map.Scale.tStyle.InfoContainerTitle);A=map.Dom.getBox(m);if(0<A.width&&0<A.height){m.fu.scale(2,2);m.fu.setPosition(map.Scale.normalX(6)-2*A.x,r.height+map.Scale.normalY(6)-
2*A.y);z=A.y+A.height+map.Scale.normalY(6);B=__scaleStyleString(map.Scale.tStyle.Description.szStyle,.5);z+=.25*map.Scale.tStyle.Description.nFontHeight+map.Scale.normalY(1);map.Dom.newText(m,A.x,z,B,q.szTitle);z+=1*map.Scale.tStyle.Description.nFontHeight+map.Scale.normalY(1);if(D=map.Themes.getValueComment(t,map.Themes.activeTheme))B=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.5),map.Dom.newText(m,A.x,z,B,D),z+=1*map.Scale.tStyle.Summary.nFontHeight+map.Scale.normalY(.5);if(D=map.Themes.getSummary(t,
map.Themes.activeTheme))B=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1),map.Dom.newText(m,A.x,z,B,D+q.szUnits);r=map.Dom.getBox(y);r.height+=map.Scale.normalY(12)}else if(D=map.Themes.getSummary(t,q))D=D.split("Total:")[1],B=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,2.5),map.Dom.newText(y,100,500,B,D+q.szUnits),r=map.Dom.getBox(y);q.fShowData&&(f=q.getDataGrid(t,y))&&(f.setPosition(map.Scale.normalX(5),r.height),f.hasScrollBars&&f.hasScrollBars()&&f.workspaceNode.style.setProperty("display",
"none",""))}}r=map.Dom.getBox(y)}e&&(x=e.cloneNode(1E3),x=y.appendChild(x),x.fu=new Methods(x),x.fu.setPosition(map.Scale.normalX(5),r.height+map.Scale.normalY(5)),x.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),r=map.Dom.getBox(y),r.height+=map.Scale.normalX(7));if(h&&h.length&&l.length&&!f){if(k&&k.length){if(x=[],l=l.split("|"),h=h.split("|"),k=k.split("|"),m=w.split("|"),w=d.split("|"),k&&k.length){for(d=0;d<k.length;d++)for(e=0;e<l.length;e++)k[d]==l[e]&&(x[x.length]=m&&m[d]?map.Dictionary.getLocalText(m[d]):
map.Dictionary.getLocalText(l[e]));for(d=0;d<k.length;d++)for(e=0;e<l.length;e++)k[d]==l[e]&&(m=map.Dictionary.getLocalText(h[e]),x[x.length]=__formatInfoValue(m),x[x.length-1]+=w[d]?" "+w[d]:"")}}else{x=[];l=l.split("|");w=d.split("|");for(d=0;d<l.length;d++)x[x.length]=map.Dictionary.getLocalText(l[d]);h=h.split("|");for(d=0;d<h.length;d++)isNaN(h[d])?(m=map.Dictionary.getLocalText(l[d]+":"+h[d]),x[x.length]=m!=l[d]+":"+h[d]?m:map.Dictionary.getLocalText(h[d])):(m=map.Dictionary.getLocalText(l[d]+
":"+h[d]),x[x.length]=__formatInfoValue(m!=l[d]+":"+h[d]?m:h[d])),x[x.length-1]+=w[d]?" "+w[d]:""}if(x.length){var G=createTextGrid(SVGDocument,y,b+":textgrid",x,2,14);G.fu.setPosition(map.Scale.normalX(5),r.height)}try{var E;if(E=map.User.onInfoDisplayExtend(null,v,G.parentNode,a))E=G.appendChild(E),E.fu.setPosition(map.Scale.normalX(5),r.height)}catch(I){}}try{if(E=HTMLWindow.ixmaps.htmlgui_onInfoDisplayExtend(SVGDocument,n))E=y.appendChild(E),E.fu=new Methods(E),E.fu.setPosition(map.Scale.normalX(10),
r.height+map.Scale.normalX(10))}catch(J){}y.hasChildNodes()||map.Dom.newShape("rect",y,0,0,1,1,"fill:none;stroke:none;");u.reformat();f&&f.workspaceNode.style.setProperty("display","inline","");c.match(/fix/)&&(u.objectNode.fu.scale(nFixedInfoScale,nFixedInfoScale),SVGFixedGroup.appendChild(u.objectNode),u.highLightList=new HighLight,u.highLightList.addItem(g),u.highLightList.lock(),u.setOnRemove("_doRemoveFixedInfo(map.Dom.popObj('"+map.Dom.pushObj(u)+"'))"));return u?u.objectNode:null};
_doRemoveFixedInfo=function(a){a.highLightList.unlock();a.highLightList.removeAll()};function removeInfo(a,b){setTimeout("_removeInfo()",1E3)}_removeInfo=function(a){null!=map.Event.onoverShape||map.Event.onoverPopup?setTimeout("_removeInfo()",250):SVGPopupGroup.fu.clear()};Map.prototype.removeInfo=function(){SVGFixedGroup.fu.clear()};var __infoShape=null,__stackedInfoShapeA=[];
function displayInfoDelayed(a,b,c){__stackedInfoShapeA[__stackedInfoShapeA.length]=b;1>=__stackedInfoShapeA.length&&setTimeout("doDisplayInfoDelayed()",c)}function doDisplayInfoDelayed(){if(SVGPopupGroup.hasChildNodes)setTimeout("doDisplayInfoDelayed()",1E3);else{for(var a=0;a<__stackedInfoShapeA.length;a++)displayInfo(null,__stackedInfoShapeA[a],0===a?"":"add");__stackedInfoShapeA.length=0}}
var __formatInfoValue=function(a){if(a.match(/E+/)){var b=a.split("E+"),c=parseFloat(b[0]),b=parseInt(b[1]);if(!isNaN(c)&&!isNaN(b))return c*=Math.pow(10,b),String(Math.round(100*c)/100)}c=Number(a);return isNaN(c)?a:String(c)},createTextGrid=function(a,b,c,d,e,f,g,h){a=Math.ceil(d.length/e);f=f?f:12;for(var l=0,k=0;k<d.length&&d[k];k++)l=Math.max(l,d[k].length);b=map.Dom.newGroup(b,c);var w=SVGDocument.getElementById("TextLinesBgPattern");h||szTextGridStyle.match(/background/);c=[];for(var v=[],
l=Array(a),k=0;k<a;k++)l[k]=Array(e);var n=map.Dom.newNode("g",b),u=map.Scale.normalX(5);h=map.Scale.normalX(3);for(var C=Math.min(map.Scale.normalX(250),map.Scale.bBox.width/7),y=0;y<e;y++){for(var r=map.Scale.normalY(f),k=0;k<a;k++){1<e&&0===y&&!w&&szTextGridStyle.match(/background/)&&szTextGridStyle.match(/alternate/);var m=map.Dom.newText(n,0,r,"font-family:arial;font-size:"+map.Scale.normalY(f)+"px;fill:"+szInfoBodyColor+"",d[k+y*a]);map.Dom.wrapText(m,C);l[k][y]=m;v[k]=m;1<e&&0===y&&!w&&(szTextGridStyle.match(/firstsmall/)&&
m.style.setProperty("font-size",String(map.Scale.normalY(.9*f))+"px",""),szTextGridStyle.match(/firstitalic/)&&m.style.setProperty("font-style","italic",""),szTextGridStyle.match(/firstgray/)&&m.style.setProperty("fill","#888888",""));if(g&&g[k+y*a])try{var p=__getStyleArray(g[k+y*a]),t;for(t in p)m.style.setProperty(t,p[t],"")}catch(x){}m.setAttribute("transform","matrix(1 0 0 1 "+u+" "+h+")");"a"!=m.nodeName&&m.style.setProperty("pointer-events","none","")}r=map.Dom.getBox(n).width;if(szTextGridStyle.match(/firstright/)&&
0===y)for(k=0;k<a;k++)v[k].setAttribute("transform","matrix(1 0 0 1 "+(u+r)+" "+h+")"),v[k].style.setProperty("text-anchor","end","");u=r+map.Scale.normalX(f)+map.Scale.normalX(5);if(0===y)var F=u}d=map.Scale.normalY(f);for(k=0;k<a;k++){g=map.Scale.normalY(f);for(var y=0;y<e;y++)g=Math.max(g,map.Dom.getBox(l[k][y]).height);for(y=0;y<e;y++)p=getMatrix(l[k][y]),p[5]+=d,setMatrix(l[k][y],p);d+=g+map.Scale.normalY(2)}e=map.Dom.getBox(n);for(k=0;k<a;k++)c[k]&&(szTextGridStyle.match(/full/)?c[k].setAttributeNS(null,
"width",e.width+map.Scale.normalX(f/2)):c[k].setAttributeNS(null,"width",F-map.Scale.normalX(5)));(F=SVGDocument.getElementById("TextLinesBgPattern:antizoomandpan"))&&F.setAttributeNS(null,"patternTransform","matrix(1 0 0 1 0 "+String(h-map.Scale.normalY(f-1))+")");return b},__textField_group=null,__textField_frame=null,__textField_shadow=null,__textField_fontheight=12;
function createTextField(a,b,c,d,e){e||(e=12);if(a&&b)return a=map.Dom.newGroup(b,c),b=map.Dom.newShape("rect",a,1,1,1,1,"fill:#444444;opacity:0.5;stroke:none"),c=map.Dom.newShape("rect",a,1,1,1,1,"fill:#fefeff;stroke:#444444;stroke-width:"+map.Scale.normalX(.2)+""),map.Dom.newText(a,0,map.Scale.normalY(1.25*e),"font-family:arial;font-size:"+map.Scale.normalY(e)+"px;fill:"+szInfoBodyColor+"",d),__textField_group=a,__textField_frame=c,__textField_shadow=b,__textField_fontheight=e,sizeTextField(),a}
function sizeTextField(){var a=__textField_fontheight,b=map.Dom.getBox(__textField_group);__textField_frame.setAttributeNS(null,"rx",map.Scale.normalX(2));__textField_frame.setAttributeNS(null,"ry",map.Scale.normalX(2));__textField_frame.setAttributeNS(null,"x",-map.Scale.normalX(.75*a));__textField_frame.setAttributeNS(null,"y",-map.Scale.normalY(1));__textField_frame.setAttributeNS(null,"width",b.width+map.Scale.normalX(1.5*a));__textField_frame.setAttributeNS(null,"height",b.height+map.Scale.normalY(a)/
2);__textField_shadow.setAttributeNS(null,"rx",map.Scale.normalX(4));__textField_shadow.setAttributeNS(null,"ry",map.Scale.normalX(4));__textField_shadow.setAttributeNS(null,"x",-map.Scale.normalX(.75*a)+map.Scale.normalX(2));__textField_shadow.setAttributeNS(null,"y",map.Scale.normalY(2));__textField_shadow.setAttributeNS(null,"width",b.width+map.Scale.normalX(1.5*a)+map.Scale.normalX(1.5));__textField_shadow.setAttributeNS(null,"height",b.height+map.Scale.normalX(a)/2-map.Scale.normalX(0))}
function displayScale(a,b){if(fScaleBar){for(var c=map.Scale.nTrueMapScale*map.Scale.nZoomScale,d=0,d=0;10<c;d++)c/=10;for(c=5<c?10:2.5<c?5:1.1<=c?2.5:1;0<d;d--)c*=10;var e=c/(map.Scale.nMapScale*map.Scale.nZoomScale)*(map.Scale.nMapPPI/nInch);(d=map.Dom.getObjectById("legend:scalegroup"))||(d=map.Dom.newGroup(SVGMenuGroup,"legend:scalegroup"));d.hasChildNodes();d.fu.clear();var f=d.getAttributeNS(szMapNs,"scaleunits"),g=d.getAttributeNS(szMapNs,"barcolor"),h=d.getAttributeNS(szMapNs,"bgcolor"),l=
d.getAttributeNS(szMapNs,"bgstyle"),k=d.getAttributeNS(szMapNs,"bgopacity"),w=d.getAttributeNS(szMapNs,"maxwidth");if(null==l||1>l.length)l=null==h||1>h.length?"fill:white;":"fill:"+h+";",k&&(l+="opacity:"+k+";");0===w&&(w=map.Scale.bBox.width/3/map.Scale.normalX(1));if(null==g||1>g.length)g="red";g="fill:"+g+("#ffffff"==g?";stroke:black;stroke-width:0.1;":"")+";pointer-events:none";l=map.Dom.newShape("rect",d,map.Scale.normalX(0),map.Scale.normalY(0),map.Scale.normalX(0),map.Scale.normalY(0),l);
h=map.Scale.nTrueMapScale*map.Scale.nZoomScale;h=1<=h?"1:"+String(__formatValue(h,0,"BLANK")):String(__formatValue(1/h,0,"BLANK"))+":1";map.Dom.newText(d,0,map.Scale.normalY(12),"font-family:arial;font-size:"+map.Scale.normalY(9)+"px;fill:"+szInfoBodyColor+"",h).fu.setPosition(0,-map.Scale.normalY(10));if(0<w){h=0;f=f.length?f:"meters";k=100;"feet"==f?(k=33.3,3E4<c&&(f="miles",k=5280*33.3)):1E4<c&&(f="km",k=1E5);for(var v=0;20>v;v++){var n=1==v%2?g:"fill:black;pointer-events:none";map.Dom.newShape("rect",
d,map.Scale.normalX(h),map.Scale.normalY(5),map.Scale.normalX(e),map.Scale.normalY(5),n);var n=Math.floor(c/k*v*100)/100,u=f;0<v&&(u=Math.floor(n)!=n?String(n):String(Math.floor(n)));map.Dom.newText(d,0===v?map.Scale.normalX(h):map.Scale.normalX(h-4),map.Scale.normalY(18),"font-family:arial;font-size:"+map.Scale.normalY(8)+"px;fill:"+szInfoBodyColor+";pointer-events:none;",u);h+=e;if(1<w&&h>w||map.Scale.mapPosition.x&&map.Scale.normalX(h)>9*map.Scale.bBox.width/10||!map.Scale.mapPosition.x&&map.Scale.normalX(h)>
map.Scale.bBox.width/2)break}c=map.Scale.nTrueMapScale*map.Scale.nZoomScale/k;100<c?Math.round(c):Math.round(100*c)}else map.Dom.newShape("rect",d,map.Scale.normalX(50),map.Scale.normalY(20),map.Scale.normalX(1),map.Scale.normalY(1),"fill:white;opacity:0;");c=map.Dom.getBox(d);l&&(l.setAttributeNS(null,"x",c.x-map.Scale.normalX(7)),l.setAttributeNS(null,"y",c.y-map.Scale.normalY(2)),l.setAttributeNS(null,"width",c.width+map.Scale.normalX(14)),l.setAttributeNS(null,"height",c.height+map.Scale.normalY(4)),
l.setAttributeNS(null,"rx",map.Scale.normalY(2)),l.setAttributeNS(null,"ry",map.Scale.normalY(2)));b&&(w=map.Scale.normalX(8),e=map.Scale.normalX(nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.bBox.height<map.Scale.viewBox.height&&(w=map.Scale.normalX(2),e=0),w=map.Scale.mapPosition.x+w,"bottom"==b?d.fu.setPosition(w+e,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-e-c.height):d.fu.setPosition(w+e,-c.y+map.Scale.normalY(2)+map.Scale.normalY(1)+e));d.fu.setPosition(50,
map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-90);l&&(c=d.fu.getPosition().y>map.Scale.normalY(100)?"top":"bottom",l.setAttributeNS(null,"onclick","displayScale(evt,'"+c+"')"));SVGPopupGroup&&(SVGPopupGroup.fu.clear(),d.setAttributeNS(szMapNs,"tooltip","click to move it"))}}Map.Toolbar=function(a){this.init(a)};Map.Toolbar.prototype=new Map;
Map.Toolbar.prototype.init=function(a){a=SVGDocument.getElementById("legend:toolbar");var b=SVGDocument.getElementById("toolbar");a&&b&&(b.setAttributeNS(null,"id","toolbar:movable"),map.Dom.clearGroup(a),a.appendChild(b),a.setAttributeNS(null,"cursor","pointer"),this.refresh())};
Map.Toolbar.prototype.refresh=function(a){if((a=SVGDocument.getElementById("legend:toolbar"))&&!(map.Legend&&map.Legend.objNode&&map.Legend.objNode.fu.isContained(a))){var b=map.Scale.normalX(nMapBorderWidth);a.fu=new Methods(a);var c=a.fu.getPosition(),d=a.getAttributeNS(szMapNs,"position");d.match(/NONE/)&&a.style.setProperty("display","none","");d.match(/INMAP/)&&(d.match(/RIGHT/)?(d=a.fu.getBox(),a.fu.setPosition(map.Scale.mapPosition.x+map.Scale.bBox.width-b-map.Scale.normalX(10)-d.width,c.y+
b)):a.fu.setPosition(map.Scale.mapPosition.x+map.Scale.normalX(6)+b,c.y+b))}};
Map.Legend=function(a){a=a?a.target.ownerDocument:SVGDocument;var b=a.getElementById("legend:group");if(!b||"undefined"==typeof b)return null;this.fInitializing=!0;this.lastItemObjectA=[];this.objNode=b;this.objNode.fu=new Methods(this.objNode);a=a.getElementById("legend_body");try{map.Dictionary.applyToNode(a)}catch(c){}this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity","0","");fAllIncluded||fPDFEmbed?this.init():setTimeout("map.Legend.init()",500)};
Map.Legend.prototype=new Map;
Map.Legend.prototype.init=function(a){if(!0!==this.blockRecursion){var b=map.Scale.mapPosition.x?map.Scale.normalY(10):map.Scale.normalY(60),c=a?a.target.ownerDocument:SVGDocument,d=c.getElementById("legend:group");if(!d)return this.fInitializing=!1;this.objNode=d;this.objNode.fu=new Methods(this.objNode);var e=c.getElementById("legend_title");c.getElementById("legend_onoff_bg:sizeable");var f=c.getElementById("legend_body"),g=c.getElementById("legend:toolbar"),h=c.getElementById("legend_bg"),l=c.getElementById("legend_body_bg"),
k=c.getElementById("legend_body_header"),w=c.getElementById("legend_body_footer"),v=c.getElementById("legend_body:frame"),n=c.getElementById("legend:off:legend_body"),u=c.getElementById("legend_body:workspace:movabley");try{var C=map.Dom.getBox(u?u:f)}catch(y){this.fHidden||(this.show(),setTimeout("map.Legend.init()",10));this.fInitializing=!1;return}var r=1E5,m=1E5,p=SVGDocument.getElementById("legend:param");p&&(r=Number(p.getAttributeNS(szMapNs,"maxwidth")),m=Number(p.getAttributeNS(szMapNs,"maxheight")),
r=r?map.Scale.normalX(r):1E6,m=m?map.Scale.normalY(m):1E6);(p=SVGDocument.getElementById("test:markerrect"))&&p.parentNode.removeChild(p);this.fInitializing&&(this.blockRecursion=!0,this.checkGroupCollapse(null),this.blockRecursion=!1);try{C=map.Dom.getBox(u?u:f)}catch(t){C=new box(0,0,map.Scale.normalX(150),map.Scale.normalX(300))}var x=__getLegendPartBox(a,e),p=__getLegendPartBox(a,k),u=__getLegendPartBox(a,w);g&&g.parentNode==f&&(g.fu=new Methods(g),g=g.fu.getBox(),0>=g.y&&0<g.width&&1E5>g.width&&
(p.y+=g.y+g.height,p.width=Math.max(p.width,g.width),k&&(k.fu=new Methods(k),k.fu.setPosition(p.x,p.y))));if(p.y||p.height)v.fu=new Methods(v),v.fu.setPosition(v.fu.getPosition().x,p.y+p.height);C.height+=map.Scale.normalY(0);(g=SVGDocument.getElementById("legend:show:button"))&&g.style.setProperty("display","none","");f&&l&&(map.Scale.legendWidth=Math.max(x.x+x.width+map.Scale.normalX(10),Math.max(C.x+C.width,Math.max(p.x+p.width,u.x+u.width)))+map.Scale.normalX(20),map.Scale.legendWidth=Math.min(map.Scale.legendWidth,
r),r=this.objNode.fu.getPosition(),r.x<map.Scale.mapPosition.x&&0<map.Scale.viewBox.width-map.Scale.bBox.width?(map.Scale.legendWidth=map.Scale.mapPosition.x-map.Scale.normalX(2),m=1E5,this.fInMap=!1,fLegendToggleButtons&&(r=Number(l.getAttributeNS(null,"y")),l.setAttributeNS(null,"y",r+map.Scale.normalX(-100)),SVGDocument.getElementById("legend:hide:button")||(r=new Button(d,"legend:hide","BUTTON","#expand_left_button","map.Api.extendMap()","","expand map"),r.nodeObj.style.setProperty("opacity",
"0.9",""),r.scale(1.8,1.8),r.setPosition(map.Scale.legendWidth-map.Scale.normalX(6),map.Scale.mapPosition.y+map.Scale.normalY(8))),SVGDocument.getElementById("legend:show:button")||(r=new Button(d.parentNode,"legend:show","BUTTON","#expand_right_button","map.Api.normalMap()","","show legend"),d.parentNode.insertBefore(r.nodeObj,d.parentNode.firstChild),r.scale(1.8,1.8),r.nodeObj.style.setProperty("opacity","0.8",""),r.nodeObj.style.setProperty("display","none",""),fMapBorder3D&&SVGDocument.getElementById(szShadowFilterId)&&
r.nodeObj.style.setProperty("filter","url(#"+szShadowFilterId+")",""),r.setPosition(map.Scale.normalX(9),map.Scale.mapOffset.y+map.Scale.normalY(14))))):r.x>=map.Scale.mapPosition.x+map.Scale.bBox.width?(map.Scale.legendWidth=map.Scale.viewBox.width-map.Scale.mapPosition.x-map.Scale.bBox.width-map.Scale.normalX(8),m=1E5,this.fInMap=!1):(this.objNode.fu.setPosition(map.Scale.normalX(8+nMapBorderWidth),map.Scale.normalY(nMapBorderWidth)),m+=u.height,k&&k.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),
n&&n.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),this.fInMap=!0),map.Scale.legendHeight=Math.min(C.y+C.height+p.y+p.height+u.height+map.Scale.normalY(6),Math.min(m,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-b)),l.setAttributeNS(null,"width",map.Scale.legendWidth),l.setAttributeNS(null,"height",map.Scale.legendHeight-Number(l.getAttributeNS(null,"y"))+map.Scale.normalY(5)),l.setAttributeNS(null,"rx",map.Scale.normalX(2)),l.setAttributeNS(null,"ry",map.Scale.normalX(2)),
this.fInMap&&(fObjectPseudoShadow&&!this.shadowNode&&(d=(b=l.style.getPropertyValue("opacity"))&&b.length?Number(b):1,b=l.style.getPropertyValue("fill-opacity"),b=d*(b&&b.length?Number(b):1),b=1==b?.5*b:.2*b,this.shadowNode=map.Dom.newShape("rect",f,map.Scale.normalX(3),map.Scale.normalY(-19),map.Scale.normalX(10),map.Scale.normalY(10),"fill:#444444;stroke:#888888;opacity:"+b+";"),this.shadowNode=f.insertBefore(this.shadowNode,l)),this.shadowNode.setAttributeNS(null,"width",map.Scale.legendWidth),
this.shadowNode.setAttributeNS(null,"height",map.Scale.legendHeight-Number(l.getAttributeNS(null,"y"))+map.Scale.normalY(5)),this.shadowNode.setAttributeNS(null,"rx",map.Scale.normalX(5)),this.shadowNode.setAttributeNS(null,"ry",map.Scale.normalX(5))),l.setAttributeNS(szMapNs,"menu","legendmenu"));f&&h&&h.setAttributeNS(null,"width",C.x+C.width-map.Scale.normalY(15));f&&n&&fInitLegendOff&&(f.style.setProperty("display","none",""),n.style.setProperty("display","none",""));f=null;if(v)if(f=map.Dom.setClipRect(v,
new box(0,0,1,1)),v=map.Scale.legendHeight-p.height-u.height,C.height<=v?(f.setAttributeNS(null,"width",map.Scale.legendWidth),f.setAttributeNS(null,"height",C.y+C.height+map.Scale.normalY(10))):(f.setAttributeNS(null,"width",map.Scale.legendWidth),f.setAttributeNS(null,"height",v)),w&&(w.fu=new Methods(w),w.fu.setPosition(0,map.Scale.legendHeight-u.height-map.Scale.normalY(2)),map.Dom.setClipRect(w,new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),map.Scale.viewBox.height))),k&&map.Dom.setClipRect(k,
new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),v)),e&&map.Dom.setClipRect(e,new box(map.Scale.normalX(-20),map.Scale.normalY(-20),map.Scale.legendWidth-map.Scale.normalX(0),v)),this.scrollObj)e=new box(f.getAttributeNS(null,"x"),f.getAttributeNS(null,"y"),f.getAttributeNS(null,"width"),f.getAttributeNS(null,"height")),this.scrollObj.setWidth(e.width/map.Scale.normalX(1)),this.scrollObj.setHeight(e.height/map.Scale.normalY(1)),this.scrollObj.reformat(a);else if(k=c.getElementById("legend_body:workspace:movabley"))e=
new box(f.getAttributeNS(null,"x"),f.getAttributeNS(null,"y"),f.getAttributeNS(null,"width"),f.getAttributeNS(null,"height")),this.scrollObj=new ScrollArea(a,null,null,e.width/map.Scale.normalX(1),e.height/map.Scale.normalY(1),10),this.scrollObj.workspaceNode=k,this.scrollObj.cliprectNode=f,this.scrollObj&&this.scrollObj.reformat(a);fClipMapToLegend&&(a=c.getElementById("mapcliprect"))&&(c=map.Dom.getBox(a),c=c.x+c.width,e=map.Scale.normalX(5),a.setAttributeNS(null,"x",map.Scale.legendWidth+e),a.setAttributeNS(null,
"width",c-map.Scale.legendWidth-e));this.fInitializing=!1;this.objNode.parentNode.appendChild(this.objNode);this.fHidden||this.show();return!0}};Map.Legend.prototype.move=function(a){mouseObject=new MouseObject(a,this.objNode)};Map.Legend.prototype.reformat=function(a){this.scrollObj&&this.scrollObj.reformat(a)};
Map.Legend.prototype.hide=function(a){this.objNode.style.setProperty("display","none","");this.fHidden=!0;(a=SVGDocument.getElementById("legend:show:button"))&&a.style.setProperty("display","inline","")};Map.Legend.prototype.show=function(a){this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity","1","");this.fHidden=!1;(a=SVGDocument.getElementById("legend:show:button"))&&a.style.setProperty("display","none","")};
Map.Legend.prototype.getPosition=function(a){return(a=(a?a.target.ownerDocument:SVGDocument).getElementById("legend:group"))?(a=getMatrix(a),new point(a[4],a[5])):new point(0,0)};
function __getLegendPartBox(a,b){var c=new box(0,0,0,0);if(b)try{if("text"==b.nodeName)return map.Dom.getBox(b);for(var d=b.childNodes,e=0;e<d.length;e++)if(1==d.item(e).nodeType){var f=getScale(d.item(e)),g=getTranslate(d.item(e)),h=map.Dom.getBox(d.item(e));h.x=g.x+h.x*f.x;h.y=g.y+h.y*f.y;h.width*=f.x;h.height*=f.y;if(d.item(e).getAttributeNS(null,"id").match(/overviewmap/)){var l=SVGDocument.getElementById("overviewmap:clippath");l&&(h=map.Dom.getBox(l),h.height=l.firstChild.getAttribute("height"),
h.width=l.firstChild.getAttribute("width"),h.height=c.height+h.height*map.Scale.getGroupScale(l).y,h.width*=map.Scale.getGroupScale(l).x)}isNaN(h.width)||isNaN(h.height)||0>h.width||0>h.height||(c.x=Math.min(c.x,h.x),c.y=Math.min(c.y,h.y),c.width=Math.max(c.width,h.x+h.width),c.height=Math.max(c.height,h.y+h.height))}if(isNaN(c.width)||isNaN(c.height)||0>c.width||0>c.height)c=new box(0,0,0,0)}catch(k){c=new box(0,0,0,0)}return c}
Map.Legend.prototype.checkGroupCollapse=function(a,b){var c=a?a.target.ownerDocument:SVGDocument;null==b&&(b=c.getElementById("legend_body:workspace:movabley"));if(b&&1==b.nodeType)for(var d=b.childNodes,e=0;e<d.length;e++)if(1==d.item(e).nodeType){var f=d.item(e).getAttributeNS(szMapNs,"mode");f&&f.match(/HIDDEN/)&&(f=d.item(e).getAttributeNS(null,"id").split(":"),"legend"==f[0]&&"item"==f[1]&&(f=c.getElementById("legend:collapse:"+f[2]),this.legendMouseClick(a,f)));this.checkGroupCollapse(a,d.item(e))}};
Map.Legend.prototype.legendMouseClick=function(a,b){if(null==b||1!=b.nodeType)return!1;var c=b.getAttributeNS(null,"id");if(c&&!c.match(/legend/))return!1;if(c&&c.match(/this:item/))return this.execLegendMouseClickOnItem(a,b,c),!0;for(var c=c.split(":"),d=3;d<c.length;d++)c[2]+=":"+c[d];this.execLegendMouseClick(a,b,c[2],c[1])||this.execLegendMouseClickOnTiles(a,b,c[2],c[1])||(clearThemes(),setMapTool(""));c[2]&&!c[2].match(/:label/)&&map.Layer.isScaleDependentLayerOn(c[2]+":label")&&this.execLegendMouseClick(a,
b,c[2]+":label",c[1]);return!0};
Map.Legend.prototype.execLegendMouseClick=function(a,b,c,d,e){if(null==c||null==d)return!1;if("mapzoom"==d&&!c.match(/label/))return map.Zoom.doZoomMap(c,"byfactor"),!0;if("textscale"==d&&!c.match(/label/))return map.Layer.changeLabelScaling(null,c,"byfactor"),!0;if("backwards"==d&&!c.match(/label/))return zoomAndPanHistory.backwards(),!0;if("activatetool"==d&&!c.match(/label/))return setMapTool(c),!0;var f=map.Dom.getAttributeByNodeOrParents(b,szMapNs,"classname");f.match(/legendgroup/)&&(f=null);
switch(d){case "suboff":d="off";case "off":e&&e.length?map.Layer.switchLayerByCSS(a,c,f,"none"):c.match(/\'/)?map.Layer.switchLayer(a,c,f,!1):executeWithMessage("map.Layer.switchLayer(null,'"+c+"','"+f+"',false)","...");b.style.setProperty("display","none","");!c.match(/label/)&&fCheckSublayerCollapse&&__checkCollapsable(b,"collapse");break;case "on":e&&e.length?map.Layer.switchLayerByCSS(a,c,f,"inline"):c.match(/\'/)?map.Layer.switchLayer(a,c,f,!0):executeWithMessage("map.Layer.switchLayer(null,'"+
c+"','"+f+"',true)","...");(e=SVGDocument.getElementById("legend:off:"+c))&&e.style.setProperty("display","inline","");!c.match(/label/)&&fCheckSublayerCollapse&&__checkCollapsable(b,"expand");map.Event.doDefaultZoom(a);break;case "collapse":b.style.setProperty("display","none","");__checkCollapsable(b,"collapse");break;case "expand":(e=SVGDocument.getElementById("legend:collapse:"+c))&&e.style.setProperty("display","inline","");__checkCollapsable(b,"expand");break;case "setactive":activateTheme(c);
szMapToolType.match(/select/)||setMapTool("info");break;case "item":try{this.lastItemObjectA[c].redraw()}catch(g){}}__setThemeState(c,d);return!0};
Map.Legend.prototype.execLegendMouseClickOnItem=function(a,b,c){if((a=map.Dom.getAttributeByNodeOrParents(b,szMapNs,"onactivate"))&&a.length){var d=c.split(":"),e=d[d.length-1];switch(d[1]){case "off":b.style.setProperty("display","none","");try{this.lastItemObjectA[e]&&this.lastItemObjectA[e].remove()}catch(f){}this.lastItemObjectA[e]=null;break;case "on":if(this.lastItemObjectA[e])break;c="legend:off:"+c.substr(10,c.length-10);(b=SVGDocument.getElementById(c))&&b.style.setProperty("display","inline",
"");try{this.lastItemObjectA[e]=eval(a),this.lastItemObjectA[e]&&(this.lastItemObjectA[e].onremove="map.Legend.setLegendCheckBox(null,'"+c+"','unchecked');map.Legend.lastItemObjectA['"+e+"']=null;deactivateTheme('"+e+"')",this.lastItemObjectA[e].szItem=e)}catch(g){alert("ERROR: "+g.description+" \nIN: "+a)}}}return!0};
function __opacityPlus(a){if(map.Event.fMouseDown){var b=SVGDocument.getElementById(a),c=b.style.getPropertyValue("opacity"),c=""!==c?Number(c):1;1>c&&(b.style.setProperty("opacity",String(c+.1),""),setTimeout("__opacityPlus('"+a+"')",200))}}function __opacityMinus(a){if(map.Event.fMouseDown){var b=SVGDocument.getElementById(a),c=b.style.getPropertyValue("opacity"),c=""!==c?Number(c):1;0<c&&(b.style.setProperty("opacity",String(c-.1),""),setTimeout("__opacityMinus('"+a+"')",200))}}
Map.Legend.prototype.execLegendMouseClickOnTiles=function(a,b,c,d){var e=!1;if(c&&map.Tiles&&0<map.Tiles.nCount)for(var f=map.Tiles.getTileNodeIds(c),g=0;g<f.length;g++)this.execLegendMouseClick(a,b,f[g],d)&&(e=!0);e||(f=map.Dom.getAttributeByNodeOrParents(b,szMapNs,"classname"))&&f.length&&(e=this.execLegendMouseClick(a,b,c,d,f));return e};
Map.Legend.prototype.setLegendCheckBox=function(a,b,c){if(b.match(/legend/)){a=b.split(":");b="legend:off";for(var d=2;d<a.length;d++)b+=":"+a[d]}(b=SVGDocument.getElementById(b))&&b.style.setProperty("display","checked"==c?"inline":"none","")};
Map.Legend.prototype.switchLegendCheckBox=function(a,b,c){a="legend:off:"+b;var d=SVGDocument.getElementById(a);d||(d=SVGDocument.getElementById(a+":byclassname"));d&&d.style.setProperty("display",c,"");(d=SVGDocument.getElementById("legend:setactive:"+b))&&d.style.setProperty("opacity","none"==c?"0.4":"1","")};
function __setThemeState(a,b){var c=SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(c)for(var d=0;d<c.length;d++)c.item(d).getAttributeNS(null,"name")==map.Tiles.getMasterId(a)&&c.item(d).setAttributeNS(null,"state",b)}function __getThemeState(a){var b=SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(b)for(var c=0;c<b.length;c++)if(b.item(c).getAttributeNS(null,"name")==map.Tiles.getMasterId(a))return b.item(c).getAttributeNS(null,"state");return"none"}
function __checkCollapsable(a,b){if(null!=a){var c=a.getAttributeNS(null,"id");if(!c.match(/label/)){var d,e=c.split(":"),c=e[0]+":item:"+e[2];for(d=3;d<e.length;d++)c=c+":"+e[d];if(c=a.ownerDocument.getElementById(c)){var f,e=null,g=c.childNodes;for(d=0;d<g.length;d++)if(1==g.item(d).nodeType&&g.item(d).getAttributeNS(null,"id")&&g.item(d).getAttributeNS(null,"id").match(/collapsable/)){f=0;switch(b){case "collapse":if("collapsed"==g.item(d).getAttributeNS(szMapNs,"state")||g.item(d).getAttributeNS(null,
"id").match(/placeholder/))break;(e=a.ownerDocument.getElementById(g.item(d).getAttributeNS(null,"id")+":end"))?f=-e.getAttributeNS(null,"y")+map.Scale.normalY(20):(e=map.Dom.getBox(g.item(d)),f=-e.height);e=map.Dom.newGroup(g.item(d).parentNode,g.item(d).getAttributeNS(null,"id")+":placeholder");e.setAttributeNS(szMapNs,"state","collapsed");e.parentNode.insertBefore(e,g.item(d));SVGHiddenGroup.appendChild(g.item(d+1));break;case "expand":if("collapsed"!=g.item(d).getAttributeNS(szMapNs,"state")&&
!g.item(d).getAttributeNS(null,"id").match(/placeholder/))break;f=null;if(g.item(d).getAttributeNS(null,"id").match(/placeholder/)){e=g.item(d);f=e.getAttributeNS(null,"id").split(":");g="";for(d=0;d<f.length-1;d++)g+=0<d?":":"",g+=f[d];f=SVGDocument.getElementById(g);e.parentNode.replaceChild(f,e);f=SVGDocument.getElementById(g)}else f=g.item(d);f.setAttributeNS(szMapNs,"state","expanded");(e=a.ownerDocument.getElementById(f.getAttributeNS(null,"id")+":end"))?f=e.getAttributeNS(null,"y")-map.Scale.normalY(20):
(e=map.Dom.getBox(f),f=e.height)}for(d=c.nextSibling;d&&f;)if(1==d.nodeType&&(e=getMatrix(d),e[5]+=f,setMatrix(d,e)),d=d.nextSibling,null==d)for(;c.parentNode&&c.parentNode.getAttributeNS(null,"id").match(/legend/);)if(c=c.parentNode,c.getAttributeNS(null,"id").match(/item/)){d=c.nextSibling;break}try{map.Legend.init(null)}catch(h){}break}}}}}var zoomAndPanHistory=new History;highLightList=new HighLight;
