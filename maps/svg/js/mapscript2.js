Map.Label=function(b){this.document=b?b.target.ownerDocument:SVGDocument;this.checkItemA=[];this.checkOvlA=[];this.nodeA=[];this.boxA=[];this.rootNode=null;this.zoomScale=0;this.fCheckLabelOverlappingPending=!1;this.ALTS_rootNode=this.ALTS_nodeA=this.ALTS_textA=null;this.killProcess=this.fAdaptLabelToScalingPending=!1};Map.Label.prototype=new Map;
Map.Label.Item=function(b){if(b)this.textNode=b,this.szId=b.getAttributeNS(null,"id")||"noId",this.bgNode=SVGDocument.getElementById(this.szId+":bg"),this.bbNode=SVGDocument.getElementById(this.szId+":textbg"),this.poNode=SVGDocument.getElementById(this.szId.slice(0,this.szId.length-1)),this.poNode||(b=map.Tiles.getMasterId(this.szId),b=b.slice(0,b.length-1),this.poNode=SVGDocument.getElementById(b)),this.bBox=null;else return this.szId="mapLabelNullItem",null};
Map.Label.Item.prototype.setDisplay=function(b){this.textNode.style.setProperty("display",b,"");this.bgNode&&this.bgNode.style.setProperty("display",b,"");this.bbNode&&this.bbNode.style.setProperty("display",b,"");this.poNode&&"use"==this.poNode.nodeName&&this.poNode.style.setProperty("display",b,"")};Map.Label.Item.prototype.setScale=function(b,d){setScale(this.textNode,b,d);this.bgNode&&setScale(this.bgNode,b,d);this.bbNode&&setScale(this.bbNode,b,d)};
Map.Label.Item.prototype.scaleBackground=function(){if(this.bbNode&&this.textNode){var b=map.Scale.normalX(2)*map.Scale.nZoomScale,d=map.Dom.getBox(this.textNode),e=getTranslateAttributeValue(this.textNode);0<d.width&&0<d.height&&(this.bbNode.setAttributeNS(null,"x",d.x+(e.x?e.x-b:0)),this.bbNode.setAttributeNS(null,"y",d.y-b+e.y),this.bbNode.setAttributeNS(null,"width",d.width+2*b),this.bbNode.setAttributeNS(null,"height",d.height+2*b))}};
Map.Label.prototype.stopProcessing=function(){this.killProcess=!0};Map.Label.prototype.prepareCheckOverlap=function(b){b=b.getElementsByTagName("text");for(var d=0;d<b.length;d++)b.item(d).firstChild&&"textPath"!=b.item(d).firstChild.nodeName&&!b.item(d).getAttributeNS(null,"id").match(/:bg/)&&(new Map.Label.Item(b.item(d))).setDisplay("none")};
Map.Label.prototype.initCheckOverlap=function(b){this.killProcess=!1;this.fCheckLabelOverlappingPending||(this.fCheckLabelOverlappingPending=!0,this.checkItemA.length=0,this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0,this.rootNode=b,fPDFEmbed||!map.Tiles.dataNode?setTimeout("map.Label.collectCheckOverlap()",0):map.pushAction("map.Label.collectCheckOverlap()"))};Map.Label.prototype.getCheckItem=function(b){return this.checkItemA[b]};Map.Label.prototype.getCheckItemCount=function(){return this.checkItemA.length};
Map.Label.prototype.addCheckItem=function(b,d){if(b){var e=map.Layer.getLayerObjOfNode(b);if((!e||b.parentNode.getAttributeNS(null,"id").match(/value/)||"inline"==e.szDisplayLabel)&&(fCheckLabelOverlap||"polygon"==e.szType)&&b.firstChild&&"textPath"!=b.firstChild.nodeName&&!b.getAttributeNS(null,"id").match(/:bg/)){var f=getMatrix(b),f=new point(Number(f[4]),Number(f[5])),g=map.Scale.getMapOffset(b);f.x+=g.x;f.y+=g.y;f.x<this.zoomBox.x||f.x>this.zoomBox.x+this.zoomBox.width||f.y<this.zoomBox.y||f.y>
this.zoomBox.y+this.zoomBox.height||(f=new Map.Label.Item(b),f.fRef=e&&"polygon"==e.szType?!0:!1,f.fScale=d,this.checkItemA[this.checkItemA.length]=f)}}else f=new Map.Label.Item(null),this.checkItemA[this.checkItemA.length]=f};
Map.Label.prototype.collectCheckOverlap=function(){var b=null,d=!1,e=[];for(a in map.Layer.listA)"polygon"==map.Layer.listA[a].szType&&e.push(a);fCheckOverlapAllLayer||e.push("resetoverlap");for(a in map.Layer.listA)"polygon"!=map.Layer.listA[a].szType&&e.push(a);this.zoomBox=map.Zoom.getBox();for(var f=e.length-1;0<=f;f--)if("resetoverlap"==e[f])this.addCheckItem(null);else{var g=map.Layer.listA[e[f]];if(g.szFlag.match(/tiled/)){if(!d&&(d=!0,g=map.Tiles.getTileInfo())){this.addCheckItem(null);for(var h=
0;h<g.length;h++)if("inline"==g[h].tileGroup.style.getPropertyValue("display")){for(var b=g[h].tileGroup.getElementsByTagName("text"),k=b.length-1;0<=k;k--)"none"!=b.item(k).parentNode.style.getPropertyValue("display")&&this.addCheckItem(b.item(k));fCheckOverlapClipOnTiles&&this.addCheckItem(null)}}}else if(g.szName){if(h=SVGDocument.getElementById(g.szName+":label"))if((k=h.getElementsByTagName("g"))&&0<k.length)for(var l=0;l<k.length;l++)for(b=k.item(l).getElementsByTagName("text"),h=b.length-1;0<=
h;h--)this.addCheckItem(b.item(h));else for(b=h.getElementsByTagName("text"),h=b.length-1;0<=h;h--)this.addCheckItem(b.item(h));if(h=SVGDocument.getElementById(g.szName+":values"))for(b=h.getElementsByTagName("text"),h=b.length-1;0<=h;h--)this.addCheckItem(b.item(h))}}d=map.Themes.getTextObjects();for(h=0;h<d.length;h++)this.addCheckItem(d[h],!0);this.zoomScale=map.Scale.nZoomScale;setTimeout("map.Label.getBoxCheckOverlap(0)",100)};
Map.Label.prototype.getBoxCheckOverlap=function(b){var d=new Map.Sleep("map.Label.getBoxCheckOverlap",this.nflushLabelDraw,"");for(_STATUS("Map.Label: getBoxCheckOverlap ==== "+b+" ====== >>>");0<=b;b++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;break}if(d.checkSleep(b,10))break;if(cItem=this.getCheckItem(b))if("mapLabelNullItem"==cItem.szId&&fCheckOverlapImplicit)this.nodeA.length=0;else try{cItem.szOldDisplay=cItem.textNode.style.getPropertyValue("display");cItem.textNode.style.setProperty("display",
"inline","");cItem.setScale(1,1);cItem.textNode.setAttributeNS(null,"x",0);cItem.textNode.setAttributeNS(null,"y",0);cItem.bgNode&&(cItem.bgNode.style.setProperty("display","inline",""),cItem.bgNode.setAttributeNS(null,"x",0),cItem.bgNode.setAttributeNS(null,"y",0));var e=map.Dom.getBox(cItem.textNode);cItem.fScale&&(e.x*=map.Layer.nFeatureScale,e.y*=map.Layer.nFeatureScale,e.width*=map.Layer.nFeatureScale,e.height*=map.Layer.nFeatureScale);var f=map.Scale.getMapOffset(cItem.textNode);e.x+=f.x;e.y+=
f.y;f=getTranslate(cItem.textNode);e.x+=f.x;e.y+=f.y;if(map.Zoom.isVisibleBox(e)&&this.checkLabelSpace(cItem,e)){15<getRotateAttributeValue(cItem.textNode)&&345>getRotateAttributeValue(cItem.textNode)&&cItem.setScale(1,1);cItem.bBox=e;var g=this.nodeA.length;this.checkOvlA[g]=cItem;this.nodeA[g]=cItem.textNode;this.boxA[g]=e;fCheckLabelOverlap||(cItem.setDisplay("inline"),cItem.scaleBackground());fCheckOverlapImplicit&&this.execCheckLabelOverlappingOne(g)}else cItem.setDisplay("none")}catch(h){}else{fCheckOverlapImplicit?
this.fCheckLabelOverlappingPending=!1:setTimeout("map.Label.doCheckOverlap()",100);break}}};
Map.Label.prototype.checkLabelSpace=function(b,d){var e=null;if(!b.fRef)return!0;b.szId.match(/#/)?(e=b.szId.split("#"),e=e[0].substr(0,e[0].length-1)+"#"+e[1]):e=b.szId.substr(0,b.szId.length-1);if(e=SVGDocument.getElementById(e))if(b.refBox=map.Dom.getBox(e),e=b.refBox,e.width*=nCheckLabelSpace,d.width>e.width&&fAdaptLabelToScaling){var f=1,g=1;fCheckLabelSqueeze&&(d.width<=2*e.width||!fCheckLabelSpace)&&(f=Math.max(.7,e.width/d.width),d.width*=f,b.setScale(f,1));fCheckLabelSize&&(d.width<=1.5*
e.width||!fCheckLabelSpace)&&(g=Math.max(.7,e.width/d.width),d.width*=g,d.height*=g,b.setScale(f*g,g));if(!fCheckLabelSpace||d.width<=e.width)b.setDisplay("inline");else return b.setDisplay("none"),!1}else b.setDisplay("inline");else b.setDisplay(b.szOldDisplay);return!0};
Map.Label.prototype.doCheckOverlap=function(){fCheckLabelOverlap?2E4<nodeA.length?(this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0):(this.zoomScale=map.Scale.nZoomScale,"delayed"==fCheckLabelOverlap?setTimeout("map.Label.execCheckLabelOverlappingOnly(0)",2E3):map.pushAction("map.Label.execCheckLabelOverlappingOnly(0)")):this.fCheckLabelOverlappingPending=!1};
Map.Label.prototype.execCheckLabelOverlappingOnly=function(b){for(var d=new Map.Sleep("map.Label.execCheckLabelOverlappingOnly",25,"");b<this.checkOvlA.length;b++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;return}if(d.checkSleep(b,10))return;this.execCheckLabelOverlappingOne(b)}this.fCheckLabelOverlappingPending=!1};
Map.Label.prototype.execCheckLabelOverlappingOne=function(b){var d,e,f=this.checkOvlA[b];if(map.Zoom.isVisibleBox(f.bBox)){f.refBox||f.setDisplay("inline");if(fCheckLabelOverlap)for(var g=f.textNode.firstChild.nodeValue,h=f.bBox,k=Number(f.textNode.getAttributeNS(szMapNs,"pos")),l=!1,m=0;m<b;m++){d=this.checkOvlA[m].textNode.firstChild.nodeValue;var n=this.checkOvlA[m].bBox;if(fCheckLabelOnlyOne&&g==d){e=Number(f.textNode.getAttributeNS(szMapNs,"partlen"));d=Number(this.checkOvlA[m].textNode.getAttributeNS(szMapNs,
"partlen"));if(e>d){this.checkOvlA[m].bBox=null;this.checkOvlA[m].setDisplay("none");continue}f.setDisplay("none");f.bBox=null}if(h&&n&&f.textNode!=this.checkOvlA[m].textNode&&map.Tiles.getMasterId(f.szId)!=map.Tiles.getMasterId(this.checkOvlA[m].szId)&&__checkOverlapBox(h,n)){if(fKillOverlappingLabel||l){n.height<h.height&&(f.refBox||!this.checkOvlA[m].refBox)?(this.checkOvlA[m].bBox=null,this.checkOvlA[m].setDisplay("none")):(f.setDisplay("none"),f.bBox=null);break}if(f.refBox)h.y>n.y?(f.textNode.setAttributeNS(null,
"y",h.height),f.bgNode&&f.bgNode.setAttributeNS(null,"y",h.height),h.y+=h.height):(f.textNode.setAttributeNS(null,"y",-h.height),f.bgNode&&f.bgNode.setAttributeNS(null,"y",-h.height),h.y-=h.height);else if(d=parseInt(f.textNode.style.getPropertyValue("font-size")),h.y>=n.y&&(11==k||12==k||1==k||9==k||3==k||0==k))f.textNode.setAttributeNS(null,"y",d),f.bgNode&&f.bgNode.setAttributeNS(null,"y",d),h.y+=parseInt(d);else if(h.y<=n.y&&(7==k||6==k||5==k||9==k||3==k||0==k))f.textNode.setAttributeNS(null,
"y",-h.height),f.bgNode&&f.bgNode.setAttributeNS(null,"y",-h.height),h.y-=h.height;else if(h.x<=n.x&&(1==k||3==k||5==k))f.textNode.setAttributeNS(null,"x",-(h.width+50*map.Scale.nZoomScale)),f.bgNode&&f.bgNode.setAttributeNS(null,"x",-(h.width+50*map.Scale.nZoomScale)),h.x-=h.width+50*map.Scale.nZoomScale;else if(h.x>=n.x&&(11==k||9==k||7==k))f.textNode.setAttributeNS(null,"x",+(h.width+50*map.Scale.nZoomScale)),f.bgNode&&f.bgNode.setAttributeNS(null,"x",+(h.width+50*map.Scale.nZoomScale)),h.x+=h.width+
50*map.Scale.nZoomScale;else if(n.height<h.height&&(f.refBox||!this.checkOvlA[m].refBox)){this.checkOvlA[m].bBox=null;this.checkOvlA[m].setDisplay("none");continue}l=!0;m=0}}f.bbNode&&f.scaleBackground()}};__checkOverlapBox=function(b,d){return!b||!d||b.x+b.width<d.x||b.x>d.x+d.width||b.y+b.height<d.y||b.y>d.y+d.height?!1:!0};
Map.Label.prototype.adaptLabelToScaling=function(b,d){this.killProcess=!1;d||(d=SVGRootElement);this.fAdaptLabelToScalingPending=!1;this.ALTS_nodeA=[];this.ALTS_textA=[];this.ALTS_rootNode=d;var e=this.ALTS_nodeA,f=null,g=map.Tiles.getTileInfo();if(g)for(var h=0;h<g.length;h++)if("inline"==g[h].tileGroup.style.getPropertyValue("display"))for(var f=g[h].tileGroup.getElementsByTagName("textPath"),k=0;k<f.length;k++)f.item(k).parentNode.getAttributeNS(null,"id").match(/:bg/)||f.item(k).parentNode.getAttributeNS(null,
"id").match(/:linedecoration/)||(e[e.length]=f.item(k));if(null==e||0==e.length)for(f=SVGRootElement.getElementsByTagName("textPath"),h=0;h<f.length;h++)f.item(h).parentNode.getAttributeNS(null,"id").match(/:bg/)||f.item(h).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||(e[e.length]=f.item(h));map.pushAction("map.Label.execAdaptLabelToScaling(0)")};
Map.Label.prototype.execAdaptLabelToScaling=function(b){for(var d=new Map.Sleep("map.Label.execAdaptLabelToScaling",25,""),e=this.ALTS_nodeA,f=this.ALTS_rootNode,g=null;b<e.length;b++){if(d.checkSleep(b,10))return;var h=e[b].getAttributeNS(szXlink,"href"),h=h.substr(1,h.length-1),k=f.getElementById(h);if(k){var l=k.parentNode.getAttributeNS(null,"id"),g=map.Tiles.getMasterId(l),l=map.Tiles.getTileId(l);if(0==map.Layer.isScaleDependentLayerOn(g))e[b].parentNode.style.setProperty("display","none","");
else if(g=e[b].firstChild.nodeValue,!(this.ALTS_textA[g+l]&&1>=map.Tiles.getTileNodes(map.Tiles.getMasterId(h)).length)){pBox=map.Dom.getBox(k);e[b].setAttributeNS(szXlink,"href","");e[b].parentNode.style.setProperty("display","inline","");e[b].parentNode.style.setProperty("font-stretch","normal","");tBox=map.Dom.getBox(e[b].parentNode);e[b].setAttributeNS(szXlink,"href","#"+h);var m=Math.sqrt(tBox.width*tBox.width+tBox.height*tBox.height),n=Math.sqrt(pBox.width*pBox.width+pBox.height*pBox.height),
w=e[b].parentNode,v=SVGDocument.getElementById(w.getAttributeNS(null,"id")+":bg");v&&v.style.setProperty("display","inline","");if(.9*m<n){if(1.3*m<n?(w.style.setProperty("font-stretch","normal",""),v&&v.style.setProperty("font-stretch","normal","")):(w.style.setProperty("font-stretch","narrower",""),v&&v.style.setProperty("font-stretch","narrower","")),fCheckLabelOnlyOne){var t=map.Scale.getMapOffset(k);pBox.x+=t.x;pBox.y+=t.y;t=getTranslate(k);pBox.x+=t.x;pBox.y+=t.y;k=new box(pBox.x,pBox.y,pBox.width,
pBox.height);k.scale(m/n,m/n);map.Zoom.isCompletelyVisibleBox(k)?fTileTextNoClip?this.ALTS_textA[g]=h:this.ALTS_textA[g+l]=h:(w.style.setProperty("display","none",""),v&&v.style.setProperty("display","none",""))}}else w.style.setProperty("display","none",""),v&&v.style.setProperty("display","none","")}}}__adaptLabelToSymbols(null,f)};__adaptLabelToSymbols=function(b,d){};
Map.Label.prototype.getLabel=function(b){if(!SVGDocument.getElementById(b)){var d=map.Tiles.getTileNodes(map.Tiles.getMasterId(b));if(1>d.length)return null;for(var e=0;e<d.length;e++){var f=this.getLabel(d[e].getAttributeNS(null,"id"));if(f)return f}}b=SVGDocument.getElementById(b);if(!b)return null;if("g"==b.tagName)for(nodeA=b.childNodes,d=0;d<nodeA.length;d++)if(1==nodeA.item(d).nodeType){b=nodeA.item(d);break}d=null;if(d=b.getAttributeNS(null,"id"))if(d.match(/#/)?(d=d.split("#"),d=SVGDocument.getElementById(d[0]+
"T#"+d[1])):d=SVGDocument.getElementById(d+"T"),d)return d.firstChild.nodeValue;return b.getAttributeNS(szMapNs,"tooltip")};Map.Label.prototype.xgetLabel=function(b){map.Layer.getLayerObj(szTheme);return null};Map.Sleep=function(b,d,e){this.szFunction=b;this.initCheckSleep(d,e);this.fShowProgressBar=this.fEnableProgressBar=!1;this.nCount=0;this.szCancel="__cancelSleep()"};
Map.Sleep.prototype.initCheckSleep=function(b,d){this.checkSleepMaxCount=b;this.checkSleepCount=0;this.checkSleepMessage=d;this.runningTime=0;this.fShowProgressBar=this.fMessageDisplay=!1;"string"==typeof this.checkSleepMessage&&this.checkSleepMessage.length&&(fExecuteSilent||displayMessage(this.checkSleepMessage,1E3));__timer_reset()};
Map.Sleep.prototype.checkSleep=function(b,d){if(this.checkSleepMaxCount&&this.checkSleepCount++>=this.checkSleepMaxCount){this.checkSleepCount=0;var e=this.szFunction+"('"+String(b)+"')";this.fShowProgressBar?(this.runningTime=__timer_getSEC(),executeWithProgressBar(e,this.nDoneCount,this.nCount,this.checkSleepMessage,this.szCancel,this.runningTime)):(this.fMessageDisplay||(fExecuteSilent||displayMessage(this.checkSleepMessage,1E3),this.fMessageDisplay=!0),setTimeout(e,d?d:1));return!0}return!1};
Map.Sleep.prototype.checkSleepMS=function(b,d){return this.checkSleepMaxCount&&__timer_getMS()>this.checkSleepMaxCount?(__timer_reset(),setTimeout(this.szFunction+"('"+String(b)+"')",d?d:1),!0):!1};function __cancelSleep(){alert("cancel sleep")}
Map.Tiles=function(){var b=SVGDocument.getElementsByTagNameNS(szMapNs,"tiles");b.length&&(this.tilesNode=SVGDocument.getElementsByTagNameNS(szMapNs,"maptiles"),this.dataNode=b.item(0),this.nCount=this.dataNode.getAttributeNS(null,"count"),this.tileWidth=this.dataNode.getAttributeNS(null,"width"),this.tileHeight=this.dataNode.getAttributeNS(null,"height"),this.tilesRoot=this.dataNode.getAttributeNS(null,"root").split(".")[0],this.tilesSuffix=this.dataNode.getAttributeNS(null,"root").split(".")[1],
this.depUpper=this.dataNode.getAttributeNS(null,"upper"),this.depLower=this.dataNode.getAttributeNS(null,"lower"),fMarkTiles&&this.markTiles(),this.xLoader=null,this.fDiscardPending=!1)};Map.Tiles.prototype=new Map;Map.Tiles.prototype.getTileNodes=function(b){var d=[];b=this.getTileNodeIds(b);for(var e=0;e<b.length;e++){var f=SVGDocument.getElementById(b[e]);f&&(d[d.length]=f)}return d};
Map.Tiles.prototype.getTileNodeIds=function(b){var d=b.split(":");b=d[0];for(var e="",f=1;f<d.length;f++)e+=":"+d[f];d=[];for(f=0;f<this.nCount;f++)for(var g=0;g<this.nCount;g++)d[d.length]=b+"#"+this.buildTileExtension(g,f)+e;return d};
Map.Tiles.prototype.getTilePositions=function(){for(var b=map.Scale.origMinX,d=map.Scale.origMinY,e=[],f=0;f<this.nCount;f++)for(var g=0;g<this.nCount;g++)if(g<this.nCount&&f<this.nCount){var h=new box(b+g*this.tileWidth,d+f*this.tileHeight,this.tileWidth,this.tileHeight);e[e.length]=h}return e};
Map.Tiles.prototype.getTileBox=function(b){var d=b.split("#")[1];if(null==d||0>=d.length)return null;b=Number(d.substr(0,3));d=Number(d.substr(3,3));return new box(d*this.tileWidth-map.Scale.mapOffset.x,b*this.tileHeight-map.Scale.mapOffset.x,this.tileWidth,this.tileHeight)};
Map.Tiles.prototype.getTileInfo=function(){for(var b=map.Scale.origMinX,d=map.Scale.origMinY,e=[],f=1,g=Math.floor(this.nCount/2);g<=this.nCount&&0<=g;){for(var h=1,k=Math.floor(this.nCount/2);k<=this.nCount&&0<=k;){if(k<this.nCount&&g<this.nCount){var l=this.tilesRoot+"_"+this.buildTileExtension(k,g)+"."+this.tilesSuffix,m="tile"+this.buildTileExtension(k,g),n=SVGDocument.getElementById(m),w=new box(b+k*this.tileWidth,d+g*this.tileHeight,this.tileWidth,this.tileHeight);e[e.length]={szUrl:l,szGroup:m,
tileGroup:n,x:k,y:g,bBox:w};l=this.tilesRoot+"_"+this.buildTileExtension(k,g)+"_ncl."+this.tilesSuffix;m="tile"+this.buildTileExtension(k,g)+":noclip";(n=SVGDocument.getElementById(m))&&(e[e.length]={szUrl:l,szGroup:m,tileGroup:n,x:k,y:g,bBox:w})}k+=h;h=Math.abs(h)+1;0==(h&1)&&(h=-h)}g+=f;f=Math.abs(f)+1;0==(f&1)&&(f=-f)}b=e.length;f=d=0;for(a in e)e[a].tileGroup&&(e[a].tileGroup.hasChildNodes()&&d++,"inline"==e[a].tileGroup.style.getPropertyValue("display")&&f++);_STATUS("Tiling: "+b+"/"+d+"/"+f);
return e};Map.Tiles.prototype.getMasterId=function(b){if(null==b)return null;b=b.split(":");for(var d=b[0].split("#")[0],e=1;e<b.length;e++)d+=":"+b[e];b.length=0;return d};Map.Tiles.prototype.getTileId=function(b){if(null==b)return null;b=b.split(":");var d=b[0];b.length=0;return d};Map.Tiles.prototype.buildTileExtension=function(b,d){return __maptheme_formatpart(d,"0")+__maptheme_formatpart(b,"0")};
Map.Tiles.prototype.setShapeStyle=function(b,d){if(b&&this.nCount){var e=new MapObject(b);if(null!=e)for(var e=this.getMasterId(e.szId),f=e.split(":")[0],e=e.substr(f.length,e.length-f.length),f=this.getTileNodeIds(f),g=0;g<f.length;g++)(shapeNode=SVGDocument.getElementById(f[g]+e))&&shapeNode.setAttributeNS(null,"style",d)}};
Map.Tiles.prototype.markTiles=function(){var b=SVGDocument.getElementById("maptilesbg");if(b)for(var d=0;d<this.nCount;d++)for(var e=0;e<this.nCount;e++)map.Dom.newShape("rect",b,-this.tileWidth*this.nCount/2+e*this.tileWidth,-this.tileHeight*this.nCount/2+d*this.tileHeight,this.tileWidth,this.tileHeight,"fill:none;stroke:gray;stroke-width:0.01")};
Map.Tiles.prototype.switchScaleDependentTiles=function(b){if(fDynamicTiles&&!this.clearTiles(b)){var d=!1;if(0<this.nCount){getMatrix(map.Zoom.canvasNode);var e=map.Scale.origMinX,f=map.Scale.origMinY,g=map.Zoom.getBox(),h=this.getTileInfo();if(h)for(var k=0;k<h.length;k++){var l=h[k].szUrl,m=h[k].szGroup,n=h[k].x,w=h[k].y,v=h[k].bBox,t=h[k].tileGroup;t&&((n=new box(e+n*this.tileWidth,f+w*this.tileHeight,this.tileWidth,this.tileHeight),n.x==v.x&&n.y==v.y&&n.width==v.width&&n.height==v.height||alert("switchScaleDependentTiles box error !!"),
n.x+n.width<g.x||n.y+n.height<g.y||n.x>g.x+g.width||n.y>g.y+g.height)?t.hasChildNodes()&&("external"==t.getAttributeNS(szMapNs,"type")?(t.style.setProperty("display","none",""),fDiscardTiles&&"delayed"!=fDiscardTiles&&(map.Themes.removeFromThemeNodesCache(t),map.Dom.clearGroup(t))):t.style.setProperty("display","none","")):t.hasChildNodes()||"external"!=t.getAttributeNS(szMapNs,"type")?"inline"!=t.style.getPropertyValue("display")&&(t.style.setProperty("display","inline",""),d=!0,fAdaptLabelToScaling&&
map.Layer.adaptLabelToScaling(b,t)):(t.style.setProperty("display","inline",""),setTimeout("map.Tiles.loadScaleDependentTiles('"+m+"','"+l+"')",10)))}}"delayed"==fDiscardTiles&&this.discardTiles();d&&(map.Layer.adaptLabel(b,map.Layer.layerNode),map.Layer.doStoredFeatureScaling())}};
Map.Tiles.prototype.loadScaleDependentTiles=function(b,d){_STATUS("Loading Tile:"+d+","+b);var e=SVGDocument.getElementById(b);this.xLoader||(this.xLoader=new SVGLoaderTiles);this.xLoader.importSVGFile(d,SVGDocument,e,null)&&(fTilesLoaded=!0)};Map.Tiles.prototype.isLoading=function(){return this.xLoader?this.xLoader.isLoading():!1};
Map.Tiles.prototype.clearTiles=function(b){if(!fDynamicTiles)return!1;try{for(a in map.Layer.listA){var d=map.Layer.listA[a];if(d.szFlag.match(/tiled/)&&map.Themes.isThemeLayerUsed(d.szName)&&map.Layer.isScaleDependentLayerOn(d.szName))return!1}}catch(e){}if(0<this.nCount){b=1E11;var d=0,f=this.depUpper,g=this.depLower;f&&f.length&&(b=Number(f.split(":")[1]));g&&g.length&&(d=Number(g.split(":")[1]));if(map.Scale.getTrueMapScale()*map.Scale.nZoomScale>=d&&map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=
b)return!1;if(b=this.getTileInfo())for(d=0;d<b.length;d++)(f=b[d].tileGroup)&&f.hasChildNodes()&&(f.style.setProperty("display","none",""),fDiscardTiles&&"delayed"!=fDiscardTiles&&(map.Themes.removeFromThemeNodesCache(f),map.Dom.clearGroup(f)))}"delayed"==fDiscardTiles&&this.discardTiles();return!0};Map.Tiles.prototype.discardTiles=function(b){fTilesLoaded&&fDiscardTiles&&!this.fDiscardPending&&(setTimeout("map.Tiles.doDiscardTiles()",5E3),this.fDiscardPending=!0)};
Map.Tiles.prototype.doDiscardTiles=function(b){if(fDynamicTiles&&fTilesLoaded)if(mouseObject)setTimeout("map.Tiles.doDiscardTiles()",6E3);else{if(map.Tiles&&0<map.Tiles.nCount&&(b=map.Tiles.getTileInfo()))for(var d=0;d<b.length;d++){var e=b[d].tileGroup;if(e&&"none"==e.style.getPropertyValue("display")&&e.hasChildNodes()){map.Themes.removeFromThemeNodesCache(e);map.Dom.clearGroup(e);setTimeout("map.Tiles.doDiscardTiles()",2E3);return}}this.fDiscardPending=!1}else this.fDiscardPending=!1};
Map.Tiles.prototype.isAnyTiledLayerVisible=function(){for(a in map.Layer.listA){var b=map.Layer.listA[a];if(b.szFlag.match(/tiled/)&&(1==b.nState||"none"!=b.szDisplay||"none"!=b.szDisplayLabel))return!0}return!1};Map.Tiles.prototype.allTilesLoaded=function(){var b=this.getTileInfo();if(b){var d=b.length,e=0;for(a in b)b[a].tileGroup&&b[a].tileGroup.hasChildNodes()&&e++;return d==e}return!1};
Map.Tiles.prototype.isAnyLayerTileLoaded=function(b){if(b=this.getTileInfo())for(a in b)if(b[a].tileGroup&&b[a].tileGroup.hasChildNodes())return!0;return!1};Map.Event=function(){this.fPanDone=!1;this.onoverShape=null;this.fMouseDown=!1;this.contextMenuObj=null;this.onoverPopup=!1;this.tooltipDone=this.popupContextObj=null};Map.Event.prototype=new Map;
Map.Event.prototype.initUseNodes=function(b){if(b&&(b=b.getElementsByTagName("use"))&&b.length)for(i=0;i<b.length;i++)b.item(i).style.setProperty("pointer-events","none","")};Map.Event.prototype.resolveInstance=function(b){if(!b)return null;if("undefined"!=typeof b.nodeType)return b;for(;b.parentNode&&"undefined"==b.correspondingUseElement;)b=b.parentNode;return b.correspondingUseElement};Map.Event.prototype.stopMouseEvent=function(b){b&&(b.stopPropagation(),b.preventDefault())};
Map.Event.prototype.defaultMouseOver=function(b){if(b&&b.target){var d=this.resolveInstance(b.target);if(1==d.nodeType){var e=new MapObject(d);if(e&&e.szId&&e.szId.match(/widget/))widgetList.onMouseOver(b);if(!this.fMouseDown||!this.fMouseDownMoved){if("idle"==szMapToolType)try{if(!e){HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();return}var f=e.szId;if(!(f.match(/legend/)||f.match(/tool/)||f.match(/button/)||f.match(/widget/)||f.match(/movable/)||f.match(/checked/)||f.match(/unchecked/))){HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();
return}}catch(g){}SVGPopupGroup.fu.isContained(d)||SVGFixedGroup.fu.isContained(d)?(this.popupContextObj&&__normalHighlight(b,this.popupContextObj),this.onoverPopup=!0):this.onoverPopup=!1;if(this.onoverPopup||!__normalHighlight(b,d)||"info"!==szMapToolType&&""!==szMapToolType)__simpleHighlight(b,d),this.tooltipDone=displayTooltip(b,d);else{displayInfo(b,d,"delayed|pointer");this.onoverShape=d;try{highlightTheme(new MapObject(d))}catch(h){}}try{"mapbackground:eventrect"==d.getAttributeNS(null,"id")&&
HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(k){}}}}};__simpleHighlight=function(b,d){if(d)try{var e=d.getAttributeNS(szMapNs,"origstyle");if(!e||"null"==e){var f=d.getAttributeNS(szMapNs,"onoverstyle");f&&(d.setAttributeNS(szMapNs,"origstyle",d.getAttributeNS(null,"style")),d.setAttributeNS(null,"style",f))}}catch(g){}};
__simpleHighlightRemove=function(b,d){if(d)try{var e=d.getAttributeNS(szMapNs,"origstyle");e&&2<e.length&&(d.removeAttributeNS(szMapNs,"origstyle"),d.setAttributeNS(null,"style",e))}catch(f){}};
__normalHighlight=function(b,d){if(__isChart(b,d))return(new MapObject(d)).fu.scale(1.05,1.05),!0;var e=new MapObject(d);if(null==e)return!1;var f=!0,g=null,e=e.szId;if(0===e.length||e.match(/legend/)||e.match(/background/)||e.match(/button/)||e.match(/widget/)||e.match(/textgrid/)||"info"!=szMapToolType&&""!=szMapToolType)return highLightList&&highLightList.removeAll(),!1;if(highLightList&&!highLightList.checkItem(d)){e=d;"g"!=e.nodeName&&(e=e.parentNode);if((e=e.getAttributeNS(null,"id"))&&!e.match(/chartgroup/)&&
_activeTheme!=map.Tiles.getMasterId(e.split(":")[0]))if(f=map.Layer.getLayerObj(e),!f||!f.szSelection||map.Event.tooltipDone||"info"!=szMapToolType&&""!=szMapToolType||displayTooltipText(b,map.Dictionary.getLocalText("click to activate")),fHighlightHint)g="hint",f=!1;else return!1;highLightList.removeAll();for(var e=map.Layer.getLayerItemNodes(d),h=0;h<e.length;h++)highLightList.addItem(e[h],g)}return f};
__isChart=function(b,d){mapObj=new MapObject(d);if(mapObj.szId.match(/chartgroup/)||mapObj.szId.match(/chart:box/)){var e=map.Themes.getTheme(mapObj.szId.split(":")[0]);return e&&e.szFlag&&e.szFlag.match(/BUFFER/)?!1:!0}return!1};
Map.Event.prototype.defaultMouseOut=function(b){if(b&&b.target){var d=this.resolveInstance(b.target),e=new MapObject(d);if(e&&e.szId&&e.szId.match(/widget/))widgetList.onMouseOut(b);__simpleHighlightRemove(b,d);this.onoverShape&&(removeInfo(b,this.onoverShape),__isChart(b,this.onoverShape)&&(new MapObject(this.onoverShape)).fu.scale(1,1));this.onoverShape&&!_activeItem&&(highLightList.removeItem(this.onoverShape),this.onoverShape=null,highlightThemeRemove());killTooltip();killInfo()}};
Map.Event.prototype.defaultMouseClick=function(b){if(b&&b.target){var d=this.resolveInstance(b.target);if(d&&1==d.nodeType){var e=new MapObject(d);if(d==this.ondownShape)if(5<this.fMouseDownMoved)this.fMouseDownMoved=0;else{var f=d.parentNode;if("a"==f.nodeName){f=f.getAttributeNS(szXlink,"href");try{HTMLWindow.ixmaps.htmlgui_popupWindow(f),this.stopMouseEvent(b)}catch(g){}}e=new MapObject(d);if(null!=e){f=e.objNode;e=e.szId;try{if(map.User.onClick(b,e))return null}catch(h){}try{HTMLWindow.ixmaps.htmlgui_onItemClick(e)}catch(k){}if(e){if(widgetList.onClick(b))return;
try{"mapbackground:eventrect"==e&&HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(l){}}map.Legend&&map.Legend.legendMouseClick(b,f)?this.stopMouseEvent(b):!f||1!=f.nodeType||!f.parentNode||1!=f.parentNode.nodeType||map.Legend&&map.Legend.legendMouseClick(b,f.parentNode)||!(e=f.parentNode.getAttributeNS(null,"id"))||"PopupGroup"==e||e.match(/widget/)||!fActivateInfoOnClick&&"info"!=szMapToolType&&""!=szMapToolType&&"zoomrect"!=szMapToolType||(isActiveTheme(map.Layer.getLayerName(e))?(SVGPopupGroup.fu.clear(),
displayInfo(b,d,"add|fix|pointer")):(activateTheme(e.split(":")[0]),szMapToolType.match(/select/),map.Zoom.cancel(),this.defaultMouseOver(b),killTooltip()))}}}}};
Map.Event.prototype.defaultMouseDown=function(b){if(b&&b.target&&!map.fInitializing){var d=this.resolveInstance(b.target);if(2==b.button)this.contextMenuObj=d,this.contextMenuCurrentObj=b.currentTarget,__setContextMenu(b);else if(0==b.button&&(this.fMouseDown=!0,this.ondownShape=d,this.fMouseDownMoved=0,d=new MapObject(d),null!=d)){clickNode=d.objNode;d=String(d.szId);try{if(map.User.onMouseDown(b,d))return null}catch(e){}this.stopMouseEvent(b);widgetList.onMouseDown(b);if(d.match(/movabley/))mouseObject=
new MouseObject(b,clickNode,"yonly");else if(d.match(/movablex/))mouseObject=new MouseObject(b,clickNode,"xonly");else if(d.match(/movable/))mouseObject=new MouseObject(b,clickNode);else if(d.match(/maptoolnode/))mapToolList.onMouseDown(b);else if(d.match(/widget/))widgetList.onMouseDown(b);else d.match(/legend/)?(b=d.split(":"),2<b.length&&clickNode.ownerDocument.getElementById(b[2])&&("minus"==b[1]&&setTimeout("__opacityMinus('"+b[2]+"')",200),"plus"==b[1]&&setTimeout("__opacityPlus('"+b[2]+"')",
200))):(b.shiftKey||b.altKey||b.crtlKey||!map.Layer.isMapObject(clickNode)||szMapToolType&&""!=szMapToolType&&(mapTool=new MapTool(b,szMapToolType)),b.shiftKey&&!b.altKey&&!b.crtlKey&&map.Layer.isMapObject(clickNode)&&(mapTool=""==szMapToolType?new MapTool(b,"pan"):new MapTool(b,szMapToolType)),!fTriggerMouseMoveForPan||d.match(/legend/)||d.match(/tool/)||d.match(/button/)||d.match(/widget/)||d.match(/movable/)||d.match(/checked/)||d.match(/unchecked/)||"info"!=szMapToolType&&""!=szMapToolType||(this.triggerMoveForPan=
!0))}}};Map.Event.prototype.defaultMouseUp=function(b){if(b&&b.target&&!map.fInitializing){this.stopMouseEvent(b);try{if(map.User.onMouseUp(b))return null}catch(d){}this.fMouseDown=!1;if(mouseObject){try{mouseObject.onMouseUp(b)}catch(e){}mouseObject=null}widgetList.onMouseUp(b);this.triggerMoveForPan=!1}};
Map.Event.prototype.defaultMouseMove=function(b){if(b&&b.target&&!map.fInitializing){var d=this.resolveInstance(b.target);this.triggerMoveForPan&&this.fMouseDownMoved&&(mapTool=new MapTool(b,"pan"),this.triggerMoveForPan=!1);if(!mouseObject)try{var e=(new MapObject(d)).objNode.getAttributeNS(null,"id");if(!(e.match(/legend/)||e.match(/tool/)||e.match(/button/)||e.match(/widget/)||e.match(/movable/)||e.match(/checked/)||e.match(/unchecked/)||"idle"!=szMapToolType&&"mapbackground:eventrect"!=e)){HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();
return}}catch(f){}this.stopMouseEvent(b);if(mouseObject)try{mouseObject.onMouseMove(b)}catch(g){}this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null));this.fMouseDownMoved+=this.fMouseDown?1:0;widgetList.onMouseMove(b)}};var __fShiftDone=!1,__szOldMapToolType=null;
Map.Event.prototype.defaultKeyDown=function(b){!b||__fShiftDone||!b.shiftKey||b.altKey||b.crtlKey||(__szOldMapToolType=szMapToolType,"pan"==szMapToolType?setMapTool("zoomrect"):"zoomrect"==szMapToolType?setMapTool("pan"):"info"==szMapToolType&&setMapTool("pan"),__fShiftDone=!0)};Map.Event.prototype.defaultKeyUp=function(b){!b||!__fShiftDone||b.shiftKey||b.altKey||b.crtlKey||(setMapTool(__szOldMapToolType),__fShiftDone=!1)};
Map.Event.prototype.doDefaultZoom=function(b){if(!fFroozeDynamicContent){SVGNotifyGroup.fu.clear();map.showMap();var d=SVGRootElement.getAttribute("viewBox").split(" "),e=SVGOrigViewBoxString.split(" "),e=1/(Number(e[2])/Number(d[2]));if(d=map.Scale.zoomNode)var f=getMatrix(d),e=e/f[0];map.Scale.oldZoomScale=map.Scale.nZoomScale;map.Scale.oldMapCenter=map.Scale.mapCenter;map.Scale.nZoomScale!=e&&(map.Dom.clearGroup(SVGToolsGroup),map.Dom.clearGroup(SVGFixedGroup),map.removeAllHighlights());map.Scale.nZoomScale=
e;map.Scale.mapCenter=new point(f[4],f[5]);if(0==fPanByViewer){if(0!=SVGRootElement.currentTranslate.x||0!=SVGRootElement.currentTranslate.y){var d=map.Scale.zoomNode,f=getMatrix(d),e=f[0],g=f[3],h=map.Scale.rotatePoint(SVGRootElement.currentTranslate);SVGRootElement.currentTranslate.x=h.x;SVGRootElement.currentTranslate.y=h.y;h=f[4]+map.Scale.scaleX(SVGRootElement.currentTranslate.x);f=f[5]+map.Scale.scaleY(SVGRootElement.currentTranslate.y);d.setAttributeNS(null,"transform","matrix("+e+" 0 0 "+
g+" "+h+" "+f+")");map.Scale.mapCenter=new point(h,f);SVGRootElement.currentTranslate.x=0;SVGRootElement.currentTranslate.y=0}}else{if(f=SVGDocument.getElementById("mapcliprect"))f.setAttributeNS(null,"x",map.Scale.scaleX(-SVGRootElement.currentTranslate.x)),f.setAttributeNS(null,"y",map.Scale.scaleY(-SVGRootElement.currentTranslate.y)),f.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),f.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()));if(f=SVGDocument.getElementById("mapbackground:eventrect"))f.setAttributeNS(null,
"x",map.Scale.scaleX(-SVGRootElement.currentTranslate.x)),f.setAttributeNS(null,"y",map.Scale.scaleY(-SVGRootElement.currentTranslate.y)),f.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),f.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()))}b&&antiZoomAndPanList.adjustGroups(b);Math.abs(map.Scale.oldZoomScale-map.Scale.nZoomScale)>map.Scale.oldZoomScale/100?("delayed"==fFeatureScaling?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+
"')",1E3):map.Layer.changeFeatureScaling(b,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&"delayed"==fDynamicLayer?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(b),displayScale(b)):"delayed"==fDynamicTiles?setTimeout("map.Layer.doStoredFeatureScaling()",500):map.Layer.doStoredFeatureScaling(b);"delayed"==fDynamicTiles?setTimeout("map.Tiles.switchScaleDependentTiles(null)",500):map.Tiles.switchScaleDependentTiles(b);if(map.Scale.oldZoomScale!=
map.Scale.nZoomScale||10<Math.abs(map.Scale.oldMapCenter.x-map.Scale.mapCenter.x)||10<Math.abs(map.Scale.oldMapCenter.y-map.Scale.mapCenter.y)){try{HTMLWindow.ixmaps.htmlgui_onZoomAndPan(map.Scale.nZoomScale)}catch(k){}"delayed"==fDynamicTiles||"delayed"==fDynamicLayer?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",10);try{map.Scale.oldZoomScale!=map.Scale.nZoomScale?map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/map.Scale.nZoomScale):setTimeout("map.Themes.actualizeActiveTheme("+
map.Scale.oldZoomScale/map.Scale.nZoomScale+")",10)}catch(l){}try{HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.getTrueMapScale()*map.Scale.nZoomScale)),0,"BLANK"))}catch(m){}}zoomAndPanHistory.newItem();map.Zoom.actualizeOverviewMap(b);map.Scale.refreshCSSStyles()}};
Map.Event.prototype.doPrintZoom=function(b){map.Scale.nZoomScale/=5;map.Scale.oldZoomScale!=map.Scale.nZoomScale?("delayed"==fFeatureScaling?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+"')",1E3):map.Layer.changeFeatureScaling(b,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&"delayed"==fDynamicLayer?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(b),displayScale(b)):"delayed"==fDynamicTiles?setTimeout("map.Layer.doStoredFeatureScaling()",
500):map.Layer.doStoredFeatureScaling(b);"delayed"==fDynamicTiles?setTimeout("map.Tiles.switchScaleDependentTiles(null)",500):map.Tiles.switchScaleDependentTiles(b);if(map.Scale.oldZoomScale!=map.Scale.nZoomScale||map.Scale.oldMapCenter.x!=map.Scale.mapCenter.x||map.Scale.oldMapCenter.y!=map.Scale.mapCenter.y){"delayed"==fDynamicTiles||"delayed"==fDynamicLayer?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",10);try{map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/
map.Scale.nZoomScale)}catch(d){}}try{HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.getTrueMapScale()*map.Scale.nZoomScale)),0,"BLANK")),HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(map.Zoom.getEnvelopeString(),map.Scale.oldZoomScale!=map.Scale.nZoomScale)}catch(e){}map.Scale.refreshCSSStyles()};Map.Event.prototype.doDefaultResize=function(b){map&&map.Layer&&(map.Layer.switchScaleDependentLayer(b),displayScale(b))};
Map.Event.prototype.doDefaultPan=function(b){b&&!mouseObject&&(antiZoomAndPanList.adjustGroups(b),map.Event.fPanDone=!0)};Map.Event.prototype.doDefaultAdjustPan=function(b){this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null))};Map.Event.prototype.moveToFrontOfGroup=function(b){b&&b.currentTarget&&b.currentTarget.parentNode&&b.currentTarget!=b.currentTarget.parentNode.lastChild&&b.currentTarget.parentNode.appendChild(b.currentTarget)};
function History(){this.itemA=[];this.historyPointer=0;this.fSuspend=!1;this.newItem()}History.prototype.add=function(b){this.historyPointer=this.itemA.length;this.itemA[this.itemA.length]=b};History.prototype.newItem=function(){this.fSuspend?this.fSuspend=!1:this.add(new HistoryItem)};History.prototype.backwards=function(){0<this.historyPointer&&(this.fSuspend=!0,this.itemA.length=this.historyPointer,this.historyPointer--,this.itemA[this.historyPointer].exec())};
History.prototype.forwards=function(){this.historyPointer<this.itemA.length-1&&(this.fSuspend=!0,this.historyPointer++,this.itemA[this.historyPointer].exec())};History.prototype.clear=function(){this.itemA.length=0};function HistoryItem(){try{this.szEnvelope=map.Zoom.getEnvelopeString()}catch(b){}}HistoryItem.prototype.exec=function(){try{var b=this.szEnvelope.split("="),d=b[1].split("'")[1],e=b[2].split("'")[1],f=b[3].split("'")[1],g=b[4].split("'")[1];map.Zoom.doZoomMapToEnvelope(d,e,f,g)}catch(h){alert("History Item not valid")}};
InfoContainer=function(b,d,e,f,g,h,k){d&&e&&2<e.length&&(this.szId=e+":movable",this.objectNode=map.Dom.newGroup(d,this.szId),this.ptPosition=f,this.ptOffsetOrig=new point(g.x,g.y),this.ptOffset=g,this.szMode=h,this.szTitle=k,this.nFontheight=14,this.onRemove="",this.fClipped=!0,this.create())};
InfoContainer.prototype.create=function(){this.ptPosition||(this.ptPosition=new point(1E3,1E3));this.ptOffset||(this.ptOffset=new point(100,100));this.szMode||(this.szMode="");this.szMode.match(/left/)&&(this.ptOffset.x=-(2*this.ptOffset.x),this.ptOffset.y*=3);this.frameNode=map.Dom.newShape("rect",this.objectNode,0,0,map.Scale.normalX(10),map.Scale.normalY(10),"fill:#ffffff;stroke:black;stroke-width:"+map.Scale.normalX(0)+"");this.frameNode.setAttributeNS(null,"rx",map.Scale.normalX(2*nInfoRoundRect));
this.frameNode.setAttributeNS(null,"ry",map.Scale.normalX(2*nInfoRoundRect));SVGDocument.getElementById(szShadowFilterToolsId)&&this.frameNode.style.setProperty("filter","url(#"+szShadowFilterToolsId+")","");this.canvasNode=map.Dom.newGroup(this.objectNode,this.szId+":canvas");this.canvasNode.fu.setPosition(map.Scale.normalX(1),map.Scale.normalY(1));this.titleNode=map.Dom.newGroup(this.objectNode,this.szId+":title");this.titleTextNode=map.Dom.newGroup(this.titleNode,this.szId+":titletext");this.szTitle&&
map.Dom.newText(this.titleTextNode,map.Scale.normalX(10),map.Scale.normalY(this.nFontheight+10),"font-family:arial;font-size:"+map.Scale.normalY(this.nFontheight/4*3)+"px;fill:black;pointer-events:none",this.szTitle);if(this.scrollObj=new ScrollArea(null,this.canvasNode,null,10,10,10))this.scrollObj.reformat(),this.workspaceNode=this.scrollObj.workspaceNode;this.workspaceNode||(this.scrollObj=null,this.workspaceNode=map.Dom.newGroup(this.canvasNode,this.szId+":workspace"),this.workspaceClipRect=map.Dom.setClipRect(this.workspaceNode,
new box(0,0,10,10)));this.objectNode.setAttributeNS(null,"onclick","map.Event.moveToFrontOfGroup(evt)");this.szMode.match(/fix/)?(this.deleteButton=new Button(this.titleNode,this.szId,"BUTTON","#delete_button","map.Dom.removeElementById('"+this.szId+"');","remove"),this.deleteButton.scale(1,1),this.deleteButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10))):this.szMode.match(/pin/)&&SVGDocument.getElementById("pin_button")&&(this.pinButton=new Button(this.titleNode,this.szId,"BUTTON","#pin_button",
"doDisplayInfo("+this.ptPosition.x+","+this.ptPosition.y+",'pointer|fix');","","fix it"),this.pinButton.scale(1,1),this.pinButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10)));this.widgetObj=new Widget(this.objectNode,this)};InfoContainer.prototype.setTitle=function(b,d){d||(d=map.Scale.tStyle.ContainerTitle);map.Dom.clearGroup(this.titleTextNode);(this.szTitle=b)&&map.Dom.newText(this.titleTextNode,map.Scale.normalX(10),1.3*d.nFontHeight,d.szStyle,this.szTitle);this.reformat()};
InfoContainer.prototype.reformat=function(){this.bBox=map.Dom.getBox(this.workspaceNode);this.tBox=map.Dom.getBox(this.titleTextNode);0>this.bBox.height&&(this.bBox.height=0);0>this.bBox.width&&(this.bBox.width=0);0>this.tBox.height&&(this.tBox.height=0);if(0!=this.bBox.width&&0!=this.bBox.height||this.szTitle&&this.szTitle.length){1==this.bBox.height&&(this.bBox.height=-200);var b=map.Scale.normalX(15+map.Scale.nButtonSize);if(this.fClipped)var b=Math.min(Math.max(this.bBox.width+b,this.tBox.width+
b),map.Scale.bBox.width/2),d=Math.min(this.bBox.height+this.tBox.height,map.Scale.bBox.height/2.4);else b=Math.max(this.bBox.width+b,this.tBox.width+b),d=this.bBox.y+this.bBox.height+this.tBox.height+map.Scale.normalY(10);d>map.Scale.bBox.height/4*5&&(b=Math.min(this.bBox.width+map.Scale.normalX(10)+map.Scale.normalY(10),map.Scale.bBox.width/2.4));b>map.Scale.bBox.width/4*5&&(d=Math.min(this.bBox.height+this.tBox.height+map.Scale.normalY(10),map.Scale.bBox.height/2.4));this.scrollObj?(this.scrollObj.setWidth(b/
map.Scale.normalX(1)-1),this.scrollObj.setHeight(d/map.Scale.normalY(1)),this.scrollObj.reformat(),this.scrollObj.hasScrollBars()?(d<this.bBox.height+map.Scale.normalX(this.scrollObj.nScrollBarWidth)&&(this.scrollObj.setHeight(d/map.Scale.normalY(1)+this.scrollObj.nScrollBarWidth+6),this.scrollObj.reformat(),d+=map.Scale.normalY(this.scrollObj.nScrollBarWidth+1)),this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(8)+this.tBox.height),b+=map.Scale.normalX(10)+map.Scale.normalX(7),
d+=map.Scale.normalY(2)+map.Scale.normalY(10)+map.Scale.normalY(5)+2*this.tBox.height):(this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(10)+1.3*this.tBox.height),d+=map.Scale.normalY(10)+this.tBox.height-map.Scale.normalY(7))):(this.workspaceClipRect.setAttributeNS(null,"width",b),this.workspaceClipRect.setAttributeNS(null,"height",d));var e=map.Scale.tStyle.ContainerTitle,e=map.Scale.normalY(map.Scale.nButtonSize/3)+e.nFontHeight/2,f=map.Scale.normalY(map.Scale.nButtonSize/
3);this.pinButton?this.pinButton.setPosition(b-f,e):this.deleteButton?this.deleteButton.setPosition(b-f,e):b-=map.Scale.normalX(map.Scale.nButtonSize);this.bBox.width=b;this.bBox.height=d;this.frameNode&&(this.frameNode.setAttributeNS(null,"width",this.bBox.width+2*map.Scale.normalX(5)),this.frameNode.setAttributeNS(null,"height",this.bBox.height+map.Scale.normalX(5)));this.shadowNode&&(this.shadowNode.setAttributeNS(null,"width",this.bBox.width+2*map.Scale.normalX(5)+map.Scale.normalX(.5)),this.shadowNode.setAttributeNS(null,
"height",this.bBox.height+map.Scale.normalX(5)+map.Scale.normalY(1)));b=map.Scale.getGroupOffset(this.objectNode);this.newPosition=map.Scale.clipWidgetObjectToSVG(this.objectNode,new point(this.ptPosition.x+b.x,this.ptPosition.y+b.y),this.ptOffsetOrig,this.bBox);this.newPosition.x-=b.x;this.newPosition.y-=b.y;this.objectNode.fu.setPosition(this.newPosition.x,this.newPosition.y);this.ptOffset.x=this.newPosition.x-this.ptPosition.x;this.ptOffset.y=this.newPosition.y-this.ptPosition.y;this.szMode.match(/pointer/)&&
this.makePointer()}else this.remove()};
InfoContainer.prototype.makePointer=function(){var b=this.ptOffset.y,d=map.Scale.normalX(15),e=map.Scale.normalX(10);map.Scale.normalX(5);this.pointerObj?(map.Dom.clearGroup(this.pointerObj),map.Dom.clearGroup(this.pointShObj)):(this.pointerObj=map.Dom.newGroup(this.objectNode),this.pointShObj=map.Dom.newGroup(this.objectNode),this.pointShObj.parentNode.insertBefore(this.pointShObj,this.pointShObj.parentNode.firstChild));0>this.ptOffset.y&&this.ptOffset.y>-this.bBox.height&&0>this.ptOffset.x&&this.ptOffset.x>
-this.bBox.width||(b=this.ptOffset.y+this.bBox.height/2,d=this.ptOffset.x+this.bBox.width/2,Math.abs(b)+this.bBox.width/2-this.bBox.height/2>Math.abs(d)?(d=0,this.ptOffset.x>2*-e&&(d=this.ptOffset.x+2*e),this.ptOffset.x<-this.bBox.width+2*e&&(d=this.ptOffset.x+this.bBox.width-2*e),0<b?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(d-map.Scale.normalX(8.5))+","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(20)+",0 z","fill:black;fill-opacity:0.5"),
map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(d-map.Scale.normalX(7.5))+","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(d-map.Scale.normalX(8.5))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(20)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+
","+-this.ptOffset.y+" l "+(d-map.Scale.normalX(7.5))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white"))):(b=0,this.ptOffset.y>2*-e&&(b=this.ptOffset.y+2*e),this.ptOffset.y<-this.bBox.height+2*e&&(b=this.ptOffset.y+this.bBox.height-2*e),0<d?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+map.Scale.normalX(1))+","+(b-map.Scale.normalX(8.5))+" 0,"+map.Scale.normalX(20)+" z","fill:black;fill-opacity:0.5"),
map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+map.Scale.normalX(1))+","+(b-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(b-map.Scale.normalX(8.5))+" 0,"+map.Scale.normalX(20)+" z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+
","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(b-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white"))))};InfoContainer.prototype.onMouseMove=function(){if(this.fMouseDown){var b=this.objectNode.fu.getPosition();this.ptOffset.x+=b.x-this.beforeMovePosition.x;this.ptOffset.y+=b.y-this.beforeMovePosition.y;this.beforeMovePosition=this.objectNode.fu.getPosition();this.szMode.match(/pointer/)&&this.makePointer()}};
InfoContainer.prototype.onMouseUp=function(){var b=this.objectNode.fu.getPosition();this.ptOffset.x+=b.x-this.beforeMovePosition.x;this.ptOffset.y+=b.y-this.beforeMovePosition.y;this.fMouseDown=!1;this.szMode.match(/pointer/)&&this.makePointer()};InfoContainer.prototype.onMouseDown=function(){this.beforeMovePosition=this.objectNode.fu.getPosition();this.fMouseDown=!0};
InfoContainer.prototype.setOnRemove=function(b){this.deleteButton&&this.deleteButton.buttonNode&&this.deleteButton.setActionOn("map.Dom.removeElementById('"+this.szId+"');"+b)};InfoContainer.prototype.remove=function(){this.objectNode.parentNode.removeChild(this.objectNode);this.objectNode=null};InfoContainer.prototype.clear=function(){map.Dom.clearGroup(this.workspaceNode)};
MouseObject=function(b,d,e,f){d&&(this.objNode=d,this.objNode.fu=new Methods(this.objNode),this.objStartPosition=this.objNode.fu.getPosition(),this.szFlag=e?e:"",this.parent=f);this.mouseStartPosition=b?map.Scale.getClientMousePosition(b,this.objNode):new point(0,0)};
MouseObject.prototype.onMouseMove=function(b){var d=map.Scale.getClientMousePosition(b,this.objNode);try{if(map.User.onMouseMove(b,this.objNode.getAttributeNS(null,"id"),d))return null}catch(e){}switch(this.szFlag){case "yonly":d.x=this.mouseStartPosition.x;break;case "xonly":d.y=this.mouseStartPosition.y}if(this.objNode&&!this.szFlag.match(/parentonly/)){var f=this.objNode.fu.getScale();this.objNode.fu.setPosition(this.objStartPosition.x+(d.x-this.mouseStartPosition.x)/f.x,this.objStartPosition.y+
(d.y-this.mouseStartPosition.y)/f.y)}if(this.parent)this.parent.onMouseMove(b)};MouseObject.prototype.onMouseUp=function(b){if(this.parent)this.parent.onMouseUp(b)};Button=function(b,d,e,f,g,h,k){this.targetGroup=b;this.szId=d?d:"button:"+String(Math.random());this.szType=e?e:"SIMPLE";this.szStyle=f?f:"";this.szActionOn=g;this.szActionOff=h;this.szTooltip=k?k:"";this.draw()};
Button.prototype.draw=function(b){!this.szType.match(/SELECTED/)||this.szType.match(/CHECKBOX/)?(this.nodeObj=map.Dom.newGroup(this.targetGroup),this.nodeObj.setAttributeNS(null,"cursor","pointer"),b=map.Dom.constructNode("a",this.nodeObj,{}),this.shapeObj=map.Dom.newGroup(b)):this.shapeObj=this.nodeObj=map.Dom.newGroup(this.targetGroup);this.nodeObj.setAttributeNS(null,"id",this.szId+":button");if(this.szType.match(/CHECKBOX/)){b=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#unchecked_button"});
var d=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#checked_button"});b.setAttributeNS(null,"id",this.szId+":unchecked");d.setAttributeNS(null,"id",this.szId+":checked");this.szType.match(/SELECTED/)&&(this.checked=!0);this.szType.match(/SELECTED/)||(this.checked=!1,d.style.setProperty("display","none",""));b=map.Dom.newShape("rect",this.shapeObj,map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(map.Scale.nButtonSize),map.Scale.normalX(map.Scale.nButtonSize),
"fill:red;fill-opacity:0");b.setAttributeNS(null,"id",this.szId+":widget:eventrect");b.setAttributeNS(szMapNs,"tooltip",this.szTooltip);b.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)");new Widget(b,this)}else if(this.szType.match(/TEXTBUTTON/)){var e=this.szStyle;b=map.Scale.normalY(.6*map.Scale.nButtonSize);var f="font-family:arial;font-size:"+b+"px;fill:#444444;baseline-shift:-30%;pointer-events:none",g=b/2*e.length,d=null;this.szType.match(/SELECTED/)?d=map.Dom.newShape("rect",
this.shapeObj,-b/5,-b/3*2,g,b/5*6,"fill:#eeeeff;stroke:black;stroke-width:"+map.Scale.normalX(1)+";stroke-opacity:0.3"):(d=map.Dom.newShape("rect",this.shapeObj,-b/5,-b/3*2,g,b/5*6,"fill:white;stroke:none;opacity:0"),d.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),d.setAttributeNS(null,"onmouseout","map.Event.stopMouseEvent(evt)"),d.setAttributeNS(null,"onclick",this.szActionOn),d.setAttributeNS(szMapNs,"tooltip",this.szTooltip));e=map.Dom.newText(this.shapeObj,0,0,f,e);this.bBox=
new box(-b/5,-b/3*2,e.getComputedTextLength()+b/5*2,b/5*6);d.setAttributeNS(null,"width",String(this.bBox.width));this.buttonNode=d}else this.szType.match(/BUTTON/)&&(b=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":this.szStyle}),b.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),b.setAttributeNS(null,"onmousedown","map.Event.stopMouseEvent(evt)"),b.setAttributeNS(null,"onclick",this.szActionOn),b.setAttributeNS(szMapNs,"tooltip",this.szTooltip),this.buttonNode=b)};
Button.prototype.scale=function(b,d){this.nodeObj&&this.nodeObj.fu.scale(b,d)};Button.prototype.setPosition=function(b,d){this.nodeObj&&this.nodeObj.fu.setPosition(b,d)};Button.prototype.getPosition=function(b,d){if(this.nodeObj)return this.nodeObj.fu.getPosition()};Button.prototype.remove=function(){this.nodeObj&&this.nodeObj.parentNode.removeChild(this.nodeObj)};Button.prototype.setActionOn=function(b){this.szActionOn=b;this.buttonNode&&this.buttonNode.setAttributeNS(null,"onclick",this.szActionOn)};
Button.prototype.onClick=function(b){this.toggleCheckBox(b);map.Event.stopMouseEvent(b)};Button.prototype.toggleCheckBox=function(b){b=SVGDocument.getElementById(this.szId+":checked");this.checked?(b.style.setProperty("display","none",""),eval(this.szActionOff)):(b.style.setProperty("display","inline",""),eval(this.szActionOn));this.checked=!this.checked};
ScrollBar=function(b,d,e,f,g,h){b&&(this.hBar=this.vBar=0,this.vScale=this.hScale=1,this.maxBox=e,this.bWidth=f,this.bHeight=g,this.hThumb=e.width,this.vThumb=e.height,this.vValue=this.hValue=this.vThumbOffset=this.hThumbOffset=0,this.contObj=b,this.contBox=contBox=map.Dom.getBox(b),this.contObj.fu=new Methods(this.contObj),contBox.width+contBox.x<=e.width-e.x+1&&contBox.height+contBox.y<=e.height-e.y+1||(contBox.width+contBox.x>e.width-e.x&&(this.hBar=g),contBox.height+contBox.y>e.height-e.y-this.hBar&&
(this.vBar=f),contBox.width+contBox.x>e.width-e.x-this.vBar&&(this.hBar=g),this.vBar&&(this.maxBox.width-=this.vBar+h),this.hBar&&(this.maxBox.height-=this.hBar+h),this.hMax=this.maxBox.width-2*this.hBar,this.vMax=this.maxBox.height-2*this.vBar,this.hScale=(contBox.width+contBox.x)/this.maxBox.width,this.vScale=(contBox.height+contBox.y)/this.maxBox.height,1<this.hScale&&(this.hThumb=Math.floor(this.hMax/this.hScale),this.hThumbOffset=Math.min(this.hMax-this.hThumb,-(d.x/this.hScale)),this.hValue=
-d.x/(contBox.width+contBox.x-this.maxBox.width)),1<this.vScale&&(this.vThumb=Math.floor(this.vMax/this.vScale),this.vThumbOffset=Math.min(this.vMax-this.vThumb,-(d.y/this.vScale)),this.vValue=-d.y/(contBox.height+contBox.y-this.maxBox.height)),this.hThumbStyle="fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.3)+";opacity:0.3",this.vThumbStyle="fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalY(.3)+";opacity:0.3"))};
ScrollBar.prototype.draw=function(b){if(this.contObj){var d="fill:white;stroke:black;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0",e="fill:#e8e8f8;stroke:white;stroke-width:"+map.Scale.normalX(.5)+";opacity:1.0";map.Scale.normalX(2);var f="fill:white;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0";this.remove(b);if(1!=this.hScale||1!=this.vScale){b=map.Dom.newGroup(this.contObj.parentNode);b.setAttributeNS(null,"id","scrollwidget");this.scrollWidget=b;var g=null;1<this.vScale&&
1<this.hScale&&map.Dom.newShape("rect",b,this.maxBox.width,this.maxBox.height,this.bWidth+map.Scale.normalX(1),this.bHeight+map.Scale.normalX(1),d);if(1<this.hScale){map.Dom.newShape("rect",b,this.bWidth,this.maxBox.height,this.hMax,this.bHeight+map.Scale.normalX(.8),f);if(g=map.Dom.newShape("rect",b,this.bWidth,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))g.setAttributeNS(null,"id","widget:scrollbar:bigstepleft"),new Widget(g,this);if(g=map.Dom.newShape("rect",
b,this.bWidth+this.hMax/2,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))g.setAttributeNS(null,"id","widget:scrollbar:bigstepright"),new Widget(g,this);g=map.Dom.newShape("rect",b,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.hThumb-map.Scale.normalX(2)),Math.max(2,this.bHeight-map.Scale.normalY(2)),this.hThumbStyle?this.hThumbStyle:e);g.fu.setPosition(this.bWidth,this.maxBox.height);this.hThumbObj=new Slider(g,new box(0,0,this.hMax-this.hThumb,0));
this.hThumbObj.parent=this;this.hThumbObj.setValue(new point(this.hValue,0))}if(1<this.vScale){map.Dom.newShape("rect",b,this.maxBox.width+map.Scale.normalX(2),this.bHeight,this.bWidth-map.Scale.normalX(2),this.vMax,f);if(g=map.Dom.newShape("rect",b,this.maxBox.width,this.bHeight,this.bWidth,this.vMax/2,"fill:black;stroke:black;opacity:0"))g.setAttributeNS(null,"id","widget:scrollbar:bigstepup"),new Widget(g,this);if(g=map.Dom.newShape("rect",b,this.maxBox.width,this.bHeight+this.vMax/2,this.bWidth,
this.vMax/2,"fill:black;stroke:black;opacity:0"))g.setAttributeNS(null,"id","widget:scrollbar:bigstepdown"),new Widget(g,this);g=map.Dom.newShape("rect",b,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.bWidth-map.Scale.normalX(2)),Math.max(2,this.vThumb-map.Scale.normalY(2)),this.vThumbStyle?this.vThumbStyle:e);g.fu.setPosition(this.maxBox.width,this.bHeight);this.vThumbObj=new Slider(g,new box(0,0,0,this.vMax-this.vThumb));this.vThumbObj.parent=this;this.vThumbObj.setValue(new point(0,
this.vValue))}}else this.contObj.fu.setPosition(0,0)}};ScrollBar.prototype.hasScrollBars=function(b){return 1<this.vScale||1<this.hScale};ScrollBar.prototype.onMouseDown=function(b){};ScrollBar.prototype.onMouseMove=function(b){var d=b=0;1<this.hScale&&(b=this.hThumbObj.fraction.x);1<this.vScale&&(d=this.vThumbObj.fraction.y);this.contObj.fu.setPosition(-b*(this.contBox.x+this.contBox.width-this.maxBox.width),-d*(this.contBox.y+this.contBox.height-this.maxBox.height))};
ScrollBar.prototype.onMouseUp=function(b){};ScrollBar.prototype.onClick=function(b){if(b=new MapObject(b.target))szId=b.szId,nStep=szId.match(/big/)?map.Scale.normalX(100):map.Scale.normalX(5),szId.match(/stepdown/)?this.vThumbObj.moveThumb(0,nStep):szId.match(/stepup/)?this.vThumbObj.moveThumb(0,-nStep):szId.match(/stepleft/)?this.hThumbObj.moveThumb(-nStep,0):szId.match(/stepright/)&&this.hThumbObj.moveThumb(nStep,0)};ScrollBar.prototype.remove=function(b){this.scrollWidget&&this.scrollWidget.parentNode.removeChild(this.scrollWidget)};
Slider=function(b,d,e,f,g){this.szId=null;this.moveArea=d;this.scaleArea=e;this.value=new point(0,0);this.fraction=new point(0,0);this.onUp=this.onMove=null;g&&(this.valuesA=g.split(","));this.objNode=b;this.objNode.setAttributeNS(null,"id","widget:slider:"+String(Math.random()));b.fu=new Methods(b);this.ptNull=b.fu.getPosition();widgetList.add(this)};Slider.prototype.setMoveArea=function(b){this.moveArea=b};Slider.prototype.setId=function(b){this.szId=b};
Slider.prototype.onMouseOver=function(b){if(this.parent)try{this.parent.onMouseOver(b,this.szId,this)}catch(d){}};Slider.prototype.onMouseOut=function(b){if(this.parent)try{this.parent.onMouseOut(b,this.szId,this)}catch(d){}};
Slider.prototype.onMouseDown=function(b){mouseObject=0==this.moveArea.width?new MouseObject(b,this.objNode,"yonly"):0==this.moveArea.height?new MouseObject(b,this.objNode,"xonly"):new MouseObject(b,this.objNode,null);mouseObject.parent=this;if(this.parent)try{this.parent.onMouseDown(b,this.szId,this)}catch(d){}};
Slider.prototype.onMouseMove=function(b){var d=this.objNode.fu.getPosition();d.x=Math.min(d.x,this.ptNull.x+this.moveArea.x+this.moveArea.width);d.x=Math.max(d.x,this.ptNull.x+this.moveArea.x);d.y=Math.min(d.y,this.ptNull.y+this.moveArea.y+this.moveArea.height);d.y=Math.max(d.y,this.ptNull.y+this.moveArea.y);this.objNode.fu.setPosition(d.x,d.y);this.value=new point(0,0);0<this.moveArea.width&&(this.value.x=d.x-this.ptNull.x,this.fraction.x=this.value.x/this.moveArea.width);0<this.moveArea.height&&
(this.value.y=d.y-this.ptNull.y,this.fraction.y=this.value.y/this.moveArea.height);if(this.parent)try{this.parent.onMouseMove(b,this.szId,this)}catch(e){}};Slider.prototype.onMouseUp=function(b){if(this.parent)try{this.parent.onMouseUp(b,this.szId,this)}catch(d){}};Slider.prototype.moveThumb=function(b,d){var e=this.objNode.fu.getPosition();e.x+=b;e.y+=d;this.objNode.fu.setPosition(e.x,e.y);this.onMouseMove()};
Slider.prototype.setValue=function(b){this.objNode.fu.setPosition(b.x*this.moveArea.width+this.ptNull.x,b.y*this.moveArea.height+this.ptNull.y);this.onMouseMove()};Slider.prototype.remove=function(){widgetList.removeWidget(this)};
RotationSlider=function(b,d,e,f,g,h){this.circlethumb=map.Dom.newGroup(b.parentNode,"widget:rotationslider:thumb");this.circlethumb.setAttributeNS(null,"area","-1000,-1000,1000,1000");this.circlethumb.setAttributeNS(null,"range",e);this.circlethumb.setAttributeNS(null,"scale",f);this.nStep=g;this.nSnap=h;this.pBase=b.fu.getPosition();this.circlethumb.fu.setPosition(this.pBase.x,this.pBase.y);this.circlethumbNode=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(5),"fill:#ff0000;opacity:0.0;pointer-events:none");
this.circleOverNode2=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(6),"fill:none;stroke:#ffffff;stroke-width:"+map.Scale.normalX(11)+";opacity:0.6;pointer-events:none;display:none");this.circleOverNode=map.Dom.newShape("path",this.circlethumb,"M-"+map.Scale.normalX(5.5)+",0 a"+map.Scale.normalX(6)+","+map.Scale.normalX(6)+" 0 1,0 "+map.Scale.normalX(5)+","+-map.Scale.normalX(5),"fill:none;stroke:#888888;stroke-width:"+map.Scale.normalX(1)+";opacity:0.8;pointer-events:none;display:none");
setRotate(this.circleOverNode,45);setRotate(this.circleOverNode2,45);d=map.Dom.newNode("defs",this.circlethumb);d=map.Dom.newNode("marker",d);d.setAttributeNS(null,"id","Triangle");d.setAttributeNS(null,"refX","0");d.setAttributeNS(null,"refY","0");d.setAttributeNS(null,"orient","auto");d.setAttributeNS(null,"style","overflow:visible");d.setAttributeNS(null,"path","M 0 0 L "+map.Scale.normalX(10)+" "+map.Scale.normalX(5)+" L 0 "+map.Scale.normalX(10)+" z");this.circleOverNode.style.setProperty("marker-start",
"url(#Triangle)","");this.circleOverNode.style.setProperty("marker-end","url(#Triangle)","");this.objNode=b;this.objNode.setAttributeNS(null,"id","widget:slider:"+String(Math.random()));widgetList.add(this);this.isActive=!1};RotationSlider.prototype.setValue=function(b){this.objNode.fu.setPosition(ptValue.x*this.moveArea.width+this.ptNull.x,ptValue.y*this.moveArea.height+this.ptNull.y);this.onMouseMove()};
RotationSlider.prototype.onMouseOver=function(b){this.circleOverNode.style.setProperty("display","inline","");this.circleOverNode2.style.setProperty("display","inline","");if(this.parent)try{this.parent.onMouseOver(b)}catch(d){}};RotationSlider.prototype.onMouseOut=function(b){this.isActive||(this.circleOverNode.style.setProperty("display","none",""),this.circleOverNode2.style.setProperty("display","none",""));if(this.parent)try{this.parent.onMouseOut(b)}catch(d){}};
RotationSlider.prototype.onMouseDown=function(b){var d=map.Scale.getClientMousePosition(b,SVGToolsGroup);this.startPosition=new point(d.x-this.pBase.x,d.y-this.pBase.y);this.circlethumbNode.fu.setPosition(this.startPosition.x,this.startPosition.y);mouseObject=new MouseObject(b,this.circlethumbNode);mouseObject.parent=this;this.isActive=!0;if(this.parent)try{this.parent.onMouseDown(b)}catch(e){}};
RotationSlider.prototype.onMouseMove=function(b){if(this.isActive&&(setRotate(this.objNode,this.getAngle()),this.parent))try{this.parent.onMouseMove(b)}catch(d){}};RotationSlider.prototype.onMouseUp=function(b){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display","none","");if(this.parent){try{this.parent.onMouseUp(b)}catch(d){}this.objNode.style.setProperty("opacity","1.0","")}};
RotationSlider.prototype.onClick=function(b){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display","none","");setRotate(this.objNode,0);if(this.parent){try{this.parent.onClick(b)}catch(d){}this.objNode.style.setProperty("opacity","1.0","")}};
RotationSlider.prototype.getAngle=function(b){var d=this.circlethumbNode.fu.getPosition();b=d.x;var d=d.y,e=Math.sqrt(b*b+d*d),e=Math.asin(b/e)/Math.PI*180,e=isNaN(e)?180:e;0<=b&&0<=d&&(e=180-e);0>b&&0<=d&&(e=180-e);0>b&&0>d&&(e=360+e);this.nStep&&this.nSnap&&(e%this.nStep<this.nSnap?(e=Math.floor(e/this.nStep)*this.nStep,this.objNode.style.setProperty("opacity","1.0","")):this.objNode.style.setProperty("opacity","0.5",""));return e};
function SORsliderMove(b){b=getMatrix(this.symbolNode);b[4]=Math.min(Math.max(Number(b[4]),sliderObject.moveArea.x),sliderObject.moveArea.width);b[5]=Math.min(Math.max(Number(b[5]),sliderObject.moveArea.y),sliderObject.moveArea.height);setMatrix(this.symbolNode,b);var d=SORsliderGetAngle(this.symbolNode),e=this.symbolNode.getAttribute("range");if(e&&""!=e){var f=Number(e.split(",")[0]),e=Number(e.split(",")[1]),g=0;f<e?(d=Math.min(Math.max(d,f),e),g=d/(e-f)*(sliderObject.scaleVal.ymin-sliderObject.scaleVal.xmin)):
(d>=e&&(d<=(f-e)/2?d=e:d<=f&&(d=f)),g=((d<=e?d+360:d)-f)/(360-f+e)*(sliderObject.scaleVal.ymin-sliderObject.scaleVal.xmin))}this.symbolNode.parentNode.firstChild.setAttributeNS(null,"transform","rotate("+d+")");b[4]=SX(20*Math.sin(d/180*Math.PI));b[5]=SY(-20*Math.cos(d/180*Math.PI));setMatrix(this.symbolNode,b);sliderObject.onMove&&""!=sliderObject.onMove&&eval(sliderObject.onMove+"(evt,"+String(g)+")")}
function SORsliderUp(b){b=SORsliderGetAngle(this.symbolNode);sliderObject.onUp&&""!=sliderObject.onUp&&eval(sliderObject.onUp+"(evt,"+String(b)+")");sliderObject.pointNode&&removeObject(sliderObject.pointNode);sliderObject=null}function SORsliderGetAngle(b){var d=getMatrix(b);b=Number(d[4]);var d=Number(d[5]),e=Math.sqrt(b*b+d*d),e=Math.asin(b/e)/Math.PI*180;0<=b&&0<=d&&(e=180-e);0>b&&0<=d&&(e=180-e);0>b&&0>d&&(e=360+e);return e}WidgetList=function(){this.widgetA=[]};
WidgetList.prototype.add=function(b){this.widgetA[this.widgetA.length]=b};WidgetList.prototype.getWidget=function(b){for(i in this.widgetA)if(this.widgetA[i].objNode==b)return this.widgetA[i];return null};WidgetList.prototype.onMouseOver=function(b){var d=new MapObject(b.target);if(d){d=this.getWidget(d.objNode);try{d.onMouseOver(b)}catch(e){}try{d.owner.onMouseOver(b)}catch(f){}}};WidgetList.prototype.onMouseOut=function(b){var d=new MapObject(b.target);if(d){d=this.getWidget(d.objNode);try{d.onMouseOut(b)}catch(e){}try{d.owner.onMouseOut(b)}catch(f){}}};
WidgetList.prototype.onMouseDown=function(b){var d=new MapObject(b.target);if(d){d=this.getWidget(d.objNode);try{d.onMouseDown(b)}catch(e){}try{d.owner.onMouseDown(b)}catch(f){}}};WidgetList.prototype.onMouseUp=function(b){var d=new MapObject(b.target);if(d){d=this.getWidget(d.objNode);try{d.onMouseUp(b)}catch(e){}try{d.owner.onMouseUp(b)}catch(f){}}};WidgetList.prototype.onMouseMove=function(b){var d=new MapObject(b.target);if(d){d=this.getWidget(d.objNode);try{d.onMouseMove(b)}catch(e){}try{d.owner.onMouseMove(b)}catch(f){}}};
WidgetList.prototype.onClick=function(b){var d=new MapObject(b.target);if(d&&(d=this.getWidget(d.objNode))){try{d.onClick(b)}catch(e){}try{d.owner.onClick(b)}catch(f){}return!0}return!1};WidgetList.prototype.removeWidget=function(b){for(var d=0;d<this.widgetA.length;d++)if(this.widgetA[d].objNode==b){for(;d<this.widgetA.length-1;d++)this.widgetA[d]=this.widgetA[d+1];this.widgetA.length--}};WidgetList.prototype.clear=function(){this.widgetA.length=0};
Widget=function(b,d){this.objNode=b;this.owner=d;widgetList.add(this)};Widget.prototype.remove=function(){widgetList.removeWidget(this)};widgetList=new WidgetList;MapToolList=function(){this.toolsA=[]};MapToolList.prototype.add=function(b,d){d&&d<this.toolsA.length-1?this.toolsA.splice(d,0,b):this.toolsA[this.toolsA.length]=b};MapToolList.prototype.getMapTool=function(b){for(i in this.toolsA)if(this.toolsA[i].objNode==b.parentNode)return this.toolsA[i];return null};
MapToolList.prototype.removeMapTool=function(b){for(var d=0;d<this.toolsA.length;d++)if(this.toolsA[d].objNode==b.parentNode){for(this.toolsA[d].remove();d<this.toolsA.length-1;d++)this.toolsA[d]=this.toolsA[d+1];this.toolsA.length--;this.toolsA.length&&this.toolsA[0].redraw()}};MapToolList.prototype.clear=function(){this.toolsA.length=0};
MapToolList.prototype.onMouseDown=function(b){var d=new MapObject(b.target);d&&(mapTool=mapToolList.getMapTool(d.objNode))&&(mouseObject=new MouseObject(b,d.objNode,"parentonly",mapTool),mouseObject.parent=mapTool)};mapToolList=new MapToolList;
MapTool=function(b,d,e){this.nFontSize=14;this.szLineStyle="fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";opacity:1.0;";this.szLineStyleLite="fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(.75)+";opacity:1.0;";this.szLineBgStyle="fill:none;stroke:white;stroke-width:"+map.Scale.normalX(5)+";opacity:0.5;";this.szFillBgStyle="fill:white;stroke:none;opacity:0.6";this.szTextStyle="font-family:arial;font-size:"+map.Scale.normalY(this.nFontSize)+"px;fill:darkblue;pointer-events:none;";
this.szPolylineStyle="fill:none;stroke:blue;stroke-width:"+map.Scale.normalX(2.5)+";stroke-opacity:0.5;";this.szPolygonStyle="fill:blue;stroke:black;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szBufferStyle="fill:blue;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szType=d;this.objNode=map.Dom.newGroup(SVGToolsGroup,d+String(Math.random()));var f=null,f=f=null,f=this.szPolygonStyle;switch(d){case "coord":mouseObject=new MouseObject(b,null,"parentonly");
mouseObject.parent=this;f=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",f,0,0,1,1,this.szFillBgStyle);map.Dom.newText(f,0,0,this.szTextStyle,"");map.Dom.newText(f,0,0,this.szTextStyle,"");f=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");f.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",f,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",f,-map.Scale.normalX(10),0,map.Scale.normalX(10),
0,this.szLineStyleLite);map.Dom.newShape("line",f,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",f,0,0,map.Scale.normalX(3.7),this.szLineStyle);f.fu.setPosition(mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y);this.redraw();break;case "polyline":f=this.szPolylineStyle;case "polygon":mouseObject=new MouseObject(b,null,"parentonly");mouseObject.parent=this;b=SVGDocument.getElementById("maptools_polypath");null==b&&(b=map.Dom.newNode("path",
SVGToolsGroup),b.setAttributeNS(null,"id","maptools_polypath"),b.setAttributeNS(szMapNs,"menu","polygonmenu"),b.setAttributeNS(null,"style",f),b.parentNode.insertBefore(b,this.objNode),mapToolList.toolShape=b);f=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");f.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",f,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",f,-map.Scale.normalX(10),0,map.Scale.normalX(10),0,this.szLineStyleLite);
map.Dom.newShape("line",f,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",f,0,0,map.Scale.normalX(3.7),this.szLineStyle);f.fu.setPosition(mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y);break;case "measurement":case "measurebuffer":case "selectbuffer":mouseObject=new MouseObject(b,null);mouseObject.parent=this;map.Dom.newShape("circle",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(1),
this.szLineBgStyle);map.Dom.newShape("circle",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(1),"measurebuffer"==this.szType||"selectbuffer"==this.szType?this.szBufferStyle:this.szLineStyle);map.Dom.newShape("line",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,this.szLineBgStyle);map.Dom.newShape("line",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,
mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,this.szLineStyle);f=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",f,mouseObject.mouseStartPosition.x+map.Scale.normalX(5),mouseObject.mouseStartPosition.y-map.Scale.normalY(5)-map.Scale.normalY(6*this.nFontSize/7),0,map.Scale.normalY(this.nFontSize),this.szFillBgStyle);map.Dom.newText(f,mouseObject.mouseStartPosition.x+map.Scale.normalX(5),mouseObject.mouseStartPosition.y-map.Scale.normalY(5),
this.szTextStyle,"test");f=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random()));map.Dom.newShape("circle",f,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",f,mouseObject.mouseStartPosition.x-map.Scale.normalX(10),mouseObject.mouseStartPosition.y,mouseObject.mouseStartPosition.x+map.Scale.normalX(10),mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",f,mouseObject.mouseStartPosition.x,
mouseObject.mouseStartPosition.y-map.Scale.normalX(10),mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",f,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);f=map.Dom.newGroup(this.objNode,"startpoint"+String(Math.random()));map.Dom.newShape("circle",f,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);
map.Dom.newShape("line",f,mouseObject.mouseStartPosition.x-map.Scale.normalX(10),mouseObject.mouseStartPosition.y,mouseObject.mouseStartPosition.x+map.Scale.normalX(10),mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",f,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y-map.Scale.normalX(10),mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",f,mouseObject.mouseStartPosition.x,
mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);break;case "zoomrect":case "selectrect":mouseObject=new MouseObject(b,null);mouseObject.parent=this;map.Dom.newShape("rect",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,10,10,this.szLineBgStyle);map.Dom.newShape("rect",this.objNode,mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,10,10,this.szLineStyle);break;case "pan":mouseObject=new MouseObject(b,null),mouseObject.parent=
this,this.beginPan(b)}this.mapToolList=mapToolList;mapToolList.add(this,e)};MapTool.prototype.onMouseDown=function(b){var d=new MapObject(b.target);d&&(mouseObject=new MouseObject(b,d.objNode),mouseObject.parent=this)};
MapTool.prototype.onMouseMove=function(b){var d=null,e,f=map.Scale.getClientMousePosition(b,SVGToolsGroup),g=f.x-mouseObject.mouseStartPosition.x,h=f.y-mouseObject.mouseStartPosition.y;switch(this.szType){case "coord":d=this.objNode.childNodes;e=0;d.item(e++);g=d.item(e++);f=map.Scale.clipWidgetPositionToMap(f);g.fu.setPosition(f.x,f.y);this.redraw();break;case "measurement":case "measurebuffer":case "selectbuffer":d=this.objNode.childNodes;e=0;var k=d.item(e++),l=d.item(e++),m=d.item(e++),n=d.item(e++);
b=d.item(e++);d=d.item(e++);k.setAttributeNS(null,"r",String(Math.sqrt(g*g+h*h)));l.setAttributeNS(null,"r",String(Math.sqrt(g*g+h*h)));m.setAttributeNS(null,"x2",String(f.x));m.setAttributeNS(null,"y2",String(f.y));n.setAttributeNS(null,"x2",String(f.x));n.setAttributeNS(null,"y2",String(f.y));d.fu.setPosition(g,h);b.fu.setPosition(g/2,h/2);h=g=b.firstChild;f=map.Scale.getDistanceInMeter(mouseObject.mouseStartPosition.x,mouseObject.mouseStartPosition.y,f.x,f.y);h.firstChild.nodeValue=map.Scale.formatDistanceString(f);
f=map.Dom.getBox(h);g.setAttributeNS(null,"width",f.width);break;case "zoomrect":case "selectrect":d=this.objNode.childNodes;e=0;f=d.item(e++);d=d.item(e++);f.setAttributeNS(null,"width",String(Math.max(1,g)));f.setAttributeNS(null,"height",String(Math.max(1,h)));d.setAttributeNS(null,"width",String(Math.max(1,g)));d.setAttributeNS(null,"height",String(Math.max(1,h)));break;case "pan":fPDFEmbed||!fPanToolByViewer?(map.Zoom.doPanMap(g/map.Scale.normalX(1),h/map.Scale.normalY(1)),mouseObject.mouseStartPosition.x=
f.x,mouseObject.mouseStartPosition.y=f.y):(f=map.Scale.getClientMousePosition(b,null),g=f.x-mouseObject.mouseStartPosition.x,h=f.y-mouseObject.mouseStartPosition.y,map.Zoom.doPanMapByViewer(g/map.Scale.normalX(1),h/map.Scale.normalY(1)));break;case "polyline":case "polygon":this.objNode.firstChild.fu.setPosition(f.x,f.y),this.redraw()}};
MapTool.prototype.onMouseUp=function(b){var d=0;switch(this.szType){case "coord":this.redraw();break;case "polyline":case "polygon":this.redraw();break;case "pan":displayMessage("please wait ...",500);setTimeout("map.Event.doDefaultZoom(null)",fPanToolByViewer?5:200);this.endPan(b);break;case "measurement":case "measurebuffer":toolNodes=this.objNode.childNodes;d=0;"measurement"==this.szType&&(b=toolNodes.item(d++),d=toolNodes.item(d++),b.parentNode.removeChild(b),d.parentNode.removeChild(d));break;
case "selectbuffer":toolNodes=this.objNode.childNodes;d=0;toolNodes.item(d++);d=toolNodes.item(d++);b=d.parentNode.getAttributeNS(null,"id")+":shape";d.setAttributeNS(null,"id",b);(d=map.Selections.newSelection("activeLayer",b,"type:circle"))?d.mapTool=this:this.remove();break;case "selectrect":toolNodes=this.objNode.childNodes;d=0;b=toolNodes.item(d++);d=toolNodes.item(d++);b=d.parentNode.getAttributeNS(null,"id")+":shape";d.setAttributeNS(null,"id",b);(d=map.Selections.newSelection("activeLayer",
b,"type:square"))?d.mapTool=this:this.remove();break;case "zoomrect":toolNodes=this.objNode.childNodes,d=0,b=toolNodes.item(d++),d=map.Dom.getBox(b),this.objNode.parentNode.removeChild(this.objNode),map.Zoom.doZoomMapToWidgetRect(d),setMapTool("")}};MapTool.prototype.beginPan=function(b){fPanToolByViewer&&fPanHideTools&&!fPDFEmbed&&(this.endPanTimeout=!1,map.Zoom.activateClipping(b),this.hideTools(b));try{HTMLWindow.ixmaps.htmlgui_isHTMLMapVisible()?map.hideAll():this.hideLayer(b)}catch(d){this.hideLayer(b)}map.Label.stopProcessing()};
MapTool.prototype.endPan=function(b){"delayed"!=fEndPan?(fPanToolByViewer&&fPanHideTools&&!fPDFEmbed&&(map.Zoom.removeClipping(b),setTimeout("mapTool.showTools(null)",5)),setTimeout("mapTool.showLayer(null)",50),setTimeout("map.showAll()",250)):(this.endPanTimeout=!0,setTimeout("mapTool.doEndPan(null)",500))};
MapTool.prototype.doEndPan=function(b){if(1==this.endPanTimeout){fPanToolByViewer&&fPanHideTools&&!fPDFEmbed&&(map.Zoom.removeClipping(b),this.showTools(b));this.showLayer(b);this.endPanTimeout=!1;try{map.Themes.actualizeActiveTheme()}catch(d){}}};MapTool.prototype.hideTools=function(b){this.toolsHidden&&0!=this.toolsHidden||(antiZoomAndPanList.setDisplay(b,"none"),this.toolsHidden=!0)};
MapTool.prototype.showTools=function(b){1==this.toolsHidden&&(antiZoomAndPanList.setDisplay(b,"inline"),this.toolsHidden=!1)};
MapTool.prototype.hideLayer=function(b){for(a in map.Layer.listA)if(b=map.Layer.listA[a],b.szFlag.match(/invisiblepan/)){if(map.Tiles&&0<map.Tiles.nCount)for(var d=map.Tiles.getTileNodeIds(a),e=0;e<d.length;e++){var f=d[e];if(featureNode=SVGDocument.getElementById(f))b.szBeforeHideStyle=featureNode.style.getPropertyValue("display"),featureNode.style.setProperty("display","none","");if(featureNode=SVGDocument.getElementById(f+":label"))b.szBeforeHideLabelStyle=featureNode.style.getPropertyValue("display"),
featureNode.style.setProperty("display","none","");if(featureNode=SVGDocument.getElementById(f+":label:bg"))b.szBeforeHideLabelStyle=featureNode.style.getPropertyValue("display"),featureNode.style.setProperty("display","none","")}if(featureNode=SVGDocument.getElementById(a))b.szBeforeHideStyle=featureNode.style.getPropertyValue("display"),featureNode.style.setProperty("display","none","");if(featureNode=SVGDocument.getElementById(a+":label"))b.szBeforeHideLabelStyle=featureNode.style.getPropertyValue("display"),
featureNode.style.setProperty("display","none","");if(featureNode=SVGDocument.getElementById(a+":label:bg"))b.szBeforeHideLabelStyle=featureNode.style.getPropertyValue("display"),featureNode.style.setProperty("display","none","")}};
MapTool.prototype.showLayer=function(b){for(a in map.Layer.listA)if(b=map.Layer.listA[a],b.szFlag.match(/invisiblepan/)){if(map.Tiles&&0<map.Tiles.nCount)for(var d=map.Tiles.getTileNodeIds(a),e=0;e<d.length;e++){var f=d[e];(featureNode=SVGDocument.getElementById(f))&&(b.szBeforeHideStyle.length?featureNode.style.setProperty("display",b.szBeforeHideStyle,""):featureNode.style.removeProperty("display"));(featureNode=SVGDocument.getElementById(f+":label"))&&(b.szBeforeHideLabelStyle.length?featureNode.style.setProperty("display",
b.szBeforeHideLabelStyle,""):featureNode.style.removeProperty("display"));(featureNode=SVGDocument.getElementById(f+":label:bg"))&&(b.szBeforeHideLabelStyle.length?featureNode.style.setProperty("display",b.szBeforeHideLabelStyle,""):featureNode.style.removeProperty("display"))}(featureNode=SVGDocument.getElementById(a))&&(b.szBeforeHideStyle.length?featureNode.style.setProperty("display",b.szBeforeHideStyle,""):featureNode.style.removeProperty("display"));(featureNode=SVGDocument.getElementById(a+
":label"))&&(b.szBeforeHideLabelStyle.length?featureNode.style.setProperty("display",b.szBeforeHideLabelStyle,""):featureNode.style.removeProperty("display"));(featureNode=SVGDocument.getElementById(a+":label:bg"))&&(b.szBeforeHideLabelStyle.length?featureNode.style.setProperty("display",b.szBeforeHideLabelStyle,""):featureNode.style.removeProperty("display"))}};
MapTool.prototype.redraw=function(b){switch(this.szType){case "polygon":var d=SVGDocument.getElementById("maptools_polypath");if(null==d)break;var e=[],f=this.mapToolList.toolsA;szD="";var g=f[0].objNode.firstChild;g.fu=new Methods(g);g=g.fu.getPosition();e[e.length]=g;szD+="M"+g.x+","+g.y;for(i=1;i<f.length;i++)g=f[i].objNode.firstChild,g.fu=new Methods(g),g=g.fu.getPosition(),e[e.length]=g,szD+=" "+g.x+","+g.y;szD+="z";d.setAttributeNS(null,"d",szD);(f=SVGDocument.getElementById("maptools_phantomPointGroup"))?
map.Dom.clearGroup(f):f=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");for(i=0;i<e.length;i++)x=e[i].x+(e[i<e.length-1?i+1:0].x-e[i].x)/2,y=e[i].y+(e[i<e.length-1?i+1:0].y-e[i].y)/2,g=map.Dom.newShape("circle",f,x,y,map.Scale.normalX(10),"fill:white;stroke:none;opacity:0.1;"),map.Dom.newShape("circle",f,x,y,map.Scale.normalX(2),this.szPolygonStyle+"pointer-events:none;"),g.setAttributeNS(szMapNs,"tooltip","click to add point"),g.setAttributeNS(null,"onmousedown","new MapTool(evt,'polygon',"+
(i+1)+")");(f=map.Dom.getObjectById("maptools_polygon_text"))?map.Dom.clearGroup(f):f=map.Dom.newGroup(SVGToolsGroup,"maptools_polygon_text");d=__doGetPolygonCenter(e);g=Math.abs(__doGetPolygonSurface(e,!0));e=new TextField(b,f,"maptooltext_template",18);e.setText(map.Scale.formatSurfaceString(g));b=e.textGroup.fu.getBox();e.setPosition(d.x-b.width/2,d.y-b.height/2);break;case "polyline":f=SVGDocument.getElementById("maptools_polypath");if(null==f)break;e=[];d=this.mapToolList.toolsA;szD="";g=d[0].objNode.firstChild;
g.fu=new Methods(g);g=g.fu.getPosition();e[e.length]=g;szD+="M"+g.x+","+g.y;for(i=1;i<d.length;i++)g=d[i].objNode.firstChild,g.fu=new Methods(g),g=g.fu.getPosition(),szD+=" "+g.x+","+g.y,e[e.length]=g;f.setAttributeNS(null,"d",szD);(f=SVGDocument.getElementById("maptools_phantomPointGroup"))?map.Dom.clearGroup(f):f=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");for(i=0;i<e.length-1;i++)x=e[i].x+(e[i+1].x-e[i].x)/2,y=e[i].y+(e[i+1].y-e[i].y)/2,g=map.Dom.newShape("circle",f,x,y,map.Scale.normalX(2),
this.szPolygonStyle),g.setAttributeNS(szMapNs,"tooltip","click to add point"),g.setAttributeNS(null,"onmousedown","new MapTool(evt,'polyline',"+(i+1)+")");(f=SVGDocument.getElementById("maptools_polyline_textgroup"))?map.Dom.clearGroup(f):f=map.Dom.newGroup(this.objNode,"maptools_polyline_textgroup");g=0;for(i=1;i<d.length;i++){var h=0,e=d[i].objNode.firstChild,k=d[i-1].objNode.firstChild.fu.getPosition(),l=e.fu.getPosition(),g=g+(h=map.Scale.getDistanceInMeter(k.x,k.y,l.x,l.y)),e=new TextField(b,
f,"maptooltext_template",12);e.setText(map.Scale.formatDistanceString(h));e.setPosition(k.x+(l.x-k.x)/2,k.y+(l.y-k.y)/2)}l=d[d.length-1].objNode.firstChild.fu.getPosition();e=new TextField(b,f,"maptooltext_template",18);e.setText(map.Scale.formatDistanceString(g));e.setPosition(l.x+map.Scale.normalX(5),l.y);e.textGroup.setAttributeNS(szMapNs,"menu","polylinemenu");break;case "coord":d=this.objNode.childNodes,i=0,b=d.item(i++),d=d.item(i++).fu.getPosition(),e=b.firstChild,f=e.nextSibling,g=f.nextSibling,
k=map.Scale.getMapPosition(d.x,d.y),k=map.Scale.getMapCoordinate(k.x,k.y),k=map.Scale.getGeoCoordinateOfPoint(k.x,k.y),h="Y="+String(k.y),f.firstChild.nodeValue="X="+String(k.x),g.firstChild.nodeValue=h,k=map.Dom.getBox(f),h=map.Dom.getBox(g),f.setAttributeNS(null,"y",Number(k.height)),g.setAttributeNS(null,"y",Number(k.y)+Number(k.height)+Number(h.height)+map.Scale.normalY(3)),e.setAttributeNS(null,"width",k.width),e.setAttributeNS(null,"height",Number(k.height)+Number(h.height)+map.Scale.normalY(3)),
d=new point(d.x,d.y),e=new point(map.Scale.normalX(5),map.Scale.normalY(5)),d=map.Scale.clipWidgetObjectToMap(b,d,e),b.fu.setPosition(d.x,d.y)}};MapTool.prototype.remove=function(b){this.objNode.parentNode.removeChild(this.objNode)};MapTool.prototype.printPolygon=function(b){(b=SVGDocument.getElementById("maptools_polygon"))&&alert(printNode(b))};
setMapTool=function(b){map.Layer.setPointerEvents(null);"info"==b&&"info"==szMapToolType&&deactivateTheme(_activeTheme);"pan"==b&&deactivateTheme(_activeTheme);if("overviewmap"==b)map.Zoom.showOverviewMap();else{killTooltip();killInfo();map.Dom.clearGroup(SVGMenuGroup);map.Dom.clearGroup(SVGToolsGroup);mapToolList.clear();szMapToolType=b;fPDFEmbed&&fSetToolCursor&&setTimeout("setMapToolCursor('"+b+"')",100);try{HTMLWindow.ixmaps.htmlgui_setMapTool(b)}catch(d){}}};getMapTool=function(){return szMapToolType};
setMapToolCursor=function(b){var d=null;(d=SVGDocument.getElementById("mapbackground"))&&d.setAttributeNS(null,"cursor","url(#"+b+"_cursor)");(d=SVGDocument.getElementById("mapcanvas"))&&d.setAttributeNS(null,"cursor","url(#"+b+"_cursor)");SVGToolsGroup&&SVGToolsGroup.setAttributeNS(null,"cursor","url(#"+b+"_cursor)")};var _lastActiveToolBgNode=null;
setMapToolActive=function(b){_lastActiveToolBgNode&&_lastActiveToolBgNode.style.setProperty("opacity","0","");var d=null;if(d=SVGDocument.getElementById("legend:activatetool:"+b))if(b=d.getElementsByTagName("rect").item(0))b.style.setProperty("opacity","1",""),b.style.setProperty("fill","#eeeeff",""),b.style.setProperty("stroke","#0000ff",""),b.style.setProperty("stroke-width","0.5",""),_lastActiveToolBgNode=b};
TextField=function(b,d,e,f){(b=SVGDocument.getElementById(e))?(this.textGroup=d.appendChild(b.cloneNode(1E3)),this.textGroup.fu=new Methods(this.textGroup),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.textGroup.setAttributeNS(null,"id",e+String(Math.random())),d=this.textGroup.getElementsByTagName("rect"),e=this.textGroup.getElementsByTagName("text"),1<d.length?(this.sdNode=d.item(0),this.bgNode=d.item(1)):this.bgNode=d.item(0),this.textNode=e.item(0),f&&this.textNode.style.setProperty("font-size",
String(f)+"px",""),this.textNode.parentNode==this.textGroup?(this.workspaceNode=map.Dom.newGroup(this.textGroup,"workspace:"+String(Math.random())),this.textGroup.insertBefore(this.workspaceNode,this.textNode),this.workspaceNode.appendChild(this.textNode)):this.workspaceNode=this.textNode.parentNode):"flat"==e?(this.textGroup=map.Dom.newGroup(d,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),fMapBorder3D&&SVGDocument.getElementById(szShadowFilterId)&&
(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",nInfoRoundRect*f/6),this.sdNode.setAttributeNS(null,"ry",nInfoRoundRect*f/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:#888888;stroke-width:2;"),this.bgNode.setAttributeNS(null,"rx",nInfoRoundRect*f/6),this.bgNode.setAttributeNS(null,"ry",nInfoRoundRect*f/6),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+
f+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.7")):"light"==e?(this.textGroup=map.Dom.newGroup(d,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),fMapBorder3D&&SVGDocument.getElementById(szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",nInfoRoundRect*f/6),this.sdNode.setAttributeNS(null,
"ry",nInfoRoundRect*f/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#fdfdfd;stroke:#888888;stroke-width:0.1;opacity:1;"),this.bgNode.setAttributeNS(null,"rx",nInfoRoundRect*f/6),this.bgNode.setAttributeNS(null,"ry",nInfoRoundRect*f/6),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+f+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.95")):"alert"==e?(this.textGroup=map.Dom.newGroup(d,
"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),SVGDocument.getElementById(szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#666666;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.Scale.normalY(.1)),this.sdNode.setAttributeNS(null,"ry",map.Scale.normalY(.1))),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#F9EDB8;stroke:#EDC967;stroke-width:1;opacity:1"),this.textNode=map.Dom.newText(this.textGroup,
0,0,"font-family:arial;font-size:"+f+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode):(this.textGroup=map.Dom.newGroup(d,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.5;stroke:none"),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:blue;stroke-width:0.1"),this.sdNode.setAttributeNS(null,"rx",nInfoRoundRect),this.sdNode.setAttributeNS(null,
"ry",nInfoRoundRect),this.bgNode.setAttributeNS(null,"rx",nInfoRoundRect),this.bgNode.setAttributeNS(null,"ry",nInfoRoundRect),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+f+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode,"transparent"==e&&(this.textGroup.setAttributeNS(null,"opacity","0.4"),this.sdNode.setAttributeNS(null,"rx",5*nInfoRoundRect),this.sdNode.setAttributeNS(null,"ry",5*nInfoRoundRect),this.bgNode.setAttributeNS(null,"rx",5*nInfoRoundRect),
this.bgNode.setAttributeNS(null,"ry",5*nInfoRoundRect)))};TextField.prototype.setText=function(b){try{return this.textNode.firstChild.nodeValue=b,this.resizeField(),!0}catch(d){return!1}};
TextField.prototype.resizeField=function(){try{var b=map.Dom.getBox(this.workspaceNode);this.bgNode&&(this.bgNode.setAttributeNS(null,"x",b.x-12),this.bgNode.setAttributeNS(null,"y",b.y-3),this.bgNode.setAttributeNS(null,"width",b.width+24),this.bgNode.setAttributeNS(null,"height",b.height+10));this.sdNode&&(this.sdNode.setAttributeNS(null,"x",b.x-6+1),this.sdNode.setAttributeNS(null,"y",b.y-3+2),this.sdNode.setAttributeNS(null,"width",b.width+12+1),this.sdNode.setAttributeNS(null,"height",b.height+
6+1))}catch(d){}};TextField.prototype.setPosition=function(b,d){this.textGroup.fu.setPosition(b,d)};
ScrollArea=function(b,d,e,f,g,h){this.nMaxWidth=f?f:100;this.nMaxHeight=g?g:100;this.nScrollBarWidth=h?h:10;null!=d&&(b=":"+String(Math.random()),(f=SVGDocument.getElementById(e))?(this.areaGroup=d.appendChild(f.cloneNode(1E3)),this.areaGroup.fu=new Methods(this.areaGroup),this.areaGroup.fu.extendAllIds(this.areaGroup,b),this.workspaceNode=SVGDocument.getElementById(e+":workspace"+b),this.cliprectNode=SVGDocument.getElementById(e+":cliprect"+b)):(e="scrollarea",this.areaGroup=map.Dom.newGroup(d,e+
b),d=map.Dom.newNode("clipPath",this.areaGroup),d.setAttribute("id",e+":clippath"+b),d.setAttribute("style","pointer-events:all"),this.cliprectNode=map.Dom.newShape("rect",d,0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight),"fill:none;stroke:none"),this.cliprectNode.setAttribute("id",e+":cliprect"+b),this.areaGroup.setAttributeNS(null,"clip-path","url(#"+e+":clippath"+b+")"),this.workspaceNode=map.Dom.newGroup(this.areaGroup,e+":workspace"+b)),this.szId=e)};
ScrollArea.prototype.setWidth=function(b){this.cliprectNode&&(this.nMaxWidth=Number(b),this.cliprectNode.setAttributeNS(null,"width",map.Scale.normalX(Math.max(this.nMaxWidth,0))))};ScrollArea.prototype.setHeight=function(b){this.cliprectNode&&(this.nMaxHeight=Number(b),this.cliprectNode.setAttributeNS(null,"height",map.Scale.normalX(Math.max(this.nMaxHeight,0))))};ScrollArea.prototype.setPosition=function(b,d){this.areaGroup&&this.areaGroup.fu.setPosition(b,d)};
ScrollArea.prototype.reformat=function(b){this.scrollObj&&(this.scrollObj.remove(b),this.scrollObj=null);var d=new box(0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight)),e=getTranslate(this.workspaceNode);if(0>this.nMaxWidth||0>this.nMaxHeight){var f=map.Dom.getBox(this.workspaceNode);d.width=0<=this.nMaxWidth?d.width:f.width+map.Scale.normalX(this.nScrollBarWidth+5);d.height=0<=this.nMaxHeight?d.height:f.height+map.Scale.normalY(this.nScrollBarWidth+5);this.cliprectNode.setAttributeNS(null,
"width",d.width);this.cliprectNode.setAttributeNS(null,"height",d.height)}(this.scrollObj=new ScrollBar(this.workspaceNode,new point(e.x,e.y),d,map.Scale.normalX(this.nScrollBarWidth),map.Scale.normalY(this.nScrollBarWidth),map.Scale.normalX(1)))&&this.scrollObj.draw(b)};ScrollArea.prototype.remove=function(b){this.scrollObj&&(this.scrollObj.remove(b),this.scrollObj=null);this.areaGroup&&(this.areaGroup.parentNode.removeChild(this.areaGroup),this.areaGroup=null)};
ScrollArea.prototype.hasScrollBars=function(b){return this.scrollObj?this.scrollObj.hasScrollBars():!1};ScrollArea.prototype.getWidth=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"width"))/map.Scale.normalX(1):0};ScrollArea.prototype.getHeight=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"height"))/map.Scale.normalY(1):0};
ScrollArea.prototype.setScrollPosition=function(b){this.scrollObj&&this.scrollObj.vThumbObj&&this.scrollObj.vThumbObj.setValue(b);this.scrollObj&&this.scrollObj.hThumbObj&&this.scrollObj.hThumbObj.setValue(b)};var allHighLights=[];map.removeAllHighlights=function(){for(var b=0;b<allHighLights.length;b++)allHighLights[b]&&(allHighLights[b].unlock(),allHighLights[b].removeAll());allHighLights.length=0};HighLight=function(){this.itemA=[];allHighLights[allHighLights.length]=this};
HighLight.prototype.addItem=function(b,d){for(var e=0;e<this.itemA.length;e++)if(this.itemA[e].node==b)return null;return(e=new HighLightItem(b,d))?(this.itemA[this.itemA.length]=e,e.node):null};HighLight.prototype.checkItem=function(b){for(var d=0;d<this.itemA.length;d++)if(this.itemA[d].node==b)return!0;return!1};
HighLight.prototype.removeItem=function(b){b=map.Layer.getLayerItemNodeOfNode(b);for(var d=0;d<this.itemA.length;d++)if(this.itemA[d].node==b){for(this.itemA[d].removeHighLight();d<this.itemA.length-1;d++)this.itemA[d]=this.itemA[d+1];--this.itemA.length}};HighLight.prototype.offAll=function(){for(var b=0;b<this.itemA.length;b++)this.itemA[b].removeHighLight()};HighLight.prototype.onAll=function(){for(var b=0;b<this.itemA.length;b++)this.itemA[b].doHighLight()};var __highlightObject=null;
HighLight.prototype.startToggle=function(){0<nHighlightToggle&&(this.toggleCount=2*nHighlightToggle,__highlightObject=this,setTimeout("__highlightObject.toggleAll()",1E3))};HighLight.prototype.toggleAll=function(){for(var b=0;b<this.itemA.length;b++)this.itemA[b].highlighted?this.itemA[b].removeHighLight():this.itemA[b].doHighLight();0<--this.toggleCount&&setTimeout("__highlightObject.toggleAll()",500)};
HighLight.prototype.removeAll=function(){if(!this.fLock){for(var b=0;b<this.itemA.length;b++)this.itemA[b].removeHighLight();this.itemA.length=0}};HighLight.prototype.lock=function(){this.fLock=!0};HighLight.prototype.unlock=function(){this.fLock=!1};function HighLightItem(b,d){b=map.Layer.getLayerItemNodeOfNode(b);if(!b)return null;this.node=b;this.szMode=d;this.doHighLight()}
HighLightItem.prototype.doHighLight=function(){var b=this.node;if(b){var d=new MapObject(b),e=map.Layer.getLayerObj(d.szId),d=e.szHighlight;if(!d)switch(e.szType){case "point":d="filter:url(#Glow);scale:1.5";break;case "line":d="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";break;case "polygon":d="fill:yellow"}if(this.szMode&&"hint"==this.szMode)switch(e.szType){case "point":d="filter:url(#Glow);scale:1.5";break;case "line":d="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";
break;case "polygon":d="fill:#eeeeff;fill-opacity:0.2;stroke-opacity:0.5;stroke:#eeeeff;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;"}if(d=__scaleStyleString(d,map.Scale.normalX(1/map.Zoom.nZoom))){var f=b.parentNode,g=f.nextSibling;g&&1==g.nodeType&&g.getAttributeNS(null,"id").match(/highlightgroup/)?this.highlightGroup=g:(this.highlightGroup=map.Dom.newGroup(f.parentNode,e.szName+":highlightgroup"),this.highlightGroup=f.parentNode.insertBefore(this.highlightGroup,g),this.highlightGroup.setAttributeNS(null,
"class",f.getAttributeNS(null,"class")));this.highlightGroup.setAttributeNS(null,"style",d+";display:inline;pointer-events:none");b=b.cloneNode(1E3);this.itemNode=this.highlightGroup.appendChild(b);this.itemNode.setAttributeNS(null,"id","");if(d.match(/fill:/)&&(this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),this.itemNode.hasChildNodes))for(b=this.itemNode.childNodes,e=0;e<b.length;e++)1==b.item(e).nodeType&&b.item(e).style.setProperty("fill","inherit",
"");if(d.match(/stroke:/)&&(this.itemNode.style.removeProperty("stroke"),this.itemNode.hasChildNodes))for(b=this.itemNode.childNodes,e=0;e<b.length;e++)1==b.item(e).nodeType&&(b.item(e).style.setProperty("stroke","none",""),b.item(e).style.removeProperty("stroke"));if(d.match(/scale:/)){this.itemNode.fu=new Methods(this.itemNode);d=parseFloat(d.split("scale:")[1]);if(isNaN(d)||0==d)d=1.5;this.itemNode.fu.scaleBy(d,d)}return this.highlighted=!0}return!1}};
HighLightItem.prototype.removeHighLight=function(){this.highlightGroup&&this.highlightGroup.removeChild(this.itemNode);this.highlighted=!1};var __info_infoShape=null;
function displayInfo(b,d,e){var f=null;if(b)f=map.Scale.getClientMousePosition(b,SVGPopupGroup);else{f=map.Scale.getScreenPosition(d);if(!map.Scale.isWidgetPositionInMap(f))return null;e+="|pointer"}if(e.match(/delayed/))killInfo(),__info_infoShape=d,idInfoTimeout=setTimeout("doDisplayInfo("+f.x+","+f.y+",'"+e+"')",nInfoTimeout);else return __info_infoShape=d,doDisplayInfo(f.x,f.y,e)}function killInfo(){idInfoTimeout&&clearTimeout(idInfoTimeout);__info_infoShape=null}
doDisplayInfo=function(b,d,e){var f,g,h=null;e&&e.match(/add/)||SVGPopupGroup.fu.clear();var k=null,k=__info_infoShape?map.Event.popupContextObj=__info_infoShape:map.Event.popupContextObj;if(null==k)return null;var l=k.getAttributeNS(szMapNs,"info");null!=l&&0!==l.length||!k.parentNode||(k=k.parentNode,l=k.getAttributeNS(szMapNs,"info"));var m=map.Dom.getAttributeByNodeOrParents(k.parentNode,szMapNs,"info"),n=map.Dom.getAttributeByNodeOrParents(k.parentNode,szMapNs,"show"),w=map.Dom.getAttributeByNodeOrParents(k.parentNode,
szMapNs,"label");f=map.Dom.getAttributeByNodeOrParents(k.parentNode,szMapNs,"units");var v=map.Dom.getAttributeByNodeOrParents(k,null,"id"),t=v+":info";map.Themes&&map.Themes.activeTheme&&(t+=":"+map.Themes.activeTheme.szId);if(SVGDocument.getElementById(t))return null;if(v&&v.length){var v=map.Tiles.getMasterId(v),u=v.split(":::")[0];imageNode=SVGDocument.getElementById(u+":image")}try{if(map.User.onInfoDisplay(null,v))return null}catch(F){}b=new point(b,d);u=new point(map.Scale.normalX(nInfoOffsetX),
map.Scale.normalY(nInfoOffsetY));d="info:"+String(Math.random());var u=new InfoContainer(SVGDocument,SVGPopupGroup,d+(e.match(/pointer/)?"":":movable"),b,u,e),E=u.workspaceNode,E=map.Dom.newGroup(E,t),q=new box(0,0,0,0),t=(new MapObject(k)).szId;if(t.match(/chartgroup/)){g=t.split(":")[1];var r=t.split(":")[3],t=g+"::"+r}else(layerItem=map.Layer.getLayerItemNodeOfNode(k))&&(t=layerItem.getAttributeNS(null,"id"));r=map.Label.getLabel(t);!r&&map.Themes.activeTheme&&(r=map.Themes.getTitle(t,map.Themes.activeTheme));
try{var p=map.Themes.getDataRow(t,map.Themes.activeTheme),r=HTMLWindow.ixmaps.htmlgui_onInfoTitle(r,p)}catch(H){}if(r){if(!isNaN(r))var B=map.Layer.getLayerObj(g),r=(B?B.szLabel+" ":"")+r;u.setTitle(r,map.Scale.tStyle.InfoContainerTitle)}if(e.match(/short/))return u.reformat(),u?u.objectNode:null;if(map.Themes&&map.Themes.activeTheme){var A=null;g=map.Themes.activeTheme;if((B=map.Layer.getLayerItemNodes(k))&&0<B.length)for(p=0;p<map.Themes.themesA.length;p++){g=map.Themes.themesA[p];var z=map.Dom.newGroup(E,
"info:chart"),A=map.Tiles.getMasterId(B[0].getAttributeNS(null,"id"));map.Themes.getChart(A,z,"VALUES|ZOOM|AXIS",g);z.hasChildNodes()||(A=map.Tiles.getMasterId(B[0].parentNode.getAttributeNS(null,"id")))&&map.Themes.getChart(A,z,"VALUES|ZOOM|AXIS",g);if(!z.hasChildNodes()){var C=k.getAttributeNS(null,"id");(A=C.split(":")[1])&&map.Themes.getChart(A,z,"VALUES|ZOOM|AXIS",g)}if(z.hasChildNodes()){killTooltip();u.fClipped=!1;C=map.Dom.getBox(z);if(0<C.width&&0<C.height){var r=.9*map.Scale.tStyle.Description.nFontHeight,
D=__scaleStyleString(map.Scale.tStyle.Description.szStyle,1),C=g.szTitle;map.Dom.newText(E,map.Scale.normalX(6),q.height+r,D,C);r=g.szFlag.match(/CHART/)?r+map.Scale.normalY(6/1.3):r+map.Scale.normalY(6*1.3);z.fu.scale(2,2);C=map.Dom.getBox(z);z.fu.setPosition(map.Scale.normalX(6)-2*C.x,q.height+r-2*C.y);C=map.Dom.getBox(z);r=C.y+C.height+map.Scale.normalY(6);if(q=map.Themes.getLabel(A,g))q=25>q.length?q:q.substr(0,25)+"...",r+=map.Scale.normalY(6*1.3),D=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,
1),map.Dom.newText(z,C.x,r,D,q),r+=map.Scale.tStyle.Description.nFontHeight;if(q=map.Themes.getSummary(A,g))D=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.5),map.Dom.newText(z,C.x,r,D,q);q=map.Dom.getBox(E);q.height+=map.Scale.normalY(12)}g.fShowData&&(h=g.getDataGrid(A,E))&&(h.setPosition(map.Scale.normalX(5),q.height),h.hasScrollBars&&h.hasScrollBars()&&h.workspaceNode.style.setProperty("display","none",""))}}else{z=map.Dom.newGroup(E,"info:chart");C=(new MapObject(k)).szId;A=C.split(":")[1];
D=C.split(":")[3];r=(B=map.Layer.getLayerObj(A))?B.szSelection+" ":"";(B=map.Themes.getTheme(C.split(":")[0]))&&B.szInfoTitle&&(r=B.szInfoTitle);r=(C=map.Label.getLabel(A+"::"+D))?C:r+D;A=A+"::"+D;B.szFlag.match(/POINTER/)&&1<B.nOrigSumA.length&&1<B.partsA.length?map.Themes.getChart(A,z,"VALUES|ZOOM|AXIS|HORZ",B):(map.Themes.getChart(A,z,"VALUES|ZOOM|AXIS",B),B.szFlag.match(/PIE/)&&(D=map.Dom.newGroup(z,"info:chart:x"),C=B.nNormalSizeValue,B.nNormalSizeValue=10*map.Themes.getMaxValue(A,B),map.Themes.getChart(A,
D,"CHART|BAR|HORZ|ZOOM|VALUES|AXIS|NOZERO|SORT",B),B.nNormalSizeValue=C,D.fu.setPosition(0,D.fu.getBox().height+z.fu.getBox().height/2+map.Scale.normalX(5))));B&&B.itemA[A]&&B.itemA[A].szSelectionId&&(r=B.itemA[A].szSelectionId.split(":").pop());B&&B.itemA[A]&&B.itemA[A].szTitle&&(r=B.itemA[A].szTitle);try{p=map.Themes.getDataRow(t,map.Themes.activeTheme),r=HTMLWindow.ixmaps.htmlgui_onInfoTitle(r,p)}catch(I){}if(z.hasChildNodes()){killTooltip();u.fClipped=!1;u.setTitle(r,map.Scale.tStyle.InfoContainerTitle);
C=map.Dom.getBox(z);if(0<C.width&&0<C.height){z.fu.scale(2,2);z.fu.setPosition(map.Scale.normalX(6)-2*C.x,q.height+map.Scale.normalY(6)-2*C.y);r=C.y+C.height+map.Scale.normalY(6);D=__scaleStyleString(map.Scale.tStyle.Description.szStyle,.5);r+=.25*map.Scale.tStyle.Description.nFontHeight+map.Scale.normalY(1);map.Dom.newText(z,C.x,r,D,B.szTitle);r+=.5*map.Scale.tStyle.Description.nFontHeight+map.Scale.normalY(1);if(q=map.Themes.getValueComment(A,map.Themes.activeTheme))D=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,
.5),map.Dom.newText(z,C.x,r,D,q),r+=.5*map.Scale.tStyle.Summary.nFontHeight+map.Scale.normalY(.5);if(q=map.Themes.getSummary(A,map.Themes.activeTheme))D=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.5),map.Dom.newText(z,C.x,r,D,q);q=map.Dom.getBox(E);q.height+=map.Scale.normalY(12)}g.fShowData&&(h=g.getDataGrid(A,E))&&(h.setPosition(map.Scale.normalX(5),q.height),h.hasScrollBars&&h.hasScrollBars()&&h.workspaceNode.style.setProperty("display","none",""))}}q=map.Dom.getBox(E)}imageNode&&(p=imageNode.cloneNode(1E3),
p=E.appendChild(p),p.fu=new Methods(p),p.fu.setPosition(map.Scale.normalX(5),q.height+map.Scale.normalY(5)),p.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),q=map.Dom.getBox(E),q.height+=map.Scale.normalX(7));if(l&&l.length&&m.length&&!h){if(n&&n.length){if(p=[],m=m.split("|"),l=l.split("|"),n=n.split("|"),z=w.split("|"),w=f.split("|"),n&&n.length){for(f=0;f<n.length;f++)for(g=0;g<m.length;g++)n[f]==m[g]&&(p[p.length]=z&&z[f]?map.Dictionary.getLocalText(z[f]):map.Dictionary.getLocalText(m[g]));
for(f=0;f<n.length;f++)for(g=0;g<m.length;g++)n[f]==m[g]&&(z=map.Dictionary.getLocalText(l[g]),p[p.length]=__formatInfoValue(z),p[p.length-1]+=w[f]?" "+w[f]:"")}}else{p=[];m=m.split("|");w=f.split("|");for(f=0;f<m.length;f++)p[p.length]=map.Dictionary.getLocalText(m[f]);l=l.split("|");for(f=0;f<l.length;f++)isNaN(l[f])?(z=map.Dictionary.getLocalText(m[f]+":"+l[f]),p[p.length]=z!=m[f]+":"+l[f]?z:map.Dictionary.getLocalText(l[f])):(z=map.Dictionary.getLocalText(m[f]+":"+l[f]),p[p.length]=__formatInfoValue(z!=
m[f]+":"+l[f]?z:l[f])),p[p.length-1]+=w[f]?" "+w[f]:""}if(p.length){var G=createTextGrid(SVGDocument,E,d+":textgrid",p,2);G.fu.setPosition(map.Scale.normalX(5),q.height)}try{if(userGroup=map.User.onInfoDisplayExtend(null,v,G.parentNode,b))userGroup=G.appendChild(userGroup),userGroup.fu.setPosition(map.Scale.normalX(5),q.height)}catch(J){}}try{if(userGroup=HTMLWindow.ixmaps.htmlgui_onInfoDisplayExtend(SVGDocument,t))userGroup=E.appendChild(userGroup),userGroup.fu=new Methods(userGroup),userGroup.fu.setPosition(map.Scale.normalX(10),
q.height+map.Scale.normalX(10))}catch(K){}E.hasChildNodes()||map.Dom.newShape("rect",E,0,0,1,1,"fill:none;stroke:none;");u.reformat();h&&h.workspaceNode.style.setProperty("display","inline","");e.match(/fix/)&&(u.objectNode.fu.scale(nFixedInfoScale,nFixedInfoScale),SVGFixedGroup.appendChild(u.objectNode),u.highLightList=new HighLight,u.highLightList.addItem(k),u.highLightList.lock(),u.setOnRemove("_doRemoveFixedInfo(map.Dom.popObj('"+map.Dom.pushObj(u)+"'))"));return u?u.objectNode:null};
_doRemoveFixedInfo=function(b){b.highLightList.unlock();b.highLightList.removeAll()};function removeInfo(b,d){setTimeout("_removeInfo()",1E3)}_removeInfo=function(b){null!=map.Event.onoverShape||map.Event.onoverPopup?setTimeout("_removeInfo()",250):SVGPopupGroup.fu.clear()};var __infoShape=null,__stackedInfoShapeA=[];function displayInfoDelayed(b,d,e){__stackedInfoShapeA[__stackedInfoShapeA.length]=d;1>=__stackedInfoShapeA.length&&setTimeout("doDisplayInfoDelayed()",e)}
function doDisplayInfoDelayed(){if(SVGPopupGroup.hasChildNodes)setTimeout("doDisplayInfoDelayed()",1E3);else{for(var b=0;b<__stackedInfoShapeA.length;b++)displayInfo(null,__stackedInfoShapeA[b],0==b?"":"add");__stackedInfoShapeA.length=0}}__formatInfoValue=function(b){if(b.match(/E+/)){var d=b.split("E+"),e=parseFloat(d[0]),d=parseInt(d[1]);if(!isNaN(e)&&!isNaN(d))return e*=Math.pow(10,d),String(Math.round(100*e)/100)}e=Number(b);return isNaN(e)?b:String(e)};
createTextGrid=function(b,d,e,f,g,h,k,l){b=Math.ceil(f.length/g);h=h?h:12;for(var m=0,n=0;n<f.length&&f[n];n++)m=Math.max(m,f[n].length);d=map.Dom.newGroup(d,e);e=SVGDocument.getElementById("TextLinesBgPattern");szStyle=l?l:"fill:#ffffff;stroke:"+(szTextGridStyle.match(/background/)?"1":"none");var m=[],w=[],v=map.Dom.newNode("g",d),t=map.Scale.normalX(5);l=map.Scale.normalX(3);for(c=0;c<g;c++){for(n=0;n<b;n++){1<g&&0==c&&!e&&szTextGridStyle.match(/background/)&&(!szTextGridStyle.match(/alternate/)||
n%2)&&(m[n]=map.Dom.newShape("rect",v,0,map.Scale.normalY(n*h+2)+l,100,map.Scale.normalY(h-1),"fill:#f0f0f0;stroke:none;opacity:1.0"));var u=map.Dom.newText(v,0,(n+1)*map.Scale.normalY(h),"font-family:arial;font-size:"+map.Scale.normalY(h)+"px;fill:"+szInfoBodyColor+"",f[n+c*b]);w[n]=u;1<g&&0==c&&!e&&(szTextGridStyle.match(/firstsmall/)&&u.style.setProperty("font-size",String(map.Scale.normalY(.9*h))+"px",""),szTextGridStyle.match(/firstitalic/)&&u.style.setProperty("font-style","italic",""),szTextGridStyle.match(/firstgray/)&&
u.style.setProperty("fill","#888888",""));if(k&&k[n+c*b])try{var F=__getStyleArray(k[n+c*b]);for(a in F)u.style.setProperty(a,F[a],"")}catch(E){}u.setAttribute("transform","matrix(1 0 0 1 "+t+" "+l+")");"a"!=u.nodeName&&u.style.setProperty("pointer-events","none","")}u=map.Dom.getBox(v).width;if(szTextGridStyle.match(/firstright/)&&0==c)for(n=0;n<b;n++)w[n].setAttribute("transform","matrix(1 0 0 1 "+(t+u)+" "+l+")"),w[n].style.setProperty("text-anchor","end","");t=u+map.Scale.normalX(h)+map.Scale.normalX(5);
if(0==c)var q=t}bBox=map.Dom.getBox(v);for(n=0;n<b;n++)m[n]&&(szTextGridStyle.match(/full/)?m[n].setAttributeNS(null,"width",bBox.width+map.Scale.normalX(h/2)):m[n].setAttributeNS(null,"width",q-map.Scale.normalX(5)));(f=SVGDocument.getElementById("TextLinesBgPattern:antizoomandpan"))&&f.setAttributeNS(null,"patternTransform","matrix(1 0 0 1 0 "+String(l-map.Scale.normalY(h-1))+")");return d};var __textField_group=null,__textField_frame=null,__textField_shadow=null,__textField_fontheight=12;
function createTextField(b,d,e,f,g){g||(g=12);if(b&&d)return b=map.Dom.newGroup(d,e),d=map.Dom.newShape("rect",b,1,1,1,1,"fill:#444444;opacity:0.5;stroke:none"),e=map.Dom.newShape("rect",b,1,1,1,1,"fill:#fefeff;stroke:#444444;stroke-width:"+map.Scale.normalX(.2)+""),map.Dom.newText(b,0,map.Scale.normalY(1.25*g),"font-family:arial;font-size:"+map.Scale.normalY(g)+"px;fill:"+szInfoBodyColor+"",f),__textField_group=b,__textField_frame=e,__textField_shadow=d,__textField_fontheight=g,sizeTextField(),b}
function sizeTextField(){var b=__textField_fontheight,d=map.Dom.getBox(__textField_group);__textField_frame.setAttributeNS(null,"rx",map.Scale.normalX(2));__textField_frame.setAttributeNS(null,"ry",map.Scale.normalX(2));__textField_frame.setAttributeNS(null,"x",-map.Scale.normalX(.75*b));__textField_frame.setAttributeNS(null,"y",-map.Scale.normalY(1));__textField_frame.setAttributeNS(null,"width",d.width+map.Scale.normalX(1.5*b));__textField_frame.setAttributeNS(null,"height",d.height+map.Scale.normalY(b)/
2);__textField_shadow.setAttributeNS(null,"rx",map.Scale.normalX(4));__textField_shadow.setAttributeNS(null,"ry",map.Scale.normalX(4));__textField_shadow.setAttributeNS(null,"x",-map.Scale.normalX(.75*b)+map.Scale.normalX(2));__textField_shadow.setAttributeNS(null,"y",map.Scale.normalY(2));__textField_shadow.setAttributeNS(null,"width",d.width+map.Scale.normalX(1.5*b)+map.Scale.normalX(1.5));__textField_shadow.setAttributeNS(null,"height",d.height+map.Scale.normalX(b)/2-map.Scale.normalX(0))}
function displayScale(b,d){if(fScaleBar){for(var e=map.Scale.getTrueMapScale()*map.Scale.nZoomScale,f=0,f=0;10<e;f++)e/=10;for(e=5<e?10:2.5<e?5:1.1<=e?2.5:1;0<f;f--)e*=10;var g=e/(map.Scale.nMapScale*map.Scale.nZoomScale)*(map.Scale.nMapPPI/nInch);if((f=map.Dom.getObjectById("legend:scalegroup"))&&(f.hasChildNodes()||d)){f.fu.clear();var h=f.getAttributeNS(szMapNs,"scaleunits"),k=f.getAttributeNS(szMapNs,"barcolor"),l=f.getAttributeNS(szMapNs,"bgcolor"),m=f.getAttributeNS(szMapNs,"bgstyle"),n=f.getAttributeNS(szMapNs,
"bgopacity"),w=f.getAttributeNS(szMapNs,"maxwidth");if(null==m||1>m.length)m=null==l||1>l.length?"fill:white;":"fill:"+l+";",n&&(m+="opacity:"+n+";");0==w&&(w=map.Scale.bBox.width/3/map.Scale.normalX(1));if(null==k||1>k.length)k="red";k="fill:"+k+("#ffffff"==k?";stroke:black;stroke-width:0.1;":"")+";pointer-events:none";m=map.Dom.newShape("rect",f,map.Scale.normalX(0),map.Scale.normalY(0),map.Scale.normalX(0),map.Scale.normalY(0),m);l=map.Scale.getTrueMapScale()*map.Scale.nZoomScale;l=1<=l?"1:"+String(__formatValue(l,
0,"BLANK")):String(__formatValue(1/l,0,"BLANK"))+":1";map.Dom.newText(f,0,map.Scale.normalY(12),"font-family:arial;font-size:"+map.Scale.normalY(9)+"px;fill:"+szInfoBodyColor+"",l).fu.setPosition(0,-map.Scale.normalY(10));if(0<w){l=0;h=h.length?h:"meters";n=100;"feet"==h?(n=33.3,3E4<e&&(h="miles",n=5280*33.3)):1E4<e&&(h="km",n=1E5);for(var v=0;20>v;v++){var t=1==v%2?k:"fill:black;pointer-events:none";map.Dom.newShape("rect",f,map.Scale.normalX(l),map.Scale.normalY(5),map.Scale.normalX(g),map.Scale.normalY(5),
t);var t=Math.floor(e/n*v*100)/100,u=h;0<v&&(u=Math.floor(t)!=t?String(t):String(Math.floor(t)));map.Dom.newText(f,0===v?map.Scale.normalX(l):map.Scale.normalX(l-4),map.Scale.normalY(18),"font-family:arial;font-size:"+map.Scale.normalY(8)+"px;fill:"+szInfoBodyColor+";pointer-events:none;",u);l+=g;if(1<w&&l>w||map.Scale.mapPosition.x&&map.Scale.normalX(l)>9*map.Scale.bBox.width/10||!map.Scale.mapPosition.x&&map.Scale.normalX(l)>map.Scale.bBox.width/2)break}e=map.Scale.getTrueMapScale()*map.Scale.nZoomScale/
n;100<e?Math.round(e):Math.round(100*e)}else map.Dom.newShape("rect",f,map.Scale.normalX(50),map.Scale.normalY(20),map.Scale.normalX(1),map.Scale.normalY(1),"fill:white;opacity:0;");e=map.Dom.getBox(f);m&&(m.setAttributeNS(null,"x",e.x-map.Scale.normalX(7)),m.setAttributeNS(null,"y",e.y-map.Scale.normalY(2)),m.setAttributeNS(null,"width",e.width+map.Scale.normalX(14)),m.setAttributeNS(null,"height",e.height+map.Scale.normalY(4)),m.setAttributeNS(null,"rx",map.Scale.normalY(2)),m.setAttributeNS(null,
"ry",map.Scale.normalY(2)));d&&(w=map.Scale.normalX(8),g=map.Scale.normalX(nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.bBox.height<map.Scale.viewBox.height&&(w=map.Scale.normalX(2),g=0),w=map.Scale.mapPosition.x+w,"bottom"==d?f.fu.setPosition(w+g,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-g-e.height):f.fu.setPosition(w+g,-e.y+map.Scale.normalY(2)+map.Scale.normalY(1)+g));m&&(e=f.fu.getPosition().y>map.Scale.normalY(100)?"top":"bottom",m.setAttributeNS(null,"onclick",
"displayScale(evt,'"+e+"')"));SVGPopupGroup&&(SVGPopupGroup.fu.clear(),f.setAttributeNS(szMapNs,"tooltip","click to move it"))}}}Map.Toolbar=function(b){this.init(b)};Map.Toolbar.prototype=new Map;Map.Toolbar.prototype.init=function(b){b=SVGDocument.getElementById("legend:toolbar");var d=SVGDocument.getElementById("toolbar");b&&d&&(d.setAttributeNS(null,"id","toolbar:movable"),map.Dom.clearGroup(b),b.appendChild(d),b.setAttributeNS(null,"cursor","pointer"),this.refresh())};
Map.Toolbar.prototype.refresh=function(b){if((b=SVGDocument.getElementById("legend:toolbar"))&&!(map.Legend&&map.Legend.objNode&&map.Legend.objNode.fu.isContained(b))){var d=map.Scale.normalX(nMapBorderWidth);b.fu=new Methods(b);var e=b.fu.getPosition(),f=b.getAttributeNS(szMapNs,"position");f.match(/NONE/)&&b.style.setProperty("display","none","");f.match(/INMAP/)&&(f.match(/RIGHT/)?(f=b.fu.getBox(),b.fu.setPosition(map.Scale.mapPosition.x+map.Scale.bBox.width-d-map.Scale.normalX(10)-f.width,e.y+
d)):b.fu.setPosition(map.Scale.mapPosition.x+map.Scale.normalX(6)+d,e.y+d))}};
Map.Legend=function(b){b=b?b.target.ownerDocument:SVGDocument;var d=b.getElementById("legend:group");if(!d||"undefined"==typeof d)return null;this.fInitializing=!0;this.lastItemObjectA=[];this.objNode=d;this.objNode.fu=new Methods(this.objNode);b=b.getElementById("legend_body");try{map.Dictionary.applyToNode(b)}catch(e){}this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity","0","");fAllIncluded||fPDFEmbed?this.init():setTimeout("map.Legend.init()",500)};
Map.Legend.prototype=new Map;
Map.Legend.prototype.init=function(b){if(1!=this.blockRecursion){var d=map.Scale.mapPosition.x?map.Scale.normalY(10):map.Scale.normalY(60),e=b?b.target.ownerDocument:SVGDocument,f=e.getElementById("legend:group");if(!f)return this.fInitializing=!1;this.objNode=f;this.objNode.fu=new Methods(this.objNode);var g=e.getElementById("legend_title");e.getElementById("legend_onoff_bg:sizeable");var h=e.getElementById("legend_body"),k=e.getElementById("legend:toolbar"),l=e.getElementById("legend_bg"),m=e.getElementById("legend_body_bg"),
n=e.getElementById("legend_body_header"),w=e.getElementById("legend_body_footer"),v=e.getElementById("legend_body:frame"),t=e.getElementById("legend:off:legend_body"),u=e.getElementById("legend_body:workspace:movabley");try{var F=map.Dom.getBox(u?u:h)}catch(E){this.fHidden||(this.show(),setTimeout("map.Legend.init()",10));this.fInitializing=!1;return}var q=1E5,r=1E5,p=SVGDocument.getElementById("legend:param");p&&(q=Number(p.getAttributeNS(szMapNs,"maxwidth")),r=Number(p.getAttributeNS(szMapNs,"maxheight")),
q=q?map.Scale.normalX(q):1E6,r=r?map.Scale.normalY(r):1E6);(p=SVGDocument.getElementById("test:markerrect"))&&p.parentNode.removeChild(p);this.fInitializing&&(this.blockRecursion=!0,this.checkGroupCollapse(null),this.blockRecursion=!1);try{F=map.Dom.getBox(u?u:h)}catch(H){F=new box(0,0,map.Scale.normalX(150),map.Scale.normalX(300))}var B=__getLegendPartBox(b,g),p=__getLegendPartBox(b,n),u=__getLegendPartBox(b,w);if(k&&k.parentNode==h){k.fu=new Methods(k);var A=k.fu.getBox();0>=A.y&&0<A.width&&1E5>
A.width&&(p.y+=A.y+A.height,p.width=Math.max(p.width,A.width),n&&(n.fu=new Methods(n),n.fu.setPosition(p.x,p.y)))}if(k&&k.parentNode==w){var z=e.getElementById("legend:overviewmap");z.fu=new Methods(z);k.fu=new Methods(k);A=k.fu.getBox();z.fu.setPosition(z.fu.getPosition().x,A.height)}if(p.y||p.height)v.fu=new Methods(v),v.fu.setPosition(v.fu.getPosition().x,p.y+p.height);F.height+=map.Scale.normalY(0);(k=SVGDocument.getElementById("legend:show:button"))&&k.style.setProperty("display","none","");
h&&m&&(map.Scale.legendWidth=Math.max(B.x+B.width+map.Scale.normalX(10),Math.max(F.x+F.width,Math.max(p.x+p.width,u.x+u.width)))+map.Scale.normalX(20),map.Scale.legendWidth=Math.min(map.Scale.legendWidth,q),q=this.objNode.fu.getPosition(),q.x<map.Scale.mapPosition.x&&0<map.Scale.viewBox.width-map.Scale.bBox.width?(map.Scale.legendWidth=map.Scale.mapPosition.x-map.Scale.normalX(2),r=1E5,this.fInMap=!1,fLegendToggleButtons&&(q=Number(m.getAttributeNS(null,"y")),m.setAttributeNS(null,"y",q+map.Scale.normalX(-100)),
SVGDocument.getElementById("legend:hide:button")||(q=new Button(f,"legend:hide","BUTTON","#expand_left_button","map.Api.extendMap()","","expand map"),q.nodeObj.style.setProperty("opacity","0.9",""),q.scale(1.8,1.8),q.setPosition(map.Scale.legendWidth-map.Scale.normalX(6),map.Scale.mapPosition.y+map.Scale.normalY(8))),SVGDocument.getElementById("legend:show:button")||(q=new Button(f.parentNode,"legend:show","BUTTON","#expand_right_button","map.Api.normalMap()","","show legend"),f.parentNode.insertBefore(q.nodeObj,
f.parentNode.firstChild),q.scale(1.8,1.8),q.nodeObj.style.setProperty("opacity","0.8",""),q.nodeObj.style.setProperty("display","none",""),fMapBorder3D&&SVGDocument.getElementById(szShadowFilterId)&&q.nodeObj.style.setProperty("filter","url(#"+szShadowFilterId+")",""),q.setPosition(map.Scale.normalX(9),map.Scale.mapOffset.y+map.Scale.normalY(14))))):q.x>=map.Scale.mapPosition.x+map.Scale.bBox.width?(map.Scale.legendWidth=map.Scale.viewBox.width-map.Scale.mapPosition.x-map.Scale.bBox.width-map.Scale.normalX(8),
r=1E5,this.fInMap=!1):(this.objNode.fu.setPosition(map.Scale.normalX(8+nMapBorderWidth),map.Scale.normalY(nMapBorderWidth)),r+=u.height,n&&n.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),t&&t.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),this.fInMap=!0),map.Scale.legendHeight=Math.min(F.y+F.height+p.y+p.height+u.height+map.Scale.normalY(6),Math.min(r,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-d)),m.setAttributeNS(null,"width",map.Scale.legendWidth),
m.setAttributeNS(null,"height",map.Scale.legendHeight-Number(m.getAttributeNS(null,"y"))+map.Scale.normalY(5)),m.setAttributeNS(null,"rx",map.Scale.normalX(2)),m.setAttributeNS(null,"ry",map.Scale.normalX(2)),this.fInMap&&(fObjectPseudoShadow&&!this.shadowNode&&(f=(d=m.style.getPropertyValue("opacity"))&&d.length?Number(d):1,d=m.style.getPropertyValue("fill-opacity"),d=f*(d&&d.length?Number(d):1),d=1==d?.5*d:.2*d,this.shadowNode=map.Dom.newShape("rect",h,map.Scale.normalX(3),map.Scale.normalY(-19),
map.Scale.normalX(10),map.Scale.normalY(10),"fill:#444444;stroke:#888888;opacity:"+d+";"),this.shadowNode=h.insertBefore(this.shadowNode,m)),this.shadowNode.setAttributeNS(null,"width",map.Scale.legendWidth),this.shadowNode.setAttributeNS(null,"height",map.Scale.legendHeight-Number(m.getAttributeNS(null,"y"))+map.Scale.normalY(5)),this.shadowNode.setAttributeNS(null,"rx",map.Scale.normalX(5)),this.shadowNode.setAttributeNS(null,"ry",map.Scale.normalX(5))),m.setAttributeNS(szMapNs,"menu","legendmenu"));
h&&l&&l.setAttributeNS(null,"width",F.x+F.width-map.Scale.normalY(15));h&&t&&fInitLegendOff&&(h.style.setProperty("display","none",""),t.style.setProperty("display","none",""));h=null;if(v)if(h=map.Dom.setClipRect(v,new box(0,0,1,1)),v=map.Scale.legendHeight-p.height-u.height,F.height<=v?(h.setAttributeNS(null,"width",map.Scale.legendWidth),h.setAttributeNS(null,"height",F.y+F.height+map.Scale.normalY(10))):(h.setAttributeNS(null,"width",map.Scale.legendWidth),h.setAttributeNS(null,"height",v)),w&&
(w.fu=new Methods(w),w.fu.setPosition(0,map.Scale.legendHeight-u.height-map.Scale.normalY(2)),map.Dom.setClipRect(w,new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),map.Scale.viewBox.height))),n&&map.Dom.setClipRect(n,new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),v)),g&&map.Dom.setClipRect(g,new box(map.Scale.normalX(-20),map.Scale.normalY(-20),map.Scale.legendWidth-map.Scale.normalX(0),v)),this.scrollObj)g=new box(h.getAttributeNS(null,"x"),h.getAttributeNS(null,"y"),h.getAttributeNS(null,
"width"),h.getAttributeNS(null,"height")),this.scrollObj.setWidth(g.width/map.Scale.normalX(1)),this.scrollObj.setHeight(g.height/map.Scale.normalY(1)),this.scrollObj.reformat(b);else if(n=e.getElementById("legend_body:workspace:movabley"))g=new box(h.getAttributeNS(null,"x"),h.getAttributeNS(null,"y"),h.getAttributeNS(null,"width"),h.getAttributeNS(null,"height")),this.scrollObj=new ScrollArea(b,null,null,g.width/map.Scale.normalX(1),g.height/map.Scale.normalY(1),10),this.scrollObj.workspaceNode=
n,this.scrollObj.cliprectNode=h,this.scrollObj&&this.scrollObj.reformat(b);fClipMapToLegend&&(b=e.getElementById("mapcliprect"))&&(e=map.Dom.getBox(b),e=e.x+e.width,g=map.Scale.normalX(5),b.setAttributeNS(null,"x",map.Scale.legendWidth+g),b.setAttributeNS(null,"width",e-map.Scale.legendWidth-g));this.fInitializing=!1;this.objNode.parentNode.appendChild(this.objNode);this.fHidden||this.show();return!0}};Map.Legend.prototype.move=function(b){mouseObject=new MouseObject(b,this.objNode)};
Map.Legend.prototype.reformat=function(b){this.scrollObj&&this.scrollObj.reformat(b)};Map.Legend.prototype.hide=function(b){this.objNode.style.setProperty("display","none","");this.fHidden=!0;(b=SVGDocument.getElementById("legend:show:button"))&&b.style.setProperty("display","inline","")};
Map.Legend.prototype.show=function(b){this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity","1","");this.fHidden=!1;(b=SVGDocument.getElementById("legend:show:button"))&&b.style.setProperty("display","none","")};Map.Legend.prototype.getPosition=function(b){return(b=(b?b.target.ownerDocument:SVGDocument).getElementById("legend:group"))?(b=getMatrix(b),new point(b[4],b[5])):new point(0,0)};
function __getLegendPartBox(b,d){var e=new box(0,0,0,0);if(d)try{if("text"==d.nodeName)return map.Dom.getBox(d);for(var f=d.childNodes,g=0;g<f.length;g++)if(1==f.item(g).nodeType){var h=getScale(f.item(g)),k=getTranslate(f.item(g)),l=map.Dom.getBox(f.item(g));l.x=k.x+l.x*h.x;l.y=k.y+l.y*h.y;l.width*=h.x;l.height*=h.y;if(f.item(g).getAttributeNS(null,"id").match(/overviewmap/)){var m=SVGDocument.getElementById("overviewmap:clippath");m&&(l=map.Dom.getBox(m),l.height=m.firstChild.getAttribute("height"),
l.width=m.firstChild.getAttribute("width"),l.height=e.height+l.height*map.Scale.getGroupScale(m).y,l.width*=map.Scale.getGroupScale(m).x)}isNaN(l.width)||isNaN(l.height)||0>l.width||0>l.height||(e.x=Math.min(e.x,l.x),e.y=Math.min(e.y,l.y),e.width=Math.max(e.width,l.x+l.width),e.height=Math.max(e.height,l.y+l.height))}if(isNaN(e.width)||isNaN(e.height)||0>e.width||0>e.height)e=new box(0,0,0,0)}catch(n){e=new box(0,0,0,0)}return e}
Map.Legend.prototype.checkGroupCollapse=function(b,d){var e=b?b.target.ownerDocument:SVGDocument;null==d&&(d=e.getElementById("legend_body:workspace:movabley"));if(d&&1==d.nodeType)for(var f=d.childNodes,g=0;g<f.length;g++)if(1==f.item(g).nodeType){var h=f.item(g).getAttributeNS(szMapNs,"mode");h&&h.match(/HIDDEN/)&&(h=f.item(g).getAttributeNS(null,"id").split(":"),"legend"==h[0]&&"item"==h[1]&&(h=e.getElementById("legend:collapse:"+h[2]),this.legendMouseClick(b,h)));this.checkGroupCollapse(b,f.item(g))}};
Map.Legend.prototype.legendMouseClick=function(b,d){if(null==d||1!=d.nodeType)return!1;var e=d.getAttributeNS(null,"id");if(e&&!e.match(/legend/))return!1;if(e&&e.match(/this:item/))return this.execLegendMouseClickOnItem(b,d,e),!0;for(var e=e.split(":"),f=3;f<e.length;f++)e[2]+=":"+e[f];this.execLegendMouseClick(b,d,e[2],e[1])||this.execLegendMouseClickOnTiles(b,d,e[2],e[1])||(clearThemes(),setMapTool(""));e[2]&&!e[2].match(/:label/)&&map.Layer.isScaleDependentLayerOn(e[2]+":label")&&this.execLegendMouseClick(b,
d,e[2]+":label",e[1]);return!0};
Map.Legend.prototype.execLegendMouseClick=function(b,d,e,f,g){if(null==e||null==f)return!1;if("mapzoom"==f&&!e.match(/label/))return map.Zoom.doZoomMap(e,"byfactor"),!0;if("textscale"==f&&!e.match(/label/))return map.Layer.changeLabelScaling(null,e,"byfactor"),!0;if("backwards"==f&&!e.match(/label/))return zoomAndPanHistory.backwards(),!0;if("activatetool"==f&&!e.match(/label/))return setMapTool(e),!0;var h=map.Dom.getAttributeByNodeOrParents(d,szMapNs,"classname");h.match(/legendgroup/)&&(h=null);
switch(f){case "suboff":f="off";case "off":g&&g.length?map.Layer.switchLayerByCSS(b,e,h,"none"):e.match(/\'/)?map.Layer.switchLayer(b,e,h,!1):executeWithMessage("map.Layer.switchLayer(null,'"+e+"','"+h+"',false)","...");d.style.setProperty("display","none","");!e.match(/label/)&&fCheckSublayerCollapse&&__checkCollapsable(d,"collapse");break;case "on":g&&g.length?map.Layer.switchLayerByCSS(b,e,h,"inline"):e.match(/\'/)?map.Layer.switchLayer(b,e,h,!0):executeWithMessage("map.Layer.switchLayer(null,'"+
e+"','"+h+"',true)","...");(g=SVGDocument.getElementById("legend:off:"+e))&&g.style.setProperty("display","inline","");!e.match(/label/)&&fCheckSublayerCollapse&&__checkCollapsable(d,"expand");map.Event.doDefaultZoom(b);break;case "collapse":d.style.setProperty("display","none","");__checkCollapsable(d,"collapse");break;case "expand":(g=SVGDocument.getElementById("legend:collapse:"+e))&&g.style.setProperty("display","inline","");__checkCollapsable(d,"expand");break;case "minus":opacity=featureNode.style.getPropertyValue("opacity");
opacity=""!==opacity?Number(opacity):1;0<opacity&&(opacity-=.1,featureNode.style.setProperty("opacity",String(opacity),""));break;case "plus":opacity=featureNode.style.getPropertyValue("opacity");opacity=""!==opacity?Number(opacity):1;1>opacity&&(opacity+=.1,featureNode.style.setProperty("opacity",String(opacity),""));break;case "setactive":activateTheme(e);szMapToolType.match(/select/)||setMapTool("info");break;case "item":try{this.lastItemObjectA[e].redraw()}catch(k){}}__setThemeState(e,f);return!0};
Map.Legend.prototype.execLegendMouseClickOnItem=function(b,d,e){if((b=map.Dom.getAttributeByNodeOrParents(d,szMapNs,"onactivate"))&&b.length)switch(szIdA=e.split(":"),szAction=szIdA[1],szItem=szIdA[szIdA.length-1],szAction){case "off":d.style.setProperty("display","none","");try{this.lastItemObjectA[szItem]&&this.lastItemObjectA[szItem].remove()}catch(f){}lastItemObject=this.lastItemObjectA[szItem]=null;break;case "on":if(this.lastItemObjectA[szItem])break;e="legend:off:"+e.substr(10,e.length-10);
(d=SVGDocument.getElementById(e))&&d.style.setProperty("display","inline","");try{this.lastItemObjectA[szItem]=eval(b),this.lastItemObjectA[szItem]&&(this.lastItemObjectA[szItem].onremove="map.Legend.setLegendCheckBox(null,'"+e+"','unchecked');map.Legend.lastItemObjectA['"+szItem+"']=null;deactivateTheme('"+szItem+"')",this.lastItemObjectA[szItem].szItem=szItem)}catch(g){alert("ERROR: "+g.description+" \nIN: "+b)}}return!0};
function __opacityPlus(b){if(map.Event.fMouseDown){var d=SVGDocument.getElementById(b),e=d.style.getPropertyValue("opacity"),e=""!==e?Number(e):1;1>e&&(d.style.setProperty("opacity",String(e+.1),""),setTimeout("__opacityPlus('"+b+"')",200))}}function __opacityMinus(b){if(map.Event.fMouseDown){var d=SVGDocument.getElementById(b),e=d.style.getPropertyValue("opacity"),e=""!==e?Number(e):1;0<e&&(d.style.setProperty("opacity",String(e-.1),""),setTimeout("__opacityMinus('"+b+"')",200))}}
Map.Legend.prototype.execLegendMouseClickOnTiles=function(b,d,e,f){var g=!1;if(e&&map.Tiles&&0<map.Tiles.nCount)for(var h=map.Tiles.getTileNodeIds(e),k=0;k<h.length;k++)this.execLegendMouseClick(b,d,h[k],f)&&(g=!0);g||(h=map.Dom.getAttributeByNodeOrParents(d,szMapNs,"classname"))&&h.length&&(g=this.execLegendMouseClick(b,d,e,f,h));return g};
Map.Legend.prototype.setLegendCheckBox=function(b,d,e){if(d.match(/legend/))for(szIdA=d.split(":"),d="legend:off",b=2;b<szIdA.length;b++)d+=":"+szIdA[b];(d=SVGDocument.getElementById(d))&&d.style.setProperty("display","checked"==e?"inline":"none","")};
Map.Legend.prototype.switchLegendCheckBox=function(b,d,e){b="legend:off:"+d;var f=SVGDocument.getElementById(b);f||(f=SVGDocument.getElementById(b+":byclassname"));f&&f.style.setProperty("display",e,"");(f=SVGDocument.getElementById("legend:setactive:"+d))&&f.style.setProperty("opacity","none"==e?"0.4":"1","")};
function __setThemeState(b,d){var e=SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(e)for(var f=0;f<e.length;f++)e.item(f).getAttributeNS(null,"name")==map.Tiles.getMasterId(b)&&e.item(f).setAttributeNS(null,"state",d)}function __getThemeState(b){var d=SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(d)for(var e=0;e<d.length;e++)if(d.item(e).getAttributeNS(null,"name")==map.Tiles.getMasterId(b))return d.item(e).getAttributeNS(null,"state");return"none"}
function __checkCollapsable(b,d){if(null!=b){var e=b.getAttributeNS(null,"id");if(!e.match(/label/)){var f,g=e.split(":"),e=g[0]+":item:"+g[2];for(f=3;f<g.length;f++)e=e+":"+g[f];if(e=b.ownerDocument.getElementById(e)){var h,g=null,k=e.childNodes;for(f=0;f<k.length;f++)if(1==k.item(f).nodeType&&k.item(f).getAttributeNS(null,"id")&&k.item(f).getAttributeNS(null,"id").match(/collapsable/)){h=0;switch(d){case "collapse":if("collapsed"==k.item(f).getAttributeNS(szMapNs,"state")||k.item(f).getAttributeNS(null,
"id").match(/placeholder/))break;(g=b.ownerDocument.getElementById(k.item(f).getAttributeNS(null,"id")+":end"))?h=-g.getAttributeNS(null,"y")+map.Scale.normalY(20):(g=map.Dom.getBox(k.item(f)),h=-g.height);g=map.Dom.newGroup(k.item(f).parentNode,k.item(f).getAttributeNS(null,"id")+":placeholder");g.setAttributeNS(szMapNs,"state","collapsed");g.parentNode.insertBefore(g,k.item(f));SVGHiddenGroup.appendChild(k.item(f+1));break;case "expand":if("collapsed"!=k.item(f).getAttributeNS(szMapNs,"state")&&
!k.item(f).getAttributeNS(null,"id").match(/placeholder/))break;h=null;if(k.item(f).getAttributeNS(null,"id").match(/placeholder/)){g=k.item(f);h=g.getAttributeNS(null,"id").split(":");k="";for(f=0;f<h.length-1;f++)k+=0<f?":":"",k+=h[f];h=SVGDocument.getElementById(k);g.parentNode.replaceChild(h,g);h=SVGDocument.getElementById(k)}else h=k.item(f);h.setAttributeNS(szMapNs,"state","expanded");(g=b.ownerDocument.getElementById(h.getAttributeNS(null,"id")+":end"))?h=g.getAttributeNS(null,"y")-map.Scale.normalY(20):
(g=map.Dom.getBox(h),h=g.height)}for(f=e.nextSibling;f&&h;)if(1==f.nodeType&&(g=getMatrix(f),g[5]+=h,setMatrix(f,g)),f=f.nextSibling,null==f)for(;e.parentNode&&e.parentNode.getAttributeNS(null,"id").match(/legend/);)if(e=e.parentNode,e.getAttributeNS(null,"id").match(/item/)){f=e.nextSibling;break}try{map.Legend.init(null)}catch(l){}break}}}}}zoomAndPanHistory=new History;highLightList=new HighLight;
