DonutCharts=new _DonutCharts;function _DonutCharts(){this.newChart=function(b,f,c,d,e,a){return new DonutChart(b,f,c,d,e,a)};this.partOver=_crc_donutPartOver;this.partOut=_crc_donutPartOut;this.partDown=_crc_donutPartDown;this.partUp=_crc_donutPartUp;this.partDrawOut=_crc_donutPartDrawOut;this.partDrawIn=_crc_donutPartDrawIn}
function DonutChart(b,f,c,d,e,a){this.targetDocument=b;this.targetGroup=f;this.mX=isNaN(c)?0:c;this.mY=isNaN(d)?0:d;this.nRadOuter=isNaN(e)?0:e;this.nRadInner=isNaN(a)?0:a;this.szStyle="flat";this.szLine=null;this.nLineWidth=1;this.partsA=[]}DonutChart.prototype.setCenter=function(b,f){this.mX=b;this.mY=f};DonutChart.prototype.setRadOuter=function(b){this.nRadOuter=isNaN(b)?0:b};DonutChart.prototype.setRadInner=function(b){this.nRadInner=isNaN(b)?0:b};
DonutChart.prototype.setStyle=function(b){this.szStyle=b};DonutChart.prototype.addStyle=function(b){this.szStyle+="|"+b};DonutChart.prototype.setLine=function(b){this.szLine=b};DonutChart.prototype.setLineWidth=function(b){this.nLineWidth=b};DonutChart.prototype.addPart=function(b,f,c,d,e,a,h,k){this.partsA[this.partsA.length]={nPercent:b,nInfoValue:b,nHeight:f,color:c,nOffset:d,szText:e,szInfo:a,szOver:h,szOut:k};return this.partsA[this.partsA.length-1]};
DonutChart.prototype.realize=function(){var b=0,f=360,b=null,b=this.partsA[0],c=0,d=this.partsA.length-1;this.donutPartsA=[];for(var e=!1,a=0;a<this.partsA.length;a++)0<this.partsA[a].nPercent&&(this.szStyle.match(/BIGTOTOP/)&&this.partsA[a].nPercent>c&&(b=this.partsA[a],c=this.partsA[a].nPercent),e=!0);if(e||this.szStyle.match(/AUTOCOMPLETE/)){e=c=0;if(this.szStyle.match(/VOLUME/)||this.szStyle.match(/STARBURST/)){for(a=0;a<this.partsA.length;a++)e+=this.partsA[a].nPercent,c+=Math.sqrt(this.partsA[a].nPercent);
for(a=0;a<this.partsA.length;a++)this.partsA[a].nPercent=Math.round(100/c*Math.sqrt(this.partsA[a].nPercent)),this.szStyle.match(/VOLUME/)&&(this.partsA[a].nHeight*=this.partsA[a].nPercent/25)}else{for(a=0;a<this.partsA.length;a++)e+=this.partsA[a].nPercent;if(100!=e)if(this.szStyle.match(/AUTOCOMPLETE/)&&100>e)this.addPart(Math.floor(1E5*(100-e))/1E5,this.partsA[0].nHeight,"#eeeeee",0,"");else for(a=0;a<this.partsA.length;a++)this.partsA[a].nPercent=this.partsA[a].nPercent/e*100}if((this.nRadInner||
this.szStyle.match(/VOLUME/))&&!this.szStyle.match(/NOROTATE/))if(this.szStyle.match(/STARBURST/))f=360-Math.floor(360/this.partsA.length/2);else if(this.szStyle.match(/BIGTOTOP/)){f=360;for(a=0;a<this.partsA.length&&this.partsA[a]!=b;a++)f-=100>this.partsA[a].nPercent?Math.floor(3.6*this.partsA[a].nPercent):0;f-=100>this.partsA[a].nPercent?Math.floor(1.8*b.nPercent):0}else 100>this.partsA[0].nPercent&&(f=360-Math.floor(1.8*this.partsA[0].nPercent));for(a=this.nRadOuterMaxR=this.nRadOuterMaxL=0;a<
this.partsA.length;a++)c=this.partsA[a].nPercent/100*360,e=0,this.szStyle.match(/STARBURST/)&&(c=360/this.partsA.length),this.szStyle.match(/XSRAYS/)?(c=360/this.partsA.length,e=.4*c,this.nRadInner=35):this.szStyle.match(/SRAYS/)?(c=360/this.partsA.length,e=.33*c,this.nRadInner=35):this.szStyle.match(/RAYS/)&&(c=360/this.partsA.length,e=.25*c,this.nRadInner=35),b=f%360,f=b+c,360<f&&(f%=360),this.donutPartsA[a]={nStartAngle:b+e,nEndAngle:f-e,color:this.partsA[a].color,nHeight:this.partsA[a].nHeight,
nOffset:this.partsA[a].nOffset},this.szStyle.match(/3D/)||(this.donutPartsA[a].nHeight=0),this.szStyle.match(/STARBURST/)&&(this.donutPartsA[a].nRadOuter=Math.max(1,this.nRadInner+this.partsA[a].nPercent/100*this.partsA.length*(this.nRadOuter-this.nRadInner))),180>=b&&180<=f&&(d=a),180>=b?this.nRadOuterMaxR=Math.max(this.nRadOuterMaxR,this.donutPartsA[a].nRadOuter):this.nRadOuterMaxL=Math.max(this.nRadOuterMaxL,this.donutPartsA[a].nRadOuter),this.partsA[a].nOpacity&&(this.donutPartsA[a].nOpacity=
this.partsA[a].nOpacity);this.frameGroup=_crc_constructNode("g",this.targetDocument,this.targetGroup,{});for(a=0;a<d;a++)b=_crc_drawDonut(this.targetDocument,this.frameGroup,this.mX,this.mY,this.donutPartsA[a].nRadOuter?this.donutPartsA[a].nRadOuter:this.nRadOuter,this.nRadInner,this.donutPartsA[a].nHeight,this.donutPartsA[a].nStartAngle,this.donutPartsA[a].nEndAngle,this.donutPartsA[a].color,null,null,this.szLine,this.nLineWidth,this.szStyle,this.donutPartsA[a].nOffset),this.szStyle.match(/SILENT/)||
(b.setAttributeNS(szMapNs,"tooltip",this.partsA[a].szInfo?this.partsA[a].szInfo:Math.round(10*this.partsA[a].nInfoValue)/10+" % "),this.partsA[a].szOver&&b.setAttributeNS(szMapNs,"onover",this.partsA[a].szOver),this.partsA[a].szOut&&b.setAttributeNS(szMapNs,"onout",this.partsA[a].szOut)),this.donutPartsA[a].nOpacity&&(b.style.setProperty("stroke-opacity","0.6",""),b.style.setProperty("fill-opacity","0.1","")),this.donutPartsA[a].objNode=b;for(a=this.donutPartsA.length-1;a>=d;a--)b=_crc_drawDonut(this.targetDocument,
this.frameGroup,this.mX,this.mY,this.donutPartsA[a].nRadOuter?this.donutPartsA[a].nRadOuter:this.nRadOuter,this.nRadInner,this.donutPartsA[a].nHeight,this.donutPartsA[a].nStartAngle,this.donutPartsA[a].nEndAngle,this.donutPartsA[a].color,null,null,this.szLine,this.nLineWidth,this.szStyle,this.donutPartsA[a].nOffset),this.szStyle.match(/SILENT/)||(b.setAttributeNS(szMapNs,"tooltip",this.partsA[a].szInfo?this.partsA[a].szInfo:Math.round(10*this.partsA[a].nInfoValue)/10+" % "),this.partsA[a].szOver&&
b.setAttributeNS(szMapNs,"onover",this.partsA[a].szOver),this.partsA[a].szOut&&b.setAttributeNS(szMapNs,"onout",this.partsA[a].szOut)),this.donutPartsA[a].nOpacity&&(b.style.setProperty("stroke-opacity","0.6",""),b.style.setProperty("fill-opacity","0.1","")),this.donutPartsA[a].objNode=b;this.szStyle.match(/3D/)&&this.frameGroup.setAttributeNS(null,"transform","matrix(1 0 0 0.5 0 0)")}else _crc_constructNode("circle",this.targetDocument,this.targetGroup,{id:"emptypie",cx:this.mX,cy:this.mY,r:this.nRadOuter,
style:"fill:none;stroke:gray"}),_crc_newText(this.targetDocument,this.targetGroup,this.mX,this.mY,"fill:gray;font-size:"+this.nRadOuter/5+";text-anchor:middle;","Pie error: no values !")};
DonutChart.prototype.getTextPosition=function(b){if(!this.donutPartsA[b])return null;var f=this.donutPartsA[b].nRadOuter?this.donutPartsA[b].nRadOuter:this.nRadOuter,c=this.nRadOuter,d=0,e=this.donutPartsA[b].nStartAngle,c=this.donutPartsA[b].nEndAngle;if(e==c)return null;var d=e<c?(e+c)/2:Math.min(360,(e+c+360)/2)%360,c=180>d?this.nRadOuterMaxR?this.nRadOuterMaxR+(this.nRadOuterMaxL>this.nRadOuterMaxR?Math.min(this.nRadOuterMaxR,(this.nRadOuterMaxL-this.nRadOuterMaxR)/2):0):this.nRadOuter:this.nRadOuterMaxL?
this.nRadOuterMaxL+(this.nRadOuterMaxR>this.nRadOuterMaxL?Math.min(this.nRadOuterMaxL,(this.nRadOuterMaxR-this.nRadOuterMaxL)/2):0):this.nRadOuter,e=Math.sin(d/180*Math.PI)*f,f=-Math.cos(d/180*Math.PI)*f-this.donutPartsA[b].nHeight,a=Math.sin(d/180*Math.PI)*c*1.1;b=-Math.cos(d/180*Math.PI)*c*1.1-this.donutPartsA[b].nHeight;return{x:a,y:b,lx:e,ly:f}};function _crc_createSingleNode(b,f,c){b=f.createElementNS("http://www.w3.org/2000/svg",b);c.appendChild(b);return b}
function _crc_constructNode(b,f,c,d){b=_crc_createSingleNode(b,f,c);for(var e in d)b.setAttribute(e,d[e]);return b}function _crc_newText(b,f,c,d,e,a){a||(a="(undefined)");f=_crc_constructNode("text",b,f,{x:String(c),y:String(d),style:e});b=b.createTextNode(a);f.appendChild(b);return f}
function _crc_drawDonut(b,f,c,d,e,a,h,k,g,m,l,n,p,r,q,u){null==u&&(u=0);var t=0,t=k<g?(k+g)/2:Math.max(360,(k+g+360)/2),v=Math.sin(t/180*Math.PI),t=-Math.cos(t/180*Math.PI);c+=u*v;d+=u*t;null==q&&(q="3D");null==m&&(m="#ffff00");null==l&&(l=ColorScheme.getDerivateColor(m,.7));null==n&&(n=ColorScheme.getDerivateColor(m,.7));null==p&&(p=ColorScheme.getBorderColor(m));f=q.match(/SILENT/)?_crc_constructNode("g",b,f,{}):_crc_constructNode("g",b,f,{onmouseover:"DonutCharts.partOver(evt)",onmouseout:"DonutCharts.partOut(evt)",
onmousedown:"DonutCharts.partDown(evt)",onmouseup:"DonutCharts.partUp(evt)"});if(0>k||0>g)return f;_crc_constructNode("rect",b,f,{id:"extractPoint",x:v*e/3,y:t*e/3,width:0,height:0,style:"fill:none;stroke:none"});q.match(/3D/)&&(k>g?(_crc_drawInnerWall(b,f,c,d,e,a,h,k,360,l,"none",0),_crc_drawInnerWall(b,f,c,d,e,a,h,0,g,l,"none",0)):_crc_drawInnerWall(b,f,c,d,e,a,h,k,g,l,p,r));q.match(/3D/)&&180<k&&(szPathD="",szPathD+=pathMoveToCirclePoint(c,d-h,e,k),szPathD+=pathLineToCirclePoint(c,d-h,a,k),szPathD+=
pathLineToCirclePoint(c,d,a,k),szPathD+=pathLineToCirclePoint(c,d,e,k),szPathD+=pathLineToCirclePoint(c,d-h,e,k),newPath=_crc_constructNode("path",b,f,{d:szPathD,style:"stroke:"+p+";fill:"+n+";stroke-width:"+r+";"}));q.match(/3D/)&&180>g&&(szPathD="",szPathD+=pathMoveToCirclePoint(c,d-h,e,g),szPathD+=pathLineToCirclePoint(c,d-h,a,g),szPathD+=pathLineToCirclePoint(c,d,a,g),szPathD+=pathLineToCirclePoint(c,d,e,g),szPathD+=pathLineToCirclePoint(c,d-h,e,g),newPath=_crc_constructNode("path",b,f,{d:szPathD,
style:"stroke:"+p+";fill:"+n+";stroke-width:"+r+";"}));q.match(/3D/)&&(k>g?(_crc_drawOuterWall(b,f,c,d,e,a,h,k,360,l,"none",0),_crc_drawOuterWall(b,f,c,d,e,a,h,0,g,l,"none",0)):_crc_drawOuterWall(b,f,c,d,e,a,h,k,g,l,p,r));360<=g-k?(szPathD="",szPathD+=pathMoveToCirclePoint(c,d-h,e,k),szPathD+=pathDrawArc(c,d-h,e,k,g),szPathD+=pathMoveToCirclePoint(c,d-h,a,g),a&&(szPathD+=pathDrawArcCounterClock(c,d-h,a,g,k))):(szPathD="",szPathD+=pathMoveToCirclePoint(c,d-h,e,k),szPathD+=pathDrawArc(c,d-h,e,k,g),
szPathD+=pathLineToCirclePoint(c,d-h,a,g),a&&(szPathD+=pathDrawArcCounterClock(c,d-h,a,g,k)),szPathD+=pathLineToCirclePoint(c,d-h,e,k));newPath=_crc_constructNode("path",b,f,{d:szPathD,style:"stroke:"+p+";fill:"+m+";stroke-width:"+r+";"});return f}
function _crc_drawInnerWall(b,f,c,d,e,a,h,k,g,m,l,n){90<k&&270>k&&270>g||(szPathD="",szPathD+=pathMoveToCirclePoint(c,d-h,a,k),szPathD+=pathDrawArc(c,d-h,a,k,g),szPathD+=pathLineToCirclePoint(c,d,a,g),szPathD+=pathDrawArcCounterClock(c,d,a,g,k),szPathD+=pathLineToCirclePoint(c,d-h,a,k),newPath=_crc_constructNode("path",b,f,{d:szPathD,style:"stroke:"+l+";fill:"+m+";stroke-width:"+n+";"}))}
function _crc_drawOuterWall(b,f,c,d,e,a,h,k,g,m,l,n){a=Math.max(k,90);g=Math.min(g,270);a>g||(szPathD="",szPathD+=pathMoveToCirclePoint(c,d-h,e,a),szPathD+=pathDrawArc(c,d-h,e,a,g),szPathD+=pathLineToCirclePoint(c,d,e,g),szPathD+=pathDrawArcCounterClock(c,d,e,g,a),szPathD+=pathLineToCirclePoint(c,d-h,e,a),newPath=_crc_constructNode("path",b,f,{d:szPathD,style:"stroke:"+l+";fill:"+m+";stroke-width:"+n+";"}))}
function _crc_donutPartOver(b){var f=Number(b.currentTarget.firstChild.getAttributeNS(null,"x")),c=Number(b.currentTarget.firstChild.getAttributeNS(null,"y"));b.currentTarget.setAttribute("transform","translate("+f/5+","+c/5+")");try{eval(b.currentTarget.getAttribute("onover"))}catch(d){}}function _crc_donutPartOut(b){b.currentTarget.setAttribute("transform","translate(0,0)");try{eval(b.currentTarget.getAttribute("onout"))}catch(f){}}
function _crc_donutPartDown(b){var f=Number(b.currentTarget.firstChild.getAttributeNS(null,"x")),c=Number(b.currentTarget.firstChild.getAttributeNS(null,"y")),c=c+map.Scale.normalY(.1);b.currentTarget.setAttribute("transform","translate("+f/5+","+c/5+")")}function _crc_donutPartUp(b){var f=Number(b.currentTarget.firstChild.getAttributeNS(null,"x")),c=Number(b.currentTarget.firstChild.getAttributeNS(null,"y"));b.currentTarget.setAttribute("transform","translate("+f/5+","+c/5+")")}
function _crc_donutPartDrawOut(b){if(b.firstChild){var f=Number(b.firstChild.getAttributeNS(null,"x")),c=Number(b.firstChild.getAttributeNS(null,"y"));if(f&&c)return b.setAttribute("transform","translate("+f+","+c+")"),!0}return!1}function _crc_donutPartDrawIn(b){if(b.firstChild){var f=Number(b.firstChild.getAttributeNS(null,"x")),c=Number(b.firstChild.getAttributeNS(null,"y"));if(f&&c)return b.setAttribute("transform","translate(0,0)"),!0}return!1}
function pathDrawArc(b,f,c,d,e){var a,h,k,g,m,l,n,p,r,q,u,t=" ";if(d>e)return t+=pathDrawArc(b,f,c,d,360),t+=pathDrawArc(b,f,c,0,e);for(u=1;8>=u;u++)if(!(d>45*u||e<45*(u-1))&&(g=Math.max(d,45*(u-1)),h=Math.min(e,45*u),g!=h)){180<g&&(g=360-g);90<g&&(g=180-g);45<g&&(g=90-g);180<h&&(h=360-h);90<h&&(h=180-h);45<h&&(h=90-h);l=Math.PI*g/180;m=Math.PI*h/180;a=c*Math.sin(l);k=c*Math.cos(l);h=c*Math.sin(m);g=c*Math.cos(m);a=k+Math.tan(l)*a;k=g+Math.tan(m)*h;m=(k-a)/(Math.tan(m)-Math.tan(l));l=-Math.tan(l)*
m+a;switch(u){case 1:n=h;r=m;p=-g;q=-l;break;case 2:n=g;r=l;p=-h;q=-m;break;case 3:n=g;r=l;p=h;q=m;break;case 4:n=h;r=m;p=g;q=l;break;case 5:n=-h;r=-m;p=g;q=l;break;case 6:n=-g;r=-l;p=h;q=m;break;case 7:n=-g;r=-l;p=-h;q=-m;break;case 8:n=-h,r=-m,p=-g,q=-l}t+="Q"+String(b+r)+","+String(f+q)+" "+String(b+n)+","+String(f+p)}return t}
function pathDrawArcCounterClock(b,f,c,d,e){var a;a=""+pathDrawArc(b,f,c,e,d);d="";a=a.split("Q");for(var h=a.length-1;0<h;h--)for(var k=a[h].split(" "),g=1;0<=g;g--)if(h!=a.length-1||1!=g)d=0==g?d+(" Q"+k[g]):d+(" "+k[g]);return d+=pathAddCirclePoint(b,f,c,e)}function pathMoveToCirclePoint(b,f,c,d){var e;e=Math.PI*d/180;d=c*Math.sin(e);c*=Math.cos(e);return"M"+String(b+d)+","+String(f+-c)}
function pathLineToCirclePoint(b,f,c,d){var e;e=Math.PI*d/180;d=c*Math.sin(e);c*=Math.cos(e);return"L"+String(b+d)+","+String(f+-c)}function pathAddCirclePoint(b,f,c,d){var e;e=Math.PI*d/180;d=c*Math.sin(e);c*=Math.cos(e);return" "+String(b+d)+","+String(f+-c)};
