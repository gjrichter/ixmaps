<!DOCTYPE HTML>
<html>

<head>
	<title>IXMAPS embed</title>
	<meta name="Author" content="Guenter Richter">
	<meta name="Keywords" content="map SVG HTML5 Javascript maps interactive charts ixmaps">
	<meta name="Description" content="core html page for ixmaps SVG interactive map applications in overlay on mapstraction basemaps">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

	<meta http-equiv="X-UA-Compatible" content="IE=9" />

	<!--========================================================================= 
	  we need scripting
	<!--========================================================================= -->

	<noscript>
		<div style="position:absolute;top:100px;left:100px;width:500px">
			<b>JavaScript must be enabled in order for you to use iXMaps.</b><br><br> However, it seems JavaScript is either disabled
			or not supported by your browser. To view the map application, enable JavaScript by changing your browser options, and
			then try again.</div>
	</noscript>

	<!--========================================================================= -->

	<link rel="shortcut icon" href="./resources/images/ixmaps_logo.png">

	<link href="../../ui/libs/jquery/ui/css/smoothness/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css" />
	<link href="../css/jquery-ui.css" rel="stylesheet" type="text/css" />
	<link href="../css/custom.css" rel="stylesheet" type="text/css" />
	<link href="../css/icomoon.css" rel="stylesheet" type="text/css" />
	<link href="../css/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link href="../css/messagebox.css" rel="stylesheet" type="text/css">
	<link href="../css/bootstrap.css" rel="stylesheet" type="text/css">
	<link href="../css/legend.css" rel="stylesheet" type="text/css">

	<!--========================================================================= -->

	<style type="text/css">
		a:hover {
			background-color: yellow;
			text-decoration: underline;
		}
	</style>
	<style type="text/css">
		/* style the scrollbar */

		::-webkit-scrollbar {
			width: 0px;
		}
		/* Track */

		::-webkit-scrollbar-track {
			box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.1);
			-webkit-box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.1);
			-webkit-border-radius: 0px;
			border-radius: 0px;
		}
		/* Handle */

		::-webkit-scrollbar-thumb {
			-webkit-border-radius: 0px;
			border-radius: 0px;
			background: rgba(232, 232, 232, 0.6);
			box-shadow: inset 0 0 0px rgba(0, 0, 0, 0.1);
			-webkit-box-shadow: inset 0 0 0px rgba(0, 0, 0, 0.1);
		}

		::-webkit-scrollbar-thumb:window-inactive {
			background: rgba(222, 222, 222, 0.4);
		}



		.ui-dialog {
			opacity: 1;
		}


		.ui-dialog-title {
			font-size: 0.9em;
		}


		.ui-dialog .ui-dialog-titlebar {
			padding: 0.5em 0.5em 0.6em;
		}


		#ixmapxxx {
			-moz-box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .5)/*{global-box-shadow-color}*/
			;
			-webkit-box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .5)/*{global-box-shadow-color}*/
			;
			box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .5)/*{global-box-shadow-color}*/
			;
		}


		#opensidebarbutton {
			background: #ffffff;
			border: #ccc solid 1px;
			border-radius: 0.5em;
		}


		#switchmodebutton {
			background: #ffffff url(./resources/images/info.png) no-repeat 95% 95%;
			background-size: 14px;
			border: #ccc solid 1px;
			border-radius: 0.5em;
		}


		#switchtoolsbutton {
			background: #ffffff;
			background-size: 8px;
			border: #ccc solid 1px;
			border-radius: 0.5em;
		}


		#switchsearchbutton {
			background: #ffffff;
			background-size: 8px;
			border: #ccc solid 1px;
			border-radius: 0.5em;
		}


		#switchhelpbutton {
			background: #ffffff;
			border: #ccc solid 1px;
			border-radius: 0.5em;
		}


		#switchinfobutton {
			background: #ffffff;
			border: #ccc solid 1px;
			border-radius: 0.5em;
		}


		#switchlegendbutton {
			background: #f8f8f8;
			border: #ccc solid 1px;
			border-radius: 0.4em;
		}


		#switchsplitterbutton {
			background: #ffffff;
			background-size: 14px;
			border: #ccc solid 1px;
			border-radius: 0.5em;
		}


		.search-box {
			width: 275px;
			margin: 0;
			float: left;
			outline: none;
			font-size: 1.2em;
			border: 0;
			margin-left: 0.2em;
		}


		.search-container {
			width: 275px;
			margin: 0;
			float: left;
			outline: none;
			border: 1px solid #ddd;
			font-size: 1.1em;
			border-radius: 6px;
			background: #ffffff url(./resources/images/search.png) no-repeat 98% 50%;
			background-size: 28px;
		}



		.search-btn {
			background-color: #0079c6;
			padding: 9px 13px;
			color: white;
			float: left;
			font-size: 0.9em;
			cursor: pointer;
			border-radius: 6px;
			-moz-box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .2)/*{global-box-shadow-color}*/
			;
			-webkit-box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .2)/*{global-box-shadow-color}*/
			;
			box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .2)/*{global-box-shadow-color}*/
			;
		}


		.result-list {
			font-family: Verdana, Helvetica, arial;
			display: none;
			border: 1px solid lightgray;
			border-top: none;
			position: absolute;
			z-index: 9999;
			box-sizing: border-box;
			font-size: 1.2em;
			-moz-box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .2)/*{global-box-shadow-color}*/
			;
			-webkit-box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .2)/*{global-box-shadow-color}*/
			;
			box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .2)/*{global-box-shadow-color}*/
			;
		}



		.result-item {
			background-color: white;
			border-bottom: 1px solid lightgray;
			padding: 8px;
			cursor: pointer;
			width: auto;
			overflow: hidden;
			white-space: nowrap;
			text-overflow: ellipsis;
		}



		.result-item:last-child {
			border: none;
		}



		.result-item.selected {
			background-color: whitesmoke;
		}



		.colorlist {
			padding: 0px;
			margin: 0px;
			margin-left: -10px;
			border: 0;
		}


		.colorlistitem {
			padding: 1px;
			margin: 3px;
			border: 0;
		}


		.colorlistitem>a {
			text-decoration: none;
			padding: 3px;
			margin: 3px;
			border: 0;
		}


		.colorlistitem>a:hover {
			text-decoration: none;
			background: #fd8;
		}



		a.theme-button {
			text-decoration: none;
			margin-right: 0.2em;
		}


		span.theme-button {
			font-size: 14px;
			color: #444444;
			background: #ffffff;
			padding: 0.5em;
		}


		span.legend-button-settings {
			color: #eeeeee;
		}


		table.theme-legend {
			font-size: 0.8em;
			line-height: 0.9em;
			color: #888888;
			max-width: 300px;
		}


		td.theme-legend {
			max-width: 200px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}


		td.theme-legend-count {
			min-width: 60px;
			overflow: hidden;
		}


		tr.theme-legend-item-selected {
			background: #F9F4C2;
		}


		#attribution a {
			text-decoration: none;
		}


		p.legend-description {
			margin-top: 1em;
			margin-bottom: 1em;
			font-size: 0.6em;
		}


		#title {
			font-family: arial;
			color: #666666;
			font-size: 1.3em;
			line-height: 1.1em;
			padding: 0.2em 0.5em;
		}


		.title-field {
			position: absolute;
			left: 100px;
			top: 11px;
			height: 32px;
			max-width: 200px;
			display: none;
			z-index: 9999;
			border: #d8d8d8 solid 1px;
			border-radius: 0.3em;
			background: #ffffff;
			opacity: 0.95;
			-moz-box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .2)/*{global-box-shadow-color}*/
			;
			-webkit-box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .2)/*{global-box-shadow-color}*/
			;
			box-shadow: 0px 2px 4px/*{global-box-shadow-size}*/
			rgba(0, 0, 0, .2)/*{global-box-shadow-color}*/
			;
		}


		.shadow {
			-webkit-box-shadow: 1px 1px 6px rgba(0, 0, 0, 0.2);
			box-shadow: 1px 1px 6px rgba(0, 0, 0, 0.2);
		}
		/* remove blue border around active buttons */


		xxxbutton:focus {
			outline: 0 !important;
		}
	</style>
	<style type="text/css">
		.draggable {
			position: absolute;
			left: 30px;
			top: 30px;
			width: 60px;
			height: 60px;
			margin-left: -30px;
			margin-top: -30px;

			color: #FFF;
			font: bold 16px Helvetica, Arial, Sans-serif;
			text-align: center;
		}


		.androideventpane {
			position: absolute;
			left: 30px;
			top: 30px;
			width: 60px;
			height: 60px;
			margin-left: -30px;
			margin-top: -30px;
		}
	</style>

	<!--========================================================================= -->

</head>

<body style="background:#fff;margin:0px;padding:0px;overflow:hidden;">


	<!--========================================================================= 
		story board / sidebar
	<!--========================================================================= -->

	<div id="sidebar" style="position:absolute;top:5px;padding:0;margin:0;padding-right:5px;width:0px;height:0px;display:none;background:#ffffff;">
		<div id="story-board" style="display:block;overflow:auto;padding-left:5px;">
			<h2 style="background:#fafafa;color:white;margin-top:20px;"> story board ... </h2>
		</div>
		<!-- legend -->
	</div>

	<!--========================================================================= 
		the map space
	<!--========================================================================= -->

	<div id="ixmap" style="position:relative;top:23px;left:0px;overflow:hidden;font-size:11px;">

		<div id="onmapbuttondiv" style="position:absolute;top:20px;left:10px;opacity:0.95">

			<button type="button" id="opensidebarbutton" title="open sidebar" class="shadow" style="height:40px;width:40px;">
					<label for="opensidebarbutton" style="height:36px;" >
						<img id="opensidebarbuttonicon" src="./resources/images/list-grey.png" style="height:24px;margin-left:-8px;margin-right:-4px;opacity:0.8" /></label></button>

			<button type="button" id="switchmodebutton" title="info/pan" class="shadow" style="height:40px;width:40px;display:none;">
					<label for="switchmodebutton" style="height:36px;" >
						<img id="switchmodebuttonicon" src="./resources/images/mano.png" style="height:24px;margin-left:-5px;margin-right:-4px;" /></label></button>

			<button type="button" id="switchtoolsbutton" title="show toolbar" class="shadow" style="height:40px;width:40px;display:none;">
					<label for="switchtoolsbutton" style="height:36px;" >
						<img id="switchmodebuttonicon" src="./resources/images/gear_empty.png" style="height:24px;margin-left:-5px;margin-right:-4px;" /></label></button>

			<button type="button" id="switchsearchbutton" title="show searchbar" class="shadow" style="height:40px;width:40px;display:none;vertical-align:-4px;">
					<label for="switchsearchbutton" style="height:36px;" >
						<img id="switchsearchbuttonicon" src="./resources/images/search.png" style="height:29px;margin-left:-3px;margin-top:2px;opacity:0.6" /></label></button>

			<button type="button" id="switchhelpbutton" title="show searchbar" class="shadow" style="height:40px;width:40px;display:none;vertical-align:-4px;">
					<label for="switchhelpbutton" style="height:36px;" >
						<img id="switchhelpbuttonicon" src="./resources/images/info_gray.png" style="height:29px;margin-left:-5px;margin-top:2px;opacity:0.6" /></label></button>

			<button type="button" id="switchinfobutton" title="end info window mode" class="shadow" style="height:40px;width:40px;display:none;">
					<label for="switchinfobutton" style="height:36px;" >
						<img id="switchinfobuttonicon" src="./resources/images/info_window.png" style="height:24px;margin-left:-5px;margin-right:-4px;" /></label></button>

			<button type="button" id="switchsplitterbutton" title="end info window mode" class="shadow" style="height:40px;width:40px;display:none;">
					<label for="switchsplitterbutton" style="height:36px;" >
						<img id="switchsplitterbuttonicon" src="./resources/images/splitter.png" style="height:24px;margin-left:-5px;margin-right:-4px;" /></label></button>



			<span id="embedlogo" style="vertical-align:-2px;margin-left:5px;display:none;">
					<img id="logo" src="./resources/images/ixmaps_logo_grey_transparent.png" height="20px">
				</span>

		</div>

		<div class="search-container" style="position:absolute;top:11px;left:98px;z-index:999999;display:none;width:0;">
			<input class="search-box" type="text" placeholder="trova ..." style="height:24px;padding:7px;" />
		</div>
		<div class="result-list"></div>

		<div id="onmapbuttondivbottom" style="position:absolute;bottom:30px;right:10px;display:inline;opacity:0.95;z-index:999">

			<button type="button" id="switchlegendbutton" title="switch legend display" style="height:40px;width:40px;display:none;">
					<label for="switchlegendbutton" style="height:36px;" >
						<img id="switchlegendbuttonicon" src="./resources/images/dialog_gray.png" style="height:28px;margin-top:3px;margin-left:-4px;opacity:0.8" /></label></button>

		</div>

		<!-- title -->

		<div id="title" class="title-field">
		</div>

		<div id="map-legend" class="map-legend shadow" style="z-index:999;display:none;">
		</div>

	</div>

	<!--========================================================================= 
		loading, messages, help etc
	<!--========================================================================= -->

	<div id="divlogo" style="pointer-events:none;z-index:99;visibility:hidden;">
		<div id="logo-image" style="position:absolute;top:60px;left:10px;padding-top:2px;padding-left:5px;padding-right:5px;background: rgba(255, 255, 255, 0.9);border-radius:2px"><span style="font-family:helvetica,arial,sans;color:#444;font-size:0.7em;vertical-align:3px;padding:0px;margin:0px;">application:</span>
			<img alt="logo" style="height:12px;" src="./resources/images/ixmaps_logo_transparent.png" />
		</div>
	</div>

	<div id="divloading" style="pointer-events:none;z-index:9999">
		<div id="loading-text-div" style="position:absolute;top:47%;width:100%;background-color: #ffffff;opacity:1;z-index:99">
			<div id="loading-text" style="font-family:arial;font-size:48px;opacity:1;
								color: #dddddd;
								text-align:center;
								">
			</div>
		</div>
		<div id="loading-imagexxx" style="position:absolute;top:48%;left:50%;z-index:99;display:none;">
			<p id="loading" style=" margin-top:1em;
								">
				<img style="margin-left:10em;margin-bottom:-7px;height:8px;" alt="mill" src="./resources/images/loading.gif" />
			</p>
		</div>

	</div>

	<div id="attribution-div" style="position:absolute;bottom:0px;left:0px;z-index:999">
		<span id="attribution" style="color:#444444;font-family:verdana;font-size:11px;background:#ffffff;opacity:0.7;padding-left:4.5em;padding-bottom:0.2em;padding-right:0.5em;"> <span> 
		</div>

		<div id="divstart" style="	visibility:hidden;
								position:absolute;
								top:0px;
								left:0px;
								width:100%;
								height:100%;
								z-index:1000;"  >
			<div id="start-text-div" style="position:absolute;top:45%;left:40%">
				<a id="start-text" href="javascript:__startMap()" 
							style="font-family:serif;
								font-size:48px;
								color:#666666;
								background-color:#dddddd;
								padding: 0px 12px 3px 8px;
								-moz-border-radius: 15px;
								border-radius: 15px;
								text-align:center">start</a>
				</p>
			</div>
		</div>
		<div id="velo" style="	visibility:hidden;
								background-color:#444444;
								opacity:0.2;
								position:absolute;
								top:0px;
								left:0px;
								width:100%;
								height:100%;
								z-index:1000;" width="100%" height="100%"  >
		</div>
		<div id="help" style="visibility:hidden"  >
		</div>
		<div id="dialog" style="visibility:hidden"  >
		</div>
		<div id="legend" style="visibility:hidden"  >
		</div>
		<div id="sidebar" style="visibility:hidden"  >
		</div>
		<div id="projects" style="visibility:hidden;"  >
		</div>

	<!--========================================================================= -->
	</body>

  <!--========================================================================= -->

  <script src = "../../ui/libs/jquery/jquery-1.7.1.min.js"></script>
  <script src = "../../ui/libs/jquery/ui/js/jquery-ui-1.8.16.custom.min.js"></script>

  <script src="../libs/beforeafter/js/jquery.beforeafter-canib.js"></script>
  <script src="../libs/getUrlParam/js/jquery.getUrlParam.js"></script>
  <script src="../libs/modernizr/js/testsvg.js"></script>
  <script src="../libs/csv/jquery.csv.js"></script>
  <script src="../libs/csv/papaparse.min.js"></script>
  <script src="../libs/messagebox.js"></script>

  <script type="text/javascript" src="../js/htmlgui.js" > </script>
  <script type="text/javascript" src="../js/htmlgui_query.js" > </script>
  <script type="text/javascript" src="../js/htmlgui_sync.js" > </script>
  <script type="text/javascript" src="../js/htmlgui_sync_Mapstraction.js" > </script>
  <script type="text/javascript" charset="utf-8" src="../libs/mxn-2.0.14/mxn.js?(googlev3, microsoft, leaflet)"></script> 


  <script type="text/javascript" src="../js/htmlgui_story.js" > </script>

  <script type="text/javascript" src="../js/tools/colorscheme.js" > </script>
  <script type="text/javascript" src="../js/tools/colorselect.js" > </script>
  <script type="text/javascript" src="../js/tools/history.js" > </script>
  <script type="text/javascript" src="../js/tools/theme_legend.js" > </script>
  <!--
  <script type="text/javascript" src="../js/tools/legend.js" > </script>
  -->

<!--========================================================================= -->

<!-- needed for Fusion Table data access -->
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<!--
<script type="text/javascript" src="http://dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=6"></script> 
<script type="text/javascript" src="http://openlayers.org/api/OpenLayers.js"></script> 
-->

<link rel="stylesheet" href="../../ui/libs/leaflet-0.7.7/leaflet.css" />
<!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.ie.css" />
<![endif]-->

<!--
<script src="http://cdn.leafletjs.com/leaflet-0.6/leaflet.js"></script>
-->
<script src="../../ui/libs/leaflet-0.7.7/leaflet.js"></script>

<!--========================================================================= -->

<script type="text/javascript">

	(function (ixmaps, $, undefined) {

		ixmaps.fLegendVisible = true;

		var szControls = "small";
		var szSvgLegendFlag = "nolegend";
		var szHTMLLegendFlag = "1";

		// GR 12.02.2015 define fallback default map, used if parameter SVGGIS is empty  
		var szDefaultMap = "../../maps/svg/maps/generic/mercator.svgz";

		$(document).ready(function () {

			// check browser SVG capability

			if (!Modernizr.svg) {
				alert("sorry ! your browser has no native SVG support;\n\nPlease try:   Chrome, Firefox, Safari, Opera or IE9");
			}

			// check opener

			if (window.opener) {
				ixmaps.parentApi = window.opener.ixmaps;
				ixmaps.szName = window.opener.name;
			} else
				if (parent) {
					ixmaps.parentApi = parent.window.ixmaps;
					ixmaps.szName = parent.window.name;
				}
				else {
					alert("error: missing parent window for parameter !");
				}

			// configure minimalistic interface for embedded map
			// 
			if (($(document).getUrlParam('pure')) ||
				($(document).getUrlParam('minimal')) ||
				!($(document).getUrlParam('toolbar') == '1')) {
				$("#toolbar").remove();
				$("#ixmap").css('top', '0px');
				szControls = "mobile";
				// define user on map ready
				ixmaps.onMapReady = function () {
					ixmaps.embeddedSVG.window.map.Themes.autoHideInfoTools = "all";
					// adjust on map buttons
					$("#onmapbuttondiv").css('left', String(parseInt($(ixmaps.gmapDiv).css('left')) + 10) + "px");
				};

				var mapTop = parseInt($("#ixmap").css('top'));
				$("#onmapbuttondiv").css('top', String(mapTop + 11) + 'px');
				$("#onmapbuttondiv").css('z-index', '9999');
				$("#switchmodebutton").button().click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					__switchInputMode();
				});
				$("#switchinfobutton").button().click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					__switchInfoMode();
				});
				$("#switchlegendbutton").button().click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					__switchLegendMode();
				});
				$("#switchlegendbutton").show();
				if ($(document).getUrlParam('toolbutton') ||
					$(document).getUrlParam('tools')) {
					$("#switchmodebutton").show();
					$("#onmapbuttondiv").show();
					$("#switchtoolsbutton").show();
					$("#switchtoolsbutton").button().click(function (e) {

						e.preventDefault();
						e.stopPropagation();

						htmlMap_showMapTypeControl();

						if (0) {
							ixmaps.openDialog(e, 'dialog', './popuptools_jquery.html', '', 'auto', 350, 800);
						} else {
							if ($(document).getUrlParam('bigtools')) {
								ixmaps.openDialog(e, 'dialog', './popuptools_jquery.html', '', 'auto', 380, 350);
							} else {
								var szPos = String(parseInt($(ixmaps.gmapDiv).css('left')) + 10) + ',55';
								ixmaps.openDialog(e, 'dialog', './popuptools_line_v2.html', '', szPos, 700, 100);
								$("#dialog").css("height", "100%");
								$("#dialog").css("width", "90%");
								$("#dialog").css("position", "absolute");
								$("#dialog").css("top", "10px");
								$("#dialog").css("overflow", "hidden");
							}
						}
					});
				} else {
					$("#switchtoolsbutton").remove();
					if ($(document).getUrlParam('modebutton') && ($(document).getUrlParam('modebutton') == "1")) {
						$("#switchmodebutton").show();
					}
				}
			} else {
				// position anyway, needed see below: story
				$("#onmapbuttondiv").css('top', String(mapTop + 11) + 'px');
			}

			if (!$(document).getUrlParam('title')) {
				$("#title").remove();
			}

			if (!$(document).getUrlParam('legend')) {
				try {
					$("#legendvisible")[0].checked = false;
				} catch (e) { }
				ixmaps.onMapReady = function () {
					ixmaps.toggleThemeLegends(false);
				};
			} else
				if (!$(document).getUrlParam('legendcontrol')) {
					$("#legendcontrol").remove();
				}

			// GR 09.03.2015 new geo search 
			//
			if ($(document).getUrlParam('search')) {

				ixmaps.szSearchSuffix = $(document).getUrlParam('search');

				$("#switchsearchbutton").show();
				$("#switchsearchbutton").button().click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					$("#switchsearchbutton").hide();
					$(".search-container").show().animate({ width: "400px" }, 500);
					$(".search-box").show();
				});
				$(".search-container").click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					$(".search-container").animate({ width: "0px" }, 500);
					$(".search-container").hide();
					$(" .search-box").val("");
					$("#switchsearchbutton").show();
				});
				$(".search-box").click(function (e) {
					e.stopPropagation();
				});
			}

			// GR 18.04.2015 new help 
			//
			if ($(document).getUrlParam('help')) {

				$("#switchhelpbutton").show();
				$("#switchhelpbutton").button().click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					ixmaps.openDialog(null, "help", $(document).getUrlParam('help'), "help", "auto", 800, 500, 0.9);
					//popupTools($(document).getUrlParam('help'));
				});
			}

			// GR 26.01.2016 new splitter 
			//
			if ($(document).getUrlParam('splitter')) {

				$("#switchsplitterbutton").show();
				$("#switchsplitterbutton").button().click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					ixmaps.toggleSplitter();
				});
			}

			// GR 18.04.2015 new about 
			//
			if ($(document).getUrlParam('about')) {

				$("#switchhelpbutton").show();
				$("#switchhelpbutton").button().click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					ixmaps.openDialog(null, "about", $(document).getUrlParam('about'), "info", "auto", 800, 500, 0.9);
					//popupTools($(document).getUrlParam('help'));
				});
			}

			// GR 18.04.2015 new about 
			//
			if ($(document).getUrlParam('flat')) {
				$("head").append("<link rel='stylesheet' id='extracss' href='../css/flat.css' type='text/css' />");
				$(".shadow").removeClass("shadow");
			}

			// register the embedded map,
			// in case the parent page holds more than one embedded map,
			// we can sync them if parameter name is given

			if ($(document).getUrlParam('name')) {
				ixmaps.szName = $(document).getUrlParam('name');
			}
			ixmaps.szPath = $(location).attr('pathname');
			if (ixmaps.parentApi) {
				try {
					ixmaps.parentApi.registerApi(ixmaps, ixmaps.szName || "map", window);
				} catch (e) { }
			}

			// get application id
			// used to create app specific bookmark store
			if ($(document).getUrlParam('appid')) {
				ixmaps.szAppId = $(document).getUrlParam('appid');
				ixmaps.setAppId($(document).getUrlParam('appid'));
			}

			// check predefined map height against window height

			var maxHeight = window.innerHeight;
			var maxWidth = window.innerWidth;
			maxHeight -= parseInt($("#ixmap").css('top'));

			$("#ixmap").css('height', maxHeight + 'px');
			$("#ixmap").css('width', maxWidth + 'px');
			$("#banner").css('width', maxWidth + 'px');

			if ($(document).getUrlParam('controls') == "hidden") {
				$("#tools").remove();
				$("#chartsdiv").remove();
				$("#banner").css("height", "0px");
				$("#ixmap").css("top", "0px");
			}

			// GR 02.11.2013 set background color
			// ----------------------------------
			var szMapType = decodeURIComponent($(document).getUrlParam('maptype'));
			if (szMapType.match(/dark/i) || szMapType.match(/black/i)) {
				$("#ixmap").css({ "background": "#222222" });
				setTimeout('$("#gmap").css({"background":"#222222"})', 1000);
				$("#switchlegendbutton").css("background-color", "#222222");
				$("#switchlegendbutton").css("border-color", "#666666");

				$("#loading-text-div").css("background-color", "#888888");
				$("#loading-text-div").css("opacity", "0.8");
				$("#loading-text").css("color", "#444444");

			} else if (szMapType.match(/gray/i)) {
				$("#ixmap").css({ "background": "#E6E6E6" });
				setTimeout('$("#gmap").css({"background":"#E6E6E6"})', 1000);
				$("#switchlegendbutton").css("background-color", "#E6E6E6");
				$("#switchlegendbutton").css("border-color", "#dddddd");

				$("#loading-text-div").css("background-color", "#888888");
				$("#loading-text-div").css("opacity", "0.8");
				$("#loading-text").css("color", "#444444");

			} else {
				$("#ixmap").css({ "background": "white" });
				setTimeout('$("#gmap").css({"background":"white"})', 1000);
				$("#switchlegendbutton").css("background-color", "#ffffff");
				$("#switchlegendbutton").css("border-color", "#dddddd");

				$("#loading-text-div").css("background-color", "#ffffff");
				$("#loading-text-div").css("opacity", "1");
				$("#loading-text").css("color", "#bbbbbb");

			}

			// GR 13.03.2014 svg map legend 0/1
			// ----------------------------------
			if ($(document).getUrlParam('svgmaplegend')) {
				szSvgLegendFlag = "legend";
			}
			// GR 06.01.2015 html legend 0/1
			// ----------------------------------
			if ($(document).getUrlParam('themelegend')) {
				szHTMLLegendFlag = $(document).getUrlParam('themelegend');
				ixmaps.fLegendVisible = (szHTMLLegendFlag != "0");
			}else{
				$("#switchlegendbutton").remove();
				ixmaps.fLegendVisible = false;
			}
			// GR 01.03.2015 dynamicURL flag
			// ----------------------------------
			if ($(document).getUrlParam('dynamicURL')) {
				ixmaps.fDynamicPageHistory = $(document).getUrlParam('dynamicURL');
			}
			// GR 08.10.2016 no processing messages popups
			// -------------------------------------------
			if ($(document).getUrlParam('silent')) {
				ixmaps.fSilent = ($(document).getUrlParam('silent') == "1");
			}
			// create the map app
			// -------------------
			if ($(document).getUrlParam('autoplay') != "false") {
				var szMap = decodeURIComponent($(document).getUrlParam('svggis'));
				szMap = (szMap && (szMap != "null")) ? szMap : szDefaultMap;
				map = new ixmaps.map("ixmap", {
					mapService: decodeURIComponent($(document).getUrlParam('mapservice')),
					maptype: decodeURIComponent($(document).getUrlParam('maptype')),
					svg: szMap,
					mapsize: "fullscreen",
					mode: szSvgLegendFlag,
					controls: szControls,
					silent: decodeURIComponent($(document).getUrlParam('silent'))
				});
			} else {
				$("#divstart").css("visibility", "visible");
				$("#divloading").css("visibility", "hidden");
			}

			// activate the ui
			// -------------------

			$("#zoom").button({ icons: { secondary: 'ui-icon-zoomin' } });
			$("#pan").button({ icons: { secondary: 'ui-icon-arrow-4' } });
			$("#info").button({ icons: { secondary: 'ui-icon-info' } });
			$("#select").button({ icons: { secondary: 'ui-icon-extlink' } });
			$("#tools").buttonset();


			$("#moremaps").button({ icons: { secondary: 'ui-icon-triangle-1-s' } }).click(function (e) {
				ixmaps.openMegaBox(e, 'dialog', './maps.html', 'Select map', 'auto', 850, 700, 0.8);
			});
			$("#chartsA").button().click(function (e) {
				ixmaps.changeObjectScaling(0.75);
			});
			$("#chartsB").button().click(function (e) {
				ixmaps.toggleThemeValues();
			});
			$("#chartsC").button().click(function (e) {
				ixmaps.changeObjectScaling(1 / 0.75);
			});
			$("#charts").buttonset();

			$("#toolbar").css("visibility", "visible");

			if ($(document).getUrlParam('options') ||
				$(document).getUrlParam('tools')) {
				$("#popuptools").button({ icons: { primary: 'ui-icon-gear' } }).click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					if (1) {
						ixmaps.openDialog(e, 'dialog', './popuptools_jquery.html', '', 'auto', 380, 350);
					} else {
						ixmaps.openDialog(e, 'dialog', './popuptools_line.html', '', '0,25', 650, 100);
						$("#dialog").css("height", "100%");
						$("#dialog").css("width", "90%");
						$("#dialog").css("position", "absolute");
						$("#dialog").css("top", "10px");
					}
				});
			} else {
				$("#popuptools").remove();
			}

			if ($(document).getUrlParam('reset')) {
				$("#resetbutton").button({ icons: { primary: 'ui-icon-arrowrefresh-1-w' } }).click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					ixmaps.clearAll();
				});
			} else {
				$("#resetbutton").remove();
			}
			// GR 14.11.2014 suspended because of problems with the html theme legend 
			if (0 && $(document).getUrlParam('story') && ($(document).getUrlParam('story') != "null")) {

				var szStoryUrl = $(document).getUrlParam('story');
				ixmaps.storyUrl = szStoryUrl;
				var sidebarHeight = parseInt($("#ixmap").css('height'));
				var sidebarWidth = Math.min(Math.max(window.innerWidth / 3, 200), 350);
				$("#story-board").html("<iframe id='embed-story' src=\"" + szStoryUrl + "\" " +
					" style='border:0;margin:0px;width:" + sidebarWidth + "px;height:" + sidebarHeight + "px' />");

				//ixmaps.loadStory($(document).getUrlParam('story'));
				var mapTop = parseInt($("#ixmap").css('top'));
				//			$( "#onmapbuttondiv").css('top',String(mapTop+9)+'px');
				$("#onmapbuttondiv").css('visibility', 'visible');
				$("#onmapbuttondiv").css('z-index', '9999');
				$("#opensidebarbutton").button().click(function (e) {
					e.preventDefault();
					e.stopPropagation();
					__switchMapStory();
				});
				// GR 18.06.2015 button suspended 
				$("#opensidebarbutton").remove();
			} else {
				$("#opensidebarbutton").remove();
			}
			if ($(document).getUrlParam('overlaycontrol')) {
				$("#htmlvisible").button();
				$("#svgvisible").button();
				$("#splitter").button();
				$("#visiswitch").buttonset();
			} else
				if ($(document).getUrlParam('mapcontrol')) {
					$("#svgvisible").next().remove();
					$("#svgvisible").remove();
					$("#splitter").next().remove();
					$("#splitter").remove();
					$("#htmlvisible").button();
				} else {
					$("#visiswitch").remove();
				}
			if ($(document).getUrlParam('tilemap') == "hidden") {
				ixmaps.HTML_hideMap();
				ixmaps.htmlMap = false;
				try {
					$("#htmlvisible")[0].checked = false;
				} catch (e) { }
				$("#visiswitch").buttonset('refresh');
			}
			ixmaps.embedlogo = false;
			if ($(document).getUrlParam('logo')) {
				ixmaps.embedlogo = true;
				$("#embedlogo").show();
			}
			if ($(document).getUrlParam('child')) {
				$("#switchlegendbutton").remove();
				$.getScript("../js/tools/legend.js", function () {
				});
			}

			// layout ready 
			//$( "#divlogo" ).css("visibility","visible");
			var attribution = decodeURIComponent(unescape($(document).getUrlParam('attribution')));
			$("#attribution").html((attribution && (attribution != "null")) ? attribution : "powered by <span style='color:blue'>iX</span>< span style= 'color:green' >Maps</span>" );

			ixmaps.attribution = attribution;
			ixmaps.date = decodeURIComponent(unescape($(document).getUrlParam('date')));
			ixmaps.parent = decodeURIComponent(unescape($(document).getUrlParam('parent'))); 
			
			// change input mode ?
			if ( $(document).getUrlParam('mode')){ 
				var mode = $(document).getUrlParam('mode');
				ixmaps.execBookmark("map.Api.setMapTool('" + mode + "')", false);
				__setInputMode(mode);
			} 
			// is there a bookmark to execute at load ? 
			if ( $(document).getUrlParam('bookmark') ){ 
				x = $(document).getUrlParam('bookmark');
				szBookmark = decodeURIComponent(((typeof (x) != "string") ? x.join("") : x));
				ixmaps.execBookmark(szBookmark, false);
			}
			// show/hide toolsbar elements
			__switchBannerElements();
			setTimeout("__switchBannerElements()", 5000);
			
			// --------------------------------------------------------
			// android chrome event error work around
			// --------------------------------------------------------
			// GR 27.03.2014 chrome for android doesn't get events through overlay SVG even if there pointer-events == none
			// we create a transparent pane on top to enable zoom and pan of the HTML basemap 
			aDiv = document.createElement("div");
			aDiv.setAttribute("id","androideventpane");
			aDiv.setAttribute("class", "androideventpane");
			aDiv.setAttribute("style", "width:100%;height:100%;z-index:100");
			var mapDiv = $('#gmap')[0];
			mapDiv.appendChild(aDiv);
			
			// end - android chrome event error work around
			// --------------------------------------------------------
			htmlMap_enableScrollWheelZoom();
			//htmlMap_showMapTypeControl();
		});

		$(window).resize(function(e) {
			$("#banner").css('width',window.innerWidth+'px');
			__switchBannerElements();
			if (e.target.nodeName != 'DIV') {
				var height = $("#legend").parent().height();
				var width = $("#legend").parent().width();
				$("#legend").parent().css("left",(window.innerWidth - width - 20) + "px");
				$("#legend").parent().css("top",(window.innerHeight - height - 40) + "px");
			}
		});

		// ----------------------
		// button executer
		// ----------------------

		__switchBannerElements = function () {

			var toolsWidth = parseInt($("#tools").css('width'));
			var visiToolWidth = parseInt($("#visiswitch").css('width'));
			var chartToolWidth = parseInt($("#chartsdiv").css('width'));
			if (window.innerWidth > (toolsWidth + visiToolWidth + chartToolWidth + 10)) {
				$("#visiswitch").show();
				$("#chartsdiv").show();
			} else
			if (window.innerWidth > (toolsWidth + chartToolWidth + 30)) {
				$("#visiswitch").hide();
				$("#chartsdiv").show();
			} else {
				$("#visiswitch").hide();
				$("#chartsdiv").hide();
			}

			$("#onmapbuttondiv").css('left', String(parseInt($(ixmaps.gmapDiv).css('left')) + 10) + "px");
			
			if ($(document).getUrlParam('child')) {
				if ((window.innerWidth < 650) || !ixmaps.embedlogo) {
					$("#embedlogo").hide();
				} else {
					$("#embedlogo").show();
				}
				if (window.innerWidth < 500) {
					$("#onmapbuttondiv").hide();
				} else {
					$("#onmapbuttondiv").show();
				}
			}
		}; 
	
		__switchInputMode = function() {
			
			switch (ixmaps.getMapTool()) {
				case 'info':
					ixmaps.mapTool('idle');
					ixmaps.switchAndroidEventPane(true);
					$("#switchmodebuttonicon").attr("src","./resources/images/mano.png");
					$("#switchmodebuttonicon").css("opacity","1");
					$("#switchmodebutton").css("background","#ffffff url(./resources/images/info.png) no-repeat 95% 95%");
					$("#switchmodebutton").css("background-size","13px");
					$("#switchinfobutton").hide();
					break;
				case 'pan':
				default:
					ixmaps.mapTool('info');
					ixmaps.switchAndroidEventPane(false);
					$("#switchmodebuttonicon").attr("src","./resources/images/info.png");
					$("#switchmodebutton").css("background","#ffffff url(./resources/images/mano.png) no-repeat 98% 95%");
					$("#switchmodebutton").css("background-size", "13px");
					$("#switchmodebuttonicon").css("opacity","1");
					break;
			}
		}; 
	
		__setInputMode = function(szMode) {
			try {
			switch (szMode) {
				case 'info':
					$("#switchmodebuttonicon").attr("src","./resources/images/info.png");
					$("#switchmodebutton").css("background","#ffffff url(./resources/images/mano.png) no-repeat 98% 95%");
					$("#switchmodebutton").css("background-size","13px");
					$("#switchmodebuttonicon").css("opacity","1");
					break;
				case 'pan':
				default:
					$("#switchmodebuttonicon").attr("src","./resources/images/mano.png");
					$("#switchmodebuttonicon").css("opacity","1");
					$("#switchmodebutton").css("background","#ffffff url(./resources/images/info.png) no-repeat 95% 95%");
					$("#switchmodebutton").css("background-size","13px");
				break;
				}
			}
			catch (e) {}
			try {
				$("#" + mode)[0].checked = true;
				$("#tools").buttonset('refresh');
				} 
			catch (e) {}
		};
	
		 __switchInfoMode = function() {
			 $("#switchinfobutton").hide();
			 ixmaps.mapTool('pan');
			 //ixmaps.mapTool( 'info');
		}; 
		
		// ------------------------------------------- 
		// start function in case: autoplay==false 
		// -------------------------------------------

		__startMap = function() {

			$("#divstart").hide();
			var szMap = decodeURIComponent($(document).getUrlParam('svggis'));
			szMap = (szMap && (szMap != "null")) ? szMap : szDefaultMap;

			map = new ixmaps.map("ixmap", { 
					mapService: decodeURIComponent($(document).getUrlParam('mapservice')),
					maptype: decodeURIComponent($(document).getUrlParam('maptype')),
					svg: szMap,
					mapsize: "fix",
					mode: szSvgLegendFlag,
					controls: szControls 
					});
		
			// is there a bookmark to execute at load ?
			ixmaps.onMapReady = function() {
				if ($(document).getUrlParam('bookmark')) {
					x = $(document).getUrlParam('bookmark');
					szBookmark = decodeURIComponent(((typeof (x) != "string") ? x.join("")	: x));
					ixmaps.execBookmark(szBookmark, false);
				}
				ixmaps.toggleThemeLegends(false);
			};
		};
	
		// -------------------------------------------
		// other helper
		// -------------------------------------------

		ixmaps.syncSlaveMap = function(ptSW, ptNE, nZoom) {
			ixmaps.parentApi.syncEmbed(ixmaps,ptSW,ptNE,nZoom);
		};
		
		ixmaps.syncEmbedMap = function(ptSW, ptNE, nZoom) {
			ixmaps.htmlgui_setCenterAndZoom({lat: (ptSW.lat	+ ptNE.lat) / 2, lng: (ptSW.lng + ptNE.lng) / 2	}, nZoom);
			ixmaps.fSyncByMasterMap = true;
			htmlgui_synchronizeSVG(false);
		};
		
		ixmaps.setMapTool = function(szId) {
			 $("#" + szId).click();
		};
		
		ixmaps.setColorScheme = function(index){ 
			ixmaps.changeThemeStyle(null,"colorscheme:" + index, "set");
			$("#colorList").dialog("close");
		};
		
		ixmaps.switchAndroidEventPane = function(fFlag) {
			//if ( fFlag && this.isTouchDevice() ) {
			if (fFlag) { 
				$(".androideventpane").show();
			} else { 
				$(".androideventpane").hide();
			}
		};

		ixmaps.switchUi = function(fFlag) { 
			if (fFlag) {
				$("#onmapbuttondiv").show();
				$("#onmapbuttondivbottom").show();
				htmlMap_showMapControl();
			} else {
				$("#onmapbuttondiv").hide();
				$("#onmapbuttondivbottom").hide();
				htmlMap_hideMapControl();
			}
		}; 
		
		// -------------------------------------------
		// search tool 
		// ------------------------------------------- 
		
		ixmaps.search=ixmaps.search || {};
		
		ixmaps.search.positionResultList=function(input) {
			$('.result-list').css({	
				width: input.outerWidth(),
				top: input.offset().top + input.outerHeight(),
				left:input.offset().left
			});
		}; 
		
		ixmaps.search.showQueryMessage = function() {
			$('.result-list').empty();
			this.positionResultList($('.search-box'));
			var itemObject = $('<div class="result-item" title="searching"><em>searching ...</em></div>');
			$('.result-list').append(itemObject);
			$('.result-list').show();
		};
		
		ixmaps.search.renderResults = function(result) {
			$('.result-list').empty();
			this.positionResultList($('.search-box'));
			if (!result) {
				var itemObject = $('<div class="result-item" title="not found"><em>' + $('.search-box').val() +	'</em> not found!</div>');
				$('.result-list').append(itemObject);
				$('.result-list').show();
				return;
			}
			var i = 0;
			result.forEach(function (item) {
				if (++i < 10) {
					var itemStr = '<div class="result-item" title="' + item.display_name + '">' + item.display_name + '</div>';
					var itemObject = $(itemStr);
					itemObject.data(item);
					$('.result-list').append(itemObject);
				}
			});
			$('.result-list').show();
		};
		
		ixmaps.search.renderMap = function(data) { 

			ixmaps.search.result = data;

			var x = (Number(data.boundingbox[0]) + Number(data.boundingbox[1]))	/ 2;
			var y = (Number(data.boundingbox[2]) + Number(data.boundingbox[3])) / 2;

			if (data.class == "place") {
				ixmaps.setView([x,y], 13);
			} else {
				ixmaps.setBounds([Number(data.boundingbox[0]), Number(data.boundingbox[2]), Number(data.boundingbox[1]), Number(data.boundingbox[3])]);
			} 
			
			var __szBookmark = "map.Api.doZoomMapToGeoBounds(" + data.boundingbox[0] + "," + data.boundingbox[2] + "," + data.boundingbox[1] + "," + data.boundingbox[3] + ");";
			ixmaps.execBookmark(__szBookmark);
			
			$('.search-box').val(data.display_name.replace(data.address.hamlet + ', ', ''));
		};

		ixmaps.search.szSearchSuffix = "";
		ixmaps.search.queryNominatim = function() { 
			ixmaps.search.lastSearch = $('.search-box').val();
			var query = encodeURIComponent($('.search-box').val() + ((this.szSearchSuffix.length > 1) ? ("," + this.szSearchSuffix) : ""));
			$('.error').hide();
			$('.result-list').empty().hide();

			this.showQueryMessage();

			$.ajax({
				url: "http://open.mapquestapi.com/nominatim/v1/search.php?key=9VpTwb1ib382pomWexOxmr2J67UtDJKN&q=" + query + "&format=json&addressdetails=1",
				success: function (result) {
					if (result.length) {
						ixmaps.search.renderResults(result);
					} else {
						ixmaps.search.renderResults(null);
						$('.error').show();
					}
				}
			});
		};
		
		ixmaps.search.selectResult = function (item) {
			$('.result-item').removeClass('selected');
			item.addClass('selected');
		};
		
		ixmaps.search.renderMapFromResult = function() {
			var target = $('.result-item.selected');
			ixmaps.search.renderMap(target.data());
			$('.result-list').empty().hide();
		};
		
		$('.result-list')
			.on('click', '.result-item', ixmaps.search.renderMapFromResult)
			.on('mouseenter', '.result-item', function (e) {
				$(e.currentTarget).addClass('selected');
			})
			.on('mouseleave', '.result-item', function (e) {
				$(e.currentTarget).removeClass('selected');
			});
			
			$(document).on('keydown', '.search-box', function (e) {
				var pressed = e.which;
				var keys = {
					enter: 13,
					up: 38,
					down: 40
				};
				if (pressed === keys.enter) {
					$('.result-item.selected').length ? ixmaps.search.renderMapFromResult() : ixmaps.search.queryNominatim();
				} else if (pressed === keys.up) {
					if (!$('.result-item.selected').length || $('.result-item.selected').is(':first-child')) { 
						// Choose last
						ixmaps.search.selectResult($('.result-item:last-child'));
					} else { 
						// Choose prev item
						ixmaps.search.selectResult($('.result-item.selected').prev());
					}
				} else if (pressed === keys.down) {
					if (!$('.result-item.selected').length || $('.result-item.selected').is(':last-child')) {
						// Choose first 
						ixmaps.search.selectResult($('.result-item:first-child'));
					} else {
						// Choose next item
						ixmaps.search.selectResult($('.result-item.selected').next());
					}
				} else {
					if ($('.result-item').length) { 
						$('.result-list').empty().hide();
					}
				} 
		});
		
		var __queryNominatimTimeout = null;
		
		$(document).on('keyup', '.search-box', function (e) {
			var pressed = e.which;
			var keys = {
				enter: 13,
				up: 38,
				down: 40
			};
			if (pressed !== keys.enter) {
				if (__queryNominatimTimeout) {
					clearTimeout(__queryNominatimTimeout);
				}
				__queryNominatimTimeout	= setTimeout("ixmaps.search.queryNominatim()", 500);
			}
		});
		
		$(document).on('blur', '.search-box', function () {
			if ($('.result-item').length) {
				setTimeout("$('.result-list').empty().hide();", 500);
			}
		});
		
		$(document).on('click', '.search-btn', ixmaps.search.queryNominatim);
		// ------------------------------------------- 
		// END search tool 
		// ------------------------------------------- 
		
	}( window.ixmaps = window.ixmaps || {}, jQuery ));

</script>

</html>