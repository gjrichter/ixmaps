<!DOCTYPE HTML>
<html>

<head>
	<meta charset="UTF-8">
	<title>iXmaps Theme Configurator</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<meta http-equiv="X-UA-Compatible" content="IE=9" />

	<!-- Bootstrap core CSS -->
	<link href="../assets/css/bootstrap.css" rel="stylesheet">

	<link href="../../libs/jquery/ui/css/ixmaps/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css"/>
	<link href="../../css/jquery-ui.css" rel="stylesheet" type="text/css"/>

	<!-- Custom styles -->
	<link href="../assets/css/font-awesome.min.css" rel="stylesheet">
	<link href="../assets/css/icomoon.css" rel="stylesheet">

	<link href="../../css/site.min.css" rel="stylesheet">

	<style type="text/css" media="screen">
		body {
			overflow: auto;
			border-left: solid #aaa 0.5px;
			background-color: none;
		}

		#xcolor-label>span {
			padding: 6px 12px;
		}

		.exact-value {
			margin: 0.2em 0em;
			padding: 1em;
			width: 100%;
		}

		option,
		optgroup {
			color: #666666;
			font-size: 1.2em;
		}

		optgroup,
		label {
			color: #dddddd;
			padding-left: 0.2em;
		}

		#chartValueOptions option,
		optgroup {
			color: #bbbbbb;
		}

		select.form-control {
			padding: 5px;
		}

		input.form-control {
			padding: 8px;
		}

		input::placeholder {
			color: #dddddd;
		}

		.form-control::placeholder {
			color: #dddddd;
		}

		input,
		select,
		.form-group {
			margin-bottom: 1em;
		}

		h3 {
			margin-top: 0.3em;
			margin-bottom: 0.2em;
			padding-bottom: 0.2em;
			padding-left: 0em;
			xxborder-bottom: solid #ddd 0px;
			border: solid #ddd 0px;
			border-radius: 0.1em;
			xbackground-color: #fff;
			font-size: 36px;
		}

		hr {
			margin: 0;
			height: 0px;
			color: #ffffff;
			border-color: #ffffff;
			background-color: #ffffff;
		}

		.container {
			padding-bottom: 1em;
			margin-bottom: 1em;
		}

		.colorlist {
			padding: 0px;
			margin: 0px;
			margin-left: -5px;
			border: 0;
		}

		.colorlistitem {
			padding: 1px;
			margin: 3px;
			border: 0;
			font-family: monospace;
			font-size: 24px;
			line-height: 1em;
		}

		.colorlistitem>a {
			text-decoration: none;
			padding: 3px;
			margin: 3px;
			border: 0;
		}

		.colorlistitem>a:hover {
			text-decoration: none;
			background: #fd8;
			xborder: #aaa solid 1px;
		}

		.colpick{
			z-index: 9999;
		}

		.colpick_submit {
			top: 145px;
		}

		h3.disabled {
			color: #dddddd;
		}

		h3.enabled {
			color: #48A542;
		}

		.control-alert {
			border-color: #ff8888;
			border-width: 1px;
		}

		.help {
			margin-left:0px;
			padding-left:0;
			margin-bottom:10px;
			display:none;
		}

		.calendar {
			color:black;
			background-color: transparent;
			padding:0;
			border-radius:0;
			border:0;
			box-shadow:none;
			margin-right: 10px;
		}

		.calendar .years .plus em,
		.calendar .years .minus em {
			font-size:1.1em;
			user-select: none;
			position: relative;
			display: inline-block;
			width: 32px;
			height: 32px;
			margin-top:2px;
			padding-top:4px;
			cursor: pointer;
			color: #888;
			border: 1px solid #aaa;
			border-radius: 50%;
			-webkit-border-radius: 50%;
			-moz-border-radius: 50%;
		}
		.calendar .years .minus em {
			font-size:1.3em;
			padding-top:0px;
		}

		.calendar .years .plus em:active,
		.calendar .years .plus em:hover,
		.calendar .years .minus em:active,
		.calendar .years .minus em:hover {
			border-color: #e9573f
		}


	</style>
</head>

<body id="theme-editor">

	<div class="container">
		<div id="editor-apply" style="position:absolute;top:1.5em;right:1em;margin-top:0.5em;margin-left:0.5em;z-index:99999;display:none">
			<a href='javascript:ixmaps.editor.applyChanges();'>
				<button type="button" class="btn btn-warning btn-md">
					apply changes
				</button>
			</a>
		</div>
	</div>

	<div id="workspace" style="margin-top:-2em;height:600px;overflow:auto">

		<div class="container">

			<!--  --------------------	-->
			<!--  map and data sources  -->
			<!--  --------------------	-->

			<div id="data-alert" style="margin-top:1em"></div>

			<h3 id="chartDefinitionMap_header" class="disabled">
				<span id="map-defined">map</span> and
				<span id="data-defined">data</span> sources</h3>

			<div class="row">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<label id="define-map-title">map</label>
					<div class="input-group">
						<input id="define-map" type="text" class="form-control" placeholder="SVG map..." aria-label="SVG map...">
						<span class="input-group-btn">
							<button class="btn btn-secondary" type="button">edit</button>
						</span>
					</div>
				</div>
			</div>

			<!--  map layer and embedded data  -->
			<div id="map-data" style="display:none">

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label id="map-layer-info-title" for="map-layer-info">layer</label>
							<select class="form-control" id="map-layer-info" size='6' onchange="ixmaps.editor.getSampleValues()">
								<option>-</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="sel1">sample values</label>
							<div id="mapDataValueOptions">
								<sub>
									<br>
									<span style="color:#888888;vertical-align:15px;">(no field selected ...)&#160;&#160;</span>
								</sub>
							</div>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label id="map-datafields-title" for="map-data-fields-select">data field(s)</label>
							<select class="form-control" id="map-data-fields-select" multiple="multiple" size='6' onchange="ixmaps.editor.getSampleValues()">
								<option>-</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="sel1">sample values</label>
							<div id="mapDataValueOptions">
								<sub>
									<br>
									<span style="color:#888888;vertical-align:15px;">(no field selected ...)&#160;&#160;</span>
								</sub>
							</div>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="theme-data-field2-select">2. data field</label>
							<select class="form-control" id="theme-data-field2-select">
								<option>-</option>
							</select>
						</div>
					</div>
				</div>

			</div>

			<div id="data-define" style="display:none">

				<div class="row" style="margin-top:0.5em">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<label id="define-data-title">data</label>
						<div class="input-group">
							<input id="define-data" type="text" class="form-control" placeholder="define data source ..." aria-label="data...">
							<span class="input-group-btn">
								<button class="btn btn-secondary" type="button" onclick="ixmaps.loadStoryTool('../../../app/Editor/dialog_data_load.html')">edit</button>
							</span>
						</div>
					</div>
				</div>

			</div>


			<!-- --------------------	-->
			<!-- layer and lookup       -->
			<!-- --------------------	-->

			<div id="config-lookup" style="margin-top:2em;border-top:solid #ddd 0.1em;display:none">

				<h3 id="chartLookupFields" class="disabled">lookup
					<span class="pull-right">
						<a href='javascript:ixmaps.editor.applyChanges();'>
							<button type="button" class="btn btn-link btn-md">
								apply changes
							</button>
						</a>
					</span>
				</h3>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label id="define-layer-title" for="sel1">layer</label>
							<select class="form-control" id="map-layer-select">
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label id="define-lookup-title" for="theme-data-lookup-select">lookup field</label>
							<select class="form-control" id="theme-data-lookup-select">
								<option>-</option>
							</select>
						</div>
					</div>
				</div>

				<div class="row" id="define-latlon-div">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label id="define-latlon-title" for="theme-data-lat-select">lat/lon</label>
							<select class="form-control control-alert" id="theme-data-lat-select">
								<option>-</option>
							</select>
							<select class="form-control" id="theme-data-lon-select">
								<option>-</option>
							</select>
						</div>
					</div>
				</div>

				<div id="lookup-alert"></div>
			</div>

			<!-- --------------------	-->
			<!-- data fields            -->
			<!-- --------------------	-->

			<div id="config-data" style="clear:both;display:none">

				<h3 id="chartDefinitionFields" class="disabled">data
					<span class="pull-right">
						<a href='javascript:ixmaps.editor.applyChanges();'>
							<button type="button" class="btn btn-link btn-md">
								apply changes
							</button>
						</a>
					</span>
				</h3>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label id="define-datafields-title" for="theme-data-fields-select">data field(s)</label>
							<select class="form-control" id="theme-data-fields-select" multiple="multiple" size='6' onchange="ixmaps.editor.getSampleValues()">
								<option>-</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="sel1">sample values</label>
							<div id="chartValueOptions">
								<sub>
									<br>
									<span style="color:#888888;vertical-align:15px;">(no field selected ...)&#160;&#160;</span>
								</sub>
							</div>
						</div>
					</div>
				</div>

				<div id="data-field-alert"></div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="theme-data-field2-select">2. data field</label>
							<!-- help -->
							<a href="#" onclick="$(this).siblings('.help').toggle('slow');">
							<span class="fa fa-info fa-fw" style="font-size:14px;color:#dddddd;float:right;padding-top:0.3em"></span></a>
							<div class="help" >
								<p>The second data field defines a data source to calculate the final value from two values, the data field(s) and this value.</p>
								<p>If not specified differently, iXMaps will perform a 'percent' calculation.</p>
								<p>Other calculations can be defined by 'theme type' modificators like PERMILLE, FACTOR, DIFFERENCE ...</p>
							</div>

							<select class="form-control" id="theme-data-field2-select">
								<option>-</option>
							</select>
						</div>
					</div>
				</div>

			</div>

		</div>

		<!-- ====================	-->
		<!-- theme definituion      -->
		<!-- ====================	-->

		<div id="config-theme" style="display:none">
			<div class="container" style="background:#f8f6f8">

				<!-- --------------------	-->
				<!-- theme type             -->
				<!-- --------------------	-->

				<h3 id="chartThemeTitle" class="disabled">theme type
					<span class="pull-right">
						<a href='javascript:ixmaps.editor.applyChanges();'>
							<button type="button" class="btn btn-link btn-md">
								apply changes
							</button>
						</a>
					</span>
				</h3>

				<div class="row">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label id="define-themetype-title" for="theme-type-select">theme type</label>
							<select class="form-control" id="theme-type-select" onchange="javascript:ixmaps.editor.setChartStyle()">
								<option>-</option>
							</select>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label id="actual-themetype-title" for="theme-type-select">actual theme type</label>
							<div id="theme-type-text"></div>
						</div>
					</div>
				</div>
			</div>

			<!-- -----------------------	-->
			<!-- colorscheme and classes    -->
			<!-- -----------------------	-->

			<div class="container" style="background:#f8f6f8;">

				<h3 id="chartColor-title" style="color:#dddddd">color
					<span class="pull-right" style="vertical-align:-100%">
						<a href='javascript:ixmaps.editor.applyChanges();'>
							<button type="button" class="btn btn-link btn-md">
								apply changes
							</button>
						</a>
					</span>
				</h3>

				<div class="row">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label id="xcolor-title" for="xcolor">colors</label>
							<div>
								<a id="xcolor" href="javascript:ixmaps.popupSelectColorScheme();">
									<span id="xcolor-label" style="font-size:11px;line-height:15px;background-color:white;"></span>
								</a>
							</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<!-- help -->
							<a href="#" onclick="$(this).siblings('.help').toggle();">
							<span class="fa fa-info fa-fw" style="font-size:14px;color:#dddddd;float:right;padding-top:0.3em"></span></a>
							<div class="help">
								<p>- for single fields it is either a class distributon mode like EQUIDISTAND, QUANTILE or LOGARITHMIC or EXACT for discrete value like 'type' or 'year'</p>
								<p>- for multiple field charts it can be 'by field' (for bar or pie charts) or 'dominant' or 'significant', if we have single value charts or shapes for the visualisation</p>
								<p>('significant' is a value that is most above its own mean value; measured in standard deviation)</p>
							</div>
							<!------ -->
							<label for="theme-distribution-select">distribution</label>
							<select class="form-control" id="theme-distribution-select" onchange="ixmaps.editor.setDistribution()">
								<optgroup label="distribution (numeric values only!)">
									<option value="EQUIDISTANT">Equidistant</option>
									<option value="LOGARITHMICAL">Logarithmical</option>
									<option value="QUANTILE">Quantile</option>
									<option value="RANGES">Ranges</option>
								</optgroup>
								<optgroup label="discret values (text values allowed)">
									<option value="EXACT">Exact</option>
									<option value="EXACT">Exact + ignore case</option>
								</optgroup>
								<optgroup label="dominant values (of multiple data)">
									<option value="">by data source</option>
									<option value="DOMINANT">by dominant value</option>
									<option value="DOMINANT|DEVIATION">by significant value</option>
								</optgroup>
							</select>
							<select class="form-control" id="theme-classes-select" onchange="ixmaps.editor.setClasses()">
								<option value="1">1 class</option>
								<option value="2">2 classes</option>
								<option value="3">3 classes</option>
								<option value="4" selected>4 classes</option>
								<option value="5">5 classes</option>
								<option value="6">6 classes</option>
								<option value="7">7 classes</option>
								<option value="8">8 classes</option>
								<option value="9">9 classes</option>
								<option value="10">10 classes</option>
								<option value="11">11 classes</option>
								<option value="12">12 classes</option>
								<option value="13">13 classes</option>
								<option value="14">14 classes</option>
								<option value="15">15 classes</option>
							</select>
						</div>
					</div>
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div id="theme-exact-label">
						</div>
					</div>
				</div>
			</div>

			<!-- --------------------------------- -->
			<!-- chart style					   -->
			<!-- --------------------------------- -->

			<div class="container" style="background:#f8f6f8">

				<h3 id="chartStyleTitle" class="disabled">style
					<span class="pull-right">
						<a href='javascript:ixmaps.editor.applyChanges();'>
							<button type="button" class="btn btn-link btn-md">
								apply changes
							</button>
						</a>
					</span>
				</h3>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="theme-values-checkbox"></label>
							<div class="checkbox" style="margin-top:0px">
								<label class="toggle">
									<span style="margin-left:4em;color:#666666">show values</span>
									<input type="checkbox" id="theme-values-checkbox" onchange="toggle_values()">
									<span class="handle"></span>
								</label>
							</div>
							<div class="checkbox" style="margin-top:-40px">
								<label class="toggle">
									<span style="margin-left:4em;color:#666666">shadow</span>
									<input type="checkbox" id="theme-shadow-checkbox" onchange="toggle_shadow()">
									<span class="handle"></span>
								</label>
							</div>
							<div class="checkbox" style="margin-top:-40px">
								<label class="toggle">
									<span style="margin-left:4em;color:#666666">show data</span>
									<input type="checkbox" id="theme-showdata-checkbox" onchange="toggle_data()">
									<span class="handle"></span>
								</label>
							</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="theme-glow-checkbox"></label>
							<div class="checkbox" style="margin-top:0px">
								<label class="toggle">
									<span style="margin-left:4em;color:#666666">glow</span>
									<input type="checkbox" id="theme-glow-checkbox" onchange="toggle_glow()">
									<span class="handle"></span>
								</label>
							</div>
							<div class="checkbox" style="margin-top:-40px">
								<label class="toggle">
									<span style="margin-left:4em;color:#666666">aura</span>
									<input type="checkbox" id="theme-aura-checkbox" onchange="toggle_aura()">
									<span class="handle"></span>
								</label>
							</div>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartPositionList">chart position</label>
							<select class="form-control" id="chartPositionList" name="chartThemeType">
								<option value="">---</option>
								<option value="center">center</option>
								<option value="top">top</option>
								<option value="bottom">bottom</option>
								<option value="left">left</option>
								<option value="right">right</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartLabelFade">label fade</label>
							<input type="text" class="form-control" id="chartLabelFade" placeholder="0.1 ... 3">
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartSortList">sorting</label>
							<select class="form-control" id="chartSortList" name="chartSortList">
								<option value="">---</option>
								<option value="SORT|DOWN|">sort down</option>
								<option value="SORT|UP|">sort up</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label id="chartOpacityLabel" for="chartOpacityValue">fill opacity</label>
							<div class="calendar">
								<div class="years clearfix">
									<div class="unit minus" onclick="changeChartOpacity(-1)"><em>-</em></div>
									<div class="monyear" style="padding:0em 0em 0em 1.2em" ><input class="form-control" style="width:90%" type="text" id="chartOpacityValue" placeholder="1 ... " onkeypress="setChartOpacity()"></div>
									<div class="unit plus" onclick="changeChartOpacity(1)"><em>+</em></div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartLineColor">line color</label>
							<input type="text" class="form-control" id="chartLineColor" placeholder="none" onkeypress="setLineColor()">
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chart	">line width</label>
							<div class="calendar">
								<div class="years clearfix">
									<div class="unit minus" onclick="changeLineWidth(-1)"><em>-</em></div>
									<div class="monyear" style="padding:0em 0em 0em 1.2em" ><input class="form-control" style="width:90%" type="text" id="chartLineWidth" placeholder="1 ... " onkeypress="setLineWidth()"></div>
									<div class="unit plus" onclick="changeLineWidth(1)"><em>+</em></div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartValueDecimalsList">value decimals</label>
							<select class="form-control" id="chartValueDecimalsList" name="chartSortList">
								<option value="0">#</option>
								<option value="1">#.#</option>
								<option value="2">#.##</option>
								<option value="3">#.###</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartValueScale">value text size</label>
							<div class="calendar">
								<div class="years clearfix">
									<div class="unit minus" onclick="changeValueScale(-1)"><em>-</em></div>
									<div class="monyear" style="padding:0em 0em 0em 1.2em" ><input class="form-control" style="width:90%" type="text" id="chartValueScale" placeholder="1 ... " onkeypress="setValueScale()"></div>
									<div class="unit plus" onclick="changeValueScale(1)"><em>+</em></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- --------------------------------- -->
			<!-- size                              -->
			<!-- --------------------------------- -->

			<div class="container" style="background:#f8f6f8">

				<h3 id="chartSizeTitle" class="disabled">size
					<span class="pull-right">
						<a href='javascript:ixmaps.editor.applyChanges();'>
							<button type="button" class="btn btn-link btn-md">
								apply changes
							</button>
						</a>
					</span>
				</h3>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label id="chartSizeLabel" for="chartScaleValue">scale</label>
							<div class="calendar">
								<div class="years clearfix">
									<div class="unit minus" onclick="changeChartScale(-1)"><em>-</em></div>
									<div class="monyear" style="padding:0em 0em 0em 1.2em" ><input class="form-control" style="width:90%" type="text" id="chartScaleValue" placeholder="1 ... " onkeypress="setChartScale()"></div>
									<div class="unit plus" onclick="changeChartScale(1)"><em>+</em></div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartSizeList">dynamic size</label>
							<select class="form-control" id="chartSizeList" name="chartSizeType">
								<option value="">---</option>
								<option value="SIZE">by value</option>
								<option value="LINEAR">by value - linear</option>
								<option value="SIZEP2">by value - square</option>
								<option value="SIZEP3">by value - cubic</option>
								<option value="SIZEP4">by value - power of 4</option>
								<option value="SIZELOG">by value - logarithmical</option>
								<option value="NOSIZE">don't size</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartSizeFieldList">chart size field</label>
							<select class="form-control" id="chartSizeFieldList" name="chartSizeFieldList">
								<option value="">none</option>
							</select>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartExpandList">chart height</label>
							<select class="form-control" id="chartExpandList" name="chartExpandList">
								<option value="">---</option>
								<option value="HEIGHT">by value</option>
								<option value="EXPAND">expand</option>
								<option value="EXPANDMORE">expand more</option>
								<option value="EXPANDMAX">expand maximal</option>
								<option value="COMPRESS">compress</option>
								<option value="COMPRESSMORE">compress more</option>
								<option value="COMPRESSMAX">compress maximal</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartNormalSizeValue">normal size value</label>
							<!-- help -->
							<a href="#" onclick="$(this).siblings('.help').toggle();">
							<span class="fa fa-info fa-fw" style="font-size:14px;color:#dddddd;float:right;padding-top:0.3em"></span></a>
							<div class="help">
								<p>Method to define the size of the chart objects by giving the value that should be represented by a 'normal' size of 30 screen pixel.</p>
								<p>Higher values lead to smaller charts.</p>
							</div>
							<!------ -->
							<input class="form-control" type="text" id="chartNormalSizeValue" placeholder="1 ... ">
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartRangeScaleValue">range scale</label>
							<!-- help -->
							<a href="#" onclick="$(this).siblings('.help').toggle();">
							<span class="fa fa-info fa-fw" style="font-size:14px;color:#dddddd;float:right;padding-top:0.3em"></span></a>
							<div class="help">
								<p>The range scale defines a factor to apply on yaxis compression or complex symbol radius.</p>
								<p> a value > 1 expands the chart/plot</p>
								<p> a value < 1 compresses the chart/plot</p>
							</div>
							<input class="form-control" type="text" id="chartRangeScaleValue" placeholder="1 ... " onkeypress="setChartRangeScale()">
						</div>
					</div>
				</div>
			</div>

			<!-- --------------------------------- -->
			<!-- dynamic alpha                     -->
			<!-- --------------------------------- -->

			<div class="container" style="background:#f8f6f8">

				<h3 id="chartOpacityTitle" class="disabled">opacity
					<span class="pull-right">
						<a href='javascript:ixmaps.editor.applyChanges();'>
							<button type="button" class="btn btn-link btn-md">
								apply changes
							</button>
						</a>
					</span>
				</h3>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartAlphaMode">dynamic alpha</label>
							<select id="chartAlphaMode" class="form-control" name="chartAlphaMode">
								<option value="">---</option>
								<option value="DOPACITY">dynamic</option>
								<option value="DOPACITYLOG">dynamic (log)</option>
								<option value="DOPACITYMAX">by value max</option>
								<option value="DOPACITYMIN">by value min</option>
								<option value="DOPACITYBIPOLAR">by value min/max</option>
								<option value="DOPACITYMEAN">by mean value</option>
								<option value="DOPACITYLOGMEAN">by mean value (log)</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartAlphaSpread">smoothness</label>
							<input type="text" id="chartAlphaSpread" class="form-control" placeholder="0.1 ... 3">
							<label for="chartAlphaIntensity">intensity:</label>
							<input type="text" id="chartAlphaIntensity" class="form-control" placeholder="0.1 ... 100">
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartAlphaFieldList">dynamic alpha field</label>
							<select id="chartAlphaFieldList" class="form-control" name="chartAlphaFieldList">
								<option value="">---</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartAlphaField100">analysis</label>
							<select id="chartAlphaField100" class="form-control" name="chartAlphaField100">
								<option value="">---</option>
								<option value="$density$">density</option>
							</select>
						</div>
					</div>
				</div>
			</div>

			<!-- --------------------------------- -->
			<!-- aggregation                       -->
			<!-- --------------------------------- -->

			<div class="container" style="background:#f8f6f8">
				<h3 id="chartAggregationTitle" class="disabled">aggregation
					<span class="pull-right">
						<a href='javascript:ixmaps.editor.applyChanges();'>
							<button type="button" class="btn btn-link btn-md">
								apply changes
							</button>
						</a>
					</span>
				</h3>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartAggregationMode">aggregate by</label>
							<select id="chartAggregationMode" class="form-control" name="chartAggregationMode" onchange="ixmaps.editor.setAggregationMode()" >
								<option value="">---</option>
								<option value="AGGREGATE">data field</option>
								<option value="AGGREGATE|RECT">rectangular grid</option>
								<option value="AGGREGATE">hexagonal grid</option>
							</select>
						</div>
						<div class="form-group">
							<label for="chartAggregationFieldList">aggregation field</label>
							<select id="chartAggregationFieldList" class="form-control" name="chartAggregationFieldList">
								<option value="">---</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartAggregationWidth">grid width</label>
							<input type="text" id="chartAggregationWidth" class="form-control" placeholder="0.1 ... 3">
							<label for="chartAggregationType">grid units</label>
							<select id="chartAggregationType" class="form-control" name="chartAggregationType">
								<option value="">---</option>
								<option value="pixel">screen pixel</option>
								<option value="meter">meter</option>
							</select>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="chartAggregationCalc">aggregated value</label>
							<select id="chartAggregationCalc" class="form-control" name="chartAggregationMode">
								<option value="">---</option>
								<option value="SUM">sum</option>
								<option value="MEAN">mean</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="theme-values-checkbox">relocate to value center</label>
							<div class="checkbox">
								<label class="toggle">
									<input type="checkbox" id="theme-relocate-checkbox" onchange="toggle_relocate()">
									<span class="handle"></span>
								</label>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- -----------------------	-->
			<!-- title and descriptions     -->
			<!-- -----------------------	-->

			<div class="container" style="background:#f8f6f8">

				<h3 id="chartDefinitionTitle" class="disabled">description
					<span class="pull-right">
						<a href='javascript:ixmaps.editor.applyChanges();'>
							<button type="button" class="btn btn-link btn-md">
								apply changes
							</button>
						</a>
					</span>
				</h3>
				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="theme-title-definition">title</label>
							<input type="text" class="form-control" id="theme-title-definition" placeholder="give it a nice title ...">
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="theme-snippet-definition">snippet</label>
							<textarea type="text" class="form-control" id="theme-snippet-definition" placeholder="some more words ..."></textarea>
						</div>
					</div>
				</div>

				<!-- units and title field -->

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="theme-units-definition">units</label>
							<input type="text" class="form-control" id="theme-units-definition" placeholder="give it a nice title ...">
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
						<div class="form-group">
							<label for="theme-title-field-select">title field</label>
							<select class="form-control" id="theme-title-field-select">
								<option>-</option>
							</select>
						</div>
					</div>
				</div>
			</div>

			<!-- -----------------------	-->
			<!-- EXTRA parameter            -->
			<!-- -----------------------	-->

			<div class="container" style="background:#f8f6f8">
				<h3 id="chartExtraTitle" class="disabled">extra</h3>

				<div class="row">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label for="extraParamDef">extra parameter</label>
							<input class="form-control" type="text" style="width:98%" id="extraParamDef" placeholder='"p1":value,"p2":value, ...'>
						</div>
					</div>
				</div>
			</div>

			<!-- ----------------------- -->
			<!-- MAP parameter           -->
			<!-- ----------------------- -->

			<div class="container" style="background:#888">
				<h3 id="chartExtraTitle" class="disabled">Map configuration</h3>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
							<!-- help -->
							<a href="#" onclick="$(this).siblings('.help').toggle();">
							<span class="fa fa-info fa-fw" style="font-size:14px;color:#dddddd;float:right;padding-top:0.3em"></span></a>
							<div class="help">
								<p>Objects are the charts on the map</p>
								<p>You can change the zoom behaviour of the charts here</p>
								<p>Zoom in/out to see the effect</p>
							</div>
							<!------ -->
						<div class="form-group">
							<label for="mapObjectScaling">object scaling</label>
							<select id="mapObjectScaling" class="form-control" name="mapObjectScaling" onchange="ixmaps.editor.setMapObjectScaling()">
								<option value="">false</option>
								<option value="true">normal</option>
								<option value="dynamic">dynamic</option>
							</select>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
							<!-- help -->
							<a href="#" onclick="$(this).siblings('.help').toggle();">
							<span class="fa fa-info fa-fw" style="font-size:14px;color:#dddddd;float:right;padding-top:0.3em"></span></a>
							<div class="help">
								<p>Is the map scale where the chart objects have a 'normal' size when dynamic object scaling is selected</p>
								<p>Is set automatically to the actual map scale when you change the object scaling</p>
							</div>
							<!------ -->
						<div class="form-group">
							<label for="mapNormalsizeScale">normal size scale</label>
							<input type="text" id="mapNormalsizeScale" class="form-control" placeholder="1:1000000"
							onchange="ixmaps.editor.setMapNormalSizeScale()" >
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
							<!-- help -->
							<a href="#" onclick="$(this).siblings('.help').toggle();">
							<span class="fa fa-info fa-fw" style="font-size:14px;color:#dddddd;float:right;padding-top:0.3em"></span></a>
							<div class="help">
								<p>Actualize display every n charts generated</p>
								<p>Changes user experience</p>
							</div>
							<!------ -->
						<div class="form-group">
							<label for="mapObjectScaling">render rate</label>
							<input type="text" id="mapRenderRate" class="form-control" placeholder="1:1000000"
							onchange="ixmaps.editor.setMapRenderRate()" >
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div id="map-configuration">
						</div>
						<div class="form-group">
						</div>
					</div>
				</div>
			</div>

		<!-- end of parameter blocks    --> 
		</div>

		<!-- --------------------------------- -->
		<!-- f o o t e r                       -->
		<!-- --------------------------------- -->

		<div class="container">

			<div class="row">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="generating-on-bottom">
				</div>
			</div>
			
			<!--
			<div class="row" id="apply-on-bottom" style="display:none">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<a href='javascript:ixmaps.editor.applyChanges();'>
						<button type="button" class="btn btn-warning btn-md">
							apply changes
						</button>
					</a>
				</div>
			</div>
			-->
			<br>
			<br>

		</div>

		<div id="editor-footer">
		</div>
		<div id="dialog">
		</div>

		<!-- ------------------------------------------------------------------ -->
		<!--                                                                    -->
		<!-- JavaScript                                                    -->
		<!-- Placed at the end of the document so the pages load faster         -->
		<!--                                                                    -->
		<!-- ------------------------------------------------------------------ -->

		<script src="../../../ui/libs/jquery/jquery-1.7.1.min.js"></script>
		<script src="../../../ui/libs/colpick-jQuery-Color-Picker-master/js/colpick.js"></script>
		<link href="../../../ui/libs/colpick-jQuery-Color-Picker-master/css/colpick.css" rel="stylesheet" />

		<script src="../assets/js/bootstrap.min.js"></script>

		<script type="text/javascript">

			/* get ixmaps api from parent window/frame */

			var ixmaps = null;
			if (window.opener) {
				parent = window.opener;
				ixmaps = window.opener.ixmaps;
			} else
			if (parent) {
				ixmaps = parent.window.ixmaps;
			} else {
				alert("error: missing parent window for themes !");
			}
		</script>

		<script src="../../../../data.js/data.js"></script>
		<script src="../../libs/jquery/ui/js/jquery-ui-1.8.16.custom.min.js"></script>

		<script src="../../js/htmlgui_query.js"></script>
		<script src="../../js/tools/colorscheme.js"></script>
		<script src="../../js/tools/colorselect.js"></script>

		<script type="text/javascript">

			// -----------------------------------------------------------
			// global vars
			// -----------------------------------------------------------

			var szExternalDataTable = null;
			var szExternalDataPath = null;
			var fExternalData = true;
			var fDisplayValues = false;
			var szCallTheme = "";
			var szThemeDef = "";
			var szUserColorA = null;
			var szUserLabelA = null;
			var szValuesA = null;
			var lastFieldCount = null;
			var szFieldsLast = null;
			var szShortURL = null;
			var szChartTheme = null;
			var fLookupToupper = false;
			var themeDefObj = null;

			var theme = null;

			ixmaps.editorThemeId = ixmaps.getThemeObj() ? ixmaps.getThemeObj().szId : "";

			// -----------------------------------------------------------
			// size
			// -----------------------------------------------------------

			var resize = function () {
				var height = (window.parent.$("#editor").height() || ($(window.parent).height() + 60) || ($(window).height() + 60));
				$("#workspace").css("height", (height - 60) + "px");
			};
			window.onresize = function () {
				resize();
			};
			window.onscroll = function () {
				$("#editor-apply").css("top", $("body").scrollTop() + 20);
			};

			$("#editor-apply-button").button();
			$("#editor-div").show();

			// -----------------------------------------------------------
			// little helper
			// -----------------------------------------------------------

			__rgbStringToHex = function (szRGB) {
				var szRGBA = szRGB.match(/\d+/g);
				return __toHex(szRGBA[0]) + __toHex(szRGBA[1]) + __toHex(szRGBA[2]);
			};
			__rgbToHex = function (R, G, B) {
				return __toHex(R) + __toHex(G) + __toHex(B);
			};
			__toHex = function (n) {
				n = parseInt(n, 10);
				if (isNaN(n)) {
					return "00";
				}
				n = Math.max(0, Math.min(n, 255));
				return "0123456789ABCDEF".charAt((n - n % 16) / 16) +
					"0123456789ABCDEF".charAt(n % 16);
			};

			__removeTypeFlag = function (szFlags, szFlag) {
				var styleA = szFlags.split("|");
				var szTempStyle = "";
				for (var i = 0; i < styleA.length; i++) {
					if (styleA[i] != szFlag) {
						szTempStyle += ((szTempStyle.length ? "|" : "") + styleA[i]);
					}
				}
				return szTempStyle;
			}

			ixmaps.popupSelectColorScheme = function () {
				var szColors = ixmaps.getColors();
				$("#dialog")[0].innerHTML = szColors;
				$("#dialog").dialog({
					width: 235,
					height: 500,
					position: {
						my: "left+30",
						at: "left+30"
					}
				});
			};

			ixmaps.setColorScheme = function (szColorscheme) {

				ixmaps.editorColorschemeType = "colorscheme";

				ixmaps.editorColorscheme = szColorscheme;
				ixmaps.changeThemeStyle(null, null, "colorscheme:" + szColorscheme, "set");
				ixmaps.setColors(szColorscheme);
				$("#dialog").dialog("close");
			};

			ixmaps.getColorScheme = function (szColorScheme, nClasses) {

				var csMonoBlue = new Array(5, "#eeeeff", "#0000dd");
				var csMonoRed = new Array(5, "#ffeeee", "#dd0000");
				var csMonoGreen = new Array(5, "#eeffee", "#00dd00");
				var csMonoCyan = new Array("#888800", "#aaaa00", "#cccc00", "#eeee00", "#ffff00");
				var csRedGreen = new Array(5, "#ff8888", "#88ff88");
				var csGreenRed = new Array(5, "#88ff88", "#ff8888");
				var csSpectrum = new Array(5, "spectrum", "");
				var csOffice = new Array(5, "office", "");
				var csMineral = new Array(5, "mineral", "");
				var csHarvest = new Array(5, "harvest", "");
				var colorSchemeA = {
					monored: csMonoRed,
					monogreen: csMonoGreen,
					monoblue: csMonoBlue,
					1: csMonoCyan,
					2: csRedGreen,
					3: csGreenRed,
					4: csSpectrum,
					5: csOffice,
					6: csMineral,
					7: csHarvest
				};

				// array given ?	
				var colorA = szColorScheme.split(/,/);
				if (colorA && colorA.length) {
					colorA.splice(0, 0, nClasses);
					return colorA;
				}

				if (szColorScheme.match(/Array/)) {
					var colorScheme = eval(szColorScheme);
				} else {
					var colorScheme = colorSchemeA[szColorScheme];
				}
				if (nClasses) {
					if (typeof (colorScheme[0]) == "number") {
						colorScheme[0] = Number(nClasses);
					} else {
						colorScheme[1] = colorScheme[0];
						colorScheme[2] = colorScheme[colorScheme.length - 1];
						colorScheme[0] = Number(nClasses);
						colorScheme.length = 3;
					}
				}
				return colorScheme;
			};

			function toggle_dopacity() {
				var szThemeStyle = api.getThemeStyleString();
				if (szThemeStyle && szThemeStyle.match(/DOPACITYLOG/)) {
					api.changeThemeStyle(null, 'type:DOPACITYLOG;', 'remove');
					api.changeThemeStyle(null, 'type:DOPACITYMAX;dopacityscale:5;', 'toggle');
				} else
				if (szThemeStyle && szThemeStyle.match(/DOPACITYMAX/)) {
					api.changeThemeStyle(null, 'type:DOPACITYMAX;', 'remove');
				} else
				if (szThemeStyle && szThemeStyle.match(/DOPACITY/)) {
					api.changeThemeStyle(null, 'type:DOPACITY;', 'remove');
					api.changeThemeStyle(null, 'type:DOPACITYLOG;dopacityscale:5;', 'toggle');
				} else {
					api.changeThemeStyle(null, 'type:DOPACITY;dopacityscale:5;', 'toggle');
				}
				setTimeout("init_theme_line()", 100);
			}

			function toggle_values() {
				var szThemeStyle = ixmaps.getThemeStyleString();
				if (szThemeStyle && szThemeStyle.match(/VALUES/)) {
					ixmaps.map().theme().changeStyle('type:VALUES;', 'remove');
				} else {
					ixmaps.map().theme().changeStyle('type:VALUES;', 'add');
				}
			}

			function toggle_glow() {
				var szThemeStyle = ixmaps.getThemeStyleString();
				if (szThemeStyle && szThemeStyle.match(/GLOW/)) {
					ixmaps.map().theme().changeStyle('type:GLOW;', 'remove');
				} else {
					ixmaps.map().theme().changeStyle('type:GLOW;', 'add');
				}
			}

			function toggle_aura() {
				var szThemeStyle = ixmaps.getThemeStyleString();
				if (szThemeStyle && szThemeStyle.match(/AURA/)) {
					ixmaps.map().theme().changeStyle('type:AURA;', 'remove');
				} else {
					ixmaps.map().theme().changeStyle('type:AURA;', 'add');
				}
			}

			function toggle_relocate() {
				var szThemeStyle = ixmaps.getThemeStyleString();
				if (szThemeStyle && szThemeStyle.match(/RELOCATE/)) {
					ixmaps.map().theme().changeStyle('type:RELOCATE;', 'remove');
				} else {
					ixmaps.map().theme().changeStyle('type:RELOCATE;', 'add');
				}
			}

			function toggle_shadow() {
				ixmaps.map().theme().changeStyle('shadow:toggle');
			}

			function toggle_data() {
				ixmaps.map().theme().changeStyle('showdata:toggle');
			}

			function setChartScale(nDelta) {
				if ( event.keyCode == 13 ){
					var newScale = Number($("#chartScaleValue").val());
					if ( !isNaN(newScale) ){
						ixmaps.map().theme().changeStyle('scale:'+String(newScale),'set');
					}else{
						alert("Input type error: only numbers allowed!");
					}
				}
			}
			function changeChartScale(nDelta) {
				var nScale = Number($("#chartScaleValue").val());
				if ( nDelta < 0 ){
					nScale = (nScale/1.5).toPrecision(2);
				}else{
					nScale = (nScale*1.5).toPrecision(2);
				}
				$("#chartScaleValue").val(nScale)
				ixmaps.map().theme().changeStyle('scale:'+String(nScale),'set');
			}
			function setLineColor() {
				if ( event.keyCode == 13 ){
					var newColor = String($("#chartLineColor").val());
					ixmaps.map().theme().changeStyle('linecolor:'+newColor,'set');
				}
			}
			function setLineWidth(nDelta) {
				if ( event.keyCode == 13 ){
					var newScale = Number($("#chartLineWidth").val());
					if ( !isNaN(newScale) ){
						ixmaps.map().theme().changeStyle('linewidth:'+String(newScale),'set');
					}else{
						alert("Input type error: only numbers allowed!");
					}
				}
			}
			function changeLineWidth(nDelta) {
				var nScale = Number($("#chartLineWidth").val());
				if ( nDelta < 0 ){
					nScale = (nScale/1.5).toPrecision(2);
				}else{
					nScale = (nScale*1.5).toPrecision(2);
				}
				$("#chartLineWidth").val(nScale)
				ixmaps.map().theme().changeStyle('linewidth:'+String(nScale),'set');
			}

			function setValueScale(nDelta) {
				if ( event.keyCode == 13 ){
					var newScale = Number($("#chartValueScale").val());
					if ( !isNaN(newScale) ){
						ixmaps.map().theme().changeStyle('valuescale:'+String(newScale),'set');
					}else{
						alert("Input type error: only numbers allowed!");
					}
				}
			}
			function changeValueScale(nDelta) {
				var nScale = Number($("#chartValueScale").val());
				if ( nDelta < 0 ){
					nScale = (nScale/1.5).toPrecision(2);
				}else{
					nScale = (nScale*1.5).toPrecision(2);
				}
				$("#chartValueScale").val(nScale)
				ixmaps.map().theme().changeStyle('valuescale:'+String(nScale),'set');
			}

			function setChartOpacity() {
				if ( event.keyCode == 13 ){
					var newOpacity = Number($("#chartOpacityValue").val());
					if ( !isNaN(newOpacity) ){
						ixmaps.map().theme().changeStyle('fillopacity:'+String(newOpacity),'set');
					}else{
						alert("Input type error: only numbers allowed!");
					}
				}
			}
			function changeChartOpacity(nDelta) {
				var nOpacity = Number($("#chartOpacityValue").val());
				if ( nDelta < 0 ){
					nOpacity = (nOpacity/1.5).toPrecision(2);
				}else{
					nOpacity = (nOpacity*1.5).toPrecision(2);
				}
				$("#chartScaleValue").val(nOpacity)
				ixmaps.map().theme().changeStyle('fillopacity:'+String(nOpacity),'set');
			}

			function setChartRangeScale() {
				if ( event.keyCode == 13 ){
					var newScale = Number($("#chartRangeScaleValue").val());
					if ( !isNaN(newScale) ){
						ixmaps.map().theme().changeStyle('rangescale:'+String(newScale),'set');
					}else{
						alert("Input type error: only numbers allowed!");
					}
				}
			}

			// -----------------------------------------------------------
			// editor class and methods
			// -----------------------------------------------------------

			ixmaps.editor = ixmaps.editor || {};

			ixmaps.editorColorscheme = "#ffeeee,#dd0000,dynamic,cold";

			ixmaps.editor.setSelectColorScheme = function () {
				var objTheme = ixmaps.getThemeObj();
				if (objTheme) {
					var colorArgA = objTheme.origColorScheme.slice(0);

					if (isNaN(colorArgA[0])) {
						ixmaps.setColors(colorArgA.join('|'), "directly_defined_colors", 7);
						ixmaps.editorColorschemeType = "directly_defined_colors";
					} else {
						colorArgA.shift();
						ixmaps.setColors(colorArgA.join('|'), 7);
					}
					ixmaps.editorColorscheme = colorArgA.join('|');
				}
			};

			ixmaps.editor.getFieldValues = function (szField, nMax) {

				// szField may be string or array of strings
				// if array, take first string !
				if ($.isArray(szField)) {
					szField = szField[0];
				}

				var data = ixmaps.editor.dataObj;

				var valuesA = null;
				if (data) {
					var valuesA = new Array();
					if (szField == "$item$") {
						for (i = 0; i < 20; i++) {
							valuesA.push(1);
						}
					} else {
						var fields = data.fields;
						var index = 0;
						for (i = 0; i < fields.length; i++) {
							if (fields[i].id == szField) {
								index = i;
							}
						}
						var nCount = Math.min(nMax || data.records.length, data.records.length);
						for (i = 0; i < nCount; i++) {
							valuesA.push(data.records[i][index]);
						}
					}
				} else
				if (typeof (szSelectedTheme) != 'undefined') {
					if (szField == "$lookup$") {
						valuesA = ixmaps.doQuerySelectionValues(szSelectedTheme);
					} else {
						valuesA = ixmaps.doQueryValues(szSelectedTheme, szField);
					}
				}
				return valuesA;
			};

			ixmaps.editor.getSampleValues = function () {

				szField = $("#theme-data-fields-select").val();
				var valuesA = ixmaps.editor.getFieldValues(szField, 20);

				if (szField && valuesA) {
					szHtml = "";
					var szValue = "";
					szHtml +=
						"<select id='chartValueList' name='chartValueList' size='6' class='form-control' style='background:#f8f8f8;border:0'>";
					for (var i = 0; i < valuesA.length; i++) {
						szValue = valuesA[i];
						szHtml += "<option value=\"" + valuesA[i] + "\">" + szValue + "<\/option>";
					}
					szHtml += "<option value=\"" + "---" + "\">" + "_______________" + "<\/option>";
					szHtml += "<\/select>";
					$("#chartValueOptions").html(szHtml);
				}
				// get 500 sample values and determine the values nature and space 
				valuesA = ixmaps.editor.getFieldValues(szField, 500);
				ixmaps.editor.themeDataFieldType = ixmaps.editor.analyseValues(valuesA);
			};

			ixmaps.editor.getUniqueValues_old = function () {

				nClasses = 0;
				var szLabelA = new Array();

				szField = $("#theme-data-fields-select").val();
				var szValuesA = ixmaps.editor.getFieldValues(szField);

				if (szValuesA) {
					var szSLabelA = new Array();
					for (i = 0; i < szValuesA.length; i++) {
						/**
						if ( szMethod.match(/IGNORECASE/) ){
							szValuesA[i] = String(szValuesA[i]).toUpperCase();
						}
						**/
						if (!szSLabelA[String(szValuesA[i])] && String(szValuesA[i]) && String(szValuesA[i]).length) {
							console.log(String(szValuesA[i]));
							szSLabelA[String(szValuesA[i])] = szValuesA[i];
							nClasses++;
						}
					}
					for (a in szSLabelA) {
						szLabelA.push(a);
					}
					// GR 15.01.2014
					szLabelA.sort();
				}

				return (szLabelA);
			};

			// get unique values array
			var __onlyUnique = function (value, index, self) {
				return self.indexOf(value) === index;
			};
			ixmaps.editor.getUniqueValues = function () {

				nClasses = 0;
				var szLabelA = [];

				szField = $("#theme-data-fields-select").val();

				// create data object from theme data
				// ------------------------------------
				var mydata = new Data.Table(ixmaps.editor.dataObj);
				a = mydata.column(szField).values();

				// get unique values array
				var u = a.filter(__onlyUnique);

				// count values
				var valuesCount = {};
				a.forEach(function (x) {
					valuesCount[x] = (valuesCount[x] || 0) + 1;
				});
				u.sort(function (a, b) {
					return (valuesCount[b] - valuesCount[a]);
				});
				return (u);
			};

			ixmaps.editor.setChartStyle = function () {

				console.log("setChartStyle");

				var szFlag = ixmaps.editor.themeObj.style.type || "";
				var szExact = szFlag.match(/EXACT/)?"|EXACT":"";

				var szValue = $("#theme-type-select").val();
				switch(szValue){
					case "CHOROPLETH":
						ixmaps.editor.themeObj.style.type = szValue+szExact;
						ixmaps.embeddedSVG.window.map.Api.clearAll();
						ixmaps.embeddedSVG.window.map.Api.newMapThemeByObj(ixmaps.editor.themeObj);
						break;
					case "CHART|DOT|RAW|FAST":
						ixmaps.editor.themeObj.style.type = szValue+szExact;
						ixmaps.editor.themeObj.style.fillopacity = "0.3";
						ixmaps.editor.themeObj.style.colorscheme[0] = "1";
						ixmaps.editor.themeObj.style.gridwidth = null;
						ixmaps.editor.themeObj.style.gridwidthpx = null;
						ixmaps.editor.themeObj.style.sizefield = null;
						console.log(ixmaps.editor.themeObj);	
						ixmaps.embeddedSVG.window.map.Api.clearAll();
						ixmaps.embeddedSVG.window.map.Api.newMapThemeByObj(ixmaps.editor.themeObj);
						break;
					case "CHART|BUBBLE|SIZE":
						ixmaps.editor.themeObj.style.type = szValue+szExact;
						ixmaps.editor.themeObj.style.fillopacity = "0.7";
						ixmaps.editor.themeObj.style.colorscheme[0] = "1";
						ixmaps.editor.themeObj.style.gridwidth = null;
						ixmaps.editor.themeObj.style.gridwidthpx = null;
						ixmaps.editor.themeObj.style.sizefield = null;
						console.log(ixmaps.editor.themeObj);	
						ixmaps.embeddedSVG.window.map.Api.clearAll();
						ixmaps.embeddedSVG.window.map.Api.newMapThemeByObj(ixmaps.editor.themeObj);
						break
					case "CHART|SYMBOL|GRIDSIZE|FAST|AGGREGATE|SUM|DOPACITY":
						ixmaps.editor.themeObj.style.type = szValue+szExact;
						ixmaps.editor.themeObj.style.symbols = ["hexagon"];
						ixmaps.editor.themeObj.style.gridwidth = "15px";
						ixmaps.editor.themeObj.style.fillopacity = "0.7";
						ixmaps.editor.themeObj.style.sizefield = null;
						ixmaps.editor.themeObj.style.dopacitypow = "2";
						ixmaps.editor.themeObj.style.dopacityscale = "2";
						if (!szFlag.match(/EXACT/)){
							ixmaps.editor.themeObj.style.colorscheme[0] = "1";
						}else{
							ixmaps.editor.themeObj.style.type += "CENTER|DOMINANT";
						}
						console.log(ixmaps.editor.themeObj);	
						ixmaps.embeddedSVG.window.map.Api.clearAll();
						ixmaps.embeddedSVG.window.map.Api.newMapThemeByObj(ixmaps.editor.themeObj);
						break;
					case "CHART|SYMBOL|AUTOSIZE|FAST|AGGREGATE|SUM":
						ixmaps.editor.themeObj.style.type = szValue+szExact;
						ixmaps.editor.themeObj.style.symbols = ["hexagon"];
						ixmaps.editor.themeObj.style.gridwidth = "15px";
						ixmaps.editor.themeObj.style.fillopacity = "0.7";
						ixmaps.editor.themeObj.style.sizefield = null;
						if (!szFlag.match(/EXACT/)){
							ixmaps.editor.themeObj.style.colorscheme[0] = "1";
						}else{
							ixmaps.editor.themeObj.style.type += "CENTER|DOMINANT";
						}
						console.log(ixmaps.editor.themeObj);	
						ixmaps.embeddedSVG.window.map.Api.clearAll();
						ixmaps.embeddedSVG.window.map.Api.newMapThemeByObj(ixmaps.editor.themeObj);
						break;
					case "CHART|BUBBLE|SIZE|FAST|AGGREGATE|RELOCATE|SUM":
						ixmaps.editor.themeObj.style.type = szValue+szExact;
						ixmaps.editor.themeObj.style.symbols = null;
						ixmaps.editor.themeObj.style.gridwidth = "15px";
						ixmaps.editor.themeObj.style.fillopacity = "0.7";
						ixmaps.editor.themeObj.style.sizefield = "aggregation";
						if (!szFlag.match(/EXACT/)){
							ixmaps.editor.themeObj.style.colorscheme[0] = "1";
						}else{
							ixmaps.editor.themeObj.style.type += "";
						}
						ixmaps.embeddedSVG.window.map.Api.clearAll();
						ixmaps.embeddedSVG.window.map.Api.newMapThemeByObj(ixmaps.editor.themeObj);
						break;
					case "CHART|WAFFLE|GRIDSIZE|AGGREGATE|FAST|RECT|SUM":
						ixmaps.editor.themeObj.style.type = szValue+szExact;
						ixmaps.editor.themeObj.style.symbols = null;
						ixmaps.editor.themeObj.style.gridwidth = "50px";
						ixmaps.editor.themeObj.style.fillopacity = "1";
						ixmaps.editor.themeObj.style.sizefield = "aggregation";
						ixmaps.editor.themeObj.style.bordercolor = "black";
						ixmaps.editor.themeObj.style.borderwidth = "1";
						ixmaps.editor.themeObj.style.boxcolor = "none";
						ixmaps.editor.themeObj.style.boxopacity = "0.01";
						if (!szFlag.match(/EXACT/)){
							ixmaps.editor.themeObj.style.colorscheme[0] = "1";
						}else{
							ixmaps.editor.themeObj.style.type += "";
						}
						ixmaps.embeddedSVG.window.map.Api.clearAll();
						ixmaps.embeddedSVG.window.map.Api.newMapThemeByObj(ixmaps.editor.themeObj);
						break;

					default:
						break;
				}
			};

			ixmaps.editor.setDistribution = function () {
				var szDistribution = $("#theme-distribution-select").val();
				ixmaps.changeThemeStyle('map1', 'type:EQUIDISTANT;', 'remove');
				ixmaps.changeThemeStyle('map1', 'type:QUANTILE;', 'remove');
				ixmaps.changeThemeStyle('map1', 'type:RANGE;', 'remove');
				ixmaps.changeThemeStyle('map1', 'type:LOG;', 'remove');
				ixmaps.changeThemeStyle('map1', 'type:LOGARITHMICAL;', 'remove');
				ixmaps.changeThemeStyle('map1', 'type:DOMINANT;', 'remove');
				ixmaps.changeThemeStyle('map1', 'type:DEVIATION;', 'remove');
				ixmaps.changeThemeStyle('map1', 'type:' + szDistribution + ';', 'add');
			};

			ixmaps.editor.setClasses = function () {
				ixmaps.changeThemeStyle('map1', 'classes:"'+$("#theme-classes-select").val()+'"', 'set');
			};

			ixmaps.editor.setNewLabel = function (i) {
				szUserLabelA[i] = $("#chartLabel" + i).val();
				console.log(szUserLabelA);
			};

			ixmaps.editor.setMapObjectScaling = function () {
				var szScaling = $("#mapObjectScaling").val();
				var szScale = ixmaps.getMapScale();
				$("#mapNormalsizeScale").val("1:"+szScale);
				ixmaps.setOptions(JSON.parse('{"objectscaling":"' + szScaling +'"}'));
				ixmaps.setOptions(JSON.parse('{"normalsizescale":"' + szScale +'"}'));
			};

			ixmaps.editor.setAggregationMode = function () {
				ixmaps.editor.applyChanges();
			};

			ixmaps.editor.setMapNormalSizeScale = function () {
				var szScale = $("#mapNormalsizeScale").val();
				if (szScale.match(/\:/)){
					szScale = szScale.split(/\:/)[1];
				}
				ixmaps.setOptions(JSON.parse('{"normalsizescale":"' + szScale +'"}'));
			};

			ixmaps.editor.setMapRenderRate = function () {
				var szRate = $("#mapRenderRate").val();
				ixmaps.setOptions(JSON.parse('{"flushChartDraw":"' + szRate +'"}'));
			};

			ixmaps.editor.alert = function (szAlert, szDestination, szFlag) {

				szHtml = '<div id="' + szDestination + '-alert" class="alert alert-' + szFlag + ' alert-dismissable">';
				szHtml += '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'
				szHtml += szAlert;
				szHtml += '</div>';

				var x = $("#" + szDestination);

				$("#" + szDestination).html(szHtml);

			};

			ixmaps.editor.analyseValues = function (a) {

				var themeObj = {"type":"","style":{"type":""}};

				if ( !a || (typeof(a) != "object") ){
					return null;
				}

				// get unique valyes array
				var onlyUnique = function(value, index, self) { 
					return self.indexOf(value) === index;
				};
				var u = a.filter( onlyUnique );

				// if less than 20 unique values, assume distinct values -> theme type EXACT
				// 
				nDistinct = u.length;

				// if only one vale == 1
				// 
				if ( (nDistinct == 1) && (u[0] == 1) ){
					themeObj.type = "item"
					themeObj.style.type += "|DOT";
					return themeObj;
				}

				// if less than 20 unique values, assume distinct values -> theme type EXACT
				// 
				if ( 0 && (nDistinct < 5) ){

					// sort the values to give the themes always the same value sequence
					u.sort();
					// correct known problem; ["dopo ...","entro ...","entro ...",...]
					if ( String(u[0]).match(/dopo/) ){
						u.push(u.shift());
					}
					// set the values in the theme object !!! 
					themeObj.style.label = [];
					for ( i=0; i<u.length; i++){
						themeObj.style.label.push(String(u[i]));
					}
					// set the theme distribution type 
					themeObj.type = "exact";
					themeObj.style.type += "|EXACT";
					themeObj.style.colorscheme = ["7","fruit"];
				}else{
					// if we have textual values, make always EXACT 
					if ( isNaN(u[0]) ){
						themeObj.type = "exact";
						themeObj.style.type += "|EXACT";
						themeObj.style.colorscheme = ["7","fruit"];
					} else{
						themeObj.type = "numeric";
						themeObj.style.colorscheme = ["7","#ffffff","#ff0000"];
					}
				}
				return themeObj;
			};	

			ixmaps.editor.makeDefaultTheme = function (color_selected) {
				
				if ( !ixmaps.editor.dbtable ){
					return {};
				}

				objTheme = {
					fields: "$item$"
				};
				objTheme.style = {};
				objTheme.style.dbtableUrl = ixmaps.editor.dbtableUrl || "";
				objTheme.style.dbtableType = ixmaps.editor.dbtableType || "";
				objTheme.style.dbtable = "themeDataObj";
				objTheme.style.lookupfield = " ";

				if (ixmaps.editor.dbtable && ixmaps.editor.dbtable.table && (ixmaps.editor.dbtable.table.records > 250000)) {
					objTheme.style.type = "CHART|SYMBOL|GRIDSIZE|DOPACITY|AGGREGATE|FAST|SUM|ZOOMTO";
					//objTheme.style.type = "CHART|SYMBOL|AUTOSIZE|AGGREGATE|SUM|ZOOMTO";
					objTheme.style.gridwidth = "10px";
					objTheme.style.symbols = ["hexagon"];
					objTheme.style.dopacitypow = 2;
					objTheme.style.dopacityscale = 2;
				} else
				if (ixmaps.editor.dbtable && ixmaps.editor.dbtable.table && (ixmaps.editor.dbtable.table.records > 100000)) {
					objTheme.style.type = "CHART|BUBBLE|AGGREGATE|FAST|SUM|ZOOMTO";
					objTheme.style.gridwidth = "2px";
					objTheme.style.fillopacity = "0.3";
				} else {
					//objTheme.style.type = "CHART|DOT|RAW|FAST";
					objTheme.style.type = "CHART|DOT|RAW|FAST|ZOOMTO";
					objTheme.style.fillopacity = "0.2";
				}
				objTheme.style.colorscheme = [1, "#eeeeff", "#0000dd"];
				objTheme.style.editor = true;
				ixmaps.editor.themeObj = objTheme;

				return objTheme;

			}

			// =================================================================
			// =================================================================
			//
			// h e r e   w e   g o  
			//
			// =================================================================
			// =================================================================

			$(document).ready(function () {

				resize();

				// ===========================
				// do this on every new theme  
				// ===========================

				__lastThemeId = null;
				ixmaps.parentApi.htmlgui_onDrawTheme = function (szId) {
					if (szId == __lastThemeId) {
						//return;
					}
					__lastThemeId = szId;
					setTimeout("ixmaps.editor.loadTheme(\"" + szId + "\")", 10);
				};

				// ===========================
				// first time   
				// ===========================

				ixmaps.editor.loadTheme();

			});


			// .................................................................
			//
			// t h e m e  -->  c o n f i g u r a t o r  
			//
			// .................................................................

			/**
			 * loadTheme 
			 * load theme object and fill editor form fields
			 * @param szId the id of the theme
			 * @type object
			 * @return void
			 */

			ixmaps.editor.loadTheme = function (szId) { 

				console.log("loadTheme");

				//var color_selected = "#48A542";
				var color_selected = "#83bf80";
				var color_unselected = "#dddddd";
				var color_error = "#ff8888";

				// remove all previous alerts
				$(".alert").remove();

				// ------------------------------------
				// show loaded map
				// ------------------------------------

				var szMapUrl = ixmaps.getMapUrl();
				$("#define-map").val(szMapUrl);
				$("#define-map-title").css("color", color_selected);
				$("#map-defined").css("color", color_selected);

				// ------------------------------------
				// show map layer (visible on demand)
				// ------------------------------------

				var themesA = ixmaps.doQueryThemesWithSelection();
				var szHtml = "";
				for (i in themesA) {
					szHtml += "<option value=\"" + themesA[i] + "\">" + themesA[i] + "<\/option>";
				}
				$("#map-layer-info").html(szHtml);
				$("#map-layer-info").prev().css("color", color_selected);

				$("#map-layer-select").html(szHtml);
				$("#map-layer-select").prev().css("color", color_selected);

				{
					var szDisplayFieldA = ixmaps.doQueryFields(themesA[0]);
					var fieldsA = szDisplayFieldA.slice(0, szDisplayFieldA.length);
					fieldsA.sort();
					fieldsA.push("$lookup$");
					var szHtml = "";
					szHtml += "<option value=\"none\" >---<\/option>";
					for (i in fieldsA) {
						szHtml += "<option value=\"" + fieldsA[i] + "\"" + (fieldsA[i].selected ? " selected='selected'" : "") + ">" +
							fieldsA[i] + "<\/option>";
					}
					$("#map-data-fields-select").html(szHtml);
				}

				// -----------------------------------------------------
				// get actual theme
				// if no theme given, preset with default theme values
				// -----------------------------------------------------

				var objTheme = ixmaps.editor.themeObj = ixmaps.getThemeDefinitionObj(szId);
				var objThemeObj = ixmaps.getThemeObj(szId);

				if (!objTheme || !objThemeObj) {

					// ------------------------------
					// no theme yet, lets preset one	
					// ------------------------------

					objTheme = ixmaps.editor.makeDefaultTheme(color_selected);
					objThemeObj = {
						szFieldsA: [objTheme.fields]
					};

					if (ixmaps.editor.dbtableType) {
						ixmaps.editor.applyChangesTimeout = setTimeout("ixmaps.editor.applyChanges()", 100);
						$("#data-defined").css("color", color_selected);
					}

					// ------------------------------
					// make user message	
					// ------------------------------

					if ( ixmaps.isBookmark() ){
						ixmaps.editor.alert(
							'<h3 style="margin:0">iXMaps Theme Configurator</h3><h5>loading project ... <img src="../../../ui/resources/images/loading_blue.gif" id="load-file-spinner" style="height:72px;margin:-0.4em 0 0 -2em;"></h5>',
							'data-alert', 'success');
					} else {
						ixmaps.editor.alert(
							'<h3>Welcome to the iXMaps Theme Configurator !</h3><p>please define a <strong><a href="#" onclick="ixmaps.loadStoryTool(\'../../../app/Editor/dialog_data_load.html\')"><button type="button" class="btn btn-info btn-md" style="border-radius:1.5em;padding:0.1em 0.7em 0.4em 0.7em">data source</button></a></strong>  or <strong><a href="#" onclick="ixmaps.loadStoryTool(\'../../../app/Editor/dialog_project_load.html\')""><button type="button" class="btn btn-info btn-md" style="border-radius:1.5em;padding:0.1em 0.8em 0.4em 0.8em">load a project</button></a></strong></p>',
							'data-alert', 'success');
					}
				} else {
					$("#no-data-alert").hide();
					$("#apply-on-bottom").show();
					$("#data-defined").css("color", color_selected);

					if ( objTheme.style.type.match(/ZOOMTO/) ){
						objTheme.style.type = __removeTypeFlag(objTheme.style.type, "ZOOMTO");
						ixmaps.changeThemeStyle(null, null, "type:ZOOMTO", "remove");
					}
				
				}

				if ( !objTheme || !objTheme.style ){
					return;
				}

				// ------------------------------
				// show data source
				// ------------------------------

				if (objTheme.style && objTheme.style.dbtableUrl && objTheme.style.dbtableUrl.length) {
					ixmaps.editor.alert(
						'<h3 style="margin:0">Theme</h3><p>','data-alert', 'success');

					$("#define-data").val(objTheme.style.dbtableUrl || objTheme.style.dbtableExt);
					$("#define-data-title").css("color", color_selected);

					$("#data-define").show();
					$("#config-lookup").show();
				}

				var szData = objTheme.style.dbtable;
				ixmaps.editor.dataObj = eval("ixmaps.embeddedSVG.window." + (szData || "themeDataObj"));

				// ------------------------------
				// get data fields
				// ------------------------------

				if (ixmaps.editor.dataObj && ixmaps.editor.dataObj.fields) {
					var fields = ixmaps.editor.dataObj.fields.slice();
					fields.splice(0, 0, {
						id: "$item$"
					});
					var szFieldsA = objThemeObj.szFieldsA;
					for (i in fields) {
						delete fields[i].selected;
						for (ii in szFieldsA) {
							if (fields[i].id == szFieldsA[ii]) {
								fields[i].selected = true;
								$("#no-data-alert").hide();
							}
						}
					}
				}

				// ------------------------------------------------------
				// make data field html: <options> for <select> elements
				// ------------------------------------------------------

				var szHtml = "";
				szHtml += "<option value=\"\" >---<\/option>";
				for (i in fields) {
					szHtml += "<option value=\"" + fields[i].id + "\"" + (fields[i].selected ? " selected='selected'" : "") + ">" +
						fields[i].id + "<\/option>";
				}

				$("#theme-data-fields-select").html(szHtml);

				szHtml = "<option value=\"\" >---<\/option>";
				for (i in fields) {
					szHtml += "<option value=\"" + fields[i].id + "\">" + fields[i].id + "<\/option>";
				}

				// --------------------------------------------------
				// popolate all <selection> tha need the data fields
				// --------------------------------------------------

				$("#theme-data-field2-select").html(szHtml);
				$("#theme-data-field2-select").val(objTheme.field100);

				$("#theme-data-lookup-select").html(szHtml);
				$("#theme-data-lat-select").html(szHtml);
				$("#theme-data-lon-select").html(szHtml);

				$("#theme-title-field-select").html(szHtml);
				$("#chartSizeFieldList").html(szHtml);
				$("#chartAlphaFieldList").html(szHtml);
				$("#chartAggregationFieldList").html(szHtml);

				// ------------------------------
				// 1. set lookup section
				// ------------------------------

				$("#theme-data-lookup-select").removeClass("control-alert");
				$("#theme-data-lat-select").removeClass("control-alert");
				$("#theme-data-lon-select").removeClass("control-alert");

				// if no lookup defined, try to find an appropriate data field(s)
				// ---------------------------------------------------------------
				if (objTheme.style.lookupfield == " ") {

					// 1. look for fields that contain both, latitude and longitude

					for (var i in fields) {
						// identify by name
						if (fields[i].id.match(/latitud/i) && fields[i].id.match(/longitud/i)) {
							$("#theme-data-lookup-select").val(fields[i].id);
						} else {
							// identify by value (like 13.3568,45.34567)
							valuesA = ixmaps.editor.getFieldValues(fields[i].id, 10);
							for ( x in valuesA ){
								if ( !String(valuesA[x]).match(/\'/) ){
									var matchA = String(valuesA[x]).match(/(-?[0-9\.]+) ?, ?(-?[0-9\.]+)/)
									if ( matchA && 
										(matchA.length == 3) && 
										(Number(matchA[1]) < 80)  && (Number(matchA[1]) > -80) &&
										(Number(matchA[2]) < 180) && (Number(matchA[2]) > -180) &&
										matchA[1]%1 && 
										matchA[2]%1
										) {
										alert(matchA);
										$("#theme-data-lookup-select").val(fields[i].id);
										break;
									}
								}
							}
						}
					}

					// 2. look for 2 fields that contain latitude or longitude

					for (var i in fields) {
						if (fields[i].id.match(/latitud/i) || (fields[i].id == "lat") || (fields[i].id == "LAT") || (fields[i].id == "Y")) {
							$("#theme-data-lat-select").val(fields[i].id);
						}
						if (fields[i].id.match(/longitud/i) || (fields[i].id == "lon") || (fields[i].id == "long") || (fields[i].id == "lng") || (fields[i].id ==
								"LON") || (fields[i].id == "LNG") || (fields[i].id == "X")) {
							$("#theme-data-lon-select").val(fields[i].id);
						}
					}

					// success ?

					if ( ($("#theme-data-lookup-select").val() != "") ||
						 (($("#theme-data-lon-select").val() != "") && ($("#theme-data-lon-select").val() != ""))) {

						// yes, lookup found
						ixmaps.editor.alert('<p><b>automatic</b> lookup field selection ! Please control !', "lookup-alert", "warning");
						$("#define-latlon-title").css("color", color_selected);
						$("#chartLookupFields").css("color", color_selected);

					} else {

						// no lookup found -> error
						clearTimeout(ixmaps.editor.applyChangesTimeout);

						ixmaps.editor.alert(
							'<p><b>automatic</b> coordinate field lookup <b>failed</b> !</p><p>Please select a <b>lookup</b> field or <b>lat/lon</b> fields and then click <a href="#" onclick="javascript:ixmaps.editor.applyChanges();">apply changes</a></p>',
							"lookup-alert", "danger");

						$("#chartLookupFields").css("color", color_error);

						$("#define-latlon-title").css("color", color_error);
						$("#define-lookup-title").css("color", color_error);

						$("#theme-data-lookup-select").addClass("control-alert");
						$("#theme-data-lat-select").addClass("control-alert");
						$("#theme-data-lon-select").addClass("control-alert");
					} 

				} else {

					// lookup defined in theme data
					// -----------------------------

					$("#chartLookupFields").css("color", color_unselected);
					$("#define-lookup-title").css("color", color_unselected);
					$("#define-latlon-title").css("color", color_unselected);
					if (objTheme.style.lookupfield.match(/\|/)) {
						$("#theme-data-lat-select").val(objTheme.style.lookupfield.split("|")[0]);
						$("#theme-data-lon-select").val(objTheme.style.lookupfield.split("|")[1]);
						$("#define-latlon-title").css("color", color_selected);
						$("#chartLookupFields").css("color", color_selected);
					} else {
						$("#theme-data-lookup-select").val(objTheme.style.lookupfield);
						$("#define-lookup-title").css("color", color_selected);
						$("#define-latlon-div").hide();
						$("#chartLookupFields").css("color", color_selected);
					}
				}

				// if lookup defined show all of the configurator
				// ----------------------------------------------

				if (objTheme.style.lookupfield != " ") {
					$("#config-data").show();
					$("#config-theme").show();
				}


				// ------------------------------
				// 2. set data fields section
				// ------------------------------

				$("#chartDefinitionFields").css("color", color_selected);
				ixmaps.editor.getSampleValues();
				$("#define-datafields-title").css("color", color_selected);

				if ($("#theme-data-fields-select").val() == "$item$") {
					ixmaps.editor.alert(
						"<p>data field set to <strong>generic</strong> data field <strong>'$item$'</strong></p><p>you can set <b>one </b>or<b> more</b> specific data <b>fields</b> above</p>",
						"data-field-alert", "success");
				}
				if ($("#theme-data-fields-select").val() == "") {
					ixmaps.editor.alert("no data selected", "data-field-alert", "danger");
				}


				// ------------------------------
				// 3. theme type
				// ------------------------------

				$("#chartThemeTitle").css("color", color_selected);

				szHtml = "";
				szHtml += "<option value=\"\" >select basic chart type<\/option>";
				szHtml += "<option value=\"CHOROPLETH\" >shapes<\/option>";
				szHtml += "<option value=\"CHART|DOT|RAW|FAST\" >Dots<\/option>";
				szHtml += "<option value=\"CHART|BUBBLE|SIZE\" >sized Bubbles<\/option>";
				szHtml += "<option value=\"CHART|SYMBOL|GRIDSIZE|FAST|AGGREGATE|SUM|DOPACITY\" >Hexbin - dynamic opacity<\/option>";
				szHtml += "<option value=\"CHART|SYMBOL|AUTOSIZE|FAST|AGGREGATE|SUM\" >Hexbin - dynamic size<\/option>";
				szHtml += "<option value=\"CHART|BUBBLE|SIZE|FAST|AGGREGATE|RELOCATE|SUM\" >Bubble Grid - dynamic size<\/option>";
				szHtml += "<option value=\"CHART|WAFFLE|GRIDSIZE|AGGREGATE|FAST|RECT|SUM\" >Waffle chart<\/option>";
				$("#theme-type-select").html(szHtml);
				$("#theme-type-select").val(__removeTypeFlag(objTheme.style.type, "ZOOMTO"));

				$("#theme-type-text").html(__removeTypeFlag(objTheme.style.type, "ZOOMTO").replace(/\|/g,"&nbsp;| "));

				$("#chartStyleTitle").css("color", color_unselected);

				if (objTheme.style.type.match(/VALUES/)) {
					$("#chartStyleTitle").css("color", color_selected);
					$("#theme-values-checkbox").attr("checked", "checked");
				}
				if (objTheme.style.shadow) {
					$("#chartStyleTitle").css("color", color_selected);
					$("#theme-shadow-checkbox").attr("checked", "checked");
				}
				if (objTheme.style.showdata) {
					$("#chartStyleTitle").css("color", color_selected);
					$("#theme-showdata-checkbox").attr("checked", "checked");
				}
				if (objTheme.style.type.match(/GLOW/)) {
					$("#chartStyleTitle").css("color", color_selected);
					$("#theme-glow-checkbox").attr("checked", "checked");
				}
				if (objTheme.style.type.match(/AURA/)) {
					$("#chartStyleTitle").css("color", color_selected);
					$("#theme-aura-checkbox").attr("checked", "checked");
				}
				$("#define-themetype-title").css("color", color_selected);

				if (objTheme.style.valuedecimals) {
					$("#chartValueDecimalsList").val(objTheme.style.valuedecimals);
					$("#chartValueDecimalsList").prev().css("color", color_selected);
				}

				if (objTheme.style.linecolor) {
					$("#chartLineColor").val(objTheme.style.linecolor);
					$("#chartLineColor").prev().css("color", color_selected);
				}
				if (objTheme.style.linewidth) {
					$("#chartLineWidth").val(objTheme.style.linewidth);
					$("#chartLineWidth").parent().prev().css("color", color_selected);
				}
				if (objTheme.style.valuescale) {
					$("#chartValueScale").val(objTheme.style.valuescale);
					$("#chartValueScale").parent().prev().css("color", color_selected);
				}



				// ------------------------------
				// 4. theme colors and classes
				// ------------------------------

				ixmaps.editor.setSelectColorScheme();

				$("#chartColor-title").css("color", color_selected);
				$("#xcolor-title").css("color", color_selected);


				if (objTheme.style.type.match(/RANGES/) || objTheme.style.ranges) {
					$("#theme-distribution-select").val("RANGES");
				} else
				if (objTheme.style.type.match(/QUANTILE/)) {
					$("#theme-distribution-select").val("QUANTILE");
				} else
				if (objTheme.style.type.match(/LOGARITHMICAL/)) {
					$("#theme-distribution-select").val("LOGARITHMICAL");
				} else
				if (objTheme.style.type.match(/EXACT/)) {
					$("#theme-distribution-select").val("EXACT");
				} else
				if (objTheme.style.type.match(/DEVIATION/)) {
					$("#theme-distribution-select").val("DOMINANT|DEVIATION");
				} else {
				if (objTheme.style.type.match(/DOMINANT/)) {
					$("#theme-distribution-select").val("DOMINANT");
				} else
					$("#theme-distribution-select").val("EQUIDISTANT");
				}
				$("#theme-classes-select").val(Number(objTheme.style.colorscheme[0]) || objTheme.style.colorscheme.length);

				$("#theme-distribution-select").prev().css("color", color_selected);

				if (objTheme.style.type.match(/EXACT/) || objTheme.style.label ) {

					$("#theme-classes-select").hide();

					var szLabelA = szUserLabelA = objTheme.style.label || ixmaps.editor.getUniqueValues();
					    szValueA = objTheme.style.values || szLabelA.slice(0);

					nClasses = szLabelA.length;

					if (ixmaps.editorColorschemeType && (ixmaps.editorColorschemeType == "directly_defined_colors")) {
						var colorsA = ixmaps.editorColorscheme.split('|');
					} else {
						var colorA = ixmaps.getColorScheme(ixmaps.editorColorscheme, nClasses);
						var colorsA = szUserColorA || ixmaps.getColorsFromColorScheme(colorA.join('|'));
					}
					$("#chartLabelParam").show();

					var output = $("#theme-exact-label")[0];
					var szHTML = "<label style='color:#444'>colors and label:</label>";
					var c = 0;
					for (i in szLabelA) {

						szHTML += '<div class="input-group" style="margin-bottom:0.5em;width:100%">';
						szHTML += '<a class="input-group-addon color-box" id="btnGroupAddon" style="width:2.3em;background:' + colorsA[c] +
							'"></a>';
						szHTML += "<input class='form-control' type='text' id='chartLabel" + i + "' value=\"" + szLabelA[i] + "\" onchange=\"ixmaps.editor.setNewLabel("+i+")\">";
						szHTML += '</div>';

						c++;

						if ( c >= 25 ){
							szHTML += '<div class="input-group" style="margin-bottom:0.5em;width:100%">';
							szHTML += 'there are '+(szLabelA.length-c)+' more label ...';
							szHTML += '</div>';
							break;
						}
					}
					output.innerHTML = szHTML;

					$('.color-box').colpick({
						onBeforeShow: function (el) {
							$(this).colpickSetColor(__rgbStringToHex($(this).css("background-color")));
						},
						onSubmit: function (hsb, hex, rgb, el) {
							$(el).css('background-color', '#' + hex);
							$(el).colpickHide();

							szUserColorA = new Array();
							$(".color-box").each(function (index) {
								szUserColorA.push(_circ_getHexaColor($(this).css("background-color")));
							});
							//ixmaps.onChartChange();
						}
					});

				}

				// ------------------------------
				// 5. title snippets
				// ------------------------------

				$("#chartDefinitionTitle").css("color", color_selected);
				$("#theme-title-definition").val(objTheme.style.title);
				$("#theme-title-definition").prev().css("color", color_selected);
				$("#theme-snippet-definition").val(objTheme.style.snippet);
				$("#theme-snippet-definition").prev().css("color", color_selected);

				// ------------------------------
				// 6. aggregation
				// ------------------------------

				if (objTheme.style.type.match(/AGGREGATE/)) {
					$("#chartAggregationTitle").css("color", color_selected);
					$("#chartAggregationMode").prev().css("color", color_selected);

					if (objTheme.style.type.match(/RECT/)) {
						$("#chartAggregationMode").val("AGGREGATE|RECT");
					} else {
						$("#chartAggregationMode").val("AGGREGATE");
					}
					if (objTheme.style.aggregationfield) {
						$("#chartAggregationMode").val("AGGREGATED");
					} else
					if (objTheme.style.gridwidth || objTheme.style.gridwidthpx) {
						if (objTheme.style.gridwidth) {
							if (String(objTheme.style.gridwidth).match(/px/)) {
								objTheme.style.gridwidthpx = parseInt(objTheme.style.gridwidth);
								objTheme.style.gridwidth = null;
							}
						}
						$("#chartAggregationWidth").val(objTheme.style.gridwidth || objTheme.style.gridwidthpx);
						$("#chartAggregationWidth").prev().css("color", color_selected);
						$("#chartAggregationType").val(objTheme.style.gridwidthpx ? "pixel" : "meter");
						$("#chartAggregationType").prev().css("color", color_selected);
					}
					if (objTheme.style.type.match(/RELOCATE/)) {
						$("#theme-relocate-checkbox").attr("checked", "checked");
					}
					if (objTheme.style.type.match(/SUM/)) {
						$("#chartAggregationCalc").val("SUM");
					}else
					if (objTheme.style.type.match(/MEAN/)) {
						$("#chartAggregationCalc").val("MEAN");
					}else{
						$("#chartAggregationCalc").val("SUM");
					}
				}

				// ------------------------------
				// 7. size
				// ------------------------------

				$("#chartScaleValue").val(objTheme.style.scale);
				$("#chartSizeTitle").css("color", color_selected);
				$("#chartSizeLabel").css("color", color_selected);

				if (objTheme.style.type.match(/SIZE/)||objTheme.style.sizefield||objTheme.style.normalsizevalue) {
					$("#chartSizeTitle").css("color", color_selected);
					if (objTheme.style.sizefield) {
						$("#chartSizeList").val("SIZE");
						$("#chartSizeList").prev().css("color", color_selected);
						$("#chartSizeFieldList").val(objTheme.style.sizefield);
						$("#chartSizeFieldList").prev().css("color", color_selected);
					}
					if (objTheme.style.normalsizevalue) {
						$("#chartNormalSizeValue").val(objTheme.style.normalsizevalue);
						$("#chartNormalSizeValue").prev().css("color", color_selected);
					}
				}
				if (objTheme.style.type.match(/LINEAR/)) {
					$("#chartSizeTitle").css("color", color_selected);
					$("#chartSizeList").prev().css("color", color_selected);
					$("#chartSizeList").val("LINEAR");
				}
				if (objTheme.style.type.match(/SIZEP1/)) {
					$("#chartSizeTitle").css("color", color_selected);
					$("#chartSizeList").prev().css("color", color_selected);
					$("#chartSizeList").val("LINEAR");
				}
				if (objTheme.style.type.match(/SIZEP2/)) {
					$("#chartSizeTitle").css("color", color_selected);
					$("#chartSizeList").prev().css("color", color_selected);
					$("#chartSizeList").val("SIZEP2");
				}
				if (objTheme.style.type.match(/SIZEP3/)) {
					$("#chartSizeTitle").css("color", color_selected);
					$("#chartSizeList").prev().css("color", color_selected);
					$("#chartSizeList").val("SIZEP3");
				}
				if (objTheme.style.type.match(/SIZEP4/)) {
					$("#chartSizeTitle").css("color", color_selected);
					$("#chartSizeList").prev().css("color", color_selected);
					$("#chartSizeList").val("SIZEP4");
				}
				if (objTheme.style.type.match(/SIZELOG/)) {
					$("#chartSizeTitle").css("color", color_selected);
					$("#chartSizeList").prev().css("color", color_selected);
					$("#chartSizeList").val("SIZELOG");
				}

				$("#chartRangeScaleValue").val(objTheme.style.rangescale);

				// ------------------------------
				// 8. dynamic alpha
				// ------------------------------

				$("#chartOpacityValue").val(objTheme.style.opacity||objTheme.style.fillopacity);
				$("#chartOpacityTitle").css("color", color_selected);
				$("#chartOpacityLabel").css("color", color_selected);

				if (objTheme.style.type.match(/DOPACITY/)) {
					$("#chartOpacityTitle").css("color", color_selected);
					if (objTheme.style.type.match(/DOPACITYBIPOLAR/)) {
						$("#chartAlphaMode").val("DOPACITYBIPOLAR");
					} else
					if (objTheme.style.type.match(/DOPACITYLOGMEAN/)) {
						$("#chartAlphaMode").val("DOPACITYLOGMEAN");
					} else
					if (objTheme.style.type.match(/DOPACITYMEAN/)) {
						$("#chartAlphaMode").val("DOPACITYMEAN");
					} else
					if (objTheme.style.type.match(/DOPACITYMIN/)) {
						$("#chartAlphaMode").val("DOPACITYMIN");
					} else
					if (objTheme.style.type.match(/DOPACITYMAX/)) {
						$("#chartAlphaMode").val("DOPACITYMAX");
					} else
					if (objTheme.style.type.match(/DOPACITYLOG/)) {
						$("#chartAlphaMode").val("DOPACITYLOG");
					}else {
						$("#chartAlphaMode").val("DOPACITY");
					}

					if (objTheme.style.dopacitypow) {
						$("#chartAlphaSpread").val(objTheme.style.dopacitypow);
						$("#chartAlphaSpread").prev().css("color", color_selected);
					}
					if (objTheme.style.dopacityscale) {
						$("#chartAlphaIntensity").val(objTheme.style.dopacityscale);
						$("#chartAlphaIntensity").prev().css("color", color_selected);
					}
				}

				if (objTheme.style.alphafield){
					$("#chartAlphaFieldList").val(objTheme.style.alphafield);
				}

				var scaleParam	= ixmaps.getScaleParam();
				var options		= ixmaps.getOptions();
				
				if (0){
					var szHtml = "";
					szHtml += "<table>";
					for ( i in scaleParam ){
						szHtml += "<tr><td>"+i+"</td><td>"+scaleParam[i]+"</td></tr>";
					}
					for ( i in options ){
						szHtml += "<tr><td>"+i+"</td><td>"+options[i]+"</td></tr>";
					}
					$("#map-configuration").html(szHtml);
				}

				if (scaleParam.normalSizeScale) {
					$("#mapNormalsizeScale").val("1:"+scaleParam.normalSizeScale);
				}
				if (options.objectscaling) {
					$("#mapObjectScaling").val(options.objectscaling);
				}

				if (options.flushChartDraw) {
					$("#mapRenderRate").val(options.flushChartDraw);
				}

				console.log(ixmaps.editor.themeObj);	

			};

			// .................................................................
			//
			// c o n f i g u r a t o r  -->  t h e m e
			//
			// .................................................................

			/**
			 * applay changes to the actual theme 
			 * @type void
			 */

			ixmaps.editor.applyChanges = function () { 

				console.log("applyEditorTheme");

				// theme
				// ------------------------------------
				var objTheme = ixmaps.getThemeDefinitionObj() || ixmaps.editor.themeObj;

				objTheme.style.dbtableUrl = $("#define-data").val();

				objTheme.layer = $("#map-layer-select").val();
				objTheme.field = $("#theme-data-fields-select").val();

				var lookup = $("#theme-data-lookup-select").val();
				var lat = $("#theme-data-lat-select").val();
				var lon = $("#theme-data-lon-select").val();

				if ( lookup.length ){
					objTheme.style.lookupfield = lookup;
					objTheme.style.itemfield = lookup;
				}else
				if ( lat.length && lon.length ) {
					objTheme.style.lookupfield = lat + "|" + lon;
					objTheme.style.itemfield = lat + "|" + lon;
				}else{
					alert("lookup error");
					return;
				}

				if (szUserColorA) {
					objTheme.style.colorscheme = szUserColorA;
					objTheme.style.values = szValueA;
					objTheme.style.label = szUserLabelA;
				}

				var fValues = objTheme.style.type.match(/VALUES/);

				// objTheme.style.type = $("#theme-type-select").val();

				if (ixmaps.editor.themeDataFieldType){
					if ( (ixmaps.editor.themeDataFieldType.type == "exact") && !objTheme.style.type.match(/EXACT/) ){
						objTheme.style.type += "|EXACT";
						$("#chartAlphaMode").val("");
						objTheme.style.colorscheme = ixmaps.editor.themeDataFieldType.style.colorscheme;
					}
				}

				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "AGGREGATE");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "RECT");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "RELOCATE");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "VALUES");

				if (fValues) {
					objTheme.style.type += "|VALUES";
				}

				if ($("#chartSizeFieldList").val() != "" ) {
					objTheme.style.sizefield = $("#chartSizeFieldList").val();
					objTheme.style.valuefield = $("#chartSizeFieldList").val();
				}

				if ($("#chartNormalSizeValue").val() != "" ) {
					objTheme.style.normalsizevalue = $("#chartNormalSizeValue").val();
				}

				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "SIZE");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "LINEAR");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "SIZEP1");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "SIZEP2");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "SIZEP3");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "SIZEP4");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "SIZELOG");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "NOSIZE");

				if ($("#chartSizeList").val() != "" ) {
					objTheme.style.type += "|"+$("#chartSizeList").val();
				}


				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "GLOW");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "AURA");

				if ($("#theme-glow-checkbox").attr("checked") == "checked") {
					objTheme.style.type += "|GLOW";
				}
				if ($("#theme-aura-checkbox").attr("checked") == "checked") {
					objTheme.style.type += "|AURA";
				}

				objTheme.style.valuedecimals = $("#chartValueDecimalsList").val();

				if ($("#chartAggregationMode").val().match(/AGGREGATE/)) {

					objTheme.style.type += "|" + $("#chartAggregationMode").val();

					if ($("#chartAggregationType").val() == "pixel") {
						objTheme.style.gridwidth = $("#chartAggregationWidth").val() + "px";
						objTheme.style.gridwidthpx = null;
					} else {
						objTheme.style.gridwidth = $("#chartAggregationWidth").val();
						objTheme.style.gridwidthpx = null;
					}


					objTheme.style.type = __removeTypeFlag(objTheme.style.type, "SUM");
					objTheme.style.type = __removeTypeFlag(objTheme.style.type, "MEAN");
					if ($("#chartAggregationCalc").val() == "SUM") {
						objTheme.style.type += "|SUM";
					} else 
					if ($("#chartAggregationCalc").val() == "MEAN") {
						objTheme.style.type += "|MEAN";
					} else {
					}

					objTheme.style.type = __removeTypeFlag(objTheme.style.type, "RELOCATE");
					if ($("#theme-relocate-checkbox").attr("checked") == "checked") {
						objTheme.style.type += "|RELOCATE";
					}

					if ($("#chartAggregationMode").val().match(/RECT/)){
						if ( objTheme.style.symbols && (objTheme.style.symbols[0] == "hexagon") ){
							objTheme.style.symbols[0] = "square";
						}
					}else{
						if ( objTheme.style.symbols && (objTheme.style.symbols[0] == "square") ){
							objTheme.style.symbols[0] = "hexagon";
						}
					}
				}

				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "DOPACITY");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "DOPACITYLOG");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "DOPACITYMAX");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "DOPACITYMIN");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "DOPACITYPIPOLAR");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "DOPACITYMEAN");
				objTheme.style.type = __removeTypeFlag(objTheme.style.type, "DOPACITYLOGMEAN");

				if ($("#chartAlphaMode").val().match(/DOPACITY/)) {
					objTheme.style.type += "|" + $("#chartAlphaMode").val();

					objTheme.style.dopacitypow = $("#chartAlphaSpread").val();
					objTheme.style.dopacityscale = $("#chartAlphaIntensity").val();
				}

				if ($("#chartAlphaFieldList").val() != "" ) {
					objTheme.style.alphafield = $("#chartAlphaFieldList").val();
				}

				objTheme.style.editor = true;
				objTheme.style.datacache = null;
				console.log(objTheme);

				// make the new theme
				// -----------------------------
				var oldTheme = ixmaps.getThemeDefinitionObj();
				ixmaps.embeddedSVG.window.map.Api.clearAll();
				ixmaps.embeddedSVG.window.map.Api.newMapThemeByObj(objTheme);

				if (!oldTheme) {
					//setTimeout("ixmaps.embeddedSVG.window.map.Api.zoomToTheme()",100);
				}

				ixmaps.editor.alert('<b>generating theme ...</b><img src="../../../ui/resources/images/loading_blue.gif" id="load-file-spinner" style="height:48px;margin:-0.4em 0 0 0;">', "generating-on-bottom", "default");
			};
		</script>

</body>

</html>