<!DOCTYPE HTML>
<html>

<head>
	<meta charset="UTF-8">
    <title>iXmaps Theme Legend</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> 

	<meta http-equiv="X-UA-Compatible" content="IE=9"/>

  <noscript><div style="position:absolute;top:100px;left:100px;width:500px"><b>JavaScript must be enabled in order for you to use iXMaps.</b><br><br>
  However, it seems JavaScript is either disabled or not supported by your browser.
  To view the map application, enable JavaScript by changing your browser options, and then
  try again.</div>
  </noscript>

  <!--========================================================================= -->

  <link href="../../ui/libs/jquery/ui/css/smoothness/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css"/>
  <link href="../css/jquery-ui.css" rel="stylesheet" type="text/css"/>
  <link href="../css/custom.css" rel="stylesheet" type="text/css"/>
  <link href="../css/icomoon.css" rel="stylesheet" type="text/css"/>

  <link id="story-css" href="#" rel="stylesheet" type="text/css"/>
  <link id="story-css-fonts" href="#" rel="stylesheet" type="text/css"/>

  <!--========================================================================= -->

<style type="text/css">
	a:hover {
		background-color:yellow;
		text-decoration: underline;  
	} 
</style>
<style type="text/css">

/* style the scrollbar */
::-webkit-scrollbar {
    width: 7px;
}
 
/* Track */
::-webkit-scrollbar-track {
    -webkit-box-shadow: inset 0 0 4px rgba(0,0,0,0.1); 
    -webkit-border-radius: 0px;
    border-radius: 0px;
}
 
/* Handle */
::-webkit-scrollbar-thumb {
    -webkit-border-radius: 0px;
    border-radius: 0px;
    background: rgba(232,232,232,0.6); 
    -webkit-box-shadow: inset 0 0 0px rgba(0,0,0,0.1); 
}
::-webkit-scrollbar-thumb:window-inactive {
	background: rgba(222,222,222,0.4); 
}

.ui-dialog {
	-moz-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.3) /*{global-box-shadow-color}*/ ;
	-webkit-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.3) /*{global-box-shadow-color}*/ ;
	box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.3) /*{global-box-shadow-color}*/ ;
	}
#ixmap{
	-moz-box-shadow: 0px 2px 4px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.5) /*{global-box-shadow-color}*/ ;
	-webkit-box-shadow: 0px 2px 4px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.5) /*{global-box-shadow-color}*/ ;
	box-shadow: 0px 2px 4px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.5) /*{global-box-shadow-color}*/ ;
}
#opensidebarbutton{
	-moz-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	-webkit-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	background:	#ffffff;
	border: #ccc solid 1px;
	border-radius:0.5em;
}
#switchmodebutton{
	-moz-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	-webkit-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	background:	#ffffff url(./resources/icons/arrow_dk_grey_down.png) no-repeat 90% 90%;
	background-size:					8px;
	border: #ccc solid 1px;
	border-radius:0.5em;
}
#switchtoolsbutton{
	-moz-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	-webkit-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	background:	#ffffff;
	border: #ccc solid 1px;
	border-radius:0.5em;
}
#switchinfobutton{
	-moz-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	-webkit-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	background:	#ffffff;
	border: #ccc solid 1px;
	border-radius:0.5em;
}
#switchlegendbutton{
	-moz-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	-webkit-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
	background:	#f8f8f8;
	border: #ccc solid 1px;
	border-radius:0.4em;
}

.colorlist {
	padding:0px;
	margin:0px;
	margin-left:-10px;
	border:0;
}
.colorlistitem {
	padding:1px;
	margin:3px;
	border:0;
}
.colorlistitem > a {
	text-decoration: none;
	padding:3px;
	margin:3px;
	border:0;
}
.colorlistitem > a:hover {
	text-decoration: none;
	background: #fd8;
	xborder:#aaa solid 1px;
}
a.theme-button {
	text-decoration: none;
}
span.theme-button {
	font-size:14px;
	color:#444444;
	background:#ffffff;
	padding:0.5em;
}
table.theme-legend {
    max-width: 300px;
}
td.theme-legend {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
td.theme-legend-count {
    width: 100px;
    overflow: hidden;
}
#attribution a{
	text-decoration:none;
}
p.legend-description {
	margin-top:1em;
	margin-bottom:0px;
	font-size:0.6em;
}
.legend-background {
	background: #f8f8f8;
}

</style>
<style type="text/css">
.draggable {
	position: absolute;
	left: 30px;
	top: 30px;
	width: 60px;
	height: 60px;
	margin-left: -30px;
	margin-top: -30px;

	color: #FFF;
	font: bold 16px Helvetica,Arial,Sans-serif;
	text-align: center;
}
.androideventpane {
	position: absolute;
	left: 30px;
	top: 30px;
	width: 60px;
	height: 60px;
	margin-left: -30px;
	margin-top: -30px;
}
</style>


  <script src = "../../ui/libs/jquery/jquery-1.7.1.min.js"></script>
  <script src = "../../ui/libs/jquery/ui/js/jquery-ui-1.8.16.custom.min.js"></script>

  <style type="text/css" media="screen">
    body {
        overflow: hidden;
    }

	#theme-legend  { 
		font-family: Verdana,Arial,sans-serif;
		font-size: 1.1em;
		background: rgb(248, 248, 248);
		padding: 0em 0em;
	}
  </style>

  </head>
  <body >

	<div id="theme-legend" >
	</div>

  </body>

  <script type="text/javascript">
	var ixmaps = null;
	var opener = null;
	if ( window.opener ){
		ixmaps = window.opener.ixmaps;
		opener = window.opener;
	}else
	if ( parent ){
		ixmaps = parent.window.ixmaps;
		opener = parent.window;
	}
	else{
		alert("error: missing parent window for themes !");
	}
  
   	/**************************************************************** 
	 *
	 * Theme 
	 *
	 ****************************************************************/

	// intercept theme creation
	// --------------------------------------------------------

	// little helper
	__sortList = function(a,b){
		if ( a.count < b.count){
			return 1;
		}
		return -1;
	};

	ixmaps.toggleValueDisplay = function(szThemeId){
		var szThemeStyle = ixmaps.getThemeStyleString(szThemeId);
		if ( szThemeStyle && szThemeStyle.match(/VALUES/) ){
			ixmaps.changeThemeStyle(szThemeId,'type:VALUES;','remove');
		}else{
			ixmaps.changeThemeStyle(szThemeId,'type:VALUES;','add');
			ixmaps.changeThemeStyle(szThemeId,'type:NOINLINETEXT;','add');
			ixmaps.changeThemeStyle(szThemeId,'type:AXIS;','add');
			ixmaps.changeThemeStyle(szThemeId,'valueupper','remove');
			//ixmaps.changeThemeStyle(szThemeId,'type:DTEXT;','add');
			//ixmaps.changeThemeStyle(szThemeId,'type:VALUEBACKGROUND;','add');
		}
	};

	ixmaps.changeThemeDynamic = function(szThemeId,szParameter,szFactor){

		var szThemeStyle = ixmaps.getThemeStyleString(szThemeId);

		if ( szThemeStyle.match(/CHOROPLETHE/) ){
			switch (szParameter) {
				case "amplify":
					ixmaps.changeThemeStyle(szThemeId,'dopacitypow:'+String(szFactor),'factor');
					break;
				case "scale":
					ixmaps.changeThemeStyle(szThemeId,'dopacityscale:'+String(szFactor),'factor');
					break;
				case "opacity":
					ixmaps.changeThemeStyle(szThemeId,'opacity:'+String(szFactor),'factor');
					break;
			}
		}else{
		if ( szThemeStyle.match(/GRIDSIZE/) ){
			switch (szParameter) {
				case "amplify":
					ixmaps.changeThemeStyle(szThemeId,'gridwidth:'+String(szFactor),'factor');
					break;
				case "scale":
					ixmaps.changeThemeStyle(szThemeId,'scale:'+String(szFactor),'factor');
					break;
				case "opacity":
					ixmaps.changeThemeStyle(szThemeId,'fillopacity:'+String(szFactor),'factor');
					break;
				case "aggregation":
					ixmaps.changeThemeStyle(szThemeId,'gridwidth:'+String(szFactor),'factor');
					break;
			}
		}else{
			switch (szParameter) {
				case "amplify":
					ixmaps.changeThemeStyle(szThemeId,'normalsizevalue:'+String(szFactor),'factor');
					break;
				case "scale":
					ixmaps.changeThemeStyle(szThemeId,'scale:'+String(szFactor),'factor');
					break;
				case "opacity":
					ixmaps.changeThemeStyle(szThemeId,'fillopacity:'+String(szFactor),'factor');
					break;
				case "aggregation":
					ixmaps.changeThemeStyle(szThemeId,'gridwidth:'+String(szFactor),'factor');
					break;
			}
		}
	};

	var szLegendId = null;
	var fLegendDialog = false;
	var fOnRemove = false;

	__makeColorLegendHTML = function(szId){

		var colorA  = ixmaps.themeObj.colorScheme;
		var labelA  = ixmaps.themeObj.szLabelA;

		if ( !labelA ){
			labelA = new Array();
			var szUnit = ixmaps.themeObj.szUnit || "";
			var len = Math.min(colorA.length,ixmaps.themeObj.partsA.length);
			for ( var i=0; i<len; i++){
				var szPart = parseFloat(ixmaps.themeObj.partsA[i].min).toFixed(2)+szUnit+" ... "+parseFloat(ixmaps.themeObj.partsA[i].max).toFixed(2)+szUnit;
				labelA.push(szPart);
			}
		}

		// color legend = table
		var szHtml = "<table id='legend-classes' class='theme-legend' style='font-size:0.8em;line-height:0.9em;color:#888888'>";
		var max = Math.min(200,Math.min(colorA.length,labelA.length));

		// get exact count from ixmaps.themeObj
		var count = "";

		sortA = [];
		for ( var i=0; i<max; i++){
			sortA.push({index:i,count:(ixmaps.themeObj.exactSizeA[i]||ixmaps.themeObj.exactCountA[i])});
		}
		if( ixmaps.themeObj.szFlag.match(/EXACT/) && !ixmaps.themeObj.szFlag.match(/NOSORT/) ){
			sortA.sort(__sortList);
		}

		// colorscheme
		//
		var fColorScheme = false; 
		var fCountBars = false;
		var nMaxCount = 0;

		for ( var i=0; i<max; i++){
			if ( colorA[0] !=  colorA[i] ){
				fColorScheme = true; 
			}
			if ( sortA[i].count ){
				nMaxCount = Math.max(nMaxCount,sortA[i].count);
				fCountBars = true;
			}
		}
		if ( fColorScheme &&
			( ( ixmaps.themeObj.partsA.length > 2)		||
				ixmaps.themeObj.szLabelA				||
				ixmaps.themeObj.szFlag.match(/EXACT/)	||
				ixmaps.themeObj.szRangesA.length ) ){

			// get exact count from ixmaps.themeObj
			var count = "";
			for ( var i=0; i<max; i++){

				if ( (fCountBars || ixmaps.themeObj.szFlag.match(/FILTER/) )&& !sortA[i].count ){
					continue;
				}

				count = ixmaps.__formatValue(sortA[i].count,2,"BLANK"); //sortA[i].count?""+sortA[i].count+"":"";
				szHtml += "<tr valign='top'>";

				szHtml += "<td><a class='theme-button' href='#' title='click to see'><span onclick='javascript:ixmaps.markThemeClass(\""+szId+"\","+sortA[i].index+");event.stopPropagation();return false;' style='background:"+colorA[sortA[i].index]+";font-size:0.7em;'>";

				if ( fCountBars ){
					//for ( var w=0; w<Math.ceil(Math.pow(sortA[i].count,0.5)/10); w++ ){
					for ( var w=0; w<Math.ceil(Math.pow(sortA[i].count,0.5)*(20/Math.pow(nMaxCount,0.5))); w++ ){
						szHtml += "&nbsp;";
					}
				}else{
					if ( ixmaps.themeObj.szFlag.match(/DOPACITY/) ){
						szHtml += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
						szHtml += "</span><span onclick='javascript:ixmaps.markThemeClass(\""+szId+"\","+sortA[i].index+");event.stopPropagation();return false;'  style='background:"+colorA[sortA[i].index]+";font-size:0.7em;opacity:0.75;'>"; 
						szHtml += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
						szHtml += "</span><span onclick='javascript:ixmaps.markThemeClass(\""+szId+"\","+sortA[i].index+");event.stopPropagation();return false;'  style='background:"+colorA[sortA[i].index]+";font-size:0.7em;opacity:0.5;'>"; 
						szHtml += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
					}else{
						szHtml += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
					}

				}

				var szLabel = labelA[sortA[i].index];
				var szCount = sortA[i].count?("<td class='theme-legend-count' style='text-align:right;padding-left:1em;color:#444'>"+count+"</td>"):"";

				szHtml += "</span></td><td class='theme-legend' style='max-width:"+(szCount.length?"200px":"300px")+"'><span title='"+szLabel+"'>"+szLabel+"</span></a></td>"+szCount+"</tr>";
			}

		}else if (0){
			szHtml += "<tr valign='top'><td><span onclick='javascript:ixmaps.hideThemeClass(\""+szId+"\","+0+")'  style='background:"+colorA[0]+";font-size:0.7em;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td><td><span style='padding-left:5px'>"+labelA[0]+"</span></td><td> &nbsp;&nbsp;|</td><td><span style='padding-left:5px'>"+labelA[labelA.length-1]+"</span></td></tr>";
		}else{
			szHtml += "<tr valign='top'><td><span onclick='javascript:ixmaps.hideThemeClass(\""+szId+"\","+0+")'  style='background:"+colorA[0]+";font-size:0.7em;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td><td><span style='padding-left:5px'>"+(ixmaps.themeObj.nMinValue||ixmaps.themeObj.nMin)+"</span></td><td> &nbsp;...</td><td><span style='padding-left:5px'>"+(ixmaps.themeObj.nMaxValue||ixmaps.themeObj.nMax)+"</span></td></tr>";
		}

		szHtml += "</table>";

		return szHtml;
	};

	ixmaps.makeLegendHTML = function(szId){ 

		var fColors = true;
		var fFilter = false;
		var fButton = true;
		var fLimits = false;

		ixmaps.themeObj = ixmaps.getThemeObj(szId);

		var colorA  = ixmaps.themeObj.colorScheme;
		var labelA  = ixmaps.themeObj.szLabelA;
		if ( !labelA ){
			labelA = new Array();
			var szUnit = ixmaps.themeObj.szUnit || "";
			var len = Math.min(colorA.length,ixmaps.themeObj.partsA.length);
			for ( var i=0; i<len; i++){
				var szPart = parseFloat(ixmaps.themeObj.partsA[i].min).toFixed(2)+szUnit+" ... "+parseFloat(ixmaps.themeObj.partsA[i].max).toFixed(2)+szUnit;
				labelA.push(szPart);
			}
		}

		szHtml = "";

		var nLegendHeight = Math.max(100,$(window).innerHeight()/8); 

		// legend container
		szHtml += "<div  id='legend-container'>";

		// scroll wrap
		szHtml += "<div id='legend-scroll' style='margin-top:0.2em;max-height:"+nLegendHeight+"px;overflow:auto'>";

		// legend colorscheme
		if ( fColors ){
			szHtml += __makeColorLegendHTML(szId);
		}

		szHtml += "</div>";

		// footer
		szHtml += "<div id='legend-footer' >";

		if (ixmaps.themeObj.szDescription){
			szHtml += "<p class='legend-description' >"+ixmaps.themeObj.szDescription+"</p>";
		}else{
			if ( ixmaps.themeObj.szFlag.match(/DOPACITY/) ){
				if ( ixmaps.themeObj.szAlphaField100 == "$density$" ){
					szHtml += "<span style='font-size:0.6em'>(dynamic opacity from density)</span>";
				}else{
					szHtml += "<span style='font-size:0.6em'>(dynamic opacity from value)</span>";
				}
			}else{
				szHtml += "";
				}
		}
		if( fFilter ){
			var szFilter = "";
			szHtml += "<div style='margin-top:0.5em;'>";
			szHtml += "filter: <form "
					  +"style=\"display:inline-block;left:0px;height:26px;margin-right:10px;\" "
					  +"name=\"FilterForm\">" 
							+"<input class=\"form-control\" id=\"query\" type=\"text\" size=\"9\" "
								+"value=\""+ szFilter +"\" "
								+"style=\"width:150px;height:22px;position:relative;top:0px;\" title=\"query map items\" " 
								+"onkeyup=\"javascript:var value = $(this).val();ixmaps.filterThemeItems('"+szId+"',value);\">"
							+"</input>"
					  +"</form>"
					  +"<span><a href=\"javascript:ixmaps.selectFilterItems('"+szId+"');\" >sum"
					  +"</a></span>";
				szHtml += "</div>";
		}

		if ( themeObj.szFlag.match(/SUBTHEME/) ){
			szHtml += "<h3><a href='javascript:ixmaps.unmarkThemeClass(\""+szId+"\")' class='theme-button'><span class='icon icon-undo2 theme-button' ></span></a></h3>";
		}else
		if ( fButton ){
			var id = szId.replace(/\./g,'');

			szHtml += 		"<div style='margin-top:0.75em;margin-bottom:0.25em;' >";
			szHtml += 		"<span id='legend-buttons'>";
				
			szHtml += 		"<a id='highbutton"+id+"' class='theme-button' href='javascript:ixmaps.changeThemeDynamic(\""+szId+"\",\"amplify\",\"1.5\");' title='smooth chart' >";
			szHtml += 			"<span class='icon icon-arrow-down theme-button' ></span>";
			szHtml += 			"</a>&nbsp;";

			szHtml += 		"<a id='lowbutton"+id+"' class='theme-button' href='javascript:ixmaps.changeThemeDynamic(\""+szId+"\",\"amplify\",\"0.66\");' title='amplify chart'>";
			szHtml += 			"<span class='icon icon-arrow-up theme-button' ></span>";
			szHtml += 			"</a>&nbsp;";

			szHtml += 		"<a id='minusbutton"+id+"' class='theme-button' href='javascript:ixmaps.changeThemeDynamic(\""+szId+"\",\"scale\",\"0.66\");' title='smaller charts'>";
			szHtml += 			"<span class='icon icon-minus theme-button' ></span>";
			szHtml += 			"</a>&nbsp;";

			szHtml += 		"<a id='plusbutton"+id+"' class='theme-button' href='javascript:ixmaps.changeThemeDynamic(\""+szId+"\",\"scale\",\"1.5\");' title='bigger charts'>";
			szHtml += 			"<span class='icon icon-plus theme-button' ></span>";
			szHtml += 			"</a>&nbsp;";

			szHtml += 		"<a id='valuebutton"+id+"' class='theme-button' href='javascript:ixmaps.toggleValueDisplay(\""+szId+"\");' title='add/remove textual values'>";
			szHtml += 			"<span class='icon icon-spell-check theme-button' ></span>";
			szHtml += 			"</a>&nbsp;";

			szHtml += 		"<a id='opminusbutton"+id+"' class='theme-button' href='javascript:ixmaps.changeThemeDynamic(\""+szId+"\",\"opacity\",\"0.66\");' title='more transparency'>";
			szHtml += 			"<span class='icon icon-checkbox-unchecked theme-button' style='font-size:14px; color:#bbbbbb;background:#ffffff;padding:0.5em;'></span>";
			szHtml += 			"</a>&nbsp;";

			szHtml += 		"<a id='opplusbutton"+id+"' class='theme-button' href='javascript:ixmaps.changeThemeDynamic(\""+szId+"\",\"opacity\",\"1.5\");' title='less transparency'>";
			szHtml += 			"<span class='icon icon-checkbox-partial theme-button' ></span>";
			szHtml += 			"</a>&nbsp;";

			szHtml += 		"<a id='deletebutton"+id+"' class='theme-button'  href='javascript:ixmaps.makeChartMenueHTML(\""+szId+"\");' title='chart menu'>";
			szHtml += 			"<span class='icon icon-pie theme-button' ></span>";
			szHtml += 			"</a>&nbsp;";

			szHtml += 		"<a id='deletebutton"+id+"' class='theme-button'  href='javascript:ixmaps.removeTheme(\""+szId+"\");' title='remove theme'>";
			szHtml += 			"<span class='icon icon-remove theme-button' ></span>";
			szHtml += 			"</a>&nbsp;";


			szHtml += 		"</ span>";
			szHtml += 		"</ div>";

			if( fLimits ){	
				szHtml += 	"	<div style=\"margin-top:0.5em;margin-bottom:0.5em;\">";
				szHtml += 	"		limitare elementi dei grafici:";
				szHtml += 	"		<a href=\"javascript:$('#info-limitare').toggle();\">";
				szHtml += 	"		<span class=\"icon icon-info tip\" data-tip=\"più/<br>meno\" style=\"font-size:14px;color:#aaaaaa;margin-left:0.2em;\"></span></a>";
				szHtml += 	"		<br>";
				szHtml += 	"		<a href='javascript:ixmaps.changeThemeStyle(null,\"clipparts:1\");' title=\"massimo 1 parte\" >1</a> |";
				szHtml += 	"		<a href='javascript:ixmaps.changeThemeStyle(null,\"clipparts:2\");' title=\"massimo 2 parti\" >2</a> |";
				szHtml += 	"		<a href='javascript:ixmaps.changeThemeStyle(null,\"clipparts:3\");' title=\"massimo 3 parti\" >3</a> |";
				szHtml += 	"		<a href='javascript:ixmaps.changeThemeStyle(null,\"clipparts:4\");' title=\"massimo 4 parti\" >4</a> |";
				szHtml += 	"		<a href='javascript:ixmaps.changeThemeStyle(null,\"clipparts:5\");' title=\"massimo 5 parti\" >5</a> |";
				szHtml += 	"		<a href='javascript:ixmaps.changeThemeStyle(null,\"clipparts:0\");' title=\"tutti parti\" >tutti</a> |";
				szHtml += 	"		<a href='javascript:ixmaps.changeThemeStyle(null,\"type:FADEIN\",\"toggle\");' title=\"trasparenza dinamica\" >dinamico</a> |";
				szHtml += 	"		<a href='javascript:ixmaps.changeThemeStyle(null,\"type:NONEGATIVE\",\"toggle\");' title=\"no valori negativi\" >solo valori positivi</a>";
				szHtml += 	"	</div>";
			}

			if(0){	
				szHtml += 	"	<div id=\"info-limitare\" style=\"display:none\">";
				szHtml += 	"	<p>	<b>Limita</b> il numero di <b>elementi realizzati</b> per grafici con <b>più parti</b>,"; 
				szHtml += 	"		come per esempio per colonnine con i risultati di più partiti.<br>";
				szHtml += 	"		La differenza tra selezionare solo 3 partiti e questo metodo è la seguente:";
				szHtml += 	"		siccome la sequenza dei partiti è decrescente, limitando su 3 parti ottengo una grafica che mostra per ogni comune i 3 partiti più votati.";
				szHtml += 	"		<br><a href=\"javascript:$('#info-limitare').toggle();\">";
				szHtml += 	"		[chiudi]</a><p>";
				szHtml += 	"	</div>";
			}
		}

		// end of legend-footer	
		szHtml += "</div>";

		// end of legend-container	
		szHtml += "</div>";

		__showLegendDialog(szHtml,ixmaps.themeObj.szTitle);
	}

	__refreshColorLegendHTML = function(szId){

		ixmaps.themeObj = ixmaps.getThemeObj(szId);
		$("#legend-scroll").html(__makeColorLegendHTML(szId));

	};

	__showLegendDialog = function(szHtml,szTitle){

		ixmaps.szHtml  = szHtml  || ixmaps.szHtml  || "";
		ixmaps.szTitle = szTitle || ixmaps.szTitle || "";

		// set content
		//
		$("#theme-legend").html(ixmaps.szHtml);

		opener.$("#legend-dialog").dialog( "option", "title", ixmaps.szTitle );
		opener.$("#legend-dialog").css("background","#f8f8f8");

		// make legend resizable
		// must be done before position dialog by left, top
		//
		opener.$("#legend-dialog").dialog({
		  resize: function( event, ui ) {
				$("#legend-scroll").css("max-height",(opener.$("#legend-dialog").height()-$("#legend-footer").height()-titleHeigth-15)+"px");
				$(".theme-legend").css("max-width",(opener.$("#legend-dialog").width()-100-($(".theme-legend-count:first").width()))+"px");
			}
		});

		// resize
		//
		var titleHeigth = opener.$(".ui-dialog-titlebar").height();
		var newWidth  = Math.max($("#legend-classes").width()+40,$("#legend-buttons").width()+40);
		var newHeight = $("#legend-container").height()+titleHeigth+50;

		opener.$("#legend-dialog").dialog( "option", "width", newWidth );
		opener.$("#legend-dialog").dialog( "option", "height", newHeight );
		opener.$("#legend-dialog").css("overflow", "hidden" );

		opener.$("#dialogframe").css("height", "1000px" );

		// position to the right
		//
		opener.$("#legend-dialog").parent().css("left",(opener.innerWidth-newWidth-20)+"px");
		opener.$("#legend-dialog").parent().css("top",(opener.innerHeight-newHeight-40)+"px");

	};

	__switchBannerElements = function(){
		var toolsWidth  = parseInt($("#tools").css('width'));
		var visiToolWidth	= parseInt($("#visiswitch").css('width'));
		var chartToolWidth = parseInt($("#chartsdiv").css('width'));

		if ( window.innerWidth > (toolsWidth+visiToolWidth+chartToolWidth+10) ){
			$("#visiswitch").css('visibility','visible');
			$("#chartsdiv").css('visibility','visible');
		}else
		if ( window.innerWidth > (toolsWidth+chartToolWidth+30) ){
			$("#visiswitch").css('visibility','hidden');
			$("#chartsdiv").css('visibility','visible');
		}else{
			$("#visiswitch").css('visibility','hidden');
			$("#chartsdiv").css('visibility','hidden');
		}
		$("#onmapbuttondiv").css('left',String(parseInt($(ixmaps.gmapDiv).css('left'))+10)+"px");
	};


/**
 * convert a number into a formatted string; if the number > 1000 it will be formatted like 1.023.234 
 * @param nValue the number to format
 * @param nPrecision the wanted decimal points 
 * @param szFlag "CEIL" or "FLOOR" (round either up or down)
 */
ixmaps.__formatValue = function(nValue,nPrecision,szFlag){

	nValue = Number(nValue);

	if ( !isFinite(nValue) || !isFinite(nPrecision) ){
		return String(nValue);
	}
	if ( nValue == 0 ){
		return String(nValue);
	}

	if ( !nPrecision ){
		nPrecision = 0;
	}
	nPrecision = Math.max(0,nPrecision);

	// GR 02.12.2011 make that low values do not collapse to 0
	if ( (nValue > 0.0000001) && (nPrecision > 0) ){
		while ( nValue.toFixed(nPrecision-1) == 0 ){
			nPrecision++;
		}
	}
	
	// GR 11.03.2009 fix precision before CEIL or FLOOR to avoid JS errors eg. 0.0000000000003
	nValue = nValue.toFixed(nPrecision+1);

	nClipDecimal = Math.pow(10,nPrecision);
	if (szFlag && szFlag.match(/CEIL/)){
		nValue = Math.ceil(nValue*nClipDecimal)/nClipDecimal;
	}else
	if (szFlag && szFlag.match(/FLOOR/)){
		nValue = Math.floor(nValue*nClipDecimal)/nClipDecimal;
	}
	else{
		nValue = Math.round(nValue*nClipDecimal)/nClipDecimal;
	}
	// format numbers > 1000
	if ( 0 && (nValue < 1000) ){
		return String(nValue);
	}
	else {
		var szDecimals = String(nValue);
		if (szDecimals.match(/\./) ){
			szDecimals = szDecimals.split(".")[1];
			while ( szDecimals.length < nPrecision ){
				szDecimals += '0';
			} 
		}
		else {
			szDecimals = "";
		}
		var szReturn = nValue<0?"-":"";
		var szLeading = "";

		nValue = Math.floor(Math.abs(nValue));

		// GR new flag
		if ( !szFlag || !szFlag.match(/NOBREAKS/) ){
			var nClip = 1000;
			while (nValue > nClip){
				nClip *= 1000;
			}
			nClip /= 1000;

			var nPart = 0;
			var szBreak   = " ";
			while (nClip >= 1000){
				nPart = Math.floor(nValue/nClip);
	//			_TRACE(nPart+"="+nValue+"/"+nClip);
				szReturn += __maptheme_formatpart(nPart,szLeading);
				nValue = nValue%nClip;
				nClip /= 1000;
				if ( nPart ){
					szLeading = "0";
					if (szFlag && szFlag.match(/BLANK/)){
						szBreak   = "&nbsp;";
					}else{
						szBreak   = ".";
					}
				}
				szReturn += szBreak;
			}
		}

		szReturn += __maptheme_formatpart(nValue,szLeading);

		if ( !szReturn.length || (szReturn == "-") ){
			szReturn += "0";
		}

		if ( szDecimals.length && szDecimals != "00" ){
			szReturn += ((szFlag && szFlag.match(/BLANK/))?".":",") + szDecimals;
		}
	}
	return	szReturn;
}
/**
 * helper to format a number from 0 to 999 into a string with leading character (sample 32 -> "032" )
 * @param nPart the number to format
 * @param szLeading the leading character to insert if necessary 
 */
function __maptheme_formatpart(nPart,szLeading){
	if (!szLeading){
		szLeading = "";
	}
	var szPart = "";
	if (nPart<100){
		szPart += szLeading;
	}
	if (nPart<10){
		szPart += szLeading;
	}
	if (nPart==0){
		szPart += szLeading;
	}
	else{
		szPart += String(nPart);
	}
	return szPart;
}


	ixmaps.makeLegendHTML(ixmaps.actualThemeId);

	
  </script>

 </html> 

	