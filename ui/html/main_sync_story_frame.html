<!DOCTYPE HTML>
<html>

<head>
	<meta charset="UTF-8" />
	<title>iXmaps story</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="author" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /> 

	<meta http-equiv="X-UA-Compatible" content="IE=9" />

	<meta name="description" content="Interactive &amp; estensible maps in HTML5"/>
	<meta name="keywords" content="iXMaps,SVG,GIS,map,maps,Karten,chart,charts,pie,bar,web,geo,Visualisierung,visualisation,visualizzazione,interaktiv,interactive,interattivo,SIT,Geo,georeference,georeferenziert,geomarketing,graphical,programming,example,web application,application,web2.0"/>
	<meta name="robots" content="index,follow"/>
	<meta name="page-topic" content="iXMaps presentation wrapper"/>
	<meta name="audience" content="all, Alle"/>
	<meta name="language" content="UK, uk, english, englisch"/>
	<meta name="page-type" content="wrapper"/>
	<meta name="resource-type" content="document"/>
	<meta name="Classification" content="presentation wrapper iXMaps.com"/>

	<link rel="shortcut icon" href="../resources/images/ixmaps_logo.png" />

	<link rel="stylesheet" type="text/css" href="../../ui/libs/jquery/ui/css/ixmaps/jquery-ui-1.8.16.custom.css" />
	<link rel="stylesheet" type="text/css" href="../css/jquery-ui.css" />

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.9.0/css/bootstrap-slider.min.css" />

	<link rel="stylesheet" type="text/css" href="../../ui/css/messagebox.css" />
    
	<!-- Custom styles -->
	<link href="./assets/css/font-awesome.min.css" rel="stylesheet">

	<style type="text/css">
	.disclaimer{
		margin-top:25px;
		margin-left:15px;
		font-size: 11px;
		line-height: 14px;
	}
	.disclaimer a{
		font-size: 11px;
		line-height: 14px;
	}
	ul {
		list-style: circle;
	}
	li {
		padding: 0px 5px 5px 0px;
		margin: 0px;
	}
	#sidebar {
		position:absolute;
		top:4px;
		right:10px;
		width:226px;
		color:#53637D
	}
	#sidebar-title{
		margin-left:12px;
		color:#aaa;
		font-size:2em;
	}
	#sidebar-content{
		margin-top:52px;
	}
	.sidebar-subtitle{
		margin-top:18px;
		margin-left:17px;
		color:#aaa;
	}
	.gradient-in{
		background-image: -webkit-linear-gradient(left, rgba(255,255,255,0.0001) 0%, rgba(255,255,255,1) 30%, rgba(255,255,255,1) 50%);
		background-image: -o-linear-gradient(left, rgba(255,255,255,0.0001) 0%, rgba(255,255,255,1) 30%, rgba(255,255,255,1) 50%);
		background-image: -moz-linear-gradient(left, rgba(255,255,255,0.0001) 0%, rgba(255,255,255,1) 30%, rgba(255,255,255,1) 50%);
		background-image: linear-gradient(left, rgba(255,255,255,0.0001) 0%, rgba(255,255,255,1) 30%, rgba(255,255,255,1) 50%);
	}

	#expandbutton{
		-moz-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		-webkit-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		background: #ffffff url("../resources/images/collapse_left_gray.png") center no-repeat;	
		background-size: 80%;
		border: #ccc solid 1px;
		border-radius:0.3em;
	}
	#collapsbutton{
		-moz-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		-webkit-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		background: #ffffff url("../resources/images/collapse_right_gray.png") center no-repeat;	
		background-size: 80%;
		border: #ccc solid 1px;
		border-radius:0.3em;
	}
	#title {
		font-family:arial;
		color:#666666;
		font-size:1.5em;
		line-height:1em;
		padding: 7px 0.5em 0px 0.5em;
	}
	.title-field{
		position:absolute;
		left:120px;
		top:11px;
		height:32px;
		max-width: 200px;
		display:none;
		z-index:1;
		border: #d8d8d8 solid 1px;
		border-radius:0.2em;
		background: #ffffff;
		opacity: 0.95;
		-moz-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		-webkit-box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		box-shadow: 0px 2px 6px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
		align: center;
	}
	.shadow {
		-webkit-box-shadow: 0px 2px 6px rgba(0,0,0,0.5);
		box-shadow: 0px 2px 6px rgba(0,0,0,0.5);
	}
	
	.hide-story-tool-button {
		font-family: arial,sans;
		position:absolute;
		right:0em;
		top:0.6em;
		margin-right:1em;
		padding:0.5em 0.5em 0 0.5em;
		text-align:center;
		color:#666666;
		background:#ffffff;
		border:#ffffff solid 0.1px;
		border-radius:0px;
		text-decoration:none;
        pointer-events: all;
	}

</style>

</head>


<body style="margin:0;padding:0;background:transparent;overflow:hidden;" >

<!-- Container -->
<div id="container" style="height:100%;width:100%;margin:0px;padding:0px;overflow:hidden;" >

	<!-- panes -->

	<div id="worksspace" style="height:100%;width:100%;margin:0px;padding:0px;overflow:hidden;" >

		<!-- embedded map -->

		<div id="map" style="margin:0px;padding:0px;overflow:hidden;float:left" >
		</div>

		<!-- story -->

		<div id="sidebar" class="gradient-in" style="margin:0px;padding:0px;overflow:hidden;pointer-events:none;float:left" >
			<div id="story-board" style="margin:0px;padding:0px;overflow:hidden;pointer-events:all;">
			</div>
			<div id="story-tool" style="margin:0px;padding:20px 0px 0px 0px;overflow:auto;pointer-events:none;">
			</div>
			<div id="story-frame" style="margin:0px;padding:0px;overflow:auto;pointer-events:all;background:rgba(255,255,255,0.85);">
			</div>
		</div>

		<div id="sidebarnav" style="position:absolute;left:0px;bottom:20px;opacity:0.9;width:100%;text-align:center;display:none" >
			<div>
				<span id="sidebarbuttons" data-toggle="buttons" style="padding:8px 16px 8px 18px;border:solid #ddd 1px;border-radius:2px;background-color:#ffffff;">
					<label class="btn btn-link" onclick="$('.btn').removeClass('active');ixmaps.hideSidebar();">Map
					</label>
					&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
					<label class="btn btn-link" onclick="$('.btn').removeClass('active');ixmaps.showSidebar();">Legend
					</label>
				</span>
				<!--/.nav-collapse -->
			</div>
		</div>
		<!-- buttons -->

		<div id="collaps" style="position:absolute;right:0px;top:12px;opacity:0.9;">
			<button type="button" id="collapsbutton" title="fullscreen mode" style="height:38px;width:37px;display:none;" ></button>
		</div>
		<div id="collapsx" style="position:absolute;right:5px;top:60px;opacity:0.9;">
			<button type="button" id="collapsbuttonx" title="fullscreen mode" style="height:38px;width:37px;display:none;" ></button>
		</div>
		<div id="expand" style="position:absolute;right:8px;top:12px;z-index:1">
			<button type="button" id="expandbutton" title="open sidebar" style="height:38px;width:37px;display:none;" ></button>
		</div>

		<!-- title -->

		<div id="title" class="title-field">
		</div>

	</div>

	<!-- fine Content -->


	<!-- Footer -->
	<!-- fine Footer -->

</div>
<!-- fine Container -->

</body>

<script type="text/javascript" src = "../../ui/libs/jquery/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src = "../../ui/libs/getUrlParam/js/jquery.getUrlParam.js"></script>
<script type="text/javascript" src = "../../ui/libs/jquery/ui/js/jquery-ui-1.8.16.custom.min.js"></script>

<script type="text/javascript" src = "../../ui/libs/messagebox.js"></script>

<script type="text/javascript" src = "../../ui/js/htmlgui_api.js" > </script>
<script type="text/javascript" src = "../../ui/js/htmlgui_story.js" > </script>

<script type="text/javascript" src="../../../data.min.js/data.js"></script>

<script type="text/javascript">


	// -------------------------------------------------------------------
	// initializition on document ready
	//		- wait for the embeded map to load
	//		- hide loading mesage
	//		- display first theme
	// -------------------------------------------------------------------

	// delayed on document ready (see below)
	// -------------------------------------------------------
	ixmaps.onReady = function(){

		if ( !ixmaps.iframe ){
			setTimeout("ixmaps.onReady()",1000);
			return;
		}

        // set opener or parent window

		if ( window.opener ){
			ixmaps.parentApi = window.opener.ixmaps;
			ixmaps.szName = ixmaps.szName || window.opener.name;
		}else
		if ( parent ){
			ixmaps.parentApi = parent.window.ixmaps;
			ixmaps.szName = ixmaps.szName || parent.window.name;
		}

		// register to the parent api
		// in case the parent page holds more than one embedded map,
		// we can sync them if parameter name is given

		if ( ixmaps.parentApi ){
			try{
				//console.log("main_synch_story_frame");
				//ixmaps.parentApi.registerApi(ixmaps,ixmaps.szName||"map",window);
			}catch (e){}
		}

		// then wait for the embedded map 
		//
		ixmaps.iframe.waitForMap(ixmaps.szName||"map", function(){

			if ( ixmaps.fSidebar ){
				$( "#collapsbutton" ).show();
			}
			var szMapType = $(document).getUrlParam('maptype');
			if ( szMapType && (szMapType.match(/dark/i) || szMapType.match(/black/i)) ){
				$( "#collapsbutton" ).css("background-color","#222222");
				$( "#collapsbutton" ).css("border-color","#666666");
				$( "#expandbutton" ).css("background-color","#222222");
				$( "#expandbutton" ).css("border-color","#666666");
			}else{
				$( "#collapsbutton" ).css("background-color","#ffffff");
				$( "#expandbutton" ).css("background-color","#ffffff");
			}
			ixmaps.setStoryUrl($(document).getUrlParam('story'));
			
			// GR 16.11.2016 force emedded map in iframe to resize itself
			// sometimes the map has not been in the right shape if story frame is initially hidden
			//setTimeout('ixmaps.iframe.exec("embed-cross","ixmaps.resizeMap(null,false)" )',1000);
			//ixmaps.iframe.exec("embed-cross","htmlgui_synchronizeSVG()");

			// GR 14.09.2017 load story on map ready
			// -------------------------------------
			var width  = parseInt($("#sidebar").css("width"))-ixmaps.overlap/2;
			var height = parseInt($("#sidebar").css("height"));

			$("#story-board").html("<iframe id='embed-story' style='border:0;margin:0px;width:"+width+"px;height:"+height+"px' />");

			ixmaps.szStoryUrl	= $(document).getUrlParam('story');// || "story.html";

			if ( ixmaps.szStoryUrl && ixmaps.szStoryUrl.length ){
				$("#embed-story").attr("src",ixmaps.szStoryUrl);
			}
		});
	};

	// if story is loaded and initialised
	// call onMapReady() to ensure story is starting even if map has flagged ready before story was ready
	// GR 02.12.2016 BUGFIX
	// --------------------------------------------------------------------------------------------------
	ixmaps.onStoryReady = function(){
		ixmaps.onMapReady();
	};


	// wait for map and make first theme
	// ---------------------------------
	$(document).ready(function() {

		// create the iframe with the embedded map 
		// --------------------------------------------------------

		var szBaseMap	= decodeURIComponent( $(document).getUrlParam('basemap')   ||
											  $(document).getUrlParam('mapservice') );
		var szUrl		= $(document).getUrlParam('svggis');

		var szEmbedUI = "../../ui/dispatch.htm?ui=embed";

		ixmaps.szName = ixmaps.szMap = decodeURIComponent( $(document).getUrlParam('name') || "map" );
		var src = szEmbedUI + "&basemap="	+ szBaseMap 
							+ "&name="		+ ixmaps.szName 
							+ "&svggis="	+ szUrl;
		
		// API
		// --------------------------------------------------------

		if ( $(document).getUrlParam('map') ){
			src += "&map="+decodeURIComponent($(document).getUrlParam('map'));
			}
		if ( $(document).getUrlParam('appid') ){
			src += "&appid="+decodeURIComponent($(document).getUrlParam('appid'));
			}
		if ( $(document).getUrlParam('maptype') ){
			src += "&maptype="+decodeURIComponent($(document).getUrlParam('maptype'));
			}

		if ( $(document).getUrlParam('allcontrols') ){
			src += "&overlaycontrol=1";
			src += "&mapcontrol=1";
			src += "&options=1";
			src += "&reset=1";
		}else{
			if ( $(document).getUrlParam('overlaycontrol') ){
				src += "&overlaycontrol=1";
			}
			if ( $(document).getUrlParam('mapcontrol') ){
				src += "&mapcontrol=1";
			}
			if ( $(document).getUrlParam('tilemap') ){
				src += "&tilemap="+$(document).getUrlParam('tilemap');
			}
			if ( $(document).getUrlParam('mode') ){
				src += "&mode="+$(document).getUrlParam('mode');;
			}
			if ( $(document).getUrlParam('scrollsafe') ){
				src += "&scrollsafe="+$(document).getUrlParam('scrollsafe');;
			}
			if ( $(document).getUrlParam('options') ){
				src += "&options=1";
			}
			if ( $(document).getUrlParam('tools') ){
				src += "&tools=1";
			}
			if ( $(document).getUrlParam('modebutton') ){
				src += "&modebutton=1";
			}
			if ( $(document).getUrlParam('dynamicURL') ){
				src += "&dynamicURL=1";
			}
			if ( $(document).getUrlParam('reset') ){
				src += "&reset=1";
			}
			if ( $(document).getUrlParam('legendcontrol') ){
				src += "&legendcontrol=1";
			}
			if ( $(document).getUrlParam('nolegend') ){
				src += "&nolegend=1";
			}
			if ( $(document).getUrlParam('themelegend') ){
				src += "&themelegend="+$(document).getUrlParam('themelegend');
			}
			if ( $(document).getUrlParam('logo') ){
				src += "&logo=1";
			}
			if ( $(document).getUrlParam('title') ){
				ixmaps.title = $(document).getUrlParam('title');
				src += "&title="+$(document).getUrlParam('title');
			}else{
				//$("#title").remove();
			}
			if ( $(document).getUrlParam('attribution') ){
				src += "&attribution="+$(document).getUrlParam('attribution');
			}
			if ( $(document).getUrlParam('parent') ){
				src += "&parent="+$(document).getUrlParam('parent');
			}
			if ( $(document).getUrlParam('minimal') ){
				src += "&minimal=1";
				if ( $(document).getUrlParam('options') ){
					src += "&toolbutton=1";
				}
				if ( $(document).getUrlParam('toolbutton') ){
					src += "&toolbutton=1";
				}
			}
			if ( $(document).getUrlParam('search') ){
				src += "&search="+$(document).getUrlParam('search');
			}
			if ( $(document).getUrlParam('splitter') ){
				src += "&splitter="+$(document).getUrlParam('splitter');
			}
			if ( $(document).getUrlParam('silent') ){
				src += "&silent="+$(document).getUrlParam('silent');
			}
			if ( $(document).getUrlParam('local') ){
				src += "&local="+$(document).getUrlParam('local');
			}
		}
		if ( $(document).getUrlParam('bookmark') ){
			x = $(document).getUrlParam('bookmark');
			src += "&bookmark="+((typeof(x)!="string")?x.join(""):x);
			}

		if ( $(document).getUrlParam('project') ){
			src += "&project="+$(document).getUrlParam('project');
			}

		if ( $(document).getUrlParam('data') ){
			src += "&project="+$(document).getUrlParam('data');
			}

		$("#map").html("<iframe id='embed-cross' src=\"" + src + "\" " +
					" style='padding:0;margin:0;border:0;background:transparent;overflow:hidden' wmode='transparent'  />");

		ixmaps.setStoryUrl($(document).getUrlParam('story'));

		// format the story board 
		// --------------------------------------------------------

		ixmaps.layout = null;
		ixmaps.layoutHeight = null;
		ixmaps.overlap = 0;

		if ( $(document).getUrlParam('layout') ){
			ixmaps.layout = $(document).getUrlParam('layout');
		}
		if ( $(document).getUrlParam('overlap') ){
			ixmaps.overlap = Number($(document).getUrlParam('overlap'));
		}
		if ( $(document).getUrlParam('sidebarbutton') == 0 ){
			//$( "#expandbutton" ).remove();
			$( "#collapsbutton" ).remove();
		}
		ixmaps.nSidebar = 50; // % !!
		if ( $(document).getUrlParam('sidebar') ){
			var szSidebar = String($(document).getUrlParam('sidebar'));
			ixmaps.nSidebar = parseInt(szSidebar);
			if ( !szSidebar.match(/\%/) ){
				ixmaps.nSidebar	= ixmaps.nSidebar/newWidth*100;
			}
		}
		// GR 20.05.2016 new
		if ( $(document).getUrlParam('shadow') ){
			$("#sidebar").addClass("shadow");
		}

		// GR 29.11.2017 register again with name read by getUrlParam()
		ixmaps.registerMe();

		ixmaps.resize();

		/** GR 14.09.2017 now on map ready 
		var width  = parseInt($("#sidebar").css("width"))-ixmaps.overlap/2;
		var height = parseInt($("#sidebar").css("height"));

		var szStoryUrl	= $(document).getUrlParam('story');// || "story.html";

		ixmaps.storyUrl = szStoryUrl;
		$("#story-board").html("<iframe id='embed-story' src=\"" + szStoryUrl + "\" " +
					" style='border:0;margin:0px;width:"+width+"px;height:"+height+"px' />");
		**/

		$( "#expandbutton" ).button().click(function(e){
							ixmaps.fullScreen();
							});
		$( "#collapsbutton" ).button().click(function(e){
							ixmaps.fullScreen();
							});

		if ( $(document).getUrlParam('fullscreen') ){
			ixmaps.fullScreen();
		}

		ixmaps.onReady();

	});

	// helper for buttons (string not settable in href="" )
	// ----------------------------------------------------
	ixmaps.popout = function() {
		ixmaps.embeddedApi.embeddedApi.popOutMap('window');
		// ixmaps.iframe.exec("embed-cross","ixmaps.embeddedApi.popOutMap('window')");
	};

	ixmaps.mapWidthPx = null;
	ixmaps.mapHeightPx = null;
	ixmaps.containerWidthPx = null;
	ixmaps.sidebarLeftPx = null;
	ixmaps.fSidebar = true;

	ixmaps.showSidebar = function() {

		setTimeout('$("#embed-cross").css("width","'+String(ixmaps.mapWidthPx)+'");',500);
		setTimeout('$("#embed-cross").css("height","'+String(ixmaps.mapHeightPx)+'");',500);

		// $("#sidebar").fadeIn( "slow" );
		$("#sidebar").animate({
			left: '-='+ixmaps.sidebarwidth,
			width: ixmaps.sidebarwidth+'px'
		});

		$("#expand").css("visibility","hidden");
		$("#collaps").css("visibility","visible");

		$("#expandbutton").hide();
		$("#collapsbutton").show();

		ixmaps.mapWidthPx = null;
		ixmaps.containerWidthPx = null;
		ixmaps.sidebarLeftPx = null;

		ixmaps.fSidebar = true;
	};

	ixmaps.hideSidebar = function() {

		ixmaps.containerWidthPx = $("#container").css("width");
		ixmaps.mapWidthPx = $("#embed-cross").css("width");
		ixmaps.mapHeightPx = $("#embed-cross").css("height");
		ixmaps.sidebarLeftPx = $("#sidebar").css("left");

		setTimeout('$("#embed-cross").css("width","'+String(window.innerWidth)+'px");',500);
		setTimeout('$("#embed-cross").css("height","'+String(window.innerHeight)+'px");',500);

		$("#map").css('height',String(window.innerHeight)+'px');
		$("#map").css('width',String(window.innerWidth)+'px');

		//$("#sidebar").fadeOut( "slow" );
		ixmaps.sidebarwidth = $("#sidebar").width();
		$("#sidebar").animate({
			left: '+='+ixmaps.sidebarwidth,
			width: '0px'
		});

		setTimeout('$("#expand").css("visibility","visible")',1000);
		$("#collaps").css("visibility","hidden");

		$("#expandbutton").show();
		$("#collapsbutton").hide();

		ixmaps.fSidebar = false;
	};

	ixmaps.toggleSidebar = function() { 
        if ( !ixmaps.fSidebar ){
			ixmaps.showSidebar();
		}else{
			ixmaps.hideSidebar();
		}
	};

	ixmaps.fullScreen = function() {

		ixmaps.toggleSidebar();

		var szMapType = $(document).getUrlParam('maptype');
		if ( szMapType ){
			if ( (szMapType.match(/dark/i) || szMapType.match(/black/i)) ){
				$( "#collapsbutton" ).css("background-color","#222222");
				$( "#collapsbutton" ).css("border-color","#666666");
				$( "#expandbutton" ).css("background-color","#222222");
				$( "#expandbutton" ).css("border-color","#666666");
			}else{
				$( "#collapsbutton" ).css("background-color","#ffffff");
				$( "#expandbutton" ).css("background-color","#ffffff");
			}
		}
	};

	ixmaps.sidebar = function(fShow) { 
		if ( fShow && !ixmaps.fSidebar ){
			ixmaps.showSidebar();
		}else
		if ( !fShow && ixmaps.fSidebar ){
			ixmaps.hideSidebar();
		}
	};

	ixmaps.reset = function() {
		$("a.action").css("background-color","white");
		$("a.action").css("font-weight","normal");
		ixmaps.iframe.exec("embed-cross","ixmaps.embeddedApi.resetMap()" );
	};

	ixmaps.resize = function() {
		var newWidth  = window.innerWidth;
		var newHeight = window.innerHeight;
		ixmaps.overlap = 0;

		var containerWidth = $("#container").width();
		var sidebarWidth = Math.round(containerWidth/100*ixmaps.nSidebar);
		var sidebarHeight = null;
		var mapWidth = containerWidth-(ixmaps.fSidebar?(sidebarWidth-ixmaps.overlap):0);

		$("#map").css("margin","0px");
		$("#map").css("position","absolute");
		$("#map").css("left","0px");
		$("#map").css("border","0");

		if ( ixmaps.layout && (ixmaps.layout == "vertical") ){

			// magic
			ixmaps.overlap = 0;

			mapWidth = containerWidth;
			sidebarWidth = containerWidth;
			sidebarHeight = 10000;// * 0.25;
			newHeight = newHeight - Math.min(newHeight*0.4,500);
			$("#map").css("margin","0px");
			$("#sidebar").css("margin","0px");
			$("#sidebar").css("position","absolute");
			$("#sidebar").css("top",newHeight+"px");
			$("#sidebar").css("left","0px");
			$("#collaps").hide();
		}else		
		if ( ixmaps.layout && (ixmaps.layout == "minimal") ){

			// magic
			ixmaps.overlap = 0;

			mapWidth = containerWidth;
			sidebarWidth = Math.max(400,containerWidth/3.3);
			sidebarHeight = newHeight * 0.90;
			$("#map").css("margin","0px");

			$("#sidebar").removeClass("gradient-in");
			$("#sidebar").css("margin","0px");
			$("#sidebar").css("position","absolute");
			$("#sidebar").css("top","20px");
			$("#sidebar").css("left",(containerWidth-sidebarWidth-containerWidth*0.02)+"px");
			$("#collaps").hide();
		}else		
		if ( ixmaps.layout && (ixmaps.layout == "inline") ){

			// magic
			ixmaps.overlap = 0;

			mapWidth = containerWidth;
			sidebarWidth = Math.max(400,containerWidth/3.3);
			sidebarHeight = newHeight * 0.90;
			$("#map").css("margin","0px");

			$("#sidebar").removeClass("gradient-in");
			$("#sidebar").css("margin","0px");
			$("#sidebar").css("position","absolute");
			$("#sidebar").css("top","20px");
			$("#sidebar").css("left",(containerWidth-sidebarWidth-containerWidth*0.02)+"px");
			$("#collaps").hide();
		}else		
		if ( ixmaps.layout && (ixmaps.layout == "badge") ){

			// magic
			ixmaps.overlap = 0;

			mapWidth = containerWidth;
			//sidebarWidth = Math.max(400,containerWidth/3.3);
			sidebarHeight = newHeight-25;
			$("#map").css("margin","0px");

			$("#sidebar").removeClass("gradient-in");
			$("#sidebar").css("margin","0px");
			$("#sidebar").css("position","absolute");
			$("#sidebar").css("top","0px");
			$("#sidebar").css("left",(containerWidth-sidebarWidth-sidebarWidth*0.1)+"px");
			$("#collaps").hide();
		}else		
		if ( ixmaps.layout && (ixmaps.layout == "overlay") ){

			// magic
			ixmaps.overlap = 0;

			mapWidth = containerWidth;
			sidebarWidth = (containerWidth>500)?(Math.max((sidebarWidth),350)):containerWidth-5;
			sidebarHeight = newHeight-25;
			$("#map").css("margin","0px");

			$("#sidebar").removeClass("gradient-in");
			$("#sidebar").css("margin","0px");
			$("#sidebar").css("position","absolute");
			$("#sidebar").css("top","0");
			$("#sidebar").css("left",(containerWidth-sidebarWidth)+"px");
			$("#collaps").hide();
		}else		
		if ( ixmaps.layout && (ixmaps.layout == "left") ){

			sidebarWidth = (containerWidth>500)?(Math.max((sidebarWidth-30),350)):containerWidth-5;
			// -1 because we make a boder
			mapWidth = containerWidth-sidebarWidth-1;
			sidebarHeight = newHeight;

			$("#map").css("margin","0px");
			$("#map").css("position","absolute");
			$("#map").css("left",sidebarWidth+"px");
			//$("#map").css("border-left","dotted black 1px");

			$("#sidebar").removeClass("gradient-in");
			$("#sidebar").css("margin","0px");
			$("#sidebar").css("position","absolute");
			$("#sidebar").css("top","0");
			$("#sidebar").css("left","0px");
			$("#collaps").hide();
		}else		
		if ( (newWidth < newHeight*0.8) ){
			mapWidth = containerWidth - 10;
			sidebarWidth = containerWidth - 0;
			sidebarHeight = 10000;
			newHeight *= 1;
			$("#map").css("margin","0px 10px 0px 0px");
			$("#sidebar").css("border-left","dotted black 1px");
			$("#sidebar").css("margin","0px 10px 10px 0px");
			$("#sidebar").css("position","relative");
			$("#sidebar").css("top","");
			$("#sidebar").css("left","");

			$("#collaps").hide();
		}else{		
			$("#map").css("margin","0");
			$("#sidebar").css("margin","0");
			$("#sidebar").css("position","absolute");
			$("#sidebar").css("top","0px");
			$("#sidebar").css("left",String(mapWidth-ixmaps.overlap*2)+"px");
			$("#collaps").show();
		}

		if (ixmaps.overlap == 0){
			$("#sidebar").removeClass("gradient-in");
		}

		if ( ixmaps.layoutHeight ){
			newHeight *= ixmaps.layoutHeight;
		}

		$("#embed-cross").css("width",String(mapWidth)+"px");
		$("#embed-cross").css("height",String(newHeight)+"px");
		$("#map").css("height",String(newHeight)+"px");

		ixmaps.mapWidth = $("#embed-cross").width();
		ixmaps.mapHeight = $("#embed-cross").height();
		ixmaps.containerWidth = $("#container").width();
		ixmaps.containerHeight = $("#container").height();

		$("#sidebar").css("width",String(sidebarWidth+ixmaps.overlap)+"px");
		$("#sidebar").css("height",String(sidebarHeight||ixmaps.mapHeight)+"px");

		$("#story-board").css("margin-left",String(ixmaps.overlap/2)+"px");
		$("#story-board").css("height",String(sidebarHeight||ixmaps.mapHeight)+"px");

		var width  = parseInt($("#sidebar").css("width"));
		var height = parseInt($("#sidebar").css("height"));
		$("#embed-story").css("width",String(width)+"px");
		$("#embed-story").css("height",String(height)+"px");

		$("#collaps").css("right",String(sidebarWidth+ixmaps.overlap/2+8)+"px");

		$("#start-text-div").css("width",ixmaps.mapWidth);	
		
		ixmaps.containerWidthPx = containerWidth;
		ixmaps.mapWidthPx = $("#embed-cross").css("width");
		ixmaps.sidebarLeftPx = $("#sidebar").css("left");
		ixmaps.sidebarWidth = parseInt($("#sidebar").css("width"));

		if ( containerWidth < 600 )	{
			$("#sidebarnav").show();
		}else{
			$("#sidebarnav").hide();
		}
	};

	ixmaps.setTitle = function(szTitle) {
		if ( szTitle && szTitle.length ){
			$("#title").html(szTitle).show();
		}else{
			$("#title").html("").hide();
		}
		var maxWidth = $("#sidebar").css("left");
		$("#title").css("max-width",(parseInt(maxWidth)-300-ixmaps.overlap)+"px");
		$("#title").css("width","");
		$("#title").css("height","");
		$("#title").css("line-height","1em");

	};

	ixmaps.loadMap = function(szMap,szUrl) {
		// go down two frames
		try{
			var szBookmark = ixmaps.embeddedApi.embeddedApi.getBookmarkString(1);
			ixmaps.embeddedApi.embeddedApi.pushBookmark(szBookmark);
		}catch (e){}
		ixmaps.embeddedApi.embeddedApi.HTML_loadSVGMap(szUrl);
	};

	ixmaps.loadSidebar = function(szMap,szStoryUrl,nWidth) {

		var szStoryRoot = ""; 

		// absolute or relative URL 
		// ------------------------
		if ( szStoryUrl.match(/HTTP:\/\//) || szStoryUrl.match(/http:\/\//) || szStoryUrl.match(/\/\//) || szStoryUrl.match(/\//) ) {
			urlA = szStoryUrl.split("/");
			for ( var i=0; i<urlA.length-1; i++){
				szStoryRoot += urlA[i]+"/";
			}
			szStoryUrl = urlA[urlA.length-1];
		}

		ixmaps.storyRoot = szStoryRoot;
		ixmaps.storyUrl = szStoryRoot+szStoryUrl;

		// give time to realize the sidebar
		setTimeout("$('#embed-story').attr('src','"+ixmaps.storyUrl+"')",0);
		setTimeout("ixmaps.setSidebarWidth("+nWidth+")",0);
	};

	ixmaps.setSidebarWidth = function(nWidth) {
		if ( nWidth ){
			ixmaps.nInitSidebar = ixmaps.nSidebar;
			ixmaps.nSidebar = nWidth;
			ixmaps.resize();
		}else{
			ixmaps.nSidebar = ixmaps.nInitSidebar || ixmaps.nSidebar;
			ixmaps.resize();
		}
	};

	ixmaps.setLayout = function(szLayout){
		ixmaps.layout = szLayout;
		ixmaps.resize();
	};

	ixmaps.setLayoutHeight = function(nHeight){
		ixmaps.layoutHeight = nHeight;
		ixmaps.resize();
	};

	$(window).resize(function() {
		ixmaps.resize();
	});

</script>

</html>
